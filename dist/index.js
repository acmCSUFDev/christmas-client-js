"use strict";(()=>{var Y1=Object.create;var ao=Object.defineProperty;var z1=Object.getOwnPropertyDescriptor;var X1=Object.getOwnPropertyNames;var j1=Object.getPrototypeOf,G1=Object.prototype.hasOwnProperty;var ni=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var X=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ki=(t,e)=>{for(var r in e)ao(t,r,{get:e[r],enumerable:!0})},q1=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of X1(e))!G1.call(t,n)&&n!==r&&ao(t,n,{get:()=>e[n],enumerable:!(i=z1(e,n))||i.enumerable});return t};var ve=(t,e,r)=>(r=t!=null?Y1(j1(t)):{},q1(e||!t||!t.__esModule?ao(r,"default",{value:t,enumerable:!0}):r,t));var Vh=X((i_,qh)=>{"use strict";qh.exports=V1;function V1(t,e){for(var r=new Array(arguments.length-1),i=0,n=2,o=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise(function(a,h){r[i]=function(f){if(o)if(o=!1,f)h(f);else{for(var u=new Array(arguments.length-1),c=0;c<u.length;)u[c++]=arguments[c];a.apply(null,u)}};try{t.apply(e||null,r)}catch(l){o&&(o=!1,h(l))}})}});var Zh=X(Kh=>{"use strict";var Zi=Kh;Zi.length=function(e){var r=e.length;if(!r)return 0;for(var i=0;--r%4>1&&e.charAt(r)==="=";)++i;return Math.ceil(e.length*3)/4-i};var Pr=new Array(64),Wh=new Array(123);for(vt=0;vt<64;)Wh[Pr[vt]=vt<26?vt+65:vt<52?vt+71:vt<62?vt-4:vt-59|43]=vt++;var vt;Zi.encode=function(e,r,i){for(var n=null,o=[],s=0,a=0,h;r<i;){var l=e[r++];switch(a){case 0:o[s++]=Pr[l>>2],h=(l&3)<<4,a=1;break;case 1:o[s++]=Pr[h|l>>4],h=(l&15)<<2,a=2;break;case 2:o[s++]=Pr[h|l>>6],o[s++]=Pr[l&63],a=0;break}s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),s=0)}return a&&(o[s++]=Pr[h],o[s++]=61,a===1&&(o[s++]=61)),n?(s&&n.push(String.fromCharCode.apply(String,o.slice(0,s))),n.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var $h="invalid encoding";Zi.decode=function(e,r,i){for(var n=i,o=0,s,a=0;a<e.length;){var h=e.charCodeAt(a++);if(h===61&&o>1)break;if((h=Wh[h])===void 0)throw Error($h);switch(o){case 0:s=h,o=1;break;case 1:r[i++]=s<<2|(h&48)>>4,s=h,o=2;break;case 2:r[i++]=(s&15)<<4|(h&60)>>2,s=h,o=3;break;case 3:r[i++]=(s&3)<<6|h,o=0;break}}if(o===1)throw Error($h);return i-n};Zi.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Jh=X((o_,Hh)=>{"use strict";Hh.exports=Hi;function Hi(){this._listeners={}}Hi.prototype.on=function(e,r,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:i||this}),this};Hi.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===r?i.splice(n,1):++n;return this};Hi.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<r.length;)r[n].fn.apply(r[n++].ctx,i)}return this}});var sf=X((s_,of)=>{"use strict";of.exports=Qh(Qh);function Qh(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),i=r[3]===128;function n(h,l,f){e[0]=h,l[f]=r[0],l[f+1]=r[1],l[f+2]=r[2],l[f+3]=r[3]}function o(h,l,f){e[0]=h,l[f]=r[3],l[f+1]=r[2],l[f+2]=r[1],l[f+3]=r[0]}t.writeFloatLE=i?n:o,t.writeFloatBE=i?o:n;function s(h,l){return r[0]=h[l],r[1]=h[l+1],r[2]=h[l+2],r[3]=h[l+3],e[0]}function a(h,l){return r[3]=h[l],r[2]=h[l+1],r[1]=h[l+2],r[0]=h[l+3],e[0]}t.readFloatLE=i?s:a,t.readFloatBE=i?a:s}():function(){function e(i,n,o,s){var a=n<0?1:0;if(a&&(n=-n),n===0)i(1/n>0?0:2147483648,o,s);else if(isNaN(n))i(2143289344,o,s);else if(n>34028234663852886e22)i((a<<31|2139095040)>>>0,o,s);else if(n<11754943508222875e-54)i((a<<31|Math.round(n/1401298464324817e-60))>>>0,o,s);else{var h=Math.floor(Math.log(n)/Math.LN2),l=Math.round(n*Math.pow(2,-h)*8388608)&8388607;i((a<<31|h+127<<23|l)>>>0,o,s)}}t.writeFloatLE=e.bind(null,ef),t.writeFloatBE=e.bind(null,tf);function r(i,n,o){var s=i(n,o),a=(s>>31)*2+1,h=s>>>23&255,l=s&8388607;return h===255?l?NaN:a*(1/0):h===0?a*1401298464324817e-60*l:a*Math.pow(2,h-150)*(l+8388608)}t.readFloatLE=r.bind(null,rf),t.readFloatBE=r.bind(null,nf)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),i=r[7]===128;function n(h,l,f){e[0]=h,l[f]=r[0],l[f+1]=r[1],l[f+2]=r[2],l[f+3]=r[3],l[f+4]=r[4],l[f+5]=r[5],l[f+6]=r[6],l[f+7]=r[7]}function o(h,l,f){e[0]=h,l[f]=r[7],l[f+1]=r[6],l[f+2]=r[5],l[f+3]=r[4],l[f+4]=r[3],l[f+5]=r[2],l[f+6]=r[1],l[f+7]=r[0]}t.writeDoubleLE=i?n:o,t.writeDoubleBE=i?o:n;function s(h,l){return r[0]=h[l],r[1]=h[l+1],r[2]=h[l+2],r[3]=h[l+3],r[4]=h[l+4],r[5]=h[l+5],r[6]=h[l+6],r[7]=h[l+7],e[0]}function a(h,l){return r[7]=h[l],r[6]=h[l+1],r[5]=h[l+2],r[4]=h[l+3],r[3]=h[l+4],r[2]=h[l+5],r[1]=h[l+6],r[0]=h[l+7],e[0]}t.readDoubleLE=i?s:a,t.readDoubleBE=i?a:s}():function(){function e(i,n,o,s,a,h){var l=s<0?1:0;if(l&&(s=-s),s===0)i(0,a,h+n),i(1/s>0?0:2147483648,a,h+o);else if(isNaN(s))i(0,a,h+n),i(2146959360,a,h+o);else if(s>17976931348623157e292)i(0,a,h+n),i((l<<31|2146435072)>>>0,a,h+o);else{var f;if(s<22250738585072014e-324)f=s/5e-324,i(f>>>0,a,h+n),i((l<<31|f/4294967296)>>>0,a,h+o);else{var u=Math.floor(Math.log(s)/Math.LN2);u===1024&&(u=1023),f=s*Math.pow(2,-u),i(f*4503599627370496>>>0,a,h+n),i((l<<31|u+1023<<20|f*1048576&1048575)>>>0,a,h+o)}}}t.writeDoubleLE=e.bind(null,ef,0,4),t.writeDoubleBE=e.bind(null,tf,4,0);function r(i,n,o,s,a){var h=i(s,a+n),l=i(s,a+o),f=(l>>31)*2+1,u=l>>>20&2047,c=4294967296*(l&1048575)+h;return u===2047?c?NaN:f*(1/0):u===0?f*5e-324*c:f*Math.pow(2,u-1075)*(c+4503599627370496)}t.readDoubleLE=r.bind(null,rf,0,4),t.readDoubleBE=r.bind(null,nf,4,0)}(),t}function ef(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function tf(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=t&255}function rf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function nf(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}});var af=X((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}});var hf=X(lf=>{"use strict";var lo=lf;lo.length=function(e){for(var r=0,i=0,n=0;n<e.length;++n)i=e.charCodeAt(n),i<128?r+=1:i<2048?r+=2:(i&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,r+=4):r+=3;return r};lo.read=function(e,r,i){var n=i-r;if(n<1)return"";for(var o=null,s=[],a=0,h;r<i;)h=e[r++],h<128?s[a++]=h:h>191&&h<224?s[a++]=(h&31)<<6|e[r++]&63:h>239&&h<365?(h=((h&7)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,s[a++]=55296+(h>>10),s[a++]=56320+(h&1023)):s[a++]=(h&15)<<12|(e[r++]&63)<<6|e[r++]&63,a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0);return o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};lo.write=function(e,r,i){for(var n=i,o,s,a=0;a<e.length;++a)o=e.charCodeAt(a),o<128?r[i++]=o:o<2048?(r[i++]=o>>6|192,r[i++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(a+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++a,r[i++]=o>>18|240,r[i++]=o>>12&63|128,r[i++]=o>>6&63|128,r[i++]=o&63|128):(r[i++]=o>>12|224,r[i++]=o>>6&63|128,r[i++]=o&63|128);return i-n}});var uf=X((l_,ff)=>{"use strict";ff.exports=$1;function $1(t,e,r){var i=r||8192,n=i>>>1,o=null,s=i;return function(h){if(h<1||h>n)return t(h);s+h>i&&(o=t(i),s=0);var l=e.call(o,s,s+=h);return s&7&&(s=(s|7)+1),l}}});var df=X((h_,cf)=>{"use strict";cf.exports=$e;var oi=$t();function $e(t,e){this.lo=t>>>0,this.hi=e>>>0}var ur=$e.zero=new $e(0,0);ur.toNumber=function(){return 0};ur.zzEncode=ur.zzDecode=function(){return this};ur.length=function(){return 1};var W1=$e.zeroHash="\0\0\0\0\0\0\0\0";$e.fromNumber=function(e){if(e===0)return ur;var r=e<0;r&&(e=-e);var i=e>>>0,n=(e-i)/4294967296>>>0;return r&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new $e(i,n)};$e.from=function(e){if(typeof e=="number")return $e.fromNumber(e);if(oi.isString(e))if(oi.Long)e=oi.Long.fromString(e);else return $e.fromNumber(parseInt(e,10));return e.low||e.high?new $e(e.low>>>0,e.high>>>0):ur};$e.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,i=~this.hi>>>0;return r||(i=i+1>>>0),-(r+i*4294967296)}return this.lo+this.hi*4294967296};$e.prototype.toLong=function(e){return oi.Long?new oi.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Vt=String.prototype.charCodeAt;$e.fromHash=function(e){return e===W1?ur:new $e((Vt.call(e,0)|Vt.call(e,1)<<8|Vt.call(e,2)<<16|Vt.call(e,3)<<24)>>>0,(Vt.call(e,4)|Vt.call(e,5)<<8|Vt.call(e,6)<<16|Vt.call(e,7)<<24)>>>0)};$e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};$e.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};$e.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};$e.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:i<128?9:10}});var $t=X(ho=>{"use strict";var re=ho;re.asPromise=Vh();re.base64=Zh();re.EventEmitter=Jh();re.float=sf();re.inquire=af();re.utf8=hf();re.pool=uf();re.LongBits=df();re.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);re.global=re.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||ho;re.emptyArray=Object.freeze?Object.freeze([]):[];re.emptyObject=Object.freeze?Object.freeze({}):{};re.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};re.isString=function(e){return typeof e=="string"||e instanceof String};re.isObject=function(e){return e&&typeof e=="object"};re.isset=re.isSet=function(e,r){var i=e[r];return i!=null&&e.hasOwnProperty(r)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};re.Buffer=function(){try{var t=re.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}();re._Buffer_from=null;re._Buffer_allocUnsafe=null;re.newBuffer=function(e){return typeof e=="number"?re.Buffer?re._Buffer_allocUnsafe(e):new re.Array(e):re.Buffer?re._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};re.Array=typeof Uint8Array<"u"?Uint8Array:Array;re.Long=re.global.dcodeIO&&re.global.dcodeIO.Long||re.global.Long||re.inquire("long");re.key2Re=/^true|false|0|1$/;re.key32Re=/^-?(?:0|[1-9][0-9]*)$/;re.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;re.longToHash=function(e){return e?re.LongBits.from(e).toHash():re.LongBits.zeroHash};re.longFromHash=function(e,r){var i=re.LongBits.fromHash(e);return re.Long?re.Long.fromBits(i.lo,i.hi,r):i.toNumber(!!r)};function pf(t,e,r){for(var i=Object.keys(e),n=0;n<i.length;++n)(t[i[n]]===void 0||!r)&&(t[i[n]]=e[i[n]]);return t}re.merge=pf;re.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function mf(t){function e(r,i){if(!(this instanceof e))return new e(r,i);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&pf(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}re.newError=mf;re.ProtocolError=mf("ProtocolError");re.oneOfGetter=function(e){for(var r={},i=0;i<e.length;++i)r[e[i]]=1;return function(){for(var n=Object.keys(this),o=n.length-1;o>-1;--o)if(r[n[o]]===1&&this[n[o]]!==void 0&&this[n[o]]!==null)return n[o]}};re.oneOfSetter=function(e){return function(r){for(var i=0;i<e.length;++i)e[i]!==r&&delete this[e[i]]}};re.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};re._configure=function(){var t=re.Buffer;if(!t){re._Buffer_from=re._Buffer_allocUnsafe=null;return}re._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,i){return new t(r,i)},re._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var xo=X((u_,bf)=>{"use strict";bf.exports=De;var gt=$t(),fo,Ji=gt.LongBits,gf=gt.base64,xf=gt.utf8;function si(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function co(){}function K1(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function De(){this.len=0,this.head=new si(co,0,0),this.tail=this.head,this.states=null}var wf=function(){return gt.Buffer?function(){return(De.create=function(){return new fo})()}:function(){return new De}};De.create=wf();De.alloc=function(e){return new gt.Array(e)};gt.Array!==Array&&(De.alloc=gt.pool(De.alloc,gt.Array.prototype.subarray));De.prototype._push=function(e,r,i){return this.tail=this.tail.next=new si(e,r,i),this.len+=r,this};function po(t,e,r){e[r]=t&255}function Z1(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function mo(t,e){this.len=t,this.next=void 0,this.val=e}mo.prototype=Object.create(si.prototype);mo.prototype.fn=Z1;De.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new mo((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};De.prototype.int32=function(e){return e<0?this._push(go,10,Ji.fromNumber(e)):this.uint32(e)};De.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function go(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}De.prototype.uint64=function(e){var r=Ji.from(e);return this._push(go,r.length(),r)};De.prototype.int64=De.prototype.uint64;De.prototype.sint64=function(e){var r=Ji.from(e).zzEncode();return this._push(go,r.length(),r)};De.prototype.bool=function(e){return this._push(po,1,e?1:0)};function uo(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}De.prototype.fixed32=function(e){return this._push(uo,4,e>>>0)};De.prototype.sfixed32=De.prototype.fixed32;De.prototype.fixed64=function(e){var r=Ji.from(e);return this._push(uo,4,r.lo)._push(uo,4,r.hi)};De.prototype.sfixed64=De.prototype.fixed64;De.prototype.float=function(e){return this._push(gt.float.writeFloatLE,4,e)};De.prototype.double=function(e){return this._push(gt.float.writeDoubleLE,8,e)};var H1=gt.Array.prototype.set?function(e,r,i){r.set(e,i)}:function(e,r,i){for(var n=0;n<e.length;++n)r[i+n]=e[n]};De.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(po,1,0);if(gt.isString(e)){var i=De.alloc(r=gf.length(e));gf.decode(e,i,0),e=i}return this.uint32(r)._push(H1,r,e)};De.prototype.string=function(e){var r=xf.length(e);return r?this.uint32(r)._push(xf.write,r,e):this._push(po,1,0)};De.prototype.fork=function(){return this.states=new K1(this),this.head=this.tail=new si(co,0,0),this.len=0,this};De.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new si(co,0,0),this.len=0),this};De.prototype.ldelim=function(){var e=this.head,r=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=r,this.len+=i),this};De.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,r,i),i+=e.len,e=e.next;return r};De._configure=function(t){fo=t,De.create=wf(),fo._configure()}});var _f=X((c_,vf)=>{"use strict";vf.exports=Dt;var yf=xo();(Dt.prototype=Object.create(yf.prototype)).constructor=Dt;var Wt=$t();function Dt(){yf.call(this)}Dt._configure=function(){Dt.alloc=Wt._Buffer_allocUnsafe,Dt.writeBytesBuffer=Wt.Buffer&&Wt.Buffer.prototype instanceof Uint8Array&&Wt.Buffer.prototype.set.name==="set"?function(e,r,i){r.set(e,i)}:function(e,r,i){if(e.copy)e.copy(r,i,0,e.length);else for(var n=0;n<e.length;)r[i++]=e[n++]}};Dt.prototype.bytes=function(e){Wt.isString(e)&&(e=Wt._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(Dt.writeBytesBuffer,r,e),this};function J1(t,e,r){t.length<40?Wt.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}Dt.prototype.string=function(e){var r=Wt.Buffer.byteLength(e);return this.uint32(r),r&&this._push(J1,r,e),this};Dt._configure()});var yo=X((d_,Sf)=>{"use strict";Sf.exports=Ye;var _t=$t(),bo,kf=_t.LongBits,Q1=_t.utf8;function Mt(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Ye(t){this.buf=t,this.pos=0,this.len=t.length}var Mf=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ye(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ye(e);throw Error("illegal buffer")},Af=function(){return _t.Buffer?function(r){return(Ye.create=function(n){return _t.Buffer.isBuffer(n)?new bo(n):Mf(n)})(r)}:Mf};Ye.create=Af();Ye.prototype._slice=_t.Array.prototype.subarray||_t.Array.prototype.slice;Ye.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Mt(this,10);return e}}();Ye.prototype.int32=function(){return this.uint32()|0};Ye.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function wo(){var t=new kf(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Mt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Mt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}Ye.prototype.bool=function(){return this.uint32()!==0};function Qi(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}Ye.prototype.fixed32=function(){if(this.pos+4>this.len)throw Mt(this,4);return Qi(this.buf,this.pos+=4)};Ye.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Mt(this,4);return Qi(this.buf,this.pos+=4)|0};function Ef(){if(this.pos+8>this.len)throw Mt(this,8);return new kf(Qi(this.buf,this.pos+=4),Qi(this.buf,this.pos+=4))}Ye.prototype.float=function(){if(this.pos+4>this.len)throw Mt(this,4);var e=_t.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ye.prototype.double=function(){if(this.pos+8>this.len)throw Mt(this,4);var e=_t.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ye.prototype.bytes=function(){var e=this.uint32(),r=this.pos,i=this.pos+e;if(i>this.len)throw Mt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(r,i);if(r===i){var n=_t.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,i)};Ye.prototype.string=function(){var e=this.bytes();return Q1.read(e,0,e.length)};Ye.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Mt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Mt(this);while(this.buf[this.pos++]&128);return this};Ye.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};Ye._configure=function(t){bo=t,Ye.create=Af(),bo._configure();var e=_t.Long?"toLong":"toNumber";_t.merge(Ye.prototype,{int64:function(){return wo.call(this)[e](!1)},uint64:function(){return wo.call(this)[e](!0)},sint64:function(){return wo.call(this).zzDecode()[e](!1)},fixed64:function(){return Ef.call(this)[e](!0)},sfixed64:function(){return Ef.call(this)[e](!1)}})}});var Cf=X((p_,Rf)=>{"use strict";Rf.exports=cr;var If=yo();(cr.prototype=Object.create(If.prototype)).constructor=cr;var Df=$t();function cr(t){If.call(this,t)}cr._configure=function(){Df.Buffer&&(cr.prototype._slice=Df.Buffer.prototype.slice)};cr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};cr._configure()});var Bf=X((m_,Pf)=>{"use strict";Pf.exports=ai;var vo=$t();(ai.prototype=Object.create(vo.EventEmitter.prototype)).constructor=ai;function ai(t,e,r){if(typeof t!="function")throw TypeError("rpcImpl must be a function");vo.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!r}ai.prototype.rpcCall=function t(e,r,i,n,o){if(!n)throw TypeError("request must be specified");var s=this;if(!o)return vo.asPromise(t,s,e,r,i,n);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(e,r[s.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(h,l){if(h)return s.emit("error",h,e),o(h);if(l===null){s.end(!0);return}if(!(l instanceof i))try{l=i[s.responseDelimited?"decodeDelimited":"decode"](l)}catch(f){return s.emit("error",f,e),o(f)}return s.emit("data",l,e),o(null,l)})}catch(a){s.emit("error",a,e),setTimeout(function(){o(a)},0);return}};ai.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Lf=X(Tf=>{"use strict";var em=Tf;em.Service=Bf()});var Of=X((x_,Ff)=>{"use strict";Ff.exports={}});var Yf=X(Nf=>{"use strict";var ot=Nf;ot.build="minimal";ot.Writer=xo();ot.BufferWriter=_f();ot.Reader=yo();ot.BufferReader=Cf();ot.util=$t();ot.rpc=Lf();ot.roots=Of();ot.configure=Uf;function Uf(){ot.util._configure(),ot.Writer._configure(ot.BufferWriter),ot.Reader._configure(ot.BufferReader)}Uf()});var Xf=X((b_,zf)=>{"use strict";zf.exports=Yf()});var Wf=X($f=>{"use strict";(function(t){"use strict";if(t.TextEncoder&&t.TextDecoder)return!1;function e(i="utf-8"){if(i!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${i}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(i,n={stream:!1}){if(n.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let o=0,s=i.length,a=[],h=0,l=Math.max(32,s+(s>>1)+7),f=new Uint8Array(l>>3<<3);for(;o<s;){let u=i.charCodeAt(o++);if(u>=55296&&u<=56319){if(o<s){let c=i.charCodeAt(o);(c&64512)===56320&&(++o,u=((u&1023)<<10)+(c&1023)+65536)}if(u>=55296&&u<=56319)continue}if(h+4>f.length){l+=8,l*=1+o/i.length*2,l=l>>3<<3;let c=new Uint8Array(l);c.set(f),f=c}if(u&4294967168)if(!(u&4294965248))f[h++]=u>>6&31|192;else if(!(u&4294901760))f[h++]=u>>12&15|224,f[h++]=u>>6&63|128;else if(!(u&4292870144))f[h++]=u>>18&7|240,f[h++]=u>>12&63|128,f[h++]=u>>6&63|128;else continue;else{f[h++]=u;continue}f[h++]=u&63|128}return f.slice(0,h)};function r(i="utf-8",n={fatal:!1}){if(i!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${i}') is invalid.`);if(n.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(i,n={stream:!1}){if(n.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");let o=new Uint8Array(i),s=0,a=o.length,h=[];for(;s<a;){let l=o[s++];if(l===0)break;if(!(l&128))h.push(l);else if((l&224)===192){let f=o[s++]&63;h.push((l&31)<<6|f)}else if((l&240)===224){let f=o[s++]&63,u=o[s++]&63;h.push((l&31)<<12|f<<6|u)}else if((l&248)===240){let f=o[s++]&63,u=o[s++]&63,c=o[s++]&63,d=(l&7)<<18|f<<12|u<<6|c;d>65535&&(d-=65536,h.push(d>>>10&1023|55296),d=56320|d&1023),h.push(d)}}return String.fromCharCode.apply(null,h)},t.TextEncoder=e,t.TextDecoder=r})(typeof window<"u"?window:typeof self<"u"?self:$f)});var Kf=X(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.encode=Br.decode=void 0;Wf();function sm(t,e="utf8"){return new TextDecoder(e).decode(t)}Br.decode=sm;var am=new TextEncoder;function lm(t){return am.encode(t)}Br.encode=lm});var Tr=X(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.IOBuffer=void 0;var Eo=Kf(),hm=1024*8,fm=(()=>{let t=new Uint8Array(4),e=new Uint32Array(t.buffer);return!((e[0]=1)&t[0])})(),ko={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array},Ao=class t{constructor(e=hm,r={}){let i=!1;typeof e=="number"?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);let n=r.offset?r.offset>>>0:0,o=e.byteLength-n,s=n;(ArrayBuffer.isView(e)||e instanceof t)&&(e.byteLength!==e.buffer.byteLength&&(s=e.byteOffset+n),e=e.buffer),i?this.lastWrittenByte=o:this.lastWrittenByte=0,this.buffer=e,this.length=o,this.byteLength=o,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,o),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){let i=(this.offset+e)*2,n=new Uint8Array(i);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,r){let i=ko[r].BYTES_PER_ELEMENT*e,n=this.byteOffset+this.offset,o=this.buffer.slice(n,n+i);if(this.littleEndian===fm&&r!=="uint8"&&r!=="int8"){let a=new Uint8Array(this.buffer.slice(n,n+i));a.reverse();let h=new ko[r](a.buffer);return this.offset+=i,h.reverse(),h}let s=new ko[r](o);return this.offset+=i,s}readInt16(){let e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){let e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){let e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){let e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){let e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){let e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){let e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){let e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let r="";for(let i=0;i<e;i++)r+=this.readChar();return r}readUtf8(e=1){return(0,Eo.decode)(this.readBytes(e))}decodeText(e=1,r="utf-8"){return(0,Eo.decode)(this.readBytes(e),r)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let r=0;r<e.length;r++)this._data.setUint8(this.offset++,e[r]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));return this}writeUtf8(e){return this.writeBytes((0,Eo.encode)(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};rn.IOBuffer=Ao});var Hf=X((U_,Zf)=>{"use strict";Zf.exports={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}}});var tu=X((N_,eu)=>{"use strict";var{IOBuffer:Jf}=Tr(),So=Hf(),Qf=[];for(let t=0;t<=8;t++)Qf.push(255<<t);var Do=class extends Jf{constructor(e){if(e.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!e.height||!e.width)throw new Error("ImageData width and height are required");super(e.data),this.width=e.width,this.height=e.height,this.bitDepth=e.bitDepth,this.channels=e.channels,this.components=e.components}encode(){this.encoded=new Jf,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();let e=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(e),this.encoded.toArray()}writePixelArray(){let e=this.encoded,r=Math.floor((this.bitDepth*this.width+31)/32)*4,i=Math.ceil(this.bitDepth*this.width/8),n=r-i,o=this.bitDepth*this.width%8,s=o===0?0:8-o,a=r*this.height,h,l,f=0,u=0,c=8;e.mark(),l=this.readUint8();for(let d=this.height-1;d>=0;d--){let p=d===0;e.reset(),e.skip(d*r);for(let g=0;g<i;g++){let x=g===i-1;u<=s&&x?(e.writeByte(l<<u),(s===0||s===u)&&!p&&(h=l,l=this.readByte())):u===0?(h=l,l=this.readUint8(),e.writeByte(h)):(h=l,l=this.readUint8(),e.writeByte(h<<u&Qf[u]|l>>c)),x&&(f+=o||0,e.skip(n),u=f%8,c=8-u)}}r>i&&(e.reset(),e.skip(a-1),e.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(e){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(e)}writeBitmapV5Header(){let r=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(So.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(r).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(So.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(So.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}};eu.exports=Do});var iu=X(ru=>{"use strict";var um=tu();ru.encode=function(e){return new um(e).encode()}});var L0=X((lM,wn)=>{var T0=T0||function(t){return Buffer.from(t).toString("base64")};function fw(t){var e=this,r=Math.round,i=Math.floor,n=new Array(64),o=new Array(64),s=new Array(64),a=new Array(64),h,l,f,u,c=new Array(65535),d=new Array(65535),p=new Array(64),g=new Array(64),x=[],m=0,w=7,y=new Array(64),M=new Array(64),_=new Array(64),R=new Array(256),E=new Array(2048),A,I=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],b=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],B=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],S=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],j=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],L=[0,1,2,3,4,5,6,7,8,9,10,11],G=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],H=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Q(T){for(var ee=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ie=0;ie<64;ie++){var U=i((ee[ie]*T+50)/100);U<1?U=1:U>255&&(U=255),n[I[ie]]=U}for(var me=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ge=0;ge<64;ge++){var _e=i((me[ge]*T+50)/100);_e<1?_e=1:_e>255&&(_e=255),o[I[ge]]=_e}for(var ye=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Te=0,Re=0;Re<8;Re++)for(var N=0;N<8;N++)s[Te]=1/(n[I[Te]]*ye[Re]*ye[N]*8),a[Te]=1/(o[I[Te]]*ye[Re]*ye[N]*8),Te++}function te(T,ee){for(var ie=0,U=0,me=new Array,ge=1;ge<=16;ge++){for(var _e=1;_e<=T[ge];_e++)me[ee[U]]=[],me[ee[U]][0]=ie,me[ee[U]][1]=ge,U++,ie++;ie*=2}return me}function he(){h=te(b,k),l=te(j,L),f=te(B,S),u=te(G,H)}function ae(){for(var T=1,ee=2,ie=1;ie<=15;ie++){for(var U=T;U<ee;U++)d[32767+U]=ie,c[32767+U]=[],c[32767+U][1]=ie,c[32767+U][0]=U;for(var me=-(ee-1);me<=-T;me++)d[32767+me]=ie,c[32767+me]=[],c[32767+me][1]=ie,c[32767+me][0]=ee-1+me;T<<=1,ee<<=1}}function ne(){for(var T=0;T<256;T++)E[T]=19595*T,E[T+256>>0]=38470*T,E[T+512>>0]=7471*T+32768,E[T+768>>0]=-11059*T,E[T+1024>>0]=-21709*T,E[T+1280>>0]=32768*T+8421375,E[T+1536>>0]=-27439*T,E[T+1792>>0]=-5329*T}function Y(T){for(var ee=T[0],ie=T[1]-1;ie>=0;)ee&1<<ie&&(m|=1<<w),ie--,w--,w<0&&(m==255?(P(255),P(0)):P(m),w=7,m=0)}function P(T){x.push(T)}function q(T){P(T>>8&255),P(T&255)}function se(T,ee){var ie,U,me,ge,_e,ye,Te,Re,N=0,Z,ce=8,Ce=64;for(Z=0;Z<ce;++Z){ie=T[N],U=T[N+1],me=T[N+2],ge=T[N+3],_e=T[N+4],ye=T[N+5],Te=T[N+6],Re=T[N+7];var xe=ie+Re,be=ie-Re,Ae=U+Te,pe=U-Te,Se=me+ye,je=me-ye,Pe=ge+_e,Je=ge-_e,mt=xe+Pe,At=xe-Pe,Ft=Ae+Se,Gt=Ae-Se;T[N]=mt+Ft,T[N+4]=mt-Ft;var fr=(Gt+At)*.707106781;T[N+2]=At+fr,T[N+6]=At-fr,mt=Je+je,Ft=je+pe,Gt=pe+be;var v=(mt-Gt)*.382683433,D=.5411961*mt+v,C=1.306562965*Gt+v,O=Ft*.707106781,$=be+O,K=be-O;T[N+5]=K+D,T[N+3]=K-D,T[N+1]=$+C,T[N+7]=$-C,N+=8}for(N=0,Z=0;Z<ce;++Z){ie=T[N],U=T[N+8],me=T[N+16],ge=T[N+24],_e=T[N+32],ye=T[N+40],Te=T[N+48],Re=T[N+56];var Ne=ie+Re,Be=ie-Re,Ge=U+Te,Qe=U-Te,ii=me+ye,Ze=me-ye,Ot=ge+_e,ut=ge-_e,ct=Ne+Ot,et=Ne-Ot,Ut=Ge+ii,qt=Ge-ii;T[N]=ct+Ut,T[N+32]=ct-Ut;var St=(qt+et)*.707106781;T[N+16]=et+St,T[N+48]=et-St,ct=ut+Ze,Ut=Ze+Qe,qt=Qe+Be;var $i=(ct-qt)*.382683433,Yh=.5411961*ct+$i,zh=1.306562965*qt+$i,Xh=Ut*.707106781,jh=Be+Xh,Gh=Be-Xh;T[N+40]=Gh+Yh,T[N+24]=Gh-Yh,T[N+8]=jh+zh,T[N+56]=jh-zh,N++}var Wi;for(Z=0;Z<Ce;++Z)Wi=T[Z]*ee[Z],p[Z]=Wi>0?Wi+.5|0:Wi-.5|0;return p}function J(){q(65504),q(16),P(74),P(70),P(73),P(70),P(0),P(1),P(1),P(0),q(1),q(1),P(0),P(0)}function fe(T){if(T){q(65505),T[0]===69&&T[1]===120&&T[2]===105&&T[3]===102?q(T.length+2):(q(T.length+5+2),P(69),P(120),P(105),P(102),P(0));for(var ee=0;ee<T.length;ee++)P(T[ee])}}function ue(T,ee){q(65472),q(17),P(8),q(ee),q(T),P(3),P(1),P(17),P(0),P(2),P(17),P(1),P(3),P(17),P(1)}function oe(){q(65499),q(132),P(0);for(var T=0;T<64;T++)P(n[T]);P(1);for(var ee=0;ee<64;ee++)P(o[ee])}function V(){q(65476),q(418),P(0);for(var T=0;T<16;T++)P(b[T+1]);for(var ee=0;ee<=11;ee++)P(k[ee]);P(16);for(var ie=0;ie<16;ie++)P(B[ie+1]);for(var U=0;U<=161;U++)P(S[U]);P(1);for(var me=0;me<16;me++)P(j[me+1]);for(var ge=0;ge<=11;ge++)P(L[ge]);P(17);for(var _e=0;_e<16;_e++)P(G[_e+1]);for(var ye=0;ye<=161;ye++)P(H[ye])}function z(T){typeof T>"u"||T.constructor!==Array||T.forEach(ee=>{if(typeof ee=="string"){q(65534);var ie=ee.length;q(ie+2);var U;for(U=0;U<ie;U++)P(ee.charCodeAt(U))}})}function Ee(){q(65498),q(12),P(3),P(1),P(0),P(2),P(17),P(3),P(17),P(0),P(63),P(0)}function le(T,ee,ie,U,me){for(var ge=me[0],_e=me[240],ye,Te=16,Re=63,N=64,Z=se(T,ee),ce=0;ce<N;++ce)g[I[ce]]=Z[ce];var Ce=g[0]-ie;ie=g[0],Ce==0?Y(U[0]):(ye=32767+Ce,Y(U[d[ye]]),Y(c[ye]));for(var xe=63;xe>0&&g[xe]==0;xe--);if(xe==0)return Y(ge),ie;for(var be=1,Ae;be<=xe;){for(var pe=be;g[be]==0&&be<=xe;++be);var Se=be-pe;if(Se>=Te){Ae=Se>>4;for(var je=1;je<=Ae;++je)Y(_e);Se=Se&15}ye=32767+g[be],Y(me[(Se<<4)+d[ye]]),Y(c[ye]),be++}return xe!=Re&&Y(ge),ie}function de(){for(var T=String.fromCharCode,ee=0;ee<256;ee++)R[ee]=T(ee)}this.encode=function(T,ee){var ie=new Date().getTime();ee&&ze(ee),x=new Array,m=0,w=7,q(65496),J(),z(T.comments),fe(T.exifBuffer),oe(),ue(T.width,T.height),V(),Ee();var U=0,me=0,ge=0;m=0,w=7,this.encode.displayName="_encode_";for(var _e=T.data,ye=T.width,Te=T.height,Re=ye*4,N=ye*3,Z,ce=0,Ce,xe,be,Ae,pe,Se,je,Pe;ce<Te;){for(Z=0;Z<Re;){for(Ae=Re*ce+Z,pe=Ae,Se=-1,je=0,Pe=0;Pe<64;Pe++)je=Pe>>3,Se=(Pe&7)*4,pe=Ae+je*Re+Se,ce+je>=Te&&(pe-=Re*(ce+1+je-Te)),Z+Se>=Re&&(pe-=Z+Se-Re+4),Ce=_e[pe++],xe=_e[pe++],be=_e[pe++],y[Pe]=(E[Ce]+E[xe+256>>0]+E[be+512>>0]>>16)-128,M[Pe]=(E[Ce+768>>0]+E[xe+1024>>0]+E[be+1280>>0]>>16)-128,_[Pe]=(E[Ce+1280>>0]+E[xe+1536>>0]+E[be+1792>>0]>>16)-128;U=le(y,s,U,h,f),me=le(M,a,me,l,u),ge=le(_,a,ge,l,u),Z+=32}ce+=8}if(w>=0){var Je=[];Je[1]=w+1,Je[0]=(1<<w+1)-1,Y(Je)}if(q(65497),typeof wn>"u")return new Uint8Array(x);return Buffer.from(x);var mt,At};function ze(T){if(T<=0&&(T=1),T>100&&(T=100),A!=T){var ee=0;T<50?ee=Math.floor(5e3/T):ee=Math.floor(200-T*2),Q(ee),A=T}}function Ve(){var T=new Date().getTime();t||(t=50),de(),he(),ae(),ne(),ze(t);var ee=new Date().getTime()-T}Ve()}typeof wn<"u"?wn.exports=B0:typeof window<"u"&&(window["jpeg-js"]=window["jpeg-js"]||{},window["jpeg-js"].encode=B0);function B0(t,e){typeof e>"u"&&(e=50);var r=new fw(e),i=r.encode(t,e);return{data:i,width:t.width,height:t.height}}});var O0=X((hM,as)=>{var ss=function(){"use strict";var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,i=799,n=3406,o=2276,s=1567,a=3784,h=5793,l=2896;function f(){}function u(w,y){for(var M=0,_=[],R,E,A=16;A>0&&!w[A-1];)A--;_.push({children:[],index:0});var I=_[0],b;for(R=0;R<A;R++){for(E=0;E<w[R];E++){for(I=_.pop(),I.children[I.index]=y[M];I.index>0;){if(_.length===0)throw new Error("Could not recreate Huffman Table");I=_.pop()}for(I.index++,_.push(I);_.length<=R;)_.push(b={children:[],index:0}),I.children[I.index]=b.children,I=b;M++}R+1<A&&(_.push(b={children:[],index:0}),I.children[I.index]=b.children,I=b)}return _[0].children}function c(w,y,M,_,R,E,A,I,b,k){var B=M.precision,S=M.samplesPerLine,j=M.scanLines,L=M.mcusPerLine,G=M.progressive,H=M.maxH,Q=M.maxV,te=y,he=0,ae=0;function ne(){if(ae>0)return ae--,he>>ae&1;if(he=w[y++],he==255){var N=w[y++];if(N)throw new Error("unexpected marker: "+(he<<8|N).toString(16))}return ae=7,he>>>7}function Y(N){for(var Z=N,ce;(ce=ne())!==null;){if(Z=Z[ce],typeof Z=="number")return Z;if(typeof Z!="object")throw new Error("invalid huffman sequence")}return null}function P(N){for(var Z=0;N>0;){var ce=ne();if(ce===null)return;Z=Z<<1|ce,N--}return Z}function q(N){var Z=P(N);return Z>=1<<N-1?Z:Z+(-1<<N)+1}function se(N,Z){var ce=Y(N.huffmanTableDC),Ce=ce===0?0:q(ce);Z[0]=N.pred+=Ce;for(var xe=1;xe<64;){var be=Y(N.huffmanTableAC),Ae=be&15,pe=be>>4;if(Ae===0){if(pe<15)break;xe+=16;continue}xe+=pe;var Se=e[xe];Z[Se]=q(Ae),xe++}}function J(N,Z){var ce=Y(N.huffmanTableDC),Ce=ce===0?0:q(ce)<<b;Z[0]=N.pred+=Ce}function fe(N,Z){Z[0]|=ne()<<b}var ue=0;function oe(N,Z){if(ue>0){ue--;return}for(var ce=E,Ce=A;ce<=Ce;){var xe=Y(N.huffmanTableAC),be=xe&15,Ae=xe>>4;if(be===0){if(Ae<15){ue=P(Ae)+(1<<Ae)-1;break}ce+=16;continue}ce+=Ae;var pe=e[ce];Z[pe]=q(be)*(1<<b),ce++}}var V=0,z;function Ee(N,Z){for(var ce=E,Ce=A,xe=0;ce<=Ce;){var be=e[ce],Ae=Z[be]<0?-1:1;switch(V){case 0:var pe=Y(N.huffmanTableAC),Se=pe&15,xe=pe>>4;if(Se===0)xe<15?(ue=P(xe)+(1<<xe),V=4):(xe=16,V=1);else{if(Se!==1)throw new Error("invalid ACn encoding");z=q(Se),V=xe?2:3}continue;case 1:case 2:Z[be]?Z[be]+=(ne()<<b)*Ae:(xe--,xe===0&&(V=V==2?3:0));break;case 3:Z[be]?Z[be]+=(ne()<<b)*Ae:(Z[be]=z<<b,V=0);break;case 4:Z[be]&&(Z[be]+=(ne()<<b)*Ae);break}ce++}V===4&&(ue--,ue===0&&(V=0))}function le(N,Z,ce,Ce,xe){var be=ce/L|0,Ae=ce%L,pe=be*N.v+Ce,Se=Ae*N.h+xe;N.blocks[pe]===void 0&&k.tolerantDecoding||Z(N,N.blocks[pe][Se])}function de(N,Z,ce){var Ce=ce/N.blocksPerLine|0,xe=ce%N.blocksPerLine;N.blocks[Ce]===void 0&&k.tolerantDecoding||Z(N,N.blocks[Ce][xe])}var ze=_.length,Ve,T,ee,ie,U,me;G?E===0?me=I===0?J:fe:me=I===0?oe:Ee:me=se;var ge=0,_e,ye;ze==1?ye=_[0].blocksPerLine*_[0].blocksPerColumn:ye=L*M.mcusPerColumn,R||(R=ye);for(var Te,Re;ge<ye;){for(T=0;T<ze;T++)_[T].pred=0;if(ue=0,ze==1)for(Ve=_[0],U=0;U<R;U++)de(Ve,me,ge),ge++;else for(U=0;U<R;U++){for(T=0;T<ze;T++)for(Ve=_[T],Te=Ve.h,Re=Ve.v,ee=0;ee<Re;ee++)for(ie=0;ie<Te;ie++)le(Ve,me,ge,ee,ie);if(ge++,ge===ye)break}if(ge===ye)do{if(w[y]===255&&w[y+1]!==0)break;y+=1}while(y<w.length-2);if(ae=0,_e=w[y]<<8|w[y+1],_e<65280)throw new Error("marker was not found");if(_e>=65488&&_e<=65495)y+=2;else break}return y-te}function d(w,y){var M=[],_=y.blocksPerLine,R=y.blocksPerColumn,E=_<<3,A=new Int32Array(64),I=new Uint8Array(64);function b(te,he,ae){var ne=y.quantizationTable,Y,P,q,se,J,fe,ue,oe,V,z=ae,Ee;for(Ee=0;Ee<64;Ee++)z[Ee]=te[Ee]*ne[Ee];for(Ee=0;Ee<8;++Ee){var le=8*Ee;if(z[1+le]==0&&z[2+le]==0&&z[3+le]==0&&z[4+le]==0&&z[5+le]==0&&z[6+le]==0&&z[7+le]==0){V=h*z[0+le]+512>>10,z[0+le]=V,z[1+le]=V,z[2+le]=V,z[3+le]=V,z[4+le]=V,z[5+le]=V,z[6+le]=V,z[7+le]=V;continue}Y=h*z[0+le]+128>>8,P=h*z[4+le]+128>>8,q=z[2+le],se=z[6+le],J=l*(z[1+le]-z[7+le])+128>>8,oe=l*(z[1+le]+z[7+le])+128>>8,fe=z[3+le]<<4,ue=z[5+le]<<4,V=Y-P+1>>1,Y=Y+P+1>>1,P=V,V=q*a+se*s+128>>8,q=q*s-se*a+128>>8,se=V,V=J-ue+1>>1,J=J+ue+1>>1,ue=V,V=oe+fe+1>>1,fe=oe-fe+1>>1,oe=V,V=Y-se+1>>1,Y=Y+se+1>>1,se=V,V=P-q+1>>1,P=P+q+1>>1,q=V,V=J*o+oe*n+2048>>12,J=J*n-oe*o+2048>>12,oe=V,V=fe*i+ue*r+2048>>12,fe=fe*r-ue*i+2048>>12,ue=V,z[0+le]=Y+oe,z[7+le]=Y-oe,z[1+le]=P+ue,z[6+le]=P-ue,z[2+le]=q+fe,z[5+le]=q-fe,z[3+le]=se+J,z[4+le]=se-J}for(Ee=0;Ee<8;++Ee){var de=Ee;if(z[8+de]==0&&z[16+de]==0&&z[24+de]==0&&z[32+de]==0&&z[40+de]==0&&z[48+de]==0&&z[56+de]==0){V=h*ae[Ee+0]+8192>>14,z[0+de]=V,z[8+de]=V,z[16+de]=V,z[24+de]=V,z[32+de]=V,z[40+de]=V,z[48+de]=V,z[56+de]=V;continue}Y=h*z[0+de]+2048>>12,P=h*z[32+de]+2048>>12,q=z[16+de],se=z[48+de],J=l*(z[8+de]-z[56+de])+2048>>12,oe=l*(z[8+de]+z[56+de])+2048>>12,fe=z[24+de],ue=z[40+de],V=Y-P+1>>1,Y=Y+P+1>>1,P=V,V=q*a+se*s+2048>>12,q=q*s-se*a+2048>>12,se=V,V=J-ue+1>>1,J=J+ue+1>>1,ue=V,V=oe+fe+1>>1,fe=oe-fe+1>>1,oe=V,V=Y-se+1>>1,Y=Y+se+1>>1,se=V,V=P-q+1>>1,P=P+q+1>>1,q=V,V=J*o+oe*n+2048>>12,J=J*n-oe*o+2048>>12,oe=V,V=fe*i+ue*r+2048>>12,fe=fe*r-ue*i+2048>>12,ue=V,z[0+de]=Y+oe,z[56+de]=Y-oe,z[8+de]=P+ue,z[48+de]=P-ue,z[16+de]=q+fe,z[40+de]=q-fe,z[24+de]=se+J,z[32+de]=se-J}for(Ee=0;Ee<64;++Ee){var ze=128+(z[Ee]+8>>4);he[Ee]=ze<0?0:ze>255?255:ze}}m(E*R*8);for(var k,B,S=0;S<R;S++){var j=S<<3;for(k=0;k<8;k++)M.push(new Uint8Array(E));for(var L=0;L<_;L++){b(y.blocks[S][L],I,A);var G=0,H=L<<3;for(B=0;B<8;B++){var Q=M[j+B];for(k=0;k<8;k++)Q[H+k]=I[G++]}}}return M}function p(w){return w<0?0:w>255?255:w}f.prototype={load:function(y){var M=new XMLHttpRequest;M.open("GET",y,!0),M.responseType="arraybuffer",M.onload=function(){var _=new Uint8Array(M.response||M.mozResponseArrayBuffer);this.parse(_),this.onload&&this.onload()}.bind(this),M.send(null)},parse:function(y){var M=this.opts.maxResolutionInMP*1e3*1e3,_=0,R=y.length;function E(){var pe=y[_]<<8|y[_+1];return _+=2,pe}function A(){var pe=E(),Se=y.subarray(_,_+pe-2);return _+=Se.length,Se}function I(pe){var Se=1,je=1,Pe,Je;for(Je in pe.components)pe.components.hasOwnProperty(Je)&&(Pe=pe.components[Je],Se<Pe.h&&(Se=Pe.h),je<Pe.v&&(je=Pe.v));var mt=Math.ceil(pe.samplesPerLine/8/Se),At=Math.ceil(pe.scanLines/8/je);for(Je in pe.components)if(pe.components.hasOwnProperty(Je)){Pe=pe.components[Je];var Ft=Math.ceil(Math.ceil(pe.samplesPerLine/8)*Pe.h/Se),Gt=Math.ceil(Math.ceil(pe.scanLines/8)*Pe.v/je),fr=mt*Pe.h,v=At*Pe.v,D=v*fr,C=[];m(D*256);for(var O=0;O<v;O++){for(var $=[],K=0;K<fr;K++)$.push(new Int32Array(64));C.push($)}Pe.blocksPerLine=Ft,Pe.blocksPerColumn=Gt,Pe.blocks=C}pe.maxH=Se,pe.maxV=je,pe.mcusPerLine=mt,pe.mcusPerColumn=At}var b=null,k=null,B=null,S,j,L=[],G=[],H=[],Q=[],te=E(),he=-1;if(this.comments=[],te!=65496)throw new Error("SOI not found");for(te=E();te!=65497;){var ae,ne,Y;switch(te){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var P=A();if(te===65534){var q=String.fromCharCode.apply(null,P);this.comments.push(q)}te===65504&&P[0]===74&&P[1]===70&&P[2]===73&&P[3]===70&&P[4]===0&&(b={version:{major:P[5],minor:P[6]},densityUnits:P[7],xDensity:P[8]<<8|P[9],yDensity:P[10]<<8|P[11],thumbWidth:P[12],thumbHeight:P[13],thumbData:P.subarray(14,14+3*P[12]*P[13])}),te===65505&&P[0]===69&&P[1]===120&&P[2]===105&&P[3]===102&&P[4]===0&&(this.exifBuffer=P.subarray(5,P.length)),te===65518&&P[0]===65&&P[1]===100&&P[2]===111&&P[3]===98&&P[4]===101&&P[5]===0&&(k={version:P[6],flags0:P[7]<<8|P[8],flags1:P[9]<<8|P[10],transformCode:P[11]});break;case 65499:for(var se=E(),J=se+_-2;_<J;){var fe=y[_++];m(256);var ue=new Int32Array(64);if(fe>>4)if(fe>>4===1)for(ne=0;ne<64;ne++){var oe=e[ne];ue[oe]=E()}else throw new Error("DQT: invalid table spec");else for(ne=0;ne<64;ne++){var oe=e[ne];ue[oe]=y[_++]}L[fe&15]=ue}break;case 65472:case 65473:case 65474:E(),S={},S.extended=te===65473,S.progressive=te===65474,S.precision=y[_++],S.scanLines=E(),S.samplesPerLine=E(),S.components={},S.componentsOrder=[];var V=S.scanLines*S.samplesPerLine;if(V>M){var z=Math.ceil((V-M)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${z}MP`)}var Ee=y[_++],le,de=0,ze=0;for(ae=0;ae<Ee;ae++){le=y[_];var Ve=y[_+1]>>4,T=y[_+1]&15,ee=y[_+2];if(Ve<=0||T<=0)throw new Error("Invalid sampling factor, expected values above 0");S.componentsOrder.push(le),S.components[le]={h:Ve,v:T,quantizationIdx:ee},_+=3}I(S),G.push(S);break;case 65476:var ie=E();for(ae=2;ae<ie;){var U=y[_++],me=new Uint8Array(16),ge=0;for(ne=0;ne<16;ne++,_++)ge+=me[ne]=y[_];m(16+ge);var _e=new Uint8Array(ge);for(ne=0;ne<ge;ne++,_++)_e[ne]=y[_];ae+=17+ge,(U>>4?H:Q)[U&15]=u(me,_e)}break;case 65501:E(),j=E();break;case 65500:E(),E();break;case 65498:var ye=E(),Te=y[_++],Re=[],N;for(ae=0;ae<Te;ae++){N=S.components[y[_++]];var Z=y[_++];N.huffmanTableDC=Q[Z>>4],N.huffmanTableAC=H[Z&15],Re.push(N)}var ce=y[_++],Ce=y[_++],xe=y[_++],be=c(y,_,S,Re,j,ce,Ce,xe>>4,xe&15,this.opts);_+=be;break;case 65535:y[_]!==255&&_--;break;default:if(y[_-3]==255&&y[_-2]>=192&&y[_-2]<=254){_-=3;break}else if(te===224||te==225){if(he!==-1)throw new Error(`first unknown JPEG marker at offset ${he.toString(16)}, second unknown JPEG marker ${te.toString(16)} at offset ${(_-1).toString(16)}`);he=_-1;let pe=E();if(y[_+pe-2]===255){_+=pe-2;break}}throw new Error("unknown JPEG marker "+te.toString(16))}te=E()}if(G.length!=1)throw new Error("only single frame JPEGs supported");for(var ae=0;ae<G.length;ae++){var Ae=G[ae].components;for(var ne in Ae)Ae[ne].quantizationTable=L[Ae[ne].quantizationIdx],delete Ae[ne].quantizationIdx}this.width=S.samplesPerLine,this.height=S.scanLines,this.jfif=b,this.adobe=k,this.components=[];for(var ae=0;ae<S.componentsOrder.length;ae++){var N=S.components[S.componentsOrder[ae]];this.components.push({lines:d(S,N),scaleX:N.h/S.maxH,scaleY:N.v/S.maxV})}},getData:function(y,M){var _=this.width/y,R=this.height/M,E,A,I,b,k,B,S,j,L,G,H=0,Q,te,he,ae,ne,Y,P,q,se,J,fe,ue=y*M*this.components.length;m(ue);var oe=new Uint8Array(ue);switch(this.components.length){case 1:for(E=this.components[0],G=0;G<M;G++)for(k=E.lines[0|G*E.scaleY*R],L=0;L<y;L++)Q=k[0|L*E.scaleX*_],oe[H++]=Q;break;case 2:for(E=this.components[0],A=this.components[1],G=0;G<M;G++)for(k=E.lines[0|G*E.scaleY*R],B=A.lines[0|G*A.scaleY*R],L=0;L<y;L++)Q=k[0|L*E.scaleX*_],oe[H++]=Q,Q=B[0|L*A.scaleX*_],oe[H++]=Q;break;case 3:for(fe=!0,this.adobe&&this.adobe.transformCode?fe=!0:typeof this.opts.colorTransform<"u"&&(fe=!!this.opts.colorTransform),E=this.components[0],A=this.components[1],I=this.components[2],G=0;G<M;G++)for(k=E.lines[0|G*E.scaleY*R],B=A.lines[0|G*A.scaleY*R],S=I.lines[0|G*I.scaleY*R],L=0;L<y;L++)fe?(Q=k[0|L*E.scaleX*_],te=B[0|L*A.scaleX*_],he=S[0|L*I.scaleX*_],q=p(Q+1.402*(he-128)),se=p(Q-.3441363*(te-128)-.71413636*(he-128)),J=p(Q+1.772*(te-128))):(q=k[0|L*E.scaleX*_],se=B[0|L*A.scaleX*_],J=S[0|L*I.scaleX*_]),oe[H++]=q,oe[H++]=se,oe[H++]=J;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(fe=!1,this.adobe&&this.adobe.transformCode?fe=!0:typeof this.opts.colorTransform<"u"&&(fe=!!this.opts.colorTransform),E=this.components[0],A=this.components[1],I=this.components[2],b=this.components[3],G=0;G<M;G++)for(k=E.lines[0|G*E.scaleY*R],B=A.lines[0|G*A.scaleY*R],S=I.lines[0|G*I.scaleY*R],j=b.lines[0|G*b.scaleY*R],L=0;L<y;L++)fe?(Q=k[0|L*E.scaleX*_],te=B[0|L*A.scaleX*_],he=S[0|L*I.scaleX*_],ae=j[0|L*b.scaleX*_],ne=255-p(Q+1.402*(he-128)),Y=255-p(Q-.3441363*(te-128)-.71413636*(he-128)),P=255-p(Q+1.772*(te-128))):(ne=k[0|L*E.scaleX*_],Y=B[0|L*A.scaleX*_],P=S[0|L*I.scaleX*_],ae=j[0|L*b.scaleX*_]),oe[H++]=255-ne,oe[H++]=255-Y,oe[H++]=255-P,oe[H++]=255-ae;break;default:throw new Error("Unsupported color mode")}return oe},copyToImageData:function(y,M){var _=y.width,R=y.height,E=y.data,A=this.getData(_,R),I=0,b=0,k,B,S,j,L,G,H,Q,te;switch(this.components.length){case 1:for(B=0;B<R;B++)for(k=0;k<_;k++)S=A[I++],E[b++]=S,E[b++]=S,E[b++]=S,M&&(E[b++]=255);break;case 3:for(B=0;B<R;B++)for(k=0;k<_;k++)H=A[I++],Q=A[I++],te=A[I++],E[b++]=H,E[b++]=Q,E[b++]=te,M&&(E[b++]=255);break;case 4:for(B=0;B<R;B++)for(k=0;k<_;k++)L=A[I++],G=A[I++],S=A[I++],j=A[I++],H=255-p(L*(1-j/255)+j),Q=255-p(G*(1-j/255)+j),te=255-p(S*(1-j/255)+j),E[b++]=H,E[b++]=Q,E[b++]=te,M&&(E[b++]=255);break;default:throw new Error("Unsupported color mode")}}};var g=0,x=0;function m(w=0){var y=g+w;if(y>x){var M=Math.ceil((y-x)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${M}MB`)}g=y}return f.resetMaxMemoryUsage=function(w){g=0,x=w},f.getBytesAllocated=function(){return g},f.requestMemoryAllocation=m,f}();typeof as<"u"?as.exports=F0:typeof window<"u"&&(window["jpeg-js"]=window["jpeg-js"]||{},window["jpeg-js"].decode=F0);function F0(t,e={}){var r={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},i={...r,...e},n=new Uint8Array(t),o=new ss;o.opts=i,ss.resetMaxMemoryUsage(i.maxMemoryUsageInMB*1024*1024),o.parse(n);var s=i.formatAsRGBA?4:3,a=o.width*o.height*s;try{ss.requestMemoryAllocation(a);var h={width:o.width,height:o.height,exifBuffer:o.exifBuffer,data:i.useTArray?new Uint8Array(a):Buffer.alloc(a)};o.comments.length>0&&(h.comments=o.comments)}catch(l){throw l instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+a):l instanceof ReferenceError&&l.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):l}return o.copyToImageData(h,i.formatAsRGBA),h}});var ls=X((fM,U0)=>{var uw=L0(),cw=O0();U0.exports={encode:uw,decode:cw}});var W0=X((yM,pw)=>{pw.exports={name:"has-own",version:"1.0.1",description:"A safer .hasOwnProperty() - hasOwn(name, obj)",main:"index.js",scripts:{test:"make test"},author:"Aaron Heckmann <aaron.heckmann+github@gmail.com>",license:"MIT",repository:{type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage:"https://github.com/aheckmann/has-own/",devDependencies:{mocha:"^6.2.2"}}});var ds=X((cs,K0)=>{var mw=Object.prototype.hasOwnProperty;K0.exports=cs=function(e,r){return mw.call(r,e)};cs.version=W0().version});var xs=X((AM,uc)=>{"use strict";var ms=[],gs=class{constructor(e,r){r=r||{},e===void 0&&(e=8192),typeof e=="number"&&(e=new ArrayBuffer(e));let i=e.byteLength,n=r.offset?r.offset>>>0:0;e.buffer&&(i=e.byteLength-n,e.byteLength!==e.buffer.byteLength?e=e.buffer.slice(e.byteOffset+n,e.byteOffset+e.byteLength):n?e=e.buffer.slice(n):e=e.buffer),this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=i||8192,this._mark=0}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(e){e===void 0&&(e=1),this.offset+=e}seek(e){this.offset=e}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){let r=this._increment+this._increment;this._increment=r;let i=this.length+r,n=new Uint8Array(i);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=i,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var r=new Uint8Array(e),i=0;i<e;i++)r[i]=this.readByte();return r}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e){e===void 0&&(e=1),ms.length=e;for(var r=0;r<e;r++)ms[r]=this.readChar();return ms.join("")}writeBoolean(e){this.writeUint8(e?255:0)}writeInt8(e){this.ensureAvailable(1),this._data.setInt8(this.offset++,e)}writeUint8(e){this.ensureAvailable(1),this._data.setUint8(this.offset++,e)}writeByte(e){this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var r=0;r<e.length;r++)this._data.setUint8(this.offset++,e[r])}writeInt16(e){this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2}writeUint16(e){this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2}writeInt32(e){this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4}writeUint32(e){this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat32(e){this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat64(e){this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8}writeChar(e){this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};uc.exports=gs});var pc=X((SM,dc)=>{"use strict";var bs={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},cc={};for(ws in bs)cc[bs[ws]]=ws;var ws;dc.exports={tagsById:bs,tagsByName:cc}});var xc=X((DM,gc)=>{"use strict";var vs={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},mc={};for(ys in vs)mc[vs[ys]]=ys;var ys;gc.exports={tagsById:vs,tagsByName:mc}});var yc=X((IM,bc)=>{"use strict";var Ms={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},wc={};for(_s in Ms)wc[Ms[_s]]=_s;var _s;bc.exports={tagsById:Ms,tagsByName:wc}});var ks=X((RM,_c)=>{"use strict";var vc={standard:pc(),exif:xc(),gps:yc()},Es=class{constructor(e){if(!e)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=e,this._map=null}get(e){if(typeof e=="number")return this.fields.get(e);if(typeof e=="string")return this.fields.get(vc[this.kind].tagsByName[e]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};let r=vc[this.kind].tagsById;for(var e of this.fields.keys())r[e]&&(this._map[r[e]]=this.fields.get(e))}return this._map}};_c.exports=Es});var kc=X((CM,Ec)=>{"use strict";var Mw=ks(),Ew=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,As=class extends Mw{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var e=new Date,r=Ew.exec(this.dateTime);return e.setFullYear(r[1],r[2]-1,r[3]),e.setHours(r[4],r[5],r[6]),e}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return Mc(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return Mc(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function Mc(t){return typeof t=="number"?[t]:t}Ec.exports=As});var Dc=X(Ss=>{"use strict";var Sc=new Map([[1,[1,Ac]],[2,[1,kw]],[3,[2,Aw]],[4,[4,Sw]],[5,[8,Dw]],[6,[1,Iw]],[7,[1,Ac]],[8,[2,Rw]],[9,[4,Cw]],[10,[8,Pw]],[11,[4,Bw]],[12,[8,Tw]]]);Ss.getByteLength=function(t,e){return Sc.get(t)[0]*e};Ss.readData=function(t,e,r){return Sc.get(e)[1](t,r)};function Ac(t,e){if(e===1)return t.readUint8();for(var r=new Uint8Array(e),i=0;i<e;i++)r[i]=t.readUint8();return r}function kw(t,e){for(var r=[],i="",n=0;n<e;n++){var o=String.fromCharCode(t.readUint8());o==="\0"?(r.push(i),i=""):i+=o}return r.length===1?r[0]:r}function Aw(t,e){if(e===1)return t.readUint16();for(var r=new Uint16Array(e),i=0;i<e;i++)r[i]=t.readUint16();return r}function Sw(t,e){if(e===1)return t.readUint32();for(var r=new Uint32Array(e),i=0;i<e;i++)r[i]=t.readUint32();return r}function Dw(t,e){if(e===1)return t.readUint32()/t.readUint32();for(var r=new Array(e),i=0;i<e;i++)r[i]=t.readUint32()/t.readUint32();return r}function Iw(t,e){if(e===1)return t.readInt8();for(var r=new Int8Array(e),i=0;i<e;i++)r[i]=t.readInt8();return r}function Rw(t,e){if(e===1)return t.readInt16();for(var r=new Int16Array(e),i=0;i<e;i++)r[i]=t.readInt16();return r}function Cw(t,e){if(e===1)return t.readInt32();for(var r=new Int32Array(e),i=0;i<e;i++)r[i]=t.readInt32();return r}function Pw(t,e){if(e===1)return t.readInt32()/t.readInt32();for(var r=new Array(e),i=0;i<e;i++)r[i]=t.readInt32()/t.readInt32();return r}function Bw(t,e){if(e===1)return t.readFloat32();for(var r=new Float32Array(e),i=0;i<e;i++)r[i]=t.readFloat32();return r}function Tw(t,e){if(e===1)return t.readFloat64();for(var r=new Float64Array(e),i=0;i<e;i++)r[i]=t.readFloat64();return r}});var Cc=X((BM,Rc)=>{"use strict";var Lw=xs(),Fw=ks(),Ow=kc(),Ic=Dc(),Uw={ignoreImageData:!1,onlyFirst:!1},Ds=class extends Lw{constructor(e,r){super(e,r),this._nextIFD=0}decode(e){e=Object.assign({},Uw,e);let r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(e)),e.onlyFirst)return r[0];return r}decodeHeader(){let e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+e.toString(16));if(e=this.readUint16(),e!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e){this.seek(this._nextIFD);var r;e.kind?r=new Fw(e.kind):r=new Ow;let i=this.readUint16();for(var n=0;n<i;n++)this.decodeIFDEntry(r);return e.ignoreImageData||this.decodeImageData(r),this._nextIFD=this.readUint32(),r}decodeIFDEntry(e){let r=this.offset,i=this.readUint16(),n=this.readUint16(),o=this.readUint32();if(n<1||n>12){this.skip(4);return}Ic.getByteLength(n,o)>4&&this.seek(this.readUint32());let a=Ic.readData(this,n,o);if(e.fields.set(i,a),i===34665||i===34853){let h=this.offset,l;i===34665?l="exif":i===34853&&(l="gps"),this._nextIFD=a,e[l]=this.decodeIFD({kind:l,ignoreImageData:!0}),this.offset=h}this.seek(r),this.skip(12)}decodeImageData(e){let r=e.orientation;switch(r&&r!==1&&Vr("orientation",r),e.type){case 1:case 2:this.readStripData(e);break;default:Vr("image type",e.type);break}}readStripData(e){let r=e.width,i=e.height,n=jw(e.bitsPerSample),o=e.sampleFormat,s=r*i,a=Nw(s,1,n,o),h=e.compression,f=e.rowsPerStrip*r,u=e.stripOffsets,c=e.stripByteCounts;for(var d=0,p=0;p<u.length;p++){var g=this.getStripData(h,u[p],c[p]),x=s>f?f:s;s-=x,n===8?d=Yw(a,g,d,x):n===16?d=zw(a,g,d,x,this.isLittleEndian()):n===32&&o===3?d=Xw(a,g,d,x,this.isLittleEndian()):Vr("bitDepth",n)}e.data=a}getStripData(e,r,i){switch(e){case 1:return new DataView(this.buffer,r,i);case 2:case 32773:return Vr("Compression",e);default:throw new Error("invalid compression: "+e)}}};Rc.exports=Ds;function Nw(t,e,r,i){return r===8?new Uint8Array(t*e):r===16?new Uint16Array(t*e):r===32&&i===3?new Float32Array(t*e):Vr("bit depth / sample format",r+" / "+i)}function Yw(t,e,r,i){for(var n=0;n<i;n++)t[r++]=e.getUint8(n);return r}function zw(t,e,r,i,n){for(var o=0;o<i*2;o+=2)t[r++]=e.getUint16(o,n);return r}function Xw(t,e,r,i,n){for(var o=0;o<i*4;o+=4)t[r++]=e.getFloat32(o,n);return r}function Vr(t,e){throw new Error("Unsupported "+t+": "+e)}function jw(t){if(t.length){let r=t;t=r[0];for(var e=0;e<r.length;e++)r[e]!==t&&Vr("bit depth",r)}return t}});var Bc=X((TM,Pc)=>{"use strict";var Gw=Cc();Pc.exports=function(e,r){return new Gw(e,r).decode(r)}});var Lc=X(Tc=>{"use strict";Tc.decode=Bc()});var Oc=X((FM,Fc)=>{"use strict";var qw=xs(),Vw=Lc();function $w(t){let e=new qw(t),r={};if(e.setBigEndian(),e.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(e.readUint16()===65505){let o=e.readUint16(),s=e.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){let a=Vw.decode(e,{onlyFirst:!0,ignoreImageData:!0,offset:e.offset});r.exif=a}}return r}Fc.exports=$w});var Nc=X(Uc=>{"use strict";Uc.decode=Oc()});var Yc=X((exports,module)=>{"use strict";var toBytes=t=>[...t].map(e=>e.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,e=0){let r=t[e],i=1,n=0;for(;++n<8;)i*=256,r+=t[e+n]*i;return r}var fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);let e=t instanceof Uint8Array?t:new Uint8Array(t);if(!(e&&e.length>1))return null;let r=(n,o)=>{o=Object.assign({offset:0},o);for(let s=0;s<n.length;s++)if(o.mask){if(n[s]!==(o.mask[s]&e[s+o.offset]))return!1}else if(n[s]!==e[s+o.offset])return!1;return!0},i=(n,o)=>r(toBytes(n),o);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(i("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(i("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(i("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};let n=(h,l=0)=>h.findIndex((f,u,c)=>u>=l&&c[u]===80&&c[u+1]===75&&c[u+2]===3&&c[u+3]===4),o=0,s=!1,a=null;do{let h=o+30;if(s||(s=r(oxmlContentTypes,{offset:h})||r(oxmlRels,{offset:h})),a||(i("word/",{offset:h})?a={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:i("ppt/",{offset:h})?a={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:i("xl/",{offset:h})&&(a={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),s&&a)return a;o=n(e,h)}while(o>=0);if(a)return a}if(r([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(e[6]===0||e[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){let n=e.subarray(4,4100),o=n.findIndex((s,a,h)=>h[a]===66&&h[a+1]===130);if(o!==-1){let s=o+3,a=h=>[...h].every((l,f)=>n[s+f]===l.charCodeAt(0));if(a("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(a("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let n=30;do{let o=readUInt64LE(e,n+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:n})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:n+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:n+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}n+=o}while(n+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let n=0;n<2&&n<e.length-16;n++){if(r([73,68,51],{offset:n})||r([255,226],{offset:n,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:n,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:n,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:n,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((e[0]===67||e[0]===70)&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(i("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType;module.exports.default=fileType;Object.defineProperty(fileType,"minimumBytes",{value:4100});module.exports.stream=readableStream=>new Promise((resolve,reject)=>{let stream=eval("require")("stream");readableStream.once("readable",()=>{let t=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(e)}catch(r){reject(r)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,t,()=>{})):resolve(readableStream.pipe(t))})})});var Xc=X((UM,Rs)=>{"use strict";var zc=Yc(),Ww=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),Is=t=>{let e=zc(t);return Ww.has(e&&e.ext)?e:null};Rs.exports=Is;Rs.exports.default=Is;Object.defineProperty(Is,"minimumBytes",{value:zc.minimumBytes})});var oa=X((e8,kn)=>{(function(){function t(i){for(var n=0,o=i.length-1,s=void 0,a=void 0,h=void 0,l=r(n,o);;){if(o<=n)return i[l];if(o==n+1)return i[n]>i[o]&&e(i,n,o),i[l];for(s=r(n,o),i[s]>i[o]&&e(i,s,o),i[n]>i[o]&&e(i,n,o),i[s]>i[n]&&e(i,s,n),e(i,s,n+1),a=n+1,h=o;;){do a++;while(i[n]>i[a]);do h--;while(i[h]>i[n]);if(h<a)break;e(i,a,h)}e(i,n,h),h<=l&&(n=a),h>=l&&(o=h-1)}}var e=function(n,o,s){var a;return a=[n[s],n[o]],n[o]=a[0],n[s]=a[1],a},r=function(n,o){return~~((n+o)/2)};typeof kn<"u"&&kn.exports?kn.exports=t:window.median=t})()});var la=X(An=>{var a8=function(){var t;typeof An<"u"?t=An:t={};var e={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+e.release+", released "+e.date};for(var r=0,i=null,n=null,o={init:function(h){if(h!==0&&!(h&h-1))r=h,o._initArray(),o._makeBitReversalTable(),o._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(h,l){o.fft(h,l,1)},ifft1d:function(h,l){var f=1/r;o.fft(h,l,-1);for(var u=0;u<r;u++)h[u]*=f,l[u]*=f},bt1d:function(h,l){o.fft(h,l,-1)},fft2d:function(h,l){for(var f=[],u=[],c=0,d=0;d<r;d++){c=d*r;for(var p=0;p<r;p++)f[p]=h[p+c],u[p]=l[p+c];o.fft1d(f,u);for(var g=0;g<r;g++)h[g+c]=f[g],l[g+c]=u[g]}for(var x=0;x<r;x++){for(var m=0;m<r;m++)c=x+m*r,f[m]=h[c],u[m]=l[c];o.fft1d(f,u);for(var w=0;w<r;w++)c=x+w*r,h[c]=f[w],l[c]=u[w]}},ifft2d:function(h,l){for(var f=[],u=[],c=0,d=0;d<r;d++){c=d*r;for(var p=0;p<r;p++)f[p]=h[p+c],u[p]=l[p+c];o.ifft1d(f,u);for(var g=0;g<r;g++)h[g+c]=f[g],l[g+c]=u[g]}for(var x=0;x<r;x++){for(var m=0;m<r;m++)c=x+m*r,f[m]=h[c],u[m]=l[c];o.ifft1d(f,u);for(var w=0;w<r;w++)c=x+w*r,h[c]=f[w],l[c]=u[w]}},fft:function(h,l,f){for(var u,c,d,p,g,x,m,w,y,M=r>>2,_=0;_<r;_++)p=i[_],_<p&&(g=h[_],h[_]=h[p],h[p]=g,g=l[_],l[_]=l[p],l[p]=g);for(var R=1;R<r;R<<=1){c=0,u=r/(R<<1);for(var E=0;E<R;E++){x=n[c+M],m=f*n[c];for(var A=E;A<r;A+=R<<1)d=A+R,w=x*h[d]+m*l[d],y=x*l[d]-m*h[d],h[d]=h[A]-w,h[A]+=w,l[d]=l[A]-y,l[A]+=y;c+=u}}},_initArray:function(){typeof Uint32Array<"u"?i=new Uint32Array(r):i=[],typeof Float64Array<"u"?n=new Float64Array(r*1.25):n=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var h=0,l=0,f=0;for(i[0]=0;++h<r;){for(f=r>>1;f<=l;)l-=f,f>>=1;l+=f,i[h]=l}},_makeCosSinTable:function(){var h=r>>1,l=r>>2,f=r>>3,u=h+l,c=Math.sin(Math.PI/r),d=2*c*c,p=Math.sqrt(d*(2-d)),g=n[l]=1,x=n[0]=0;c=2*d;for(var m=1;m<f;m++)g-=d,d+=c*g,x+=p,p-=c*x,n[m]=x,n[l-m]=g;f!==0&&(n[f]=Math.sqrt(.5));for(var w=0;w<l;w++)n[h-w]=n[w];for(var y=0;y<u;y++)n[y+h]=-n[y]}},s=["init","fft1d","ifft1d","fft2d","ifft2d"],a=0;a<s.length;a++)t[s[a]]=o[s[a]];return t.bt=o.bt1d,t.fft=o.fft1d,t.ifft=o.ifft1d,t}.call(An)});var Md=X((h8,_d)=>{"use strict";var ir=la(),S2={DEBUG:!1,ifft2DArray:function(t,e,r){var i=new Array(e*r),n=e/2,o=(r-1)*2;ir.init(n);for(var s={re:new Array(n),im:new Array(n)},a=0;a<r;a++){for(var h=n-1;h>=0;h--)s.re[h]=t[h*2*r+a],s.im[h]=t[(h*2+1)*r+a];ir.bt(s.re,s.im);for(var h=n-1;h>=0;h--)i[h*2*r+a]=s.re[h],i[(h*2+1)*r+a]=s.im[h]}var l=new Array(n*o);ir.init(o);for(var f={re:new Array(o),im:new Array(o)},u=o*n,h=0;h<e;h+=2){f.re[0]=i[h*r],f.im[0]=i[(h+1)*r];for(var a=1;a<r;a++)f.re[a]=i[h*r+a],f.im[a]=i[(h+1)*r+a],f.re[o-a]=i[h*r+a],f.im[o-a]=-i[(h+1)*r+a];ir.bt(f.re,f.im);for(var c=h/2*o,a=o-1;a>=0;a--)l[c+a]=f.re[a]/u}return l},fft2DArray:function(t,e,r,i){var n=Object.assign({},{inplace:!0}),o=r/2+1,s=e*2,a=new Array(s*o);ir.init(r);for(var h={re:new Array(r),im:new Array(r)},l={re:new Array(r),im:new Array(r)},f={re:new Array(r),im:new Array(r)},u,c,d,p,g,x=0;x<e/2;x++){u=x*2*r,h.re=t.slice(u,u+r),u=(x*2+1)*r,h.im=t.slice(u,u+r),ir.fft1d(h.re,h.im),this.reconstructTwoRealFFT(h,l,f),c=x*4*o,d=(x*4+1)*o,p=(x*4+2)*o,g=(x*4+3)*o;for(var m=o-1;m>=0;m--)a[c+m]=l.re[m],a[d+m]=l.im[m],a[p+m]=f.re[m],a[g+m]=f.im[m]}l=null,f=null;var w=new Array(s*o);ir.init(e);for(var y={re:new Array(e),im:new Array(e)},M=o-1;M>=0;M--){for(var x=e-1;x>=0;x--)y.re[x]=a[x*2*o+M],y.im[x]=a[(x*2+1)*o+M],isNaN(y.re[x])&&(y.re[x]=0),isNaN(y.im[x])&&(y.im[x]=0);ir.fft1d(y.re,y.im);for(var x=e-1;x>=0;x--)w[x*2*o+M]=y.re[x],w[(x*2+1)*o+M]=y.im[x]}return w},reconstructTwoRealFFT:function(t,e,r){var i=t.re.length;e.re[0]=t.re[0],e.im[0]=0,r.re[0]=t.im[0],r.im[0]=0;for(var n,o,s,a,h,l=i/2;l>0;l--)h=i-l,n=.5*(t.re[l]-t.re[h]),o=.5*(t.re[l]+t.re[h]),s=.5*(t.im[l]-t.im[h]),a=.5*(t.im[l]+t.im[h]),e.re[l]=o,e.im[l]=s,e.re[h]=o,e.im[h]=-s,r.re[l]=a,r.im[l]=-n,r.re[h]=a,r.im[h]=n},convolute2DI:function(t,e,r,i){for(var n,o,s=0;s<r/2;s++)for(var a=0;a<i;a++)n=t[s*2*i+a]*e[s*2*i+a]-t[(s*2+1)*i+a]*e[(s*2+1)*i+a],o=t[s*2*i+a]*e[(s*2+1)*i+a]+t[(s*2+1)*i+a]*e[s*2*i+a],t[s*2*i+a]=n,t[(s*2+1)*i+a]=o},convolute:function(t,e,r,i,n){for(var o=new Array(i*r),s=0;s<r*i;s++)o[s]=t[s];o=this.fft2DArray(o,r,i);for(var a=e.length,h=e[0].length,l=new Array(i*r),s=0;s<i*r;s++)l[s]=0;for(var f,u,c=Math.floor((a-1)/2),d=Math.floor((h-1)/2),p=0;p<a;p++){f=(p-c+r)%r;for(var g=0;g<h;g++)u=(g-d+i)%i,l[f*i+u]=e[p][g]}l=this.fft2DArray(l,r,i);var x=r*2,m=i/2+1;return this.convolute2DI(o,l,x,m),this.ifft2DArray(o,x,m)},toRadix2:function(t,e,r){var i,n,o,s,a=r,h=e,l=0,f=0;if(!(r!==0&&!(r&r-1))){for(a=0;r>>++a;);a=1<<a,f=a-r}if(!(e!==0&&!(e&e-1))){for(h=0;e>>++h;);h=1<<h,l=(h-e)*a}if(h==e&&a==r)return{data:t,rows:e,cols:r};var u=new Array(h*a),c=Math.floor((h-e)/2)-e,d=Math.floor((a-r)/2)-r;for(i=0;i<h;i++)for(o=i*a,s=(i-c)%e*r,n=0;n<a;n++)u[o+n]=t[s+(n-d)%r];return{data:u,rows:h,cols:a}},crop:function(t,e,r,i,n,o){if(e==i&&r==n)return t;var s=Object.assign({},o),a=new Array(n*i),h=Math.floor((e-i)/2),l=Math.floor((r-n)/2),f,u,c,d;for(c=0;c<i;c++)for(f=c*n,u=(c+h)*r,d=0;d<n;d++)a[f+d]=t[u+(d+l)];return a}};_d.exports=S2});var Ed=X(ha=>{"use strict";ha.FFTUtils=Md();ha.FFT=la()});var Ad=X((u8,kd)=>{"use strict;";var fa=Ed().FFTUtils;function D2(t,e,r){var i=ua(t),n=i.data,o=Object.assign({normalize:!1,divisor:1,rows:i.rows,cols:i.cols},r),s,a;if(o.rows&&o.cols)s=o.rows,a=o.cols;else throw new Error("Invalid number of rows or columns "+s+" "+a);var h=o.divisor,l,f,u=e.length,c=e[0].length;if(o.normalize)for(h=0,l=0;l<u;l++)for(f=0;f<c;f++)h+=e[l][f];if(h===0)throw new RangeError("convolution: The divisor is equal to zero");var d=fa.toRadix2(n,s,a),p=fa.convolute(d.data,e,d.rows,d.cols);if(p=fa.crop(p,d.rows,d.cols,s,a),h!=0&&h!=1)for(l=0;l<p.length;l++)p[l]/=h;return p}function I2(t,e,r){var i=ua(t),n=i.data,o=Object.assign({normalize:!1,divisor:1,rows:i.rows,cols:i.cols},r),s,a;if(o.rows&&o.cols)s=o.rows,a=o.cols;else throw new Error("Invalid number of rows or columns "+s+" "+a);var h=o.divisor,l=e.length,f=e[0].length,u,c,d,p,g,x,m,w,y;if(o.normalize)for(h=0,u=0;u<l;u++)for(c=0;c<f;c++)h+=e[u][c];if(h===0)throw new RangeError("convolution: The divisor is equal to zero");var M=new Array(s*a),_=Math.floor(l/2),R=Math.floor(f/2);for(p=0;p<s;p++)for(d=0;d<a;d++){for(x=0,c=0;c<l;c++)for(u=0;u<f;u++)m=e[l-c-1][f-u-1],w=(p+c-_+s)%s,y=(d+u-R+a)%a,g=w*a+y,x+=n[g]*m;g=p*a+d,M[g]=x/h}return M}function R2(t,e,r){var i=1e3;r&&r.factor&&(i=r.factor);var n=new Array(e),o,s,a,h,l;i*=-1;var f=(e-1)/2,u=2*t*t;for(o=0;o<e;o++)for(n[o]=new Array(e),h=(o-f)*(o-f),s=0;s<e;s++)a=-((s-f)*(s-f)+h)/u,n[o][s]=Math.round(i*(1+a)*Math.exp(a));return n}function ua(t){var e=t,r,i;if(typeof t[0]!="number"){r=t.length,i=t[0].length,e=new Array(r*i);for(var n=0;n<r;n++)for(var o=0;o<i;o++)e[n*i+o]=t[n][o]}else{var s=Math.sqrt(t.length);Number.isInteger(s)&&(r=s,i=s)}return{data:e,rows:r,cols:i}}kd.exports={fft:D2,direct:I2,kernelFactory:{LoG:R2},matrix2Array:ua}});var Dd=X((c8,Sd)=>{"use strict";Sd.exports=Number.isFinite||function(t){return!(typeof t!="number"||t!==t||t===1/0||t===-1/0)}});var ca=X((d8,Id)=>{var C2=Dd();Id.exports=Number.isInteger||function(t){return typeof t=="number"&&C2(t)&&Math.floor(t)===t}});var Bd=X((x8,Pd)=>{"use strict";function lt(t){if(this.size=t|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var e=new Array(this.size*2),r=0;r<e.length;r+=2){let h=Math.PI*r/this.size;e[r]=Math.cos(h),e[r+1]=-Math.sin(h)}this.table=e;for(var i=0,n=1;this.size>n;n<<=1)i++;this._width=i%2===0?i-1:i,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var s=0;s<this._width;s+=2){var a=this._width-s-2;this._bitrev[o]|=(o>>>s&3)<<a}}this._out=null,this._data=null,this._inv=0}Pd.exports=lt;lt.prototype.fromComplexArray=function(e,r){for(var i=r||new Array(e.length>>>1),n=0;n<e.length;n+=2)i[n>>>1]=e[n];return i};lt.prototype.createComplexArray=function(){let e=new Array(this._csize);for(var r=0;r<e.length;r++)e[r]=0;return e};lt.prototype.toComplexArray=function(e,r){for(var i=r||this.createComplexArray(),n=0;n<i.length;n+=2)i[n]=e[n>>>1],i[n+1]=0;return i};lt.prototype.completeSpectrum=function(e){for(var r=this._csize,i=r>>>1,n=2;n<i;n+=2)e[r-n]=e[n],e[r-n+1]=-e[n+1]};lt.prototype.transform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};lt.prototype.realTransform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};lt.prototype.inverseTransform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=1,this._transform4();for(var i=0;i<e.length;i++)e[i]/=this.size;this._out=null,this._data=null};lt.prototype._transform4=function(){var e=this._out,r=this._csize,i=this._width,n=1<<i,o=r/n<<1,s,a,h=this._bitrev;if(o===4)for(s=0,a=0;s<r;s+=o,a++){let g=h[a];this._singleTransform2(s,g,n)}else for(s=0,a=0;s<r;s+=o,a++){let g=h[a];this._singleTransform4(s,g,n)}var l=this._inv?-1:1,f=this.table;for(n>>=2;n>=2;n>>=2){o=r/n<<1;var u=o>>>2;for(s=0;s<r;s+=o)for(var c=s+u,d=s,p=0;d<c;d+=2,p+=n){let g=d,x=g+u,m=x+u,w=m+u,y=e[g],M=e[g+1],_=e[x],R=e[x+1],E=e[m],A=e[m+1],I=e[w],b=e[w+1],k=y,B=M,S=f[p],j=l*f[p+1],L=_*S-R*j,G=_*j+R*S,H=f[2*p],Q=l*f[2*p+1],te=E*H-A*Q,he=E*Q+A*H,ae=f[3*p],ne=l*f[3*p+1],Y=I*ae-b*ne,P=I*ne+b*ae,q=k+te,se=B+he,J=k-te,fe=B-he,ue=L+Y,oe=G+P,V=l*(L-Y),z=l*(G-P),Ee=q+ue,le=se+oe,de=q-ue,ze=se-oe,Ve=J+z,T=fe-V,ee=J-z,ie=fe+V;e[g]=Ee,e[g+1]=le,e[x]=Ve,e[x+1]=T,e[m]=de,e[m+1]=ze,e[w]=ee,e[w+1]=ie}}};lt.prototype._singleTransform2=function(e,r,i){let n=this._out,o=this._data,s=o[r],a=o[r+1],h=o[r+i],l=o[r+i+1],f=s+h,u=a+l,c=s-h,d=a-l;n[e]=f,n[e+1]=u,n[e+2]=c,n[e+3]=d};lt.prototype._singleTransform4=function(e,r,i){let n=this._out,o=this._data,s=this._inv?-1:1,a=i*2,h=i*3,l=o[r],f=o[r+1],u=o[r+i],c=o[r+i+1],d=o[r+a],p=o[r+a+1],g=o[r+h],x=o[r+h+1],m=l+d,w=f+p,y=l-d,M=f-p,_=u+g,R=c+x,E=s*(u-g),A=s*(c-x),I=m+_,b=w+R,k=y+A,B=M-E,S=m-_,j=w-R,L=y-A,G=M+E;n[e]=I,n[e+1]=b,n[e+2]=k,n[e+3]=B,n[e+4]=S,n[e+5]=j,n[e+6]=L,n[e+7]=G};lt.prototype._realTransform4=function(){var e=this._out,r=this._csize,i=this._width,n=1<<i,o=r/n<<1,s,a,h=this._bitrev;if(o===4)for(s=0,a=0;s<r;s+=o,a++){let Ae=h[a];this._singleRealTransform2(s,Ae>>>1,n>>>1)}else for(s=0,a=0;s<r;s+=o,a++){let Ae=h[a];this._singleRealTransform4(s,Ae>>>1,n>>>1)}var l=this._inv?-1:1,f=this.table;for(n>>=2;n>=2;n>>=2){o=r/n<<1;var u=o>>>1,c=u>>>1,d=c>>>1;for(s=0;s<r;s+=o)for(var p=0,g=0;p<=d;p+=2,g+=n){var x=s+p,m=x+c,w=m+c,y=w+c,M=e[x],_=e[x+1],R=e[m],E=e[m+1],A=e[w],I=e[w+1],b=e[y],k=e[y+1],B=M,S=_,j=f[g],L=l*f[g+1],G=R*j-E*L,H=R*L+E*j,Q=f[2*g],te=l*f[2*g+1],he=A*Q-I*te,ae=A*te+I*Q,ne=f[3*g],Y=l*f[3*g+1],P=b*ne-k*Y,q=b*Y+k*ne,se=B+he,J=S+ae,fe=B-he,ue=S-ae,oe=G+P,V=H+q,z=l*(G-P),Ee=l*(H-q),le=se+oe,de=J+V,ze=fe+Ee,Ve=ue-z;if(e[x]=le,e[x+1]=de,e[m]=ze,e[m+1]=Ve,p===0){var T=se-oe,ee=J-V;e[w]=T,e[w+1]=ee;continue}if(p!==d){var ie=fe,U=-ue,me=se,ge=-J,_e=-l*Ee,ye=-l*z,Te=-l*V,Re=-l*oe,N=ie+_e,Z=U+ye,ce=me+Re,Ce=ge-Te,xe=s+c-p,be=s+u-p;e[xe]=N,e[xe+1]=Z,e[be]=ce,e[be+1]=Ce}}}};lt.prototype._singleRealTransform2=function(e,r,i){let n=this._out,o=this._data,s=o[r],a=o[r+i],h=s+a,l=s-a;n[e]=h,n[e+1]=0,n[e+2]=l,n[e+3]=0};lt.prototype._singleRealTransform4=function(e,r,i){let n=this._out,o=this._data,s=this._inv?-1:1,a=i*2,h=i*3,l=o[r],f=o[r+i],u=o[r+a],c=o[r+h],d=l+u,p=l-u,g=f+c,x=s*(f-c),m=d+g,w=p,y=-x,M=d-g,_=p,R=x;n[e]=m,n[e+1]=0,n[e+2]=w,n[e+3]=y,n[e+4]=M,n[e+5]=0,n[e+6]=_,n[e+7]=R}});var Ld=X((w8,Td)=>{Td.exports=B2;function B2(t){return t===0?1:(t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1)}});var kr=X(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.isAnyArray=void 0;var F2=Object.prototype.toString;function O2(t){let e=F2.call(t);return e.endsWith("Array]")&&!e.includes("Big")}Sn.isAnyArray=O2});var Od=X((S8,Fd)=>{"use strict";var U2=kr();function N2(t,e={}){if(!U2.isAnyArray(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");let{fromIndex:r=0,toIndex:i=t.length}=e;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=r||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");let n=t[r];for(let o=r+1;o<i;o++)t[o]>n&&(n=t[o]);return n}Fd.exports=N2});var Nd=X((D8,Ud)=>{"use strict";var Y2=kr();function z2(t,e={}){if(!Y2.isAnyArray(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");let{fromIndex:r=0,toIndex:i=t.length}=e;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=r||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");let n=t[r];for(let o=r+1;o<i;o++)t[o]<n&&(n=t[o]);return n}Ud.exports=z2});var jd=X((I8,Xd)=>{"use strict";var Yd=kr(),X2=Od(),j2=Nd();function zd(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var G2=zd(X2),q2=zd(j2);function V2(t,e={}){if(Yd.isAnyArray(t)){if(t.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");let r;if(e.output!==void 0){if(!Yd.isAnyArray(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(t.length);let i=q2.default(t),n=G2.default(t);if(i===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");let{min:o=e.autoMinMax?i:0,max:s=e.autoMinMax?n:1}=e;if(o>=s)throw new RangeError("min option must be smaller than max option");let a=(s-o)/(n-i);for(let h=0;h<t.length;h++)r[h]=(t[h]-i)*a+o;return r}Xd.exports=V2});var ka=X(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});var ht=kr(),Gd=jd(),Dn=" ".repeat(2),$d=" ".repeat(4);function $2(){return Wd(this)}function Wd(t,e={}){let{maxRows:r=15,maxColumns:i=10,maxNumSize:n=8,padMinus:o="auto"}=e;return`${t.constructor.name} {
${Dn}[
${$d}${W2(t,r,i,n,o)}
${Dn}]
${Dn}rows: ${t.rows}
${Dn}columns: ${t.columns}
}`}function W2(t,e,r,i,n){let{rows:o,columns:s}=t,a=Math.min(o,e),h=Math.min(s,r),l=[];if(n==="auto"){n=!1;e:for(let f=0;f<a;f++)for(let u=0;u<h;u++)if(t.get(f,u)<0){n=!0;break e}}for(let f=0;f<a;f++){let u=[];for(let c=0;c<h;c++)u.push(K2(t.get(f,c),i,n));l.push(`${u.join(" ")}`)}return h!==s&&(l[l.length-1]+=` ... ${s-r} more columns`),a!==o&&l.push(`... ${o-e} more rows`),l.join(`
${$d}`)}function K2(t,e,r){return(t>=0&&r?` ${qd(t,e-1)}`:qd(t,e)).padEnd(e)}function qd(t,e){let r=t.toString();if(r.length<=e)return r;let i=t.toFixed(e);if(i.length>e&&(i=t.toFixed(Math.max(0,e-(i.length-e)))),i.length<=e&&!i.startsWith("0.000")&&!i.startsWith("-0.000"))return i;let n=t.toExponential(e);return n.length>e&&(n=t.toExponential(Math.max(0,e-(n.length-e)))),n.slice(0)}function Z2(t,e){t.prototype.add=function(i){return typeof i=="number"?this.addS(i):this.addM(i)},t.prototype.addS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+i);return this},t.prototype.addM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+i.get(n,o));return this},t.add=function(i,n){return new e(i).add(n)},t.prototype.sub=function(i){return typeof i=="number"?this.subS(i):this.subM(i)},t.prototype.subS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-i);return this},t.prototype.subM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-i.get(n,o));return this},t.sub=function(i,n){return new e(i).sub(n)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(i){return typeof i=="number"?this.mulS(i):this.mulM(i)},t.prototype.mulS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*i);return this},t.prototype.mulM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*i.get(n,o));return this},t.mul=function(i,n){return new e(i).mul(n)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(i){return typeof i=="number"?this.divS(i):this.divM(i)},t.prototype.divS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/i);return this},t.prototype.divM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/i.get(n,o));return this},t.div=function(i,n){return new e(i).div(n)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(i){return typeof i=="number"?this.modS(i):this.modM(i)},t.prototype.modS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%i);return this},t.prototype.modM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%i.get(n,o));return this},t.mod=function(i,n){return new e(i).mod(n)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(i){return typeof i=="number"?this.andS(i):this.andM(i)},t.prototype.andS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&i);return this},t.prototype.andM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&i.get(n,o));return this},t.and=function(i,n){return new e(i).and(n)},t.prototype.or=function(i){return typeof i=="number"?this.orS(i):this.orM(i)},t.prototype.orS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|i);return this},t.prototype.orM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|i.get(n,o));return this},t.or=function(i,n){return new e(i).or(n)},t.prototype.xor=function(i){return typeof i=="number"?this.xorS(i):this.xorM(i)},t.prototype.xorS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^i);return this},t.prototype.xorM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^i.get(n,o));return this},t.xor=function(i,n){return new e(i).xor(n)},t.prototype.leftShift=function(i){return typeof i=="number"?this.leftShiftS(i):this.leftShiftM(i)},t.prototype.leftShiftS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<i);return this},t.prototype.leftShiftM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<i.get(n,o));return this},t.leftShift=function(i,n){return new e(i).leftShift(n)},t.prototype.signPropagatingRightShift=function(i){return typeof i=="number"?this.signPropagatingRightShiftS(i):this.signPropagatingRightShiftM(i)},t.prototype.signPropagatingRightShiftS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>i);return this},t.prototype.signPropagatingRightShiftM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>i.get(n,o));return this},t.signPropagatingRightShift=function(i,n){return new e(i).signPropagatingRightShift(n)},t.prototype.rightShift=function(i){return typeof i=="number"?this.rightShiftS(i):this.rightShiftM(i)},t.prototype.rightShiftS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>i);return this},t.prototype.rightShiftM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>i.get(n,o));return this},t.rightShift=function(i,n){return new e(i).rightShift(n)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,~this.get(i,n));return this},t.not=function(i){return new e(i).not()},t.prototype.abs=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.abs(this.get(i,n)));return this},t.abs=function(i){return new e(i).abs()},t.prototype.acos=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.acos(this.get(i,n)));return this},t.acos=function(i){return new e(i).acos()},t.prototype.acosh=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.acosh(this.get(i,n)));return this},t.acosh=function(i){return new e(i).acosh()},t.prototype.asin=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.asin(this.get(i,n)));return this},t.asin=function(i){return new e(i).asin()},t.prototype.asinh=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.asinh(this.get(i,n)));return this},t.asinh=function(i){return new e(i).asinh()},t.prototype.atan=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.atan(this.get(i,n)));return this},t.atan=function(i){return new e(i).atan()},t.prototype.atanh=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.atanh(this.get(i,n)));return this},t.atanh=function(i){return new e(i).atanh()},t.prototype.cbrt=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.cbrt(this.get(i,n)));return this},t.cbrt=function(i){return new e(i).cbrt()},t.prototype.ceil=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.ceil(this.get(i,n)));return this},t.ceil=function(i){return new e(i).ceil()},t.prototype.clz32=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.clz32(this.get(i,n)));return this},t.clz32=function(i){return new e(i).clz32()},t.prototype.cos=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.cos(this.get(i,n)));return this},t.cos=function(i){return new e(i).cos()},t.prototype.cosh=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.cosh(this.get(i,n)));return this},t.cosh=function(i){return new e(i).cosh()},t.prototype.exp=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.exp(this.get(i,n)));return this},t.exp=function(i){return new e(i).exp()},t.prototype.expm1=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.expm1(this.get(i,n)));return this},t.expm1=function(i){return new e(i).expm1()},t.prototype.floor=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.floor(this.get(i,n)));return this},t.floor=function(i){return new e(i).floor()},t.prototype.fround=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.fround(this.get(i,n)));return this},t.fround=function(i){return new e(i).fround()},t.prototype.log=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.log(this.get(i,n)));return this},t.log=function(i){return new e(i).log()},t.prototype.log1p=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.log1p(this.get(i,n)));return this},t.log1p=function(i){return new e(i).log1p()},t.prototype.log10=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.log10(this.get(i,n)));return this},t.log10=function(i){return new e(i).log10()},t.prototype.log2=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.log2(this.get(i,n)));return this},t.log2=function(i){return new e(i).log2()},t.prototype.round=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.round(this.get(i,n)));return this},t.round=function(i){return new e(i).round()},t.prototype.sign=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.sign(this.get(i,n)));return this},t.sign=function(i){return new e(i).sign()},t.prototype.sin=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.sin(this.get(i,n)));return this},t.sin=function(i){return new e(i).sin()},t.prototype.sinh=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.sinh(this.get(i,n)));return this},t.sinh=function(i){return new e(i).sinh()},t.prototype.sqrt=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.sqrt(this.get(i,n)));return this},t.sqrt=function(i){return new e(i).sqrt()},t.prototype.tan=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.tan(this.get(i,n)));return this},t.tan=function(i){return new e(i).tan()},t.prototype.tanh=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.tanh(this.get(i,n)));return this},t.tanh=function(i){return new e(i).tanh()},t.prototype.trunc=function(){for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.set(i,n,Math.trunc(this.get(i,n)));return this},t.trunc=function(i){return new e(i).trunc()},t.pow=function(i,n){return new e(i).pow(n)},t.prototype.pow=function(i){return typeof i=="number"?this.powS(i):this.powM(i)},t.prototype.powS=function(i){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),i));return this},t.prototype.powM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),i.get(n,o)));return this}}function bt(t,e,r){let i=r?t.rows:t.rows-1;if(e<0||e>i)throw new RangeError("Row index out of range")}function yt(t,e,r){let i=r?t.columns:t.columns-1;if(e<0||e>i)throw new RangeError("Column index out of range")}function Zr(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Hr(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Ma(t,e){if(!ht.isAnyArray(e))throw new TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.rows)throw new RangeError("row indices are out of range")}function Ea(t,e){if(!ht.isAnyArray(e))throw new TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.columns)throw new RangeError("column indices are out of range")}function pa(t,e,r,i,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(In("startRow",e),In("endRow",r),In("startColumn",i),In("endColumn",n),e>r||i>n||e<0||e>=t.rows||r<0||r>=t.rows||i<0||i>=t.columns||n<0||n>=t.columns)throw new RangeError("Submatrix indices are out of range")}function Fn(t,e=0){let r=[];for(let i=0;i<t;i++)r.push(e);return r}function In(t,e){if(typeof e!="number")throw new TypeError(`${t} must be a number`)}function Kr(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}function H2(t){let e=Fn(t.rows);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[r]+=t.get(r,i);return e}function J2(t){let e=Fn(t.columns);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[i]+=t.get(r,i);return e}function Q2(t){let e=0;for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)e+=t.get(r,i);return e}function eb(t){let e=Fn(t.rows,1);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[r]*=t.get(r,i);return e}function tb(t){let e=Fn(t.columns,1);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[i]*=t.get(r,i);return e}function rb(t){let e=1;for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)e*=t.get(r,i);return e}function ib(t,e,r){let i=t.rows,n=t.columns,o=[];for(let s=0;s<i;s++){let a=0,h=0,l=0;for(let f=0;f<n;f++)l=t.get(s,f)-r[s],a+=l,h+=l*l;e?o.push((h-a*a/n)/(n-1)):o.push((h-a*a/n)/n)}return o}function nb(t,e,r){let i=t.rows,n=t.columns,o=[];for(let s=0;s<n;s++){let a=0,h=0,l=0;for(let f=0;f<i;f++)l=t.get(f,s)-r[s],a+=l,h+=l*l;e?o.push((h-a*a/i)/(i-1)):o.push((h-a*a/i)/i)}return o}function ob(t,e,r){let i=t.rows,n=t.columns,o=i*n,s=0,a=0,h=0;for(let l=0;l<i;l++)for(let f=0;f<n;f++)h=t.get(l,f)-r,s+=h,a+=h*h;return e?(a-s*s/o)/(o-1):(a-s*s/o)/o}function sb(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e[r])}function ab(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e[i])}function lb(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e)}function hb(t){let e=[];for(let r=0;r<t.rows;r++){let i=0;for(let n=0;n<t.columns;n++)i+=Math.pow(t.get(r,n),2)/(t.columns-1);e.push(Math.sqrt(i))}return e}function fb(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e[r])}function ub(t){let e=[];for(let r=0;r<t.columns;r++){let i=0;for(let n=0;n<t.rows;n++)i+=Math.pow(t.get(n,r),2)/(t.rows-1);e.push(Math.sqrt(i))}return e}function cb(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e[i])}function db(t){let e=t.size-1,r=0;for(let i=0;i<t.columns;i++)for(let n=0;n<t.rows;n++)r+=Math.pow(t.get(n,i),2)/e;return Math.sqrt(r)}function pb(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e)}var Fe=class t{static from1DArray(e,r,i){if(e*r!==i.length)throw new RangeError("data length does not match given dimensions");let o=new W(e,r);for(let s=0;s<e;s++)for(let a=0;a<r;a++)o.set(s,a,i[s*r+a]);return o}static rowVector(e){let r=new W(1,e.length);for(let i=0;i<e.length;i++)r.set(0,i,e[i]);return r}static columnVector(e){let r=new W(e.length,1);for(let i=0;i<e.length;i++)r.set(i,0,e[i]);return r}static zeros(e,r){return new W(e,r)}static ones(e,r){return new W(e,r).fill(1)}static rand(e,r,i={}){if(typeof i!="object")throw new TypeError("options must be an object");let{random:n=Math.random}=i,o=new W(e,r);for(let s=0;s<e;s++)for(let a=0;a<r;a++)o.set(s,a,n());return o}static randInt(e,r,i={}){if(typeof i!="object")throw new TypeError("options must be an object");let{min:n=0,max:o=1e3,random:s=Math.random}=i;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let a=o-n,h=new W(e,r);for(let l=0;l<e;l++)for(let f=0;f<r;f++){let u=n+Math.round(s()*a);h.set(l,f,u)}return h}static eye(e,r,i){r===void 0&&(r=e),i===void 0&&(i=1);let n=Math.min(e,r),o=this.zeros(e,r);for(let s=0;s<n;s++)o.set(s,s,i);return o}static diag(e,r,i){let n=e.length;r===void 0&&(r=n),i===void 0&&(i=r);let o=Math.min(n,r,i),s=this.zeros(r,i);for(let a=0;a<o;a++)s.set(a,a,e[a]);return s}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let i=e.rows,n=e.columns,o=new W(i,n);for(let s=0;s<i;s++)for(let a=0;a<n;a++)o.set(s,a,Math.min(e.get(s,a),r.get(s,a)));return o}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let i=e.rows,n=e.columns,o=new this(i,n);for(let s=0;s<i;s++)for(let a=0;a<n;a++)o.set(s,a,Math.max(e.get(s,a),r.get(s,a)));return o}static checkMatrix(e){return t.isMatrix(e)?e:new W(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)e.call(this,r,i);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)e.push(this.get(r,i));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let i=0;i<this.columns;i++)e[r].push(this.get(r,i))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,i=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>i?(o=!0,i=r):(n=!1,o=!0);e++}return n}isReducedEchelonForm(){let e=0,r=0,i=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>i?(o=!0,i=r):(n=!1,o=!0);for(let s=r+1;s<this.rows;s++)this.get(e,s)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),r=0,i=0;for(;r<e.rows&&i<e.columns;){let n=r;for(let o=r;o<e.rows;o++)e.get(o,i)>e.get(n,i)&&(n=o);if(e.get(n,i)===0)i++;else{e.swapRows(r,n);let o=e.get(r,i);for(let s=i;s<e.columns;s++)e.set(r,s,e.get(r,s)/o);for(let s=r+1;s<e.rows;s++){let a=e.get(s,i)/e.get(r,i);e.set(s,i,0);for(let h=i+1;h<e.columns;h++)e.set(s,h,e.get(s,h)-e.get(r,h)*a)}r++,i++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,i=e.rows,n=i-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let o=0,s=!1;for(;o<i&&s===!1;)e.get(n,o)===1?s=!0:o++;for(let a=0;a<n;a++){let h=e.get(a,o);for(let l=o;l<r;l++){let f=e.get(a,l)-h*e.get(n,l);e.set(a,l,f)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");let{rows:r=1,columns:i=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(i)||i<=0)throw new TypeError("columns must be a positive integer");let n=new W(this.rows*r,this.columns*i);for(let o=0;o<r;o++)for(let s=0;s<i;s++)n.setSubMatrix(this,this.rows*o,this.columns*s);return n}fill(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,e);return this}neg(){return this.mulS(-1)}getRow(e){bt(this,e);let r=[];for(let i=0;i<this.columns;i++)r.push(this.get(e,i));return r}getRowVector(e){return W.rowVector(this.getRow(e))}setRow(e,r){bt(this,e),r=Zr(this,r);for(let i=0;i<this.columns;i++)this.set(e,i,r[i]);return this}swapRows(e,r){bt(this,e),bt(this,r);for(let i=0;i<this.columns;i++){let n=this.get(e,i);this.set(e,i,this.get(r,i)),this.set(r,i,n)}return this}getColumn(e){yt(this,e);let r=[];for(let i=0;i<this.rows;i++)r.push(this.get(i,e));return r}getColumnVector(e){return W.columnVector(this.getColumn(e))}setColumn(e,r){yt(this,e),r=Hr(this,r);for(let i=0;i<this.rows;i++)this.set(i,e,r[i]);return this}swapColumns(e,r){yt(this,e),yt(this,r);for(let i=0;i<this.rows;i++){let n=this.get(i,e);this.set(i,e,this.get(i,r)),this.set(i,r,n)}return this}addRowVector(e){e=Zr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)+e[i]);return this}subRowVector(e){e=Zr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)-e[i]);return this}mulRowVector(e){e=Zr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)*e[i]);return this}divRowVector(e){e=Zr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)/e[i]);return this}addColumnVector(e){e=Hr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)+e[r]);return this}subColumnVector(e){e=Hr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)-e[r]);return this}mulColumnVector(e){e=Hr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)*e[r]);return this}divColumnVector(e){e=Hr(this,e);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)/e[r]);return this}mulRow(e,r){bt(this,e);for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)*r);return this}mulColumn(e,r){yt(this,e);for(let i=0;i<this.rows;i++)this.set(i,e,this.get(i,e)*r);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{let r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)>r[i]&&(r[i]=this.get(i,n));return r}case"column":{let r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)>r[n]&&(r[n]=this.get(i,n));return r}case void 0:{let r=this.get(0,0);for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)>r&&(r=this.get(i,n));return r}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){Kr(this);let e=this.get(0,0),r=[0,0];for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)>e&&(e=this.get(i,n),r[0]=i,r[1]=n);return r}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{let r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)<r[i]&&(r[i]=this.get(i,n));return r}case"column":{let r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)<r[n]&&(r[n]=this.get(i,n));return r}case void 0:{let r=this.get(0,0);for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)<r&&(r=this.get(i,n));return r}default:throw new Error(`invalid option: ${e}`)}}minIndex(){Kr(this);let e=this.get(0,0),r=[0,0];for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)<e&&(e=this.get(i,n),r[0]=i,r[1]=n);return r}maxRow(e){if(bt(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let i=1;i<this.columns;i++)this.get(e,i)>r&&(r=this.get(e,i));return r}maxRowIndex(e){bt(this,e),Kr(this);let r=this.get(e,0),i=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>r&&(r=this.get(e,n),i[1]=n);return i}minRow(e){if(bt(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let i=1;i<this.columns;i++)this.get(e,i)<r&&(r=this.get(e,i));return r}minRowIndex(e){bt(this,e),Kr(this);let r=this.get(e,0),i=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<r&&(r=this.get(e,n),i[1]=n);return i}maxColumn(e){if(yt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let i=1;i<this.rows;i++)this.get(i,e)>r&&(r=this.get(i,e));return r}maxColumnIndex(e){yt(this,e),Kr(this);let r=this.get(0,e),i=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>r&&(r=this.get(n,e),i[0]=n);return i}minColumn(e){if(yt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let i=1;i<this.rows;i++)this.get(i,e)<r&&(r=this.get(i,e));return r}minColumnIndex(e){yt(this,e),Kr(this);let r=this.get(0,e),i=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<r&&(r=this.get(n,e),i[0]=n);return i}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let i=0;i<e;i++)r.push(this.get(i,i));return r}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)e+=this.get(r,i),this.set(r,i,e);return this}dot(e){t.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let i=0;for(let n=0;n<r.length;n++)i+=r[n]*e[n];return i}mmul(e){e=W.checkMatrix(e);let r=this.rows,i=this.columns,n=e.columns,o=new W(r,n),s=new Float64Array(i);for(let a=0;a<n;a++){for(let h=0;h<i;h++)s[h]=e.get(h,a);for(let h=0;h<r;h++){let l=0;for(let f=0;f<i;f++)l+=this.get(h,f)*s[f];o.set(h,a,l)}}return o}strassen2x2(e){e=W.checkMatrix(e);let r=new W(2,2),i=this.get(0,0),n=e.get(0,0),o=this.get(0,1),s=e.get(0,1),a=this.get(1,0),h=e.get(1,0),l=this.get(1,1),f=e.get(1,1),u=(i+l)*(n+f),c=(a+l)*n,d=i*(s-f),p=l*(h-n),g=(i+o)*f,x=(a-i)*(n+s),m=(o-l)*(h+f),w=u+p-g+m,y=d+g,M=c+p,_=u-c+d+x;return r.set(0,0,w),r.set(0,1,y),r.set(1,0,M),r.set(1,1,_),r}strassen3x3(e){e=W.checkMatrix(e);let r=new W(3,3),i=this.get(0,0),n=this.get(0,1),o=this.get(0,2),s=this.get(1,0),a=this.get(1,1),h=this.get(1,2),l=this.get(2,0),f=this.get(2,1),u=this.get(2,2),c=e.get(0,0),d=e.get(0,1),p=e.get(0,2),g=e.get(1,0),x=e.get(1,1),m=e.get(1,2),w=e.get(2,0),y=e.get(2,1),M=e.get(2,2),_=(i+n+o-s-a-f-u)*x,R=(i-s)*(-d+x),E=a*(-c+d+g-x-m-w+M),A=(-i+s+a)*(c-d+x),I=(s+a)*(-c+d),b=i*c,k=(-i+l+f)*(c-p+m),B=(-i+l)*(p-m),S=(l+f)*(-c+p),j=(i+n+o-a-h-l-f)*m,L=f*(-c+p+g-x-m-w+y),G=(-o+f+u)*(x+w-y),H=(o-u)*(x-y),Q=o*w,te=(f+u)*(-w+y),he=(-o+a+h)*(m+w-M),ae=(o-h)*(m-M),ne=(a+h)*(-w+M),Y=n*g,P=h*y,q=s*p,se=l*d,J=u*M,fe=b+Q+Y,ue=_+A+I+b+G+Q+te,oe=b+k+S+j+Q+he+ne,V=R+E+A+b+Q+he+ae,z=R+A+I+b+P,Ee=Q+he+ae+ne+q,le=b+k+B+L+G+H+Q,de=G+H+Q+te+se,ze=b+k+B+S+J;return r.set(0,0,fe),r.set(0,1,ue),r.set(0,2,oe),r.set(1,0,V),r.set(1,1,z),r.set(1,2,Ee),r.set(2,0,le),r.set(2,1,de),r.set(2,2,ze),r}mmulStrassen(e){e=W.checkMatrix(e);let r=this.clone(),i=r.rows,n=r.columns,o=e.rows,s=e.columns;n!==o&&console.warn(`Multiplying ${i} x ${n} and ${o} x ${s} matrix: dimensions do not match.`);function a(u,c,d){let p=u.rows,g=u.columns;if(p===c&&g===d)return u;{let x=t.zeros(c,d);return x=x.setSubMatrix(u,0,0),x}}let h=Math.max(i,o),l=Math.max(n,s);r=a(r,h,l),e=a(e,h,l);function f(u,c,d,p){if(d<=512||p<=512)return u.mmul(c);d%2===1&&p%2===1?(u=a(u,d+1,p+1),c=a(c,d+1,p+1)):d%2===1?(u=a(u,d+1,p),c=a(c,d+1,p)):p%2===1&&(u=a(u,d,p+1),c=a(c,d,p+1));let g=parseInt(u.rows/2,10),x=parseInt(u.columns/2,10),m=u.subMatrix(0,g-1,0,x-1),w=c.subMatrix(0,g-1,0,x-1),y=u.subMatrix(0,g-1,x,u.columns-1),M=c.subMatrix(0,g-1,x,c.columns-1),_=u.subMatrix(g,u.rows-1,0,x-1),R=c.subMatrix(g,c.rows-1,0,x-1),E=u.subMatrix(g,u.rows-1,x,u.columns-1),A=c.subMatrix(g,c.rows-1,x,c.columns-1),I=f(t.add(m,E),t.add(w,A),g,x),b=f(t.add(_,E),w,g,x),k=f(m,t.sub(M,A),g,x),B=f(E,t.sub(R,w),g,x),S=f(t.add(m,y),A,g,x),j=f(t.sub(_,m),t.add(w,M),g,x),L=f(t.sub(y,E),t.add(R,A),g,x),G=t.add(I,B);G.sub(S),G.add(L);let H=t.add(k,S),Q=t.add(b,B),te=t.sub(I,b);te.add(k),te.add(j);let he=t.zeros(2*G.rows,2*G.columns);return he=he.setSubMatrix(G,0,0),he=he.setSubMatrix(H,G.rows,0),he=he.setSubMatrix(Q,0,G.columns),he=he.setSubMatrix(te,G.rows,G.columns),he.subMatrix(0,d-1,0,p-1)}return f(r,e,h,l)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");let{min:r=0,max:i=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(i))throw new TypeError("max must be a number");if(r>=i)throw new RangeError("min must be smaller than max");let n=new W(this.rows,this.columns);for(let o=0;o<this.rows;o++){let s=this.getRow(o);s.length>0&&Gd(s,{min:r,max:i,output:s}),n.setRow(o,s)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");let{min:r=0,max:i=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(i))throw new TypeError("max must be a number");if(r>=i)throw new RangeError("min must be smaller than max");let n=new W(this.rows,this.columns);for(let o=0;o<this.columns;o++){let s=this.getColumn(o);s.length&&Gd(s,{min:r,max:i,output:s}),n.setColumn(o,s)}return n}flipRows(){let e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let i=0;i<e;i++){let n=this.get(r,i),o=this.get(r,this.columns-1-i);this.set(r,i,o),this.set(r,this.columns-1-i,n)}return this}flipColumns(){let e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let i=0;i<e;i++){let n=this.get(i,r),o=this.get(this.rows-1-i,r);this.set(i,r,o),this.set(this.rows-1-i,r,n)}return this}kroneckerProduct(e){e=W.checkMatrix(e);let r=this.rows,i=this.columns,n=e.rows,o=e.columns,s=new W(r*n,i*o);for(let a=0;a<r;a++)for(let h=0;h<i;h++)for(let l=0;l<n;l++)for(let f=0;f<o;f++)s.set(n*a+l,o*h+f,this.get(a,h)*e.get(l,f));return s}kroneckerSum(e){if(e=W.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,i=e.rows,n=this.kroneckerProduct(W.eye(i,i)),o=W.eye(r,r).kroneckerProduct(e);return n.add(o)}transpose(){let e=new W(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)e.set(i,r,this.get(r,i));return e}sortRows(e=Vd){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=Vd){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,i,n){pa(this,e,r,i,n);let o=new W(r-e+1,n-i+1);for(let s=e;s<=r;s++)for(let a=i;a<=n;a++)o.set(s-e,a-i,this.get(s,a));return o}subMatrixRow(e,r,i){if(r===void 0&&(r=0),i===void 0&&(i=this.columns-1),r>i||r<0||r>=this.columns||i<0||i>=this.columns)throw new RangeError("Argument out of range");let n=new W(e.length,i-r+1);for(let o=0;o<e.length;o++)for(let s=r;s<=i;s++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);n.set(o,s-r,this.get(e[o],s))}return n}subMatrixColumn(e,r,i){if(r===void 0&&(r=0),i===void 0&&(i=this.rows-1),r>i||r<0||r>=this.rows||i<0||i>=this.rows)throw new RangeError("Argument out of range");let n=new W(i-r+1,e.length);for(let o=0;o<e.length;o++)for(let s=r;s<=i;s++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);n.set(s-r,o,this.get(s,e[o]))}return n}setSubMatrix(e,r,i){if(e=W.checkMatrix(e),e.isEmpty())return this;let n=r+e.rows-1,o=i+e.columns-1;pa(this,r,n,i,o);for(let s=0;s<e.rows;s++)for(let a=0;a<e.columns;a++)this.set(r+s,i+a,e.get(s,a));return this}selection(e,r){Ma(this,e),Ea(this,r);let i=new W(e.length,r.length);for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<r.length;s++){let a=r[s];i.set(n,s,this.get(o,a))}}return i}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let i=0;i<e;i++)r+=this.get(i,i);return r}clone(){let e=new W(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)e.set(r,i,this.get(r,i));return e}sum(e){switch(e){case"row":return H2(this);case"column":return J2(this);case void 0:return Q2(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return eb(this);case"column":return tb(this);case void 0:return rb(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){let r=this.sum(e);switch(e){case"row":{for(let i=0;i<this.rows;i++)r[i]/=this.columns;return r}case"column":{for(let i=0;i<this.columns;i++)r[i]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let{unbiased:i=!0,mean:n=this.mean(e)}=r;if(typeof i!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!ht.isAnyArray(n))throw new TypeError("mean must be an array");return ib(this,i,n)}case"column":{if(!ht.isAnyArray(n))throw new TypeError("mean must be an array");return nb(this,i,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return ob(this,i,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);let i=this.variance(e,r);if(e===void 0)return Math.sqrt(i);for(let n=0;n<i.length;n++)i[n]=Math.sqrt(i[n]);return i}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let{center:i=this.mean(e)}=r;switch(e){case"row":{if(!ht.isAnyArray(i))throw new TypeError("center must be an array");return sb(this,i),this}case"column":{if(!ht.isAnyArray(i))throw new TypeError("center must be an array");return ab(this,i),this}case void 0:{if(typeof i!="number")throw new TypeError("center must be a number");return lb(this,i),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let i=r.scale;switch(e){case"row":{if(i===void 0)i=hb(this);else if(!ht.isAnyArray(i))throw new TypeError("scale must be an array");return fb(this,i),this}case"column":{if(i===void 0)i=ub(this);else if(!ht.isAnyArray(i))throw new TypeError("scale must be an array");return cb(this,i),this}case void 0:{if(i===void 0)i=db(this);else if(typeof i!="number")throw new TypeError("scale must be a number");return pb(this,i),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return Wd(this,e)}};Fe.prototype.klass="Matrix";typeof Symbol<"u"&&(Fe.prototype[Symbol.for("nodejs.util.inspect.custom")]=$2);function Vd(t,e){return t-e}function mb(t){return t.every(e=>typeof e=="number")}Fe.random=Fe.rand;Fe.randomInt=Fe.randInt;Fe.diagonal=Fe.diag;Fe.prototype.diagonal=Fe.prototype.diag;Fe.identity=Fe.eye;Fe.prototype.negate=Fe.prototype.neg;Fe.prototype.tensorProduct=Fe.prototype.kroneckerProduct;var W=class t extends Fe{constructor(e,r){if(super(),t.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let i=0;i<e;i++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(ht.isAnyArray(e)){let i=e;if(e=i.length,r=e?i[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(i[n].length!==r)throw new RangeError("Inconsistent array dimensions");if(!mb(i[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(i[n]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,i){return this.data[e][r]=i,this}get(e,r){return this.data[e][r]}removeRow(e){return bt(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),bt(this,e,!0),r=Float64Array.from(Zr(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){yt(this,e);for(let r=0;r<this.rows;r++){let i=new Float64Array(this.columns-1);for(let n=0;n<e;n++)i[n]=this.data[r][n];for(let n=e+1;n<this.columns;n++)i[n-1]=this.data[r][n];this.data[r]=i}return this.columns-=1,this}addColumn(e,r){typeof r>"u"&&(r=e,e=this.columns),yt(this,e,!0),r=Hr(this,r);for(let i=0;i<this.rows;i++){let n=new Float64Array(this.columns+1),o=0;for(;o<e;o++)n[o]=this.data[i][o];for(n[o++]=r[i];o<this.columns+1;o++)n[o]=this.data[i][o-1];this.data[i]=n}return this.columns+=1,this}};Z2(Fe,W);var Et=class extends Fe{constructor(e,r,i){super(),this.matrix=e,this.rows=r,this.columns=i}},ma=class extends Et{constructor(e,r){yt(e,r),super(e,e.rows,1),this.column=r}set(e,r,i){return this.matrix.set(e,this.column,i),this}get(e){return this.matrix.get(e,this.column)}},ga=class extends Et{constructor(e,r){Ea(e,r),super(e,e.rows,r.length),this.columnIndices=r}set(e,r,i){return this.matrix.set(e,this.columnIndices[r],i),this}get(e,r){return this.matrix.get(e,this.columnIndices[r])}},xa=class extends Et{constructor(e){super(e,e.rows,e.columns)}set(e,r,i){return this.matrix.set(e,this.columns-r-1,i),this}get(e,r){return this.matrix.get(e,this.columns-r-1)}},wa=class extends Et{constructor(e){super(e,e.rows,e.columns)}set(e,r,i){return this.matrix.set(this.rows-e-1,r,i),this}get(e,r){return this.matrix.get(this.rows-e-1,r)}},ba=class extends Et{constructor(e,r){bt(e,r),super(e,1,e.columns),this.row=r}set(e,r,i){return this.matrix.set(this.row,r,i),this}get(e,r){return this.matrix.get(this.row,r)}},ya=class extends Et{constructor(e,r){Ma(e,r),super(e,r.length,e.columns),this.rowIndices=r}set(e,r,i){return this.matrix.set(this.rowIndices[e],r,i),this}get(e,r){return this.matrix.get(this.rowIndices[e],r)}},Jr=class extends Et{constructor(e,r,i){Ma(e,r),Ea(e,i),super(e,r.length,i.length),this.rowIndices=r,this.columnIndices=i}set(e,r,i){return this.matrix.set(this.rowIndices[e],this.columnIndices[r],i),this}get(e,r){return this.matrix.get(this.rowIndices[e],this.columnIndices[r])}},va=class extends Et{constructor(e,r,i,n,o){pa(e,r,i,n,o),super(e,i-r+1,o-n+1),this.startRow=r,this.startColumn=n}set(e,r,i){return this.matrix.set(this.startRow+e,this.startColumn+r,i),this}get(e,r){return this.matrix.get(this.startRow+e,this.startColumn+r)}},_a=class extends Et{constructor(e){super(e,e.columns,e.rows)}set(e,r,i){return this.matrix.set(r,e,i),this}get(e,r){return this.matrix.get(r,e)}},Pn=class extends Fe{constructor(e,r={}){let{rows:i=1}=r;if(e.length%i!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=i,this.columns=e.length/i,this.data=e}set(e,r,i){let n=this._calculateIndex(e,r);return this.data[n]=i,this}get(e,r){let i=this._calculateIndex(e,r);return this.data[i]}_calculateIndex(e,r){return e*this.columns+r}},it=class extends Fe{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,i){return this.data[e][r]=i,this}get(e,r){return this.data[e][r]}};function gb(t,e){if(ht.isAnyArray(t))return t[0]&&ht.isAnyArray(t[0])?new it(t):new Pn(t,e);throw new Error("the argument is not an array")}var Qr=class{constructor(e){e=it.checkMatrix(e);let r=e.clone(),i=r.rows,n=r.columns,o=new Float64Array(i),s=1,a,h,l,f,u,c,d,p,g;for(a=0;a<i;a++)o[a]=a;for(p=new Float64Array(i),h=0;h<n;h++){for(a=0;a<i;a++)p[a]=r.get(a,h);for(a=0;a<i;a++){for(g=Math.min(a,h),u=0,l=0;l<g;l++)u+=r.get(a,l)*p[l];p[a]-=u,r.set(a,h,p[a])}for(f=h,a=h+1;a<i;a++)Math.abs(p[a])>Math.abs(p[f])&&(f=a);if(f!==h){for(l=0;l<n;l++)c=r.get(f,l),r.set(f,l,r.get(h,l)),r.set(h,l,c);d=o[f],o[f]=o[h],o[h]=d,s=-s}if(h<i&&r.get(h,h)!==0)for(a=h+1;a<i;a++)r.set(a,h,r.get(a,h)/r.get(h,h))}this.LU=r,this.pivotVector=o,this.pivotSign=s}isSingular(){let e=this.LU,r=e.columns;for(let i=0;i<r;i++)if(e.get(i,i)===0)return!0;return!1}solve(e){e=W.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=e.columns,o=e.subMatrixRow(this.pivotVector,0,n-1),s=r.columns,a,h,l;for(l=0;l<s;l++)for(a=l+1;a<s;a++)for(h=0;h<n;h++)o.set(a,h,o.get(a,h)-o.get(l,h)*r.get(a,l));for(l=s-1;l>=0;l--){for(h=0;h<n;h++)o.set(l,h,o.get(l,h)/r.get(l,l));for(a=0;a<l;a++)for(h=0;h<n;h++)o.set(a,h,o.get(a,h)-o.get(l,h)*r.get(a,l))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,i=e.columns;for(let n=0;n<i;n++)r*=e.get(n,n);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,i=e.columns,n=new W(r,i);for(let o=0;o<r;o++)for(let s=0;s<i;s++)o>s?n.set(o,s,e.get(o,s)):o===s?n.set(o,s,1):n.set(o,s,0);return n}get upperTriangularMatrix(){let e=this.LU,r=e.rows,i=e.columns,n=new W(r,i);for(let o=0;o<r;o++)for(let s=0;s<i;s++)o<=s?n.set(o,s,e.get(o,s)):n.set(o,s,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function jt(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):e!==0?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}var Oi=class{constructor(e){e=it.checkMatrix(e);let r=e.clone(),i=e.rows,n=e.columns,o=new Float64Array(n),s,a,h,l;for(h=0;h<n;h++){let f=0;for(s=h;s<i;s++)f=jt(f,r.get(s,h));if(f!==0){for(r.get(h,h)<0&&(f=-f),s=h;s<i;s++)r.set(s,h,r.get(s,h)/f);for(r.set(h,h,r.get(h,h)+1),a=h+1;a<n;a++){for(l=0,s=h;s<i;s++)l+=r.get(s,h)*r.get(s,a);for(l=-l/r.get(h,h),s=h;s<i;s++)r.set(s,a,r.get(s,a)+l*r.get(s,h))}}o[h]=-f}this.QR=r,this.Rdiag=o}solve(e){e=W.checkMatrix(e);let r=this.QR,i=r.rows;if(e.rows!==i)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,o=e.clone(),s=r.columns,a,h,l,f;for(l=0;l<s;l++)for(h=0;h<n;h++){for(f=0,a=l;a<i;a++)f+=r.get(a,l)*o.get(a,h);for(f=-f/r.get(l,l),a=l;a<i;a++)o.set(a,h,o.get(a,h)+f*r.get(a,l))}for(l=s-1;l>=0;l--){for(h=0;h<n;h++)o.set(l,h,o.get(l,h)/this.Rdiag[l]);for(a=0;a<l;a++)for(h=0;h<n;h++)o.set(a,h,o.get(a,h)-o.get(l,h)*r.get(a,l))}return o.subMatrix(0,s-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,i=new W(r,r),n,o;for(n=0;n<r;n++)for(o=0;o<r;o++)n<o?i.set(n,o,e.get(n,o)):n===o?i.set(n,o,this.Rdiag[n]):i.set(n,o,0);return i}get orthogonalMatrix(){let e=this.QR,r=e.rows,i=e.columns,n=new W(r,i),o,s,a,h;for(a=i-1;a>=0;a--){for(o=0;o<r;o++)n.set(o,a,0);for(n.set(a,a,1),s=a;s<i;s++)if(e.get(a,a)!==0){for(h=0,o=a;o<r;o++)h+=e.get(o,a)*n.get(o,s);for(h=-h/e.get(a,a),o=a;o<r;o++)n.set(o,s,n.get(o,s)+h*e.get(o,a))}}return n}},nr=class{constructor(e,r={}){if(e=it.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let i=e.rows,n=e.columns,{computeLeftSingularVectors:o=!0,computeRightSingularVectors:s=!0,autoTranspose:a=!1}=r,h=!!o,l=!!s,f=!1,u;if(i<n)if(!a)u=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=e.transpose(),i=u.rows,n=u.columns,f=!0;let b=h;h=l,l=b}else u=e.clone();let c=Math.min(i,n),d=Math.min(i+1,n),p=new Float64Array(d),g=new W(i,c),x=new W(n,n),m=new Float64Array(n),w=new Float64Array(i),y=new Float64Array(d);for(let b=0;b<d;b++)y[b]=b;let M=Math.min(i-1,n),_=Math.max(0,Math.min(n-2,i)),R=Math.max(M,_);for(let b=0;b<R;b++){if(b<M){p[b]=0;for(let k=b;k<i;k++)p[b]=jt(p[b],u.get(k,b));if(p[b]!==0){u.get(b,b)<0&&(p[b]=-p[b]);for(let k=b;k<i;k++)u.set(k,b,u.get(k,b)/p[b]);u.set(b,b,u.get(b,b)+1)}p[b]=-p[b]}for(let k=b+1;k<n;k++){if(b<M&&p[b]!==0){let B=0;for(let S=b;S<i;S++)B+=u.get(S,b)*u.get(S,k);B=-B/u.get(b,b);for(let S=b;S<i;S++)u.set(S,k,u.get(S,k)+B*u.get(S,b))}m[k]=u.get(b,k)}if(h&&b<M)for(let k=b;k<i;k++)g.set(k,b,u.get(k,b));if(b<_){m[b]=0;for(let k=b+1;k<n;k++)m[b]=jt(m[b],m[k]);if(m[b]!==0){m[b+1]<0&&(m[b]=0-m[b]);for(let k=b+1;k<n;k++)m[k]/=m[b];m[b+1]+=1}if(m[b]=-m[b],b+1<i&&m[b]!==0){for(let k=b+1;k<i;k++)w[k]=0;for(let k=b+1;k<i;k++)for(let B=b+1;B<n;B++)w[k]+=m[B]*u.get(k,B);for(let k=b+1;k<n;k++){let B=-m[k]/m[b+1];for(let S=b+1;S<i;S++)u.set(S,k,u.get(S,k)+B*w[S])}}if(l)for(let k=b+1;k<n;k++)x.set(k,b,m[k])}}let E=Math.min(n,i+1);if(M<n&&(p[M]=u.get(M,M)),i<E&&(p[E-1]=0),_+1<E&&(m[_]=u.get(_,E-1)),m[E-1]=0,h){for(let b=M;b<c;b++){for(let k=0;k<i;k++)g.set(k,b,0);g.set(b,b,1)}for(let b=M-1;b>=0;b--)if(p[b]!==0){for(let k=b+1;k<c;k++){let B=0;for(let S=b;S<i;S++)B+=g.get(S,b)*g.get(S,k);B=-B/g.get(b,b);for(let S=b;S<i;S++)g.set(S,k,g.get(S,k)+B*g.get(S,b))}for(let k=b;k<i;k++)g.set(k,b,-g.get(k,b));g.set(b,b,1+g.get(b,b));for(let k=0;k<b-1;k++)g.set(k,b,0)}else{for(let k=0;k<i;k++)g.set(k,b,0);g.set(b,b,1)}}if(l)for(let b=n-1;b>=0;b--){if(b<_&&m[b]!==0)for(let k=b+1;k<n;k++){let B=0;for(let S=b+1;S<n;S++)B+=x.get(S,b)*x.get(S,k);B=-B/x.get(b+1,b);for(let S=b+1;S<n;S++)x.set(S,k,x.get(S,k)+B*x.get(S,b))}for(let k=0;k<n;k++)x.set(k,b,0);x.set(b,b,1)}let A=E-1,I=Number.EPSILON;for(;E>0;){let b,k;for(b=E-2;b>=-1&&b!==-1;b--){let B=Number.MIN_VALUE+I*Math.abs(p[b]+Math.abs(p[b+1]));if(Math.abs(m[b])<=B||Number.isNaN(m[b])){m[b]=0;break}}if(b===E-2)k=4;else{let B;for(B=E-1;B>=b&&B!==b;B--){let S=(B!==E?Math.abs(m[B]):0)+(B!==b+1?Math.abs(m[B-1]):0);if(Math.abs(p[B])<=I*S){p[B]=0;break}}B===b?k=3:B===E-1?k=1:(k=2,b=B)}switch(b++,k){case 1:{let B=m[E-2];m[E-2]=0;for(let S=E-2;S>=b;S--){let j=jt(p[S],B),L=p[S]/j,G=B/j;if(p[S]=j,S!==b&&(B=-G*m[S-1],m[S-1]=L*m[S-1]),l)for(let H=0;H<n;H++)j=L*x.get(H,S)+G*x.get(H,E-1),x.set(H,E-1,-G*x.get(H,S)+L*x.get(H,E-1)),x.set(H,S,j)}break}case 2:{let B=m[b-1];m[b-1]=0;for(let S=b;S<E;S++){let j=jt(p[S],B),L=p[S]/j,G=B/j;if(p[S]=j,B=-G*m[S],m[S]=L*m[S],h)for(let H=0;H<i;H++)j=L*g.get(H,S)+G*g.get(H,b-1),g.set(H,b-1,-G*g.get(H,S)+L*g.get(H,b-1)),g.set(H,S,j)}break}case 3:{let B=Math.max(Math.abs(p[E-1]),Math.abs(p[E-2]),Math.abs(m[E-2]),Math.abs(p[b]),Math.abs(m[b])),S=p[E-1]/B,j=p[E-2]/B,L=m[E-2]/B,G=p[b]/B,H=m[b]/B,Q=((j+S)*(j-S)+L*L)/2,te=S*L*(S*L),he=0;(Q!==0||te!==0)&&(Q<0?he=0-Math.sqrt(Q*Q+te):he=Math.sqrt(Q*Q+te),he=te/(Q+he));let ae=(G+S)*(G-S)+he,ne=G*H;for(let Y=b;Y<E-1;Y++){let P=jt(ae,ne);P===0&&(P=Number.MIN_VALUE);let q=ae/P,se=ne/P;if(Y!==b&&(m[Y-1]=P),ae=q*p[Y]+se*m[Y],m[Y]=q*m[Y]-se*p[Y],ne=se*p[Y+1],p[Y+1]=q*p[Y+1],l)for(let J=0;J<n;J++)P=q*x.get(J,Y)+se*x.get(J,Y+1),x.set(J,Y+1,-se*x.get(J,Y)+q*x.get(J,Y+1)),x.set(J,Y,P);if(P=jt(ae,ne),P===0&&(P=Number.MIN_VALUE),q=ae/P,se=ne/P,p[Y]=P,ae=q*m[Y]+se*p[Y+1],p[Y+1]=-se*m[Y]+q*p[Y+1],ne=se*m[Y+1],m[Y+1]=q*m[Y+1],h&&Y<i-1)for(let J=0;J<i;J++)P=q*g.get(J,Y)+se*g.get(J,Y+1),g.set(J,Y+1,-se*g.get(J,Y)+q*g.get(J,Y+1)),g.set(J,Y,P)}m[E-2]=ae;break}case 4:{if(p[b]<=0&&(p[b]=p[b]<0?-p[b]:0,l))for(let B=0;B<=A;B++)x.set(B,b,-x.get(B,b));for(;b<A&&!(p[b]>=p[b+1]);){let B=p[b];if(p[b]=p[b+1],p[b+1]=B,l&&b<n-1)for(let S=0;S<n;S++)B=x.get(S,b+1),x.set(S,b+1,x.get(S,b)),x.set(S,b,B);if(h&&b<i-1)for(let S=0;S<i;S++)B=g.get(S,b+1),g.set(S,b+1,g.get(S,b)),g.set(S,b,B);b++}E--;break}}}if(f){let b=x;x=g,g=b}this.m=i,this.n=n,this.s=p,this.U=g,this.V=x}solve(e){let r=e,i=this.threshold,n=this.s.length,o=W.zeros(n,n);for(let c=0;c<n;c++)Math.abs(this.s[c])<=i?o.set(c,c,0):o.set(c,c,1/this.s[c]);let s=this.U,a=this.rightSingularVectors,h=a.mmul(o),l=a.rows,f=s.rows,u=W.zeros(l,f);for(let c=0;c<l;c++)for(let d=0;d<f;d++){let p=0;for(let g=0;g<n;g++)p+=h.get(c,g)*s.get(d,g);u.set(c,d,p)}return u.mmul(r)}solveForDiagonal(e){return this.solve(W.diag(e))}inverse(){let e=this.V,r=this.threshold,i=e.rows,n=e.columns,o=new W(i,this.s.length);for(let f=0;f<i;f++)for(let u=0;u<n;u++)Math.abs(this.s[u])>r&&o.set(f,u,e.get(f,u)/this.s[u]);let s=this.U,a=s.rows,h=s.columns,l=new W(i,a);for(let f=0;f<i;f++)for(let u=0;u<a;u++){let c=0;for(let d=0;d<h;d++)c+=o.get(f,d)*s.get(u,d);l.set(f,u,c)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,i=this.s;for(let n=0,o=i.length;n<o;n++)i[n]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return W.diag(this.s)}};function xb(t,e=!1){return t=it.checkMatrix(t),e?new nr(t).inverse():Kd(t,W.eye(t.rows))}function Kd(t,e,r=!1){return t=it.checkMatrix(t),e=it.checkMatrix(e),r?new nr(t).solve(e):t.isSquare()?new Qr(t).solve(e):new Oi(t).solve(e)}function Cn(t){if(t=W.checkMatrix(t),t.isSquare()){if(t.columns===0)return 1;let e,r,i,n;if(t.columns===2)return e=t.get(0,0),r=t.get(0,1),i=t.get(1,0),n=t.get(1,1),e*n-r*i;if(t.columns===3){let o,s,a;return o=new Jr(t,[1,2],[1,2]),s=new Jr(t,[1,2],[0,2]),a=new Jr(t,[1,2],[0,1]),e=t.get(0,0),r=t.get(0,1),i=t.get(0,2),e*Cn(o)-r*Cn(s)+i*Cn(a)}else return new Qr(t).determinant}else throw Error("determinant can only be calculated for a square matrix")}function wb(t,e){let r=[];for(let i=0;i<t;i++)i!==e&&r.push(i);return r}function bb(t,e,r,i=1e-9,n=1e-9){if(t>n)return new Array(e.rows+1).fill(0);{let o=e.addRow(r,[0]);for(let s=0;s<o.rows;s++)Math.abs(o.get(s,0))<i&&o.set(s,0,0);return o.to1DArray()}}function yb(t,e={}){let{thresholdValue:r=1e-9,thresholdError:i=1e-9}=e;t=W.checkMatrix(t);let n=t.rows,o=new W(n,n);for(let s=0;s<n;s++){let a=W.columnVector(t.getRow(s)),h=t.subMatrixRow(wb(n,s)).transpose(),f=new nr(h).solve(a),u=W.sub(a,h.mmul(f)).abs().max();o.setRow(s,bb(u,f,s,r,i))}return o}function vb(t,e=Number.EPSILON){if(t=W.checkMatrix(t),t.isEmpty())return t.transpose();let r=new nr(t,{autoTranspose:!0}),i=r.leftSingularVectors,n=r.rightSingularVectors,o=r.diagonal;for(let s=0;s<o.length;s++)Math.abs(o[s])>e?o[s]=1/o[s]:o[s]=0;return n.mmul(W.diag(o).mmul(i.transpose()))}function _b(t,e=t,r={}){t=new W(t);let i=!1;if(typeof e=="object"&&!W.isMatrix(e)&&!ht.isAnyArray(e)?(r=e,e=t,i=!0):e=new W(e),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");let{center:n=!0}=r;n&&(t=t.center("column"),i||(e=e.center("column")));let o=t.transpose().mmul(e);for(let s=0;s<o.rows;s++)for(let a=0;a<o.columns;a++)o.set(s,a,o.get(s,a)*(1/(t.rows-1)));return o}function Mb(t,e=t,r={}){t=new W(t);let i=!1;if(typeof e=="object"&&!W.isMatrix(e)&&!ht.isAnyArray(e)?(r=e,e=t,i=!0):e=new W(e),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");let{center:n=!0,scale:o=!0}=r;n&&(t.center("column"),i||e.center("column")),o&&(t.scale("column"),i||e.scale("column"));let s=t.standardDeviation("column",{unbiased:!0}),a=i?s:e.standardDeviation("column",{unbiased:!0}),h=t.transpose().mmul(e);for(let l=0;l<h.rows;l++)for(let f=0;f<h.columns;f++)h.set(l,f,h.get(l,f)*(1/(s[l]*a[f]))*(1/(t.rows-1)));return h}var Bn=class{constructor(e,r={}){let{assumeSymmetric:i=!1}=r;if(e=it.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let n=e.columns,o=new W(n,n),s=new Float64Array(n),a=new Float64Array(n),h=e,l,f,u=!1;if(i?u=!0:u=e.isSymmetric(),u){for(l=0;l<n;l++)for(f=0;f<n;f++)o.set(l,f,h.get(l,f));Eb(n,a,s,o),kb(n,a,s,o)}else{let c=new W(n,n),d=new Float64Array(n);for(f=0;f<n;f++)for(l=0;l<n;l++)c.set(l,f,h.get(l,f));Ab(n,c,d,o),Sb(n,a,s,o,c)}this.n=n,this.e=a,this.d=s,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,r=this.e,i=this.d,n=new W(e,e),o,s;for(o=0;o<e;o++){for(s=0;s<e;s++)n.set(o,s,0);n.set(o,o,i[o]),r[o]>0?n.set(o,o+1,r[o]):r[o]<0&&n.set(o,o-1,r[o])}return n}};function Eb(t,e,r,i){let n,o,s,a,h,l,f,u;for(h=0;h<t;h++)r[h]=i.get(t-1,h);for(a=t-1;a>0;a--){for(u=0,s=0,l=0;l<a;l++)u=u+Math.abs(r[l]);if(u===0)for(e[a]=r[a-1],h=0;h<a;h++)r[h]=i.get(a-1,h),i.set(a,h,0),i.set(h,a,0);else{for(l=0;l<a;l++)r[l]/=u,s+=r[l]*r[l];for(n=r[a-1],o=Math.sqrt(s),n>0&&(o=-o),e[a]=u*o,s=s-n*o,r[a-1]=n-o,h=0;h<a;h++)e[h]=0;for(h=0;h<a;h++){for(n=r[h],i.set(h,a,n),o=e[h]+i.get(h,h)*n,l=h+1;l<=a-1;l++)o+=i.get(l,h)*r[l],e[l]+=i.get(l,h)*n;e[h]=o}for(n=0,h=0;h<a;h++)e[h]/=s,n+=e[h]*r[h];for(f=n/(s+s),h=0;h<a;h++)e[h]-=f*r[h];for(h=0;h<a;h++){for(n=r[h],o=e[h],l=h;l<=a-1;l++)i.set(l,h,i.get(l,h)-(n*e[l]+o*r[l]));r[h]=i.get(a-1,h),i.set(a,h,0)}}r[a]=s}for(a=0;a<t-1;a++){if(i.set(t-1,a,i.get(a,a)),i.set(a,a,1),s=r[a+1],s!==0){for(l=0;l<=a;l++)r[l]=i.get(l,a+1)/s;for(h=0;h<=a;h++){for(o=0,l=0;l<=a;l++)o+=i.get(l,a+1)*i.get(l,h);for(l=0;l<=a;l++)i.set(l,h,i.get(l,h)-o*r[l])}}for(l=0;l<=a;l++)i.set(l,a+1,0)}for(h=0;h<t;h++)r[h]=i.get(t-1,h),i.set(t-1,h,0);i.set(t-1,t-1,1),e[0]=0}function kb(t,e,r,i){let n,o,s,a,h,l,f,u,c,d,p,g,x,m,w,y;for(s=1;s<t;s++)e[s-1]=e[s];e[t-1]=0;let M=0,_=0,R=Number.EPSILON;for(l=0;l<t;l++){for(_=Math.max(_,Math.abs(r[l])+Math.abs(e[l])),f=l;f<t&&!(Math.abs(e[f])<=R*_);)f++;if(f>l)do{for(n=r[l],u=(r[l+1]-n)/(2*e[l]),c=jt(u,1),u<0&&(c=-c),r[l]=e[l]/(u+c),r[l+1]=e[l]*(u+c),d=r[l+1],o=n-r[l],s=l+2;s<t;s++)r[s]-=o;for(M=M+o,u=r[f],p=1,g=p,x=p,m=e[l+1],w=0,y=0,s=f-1;s>=l;s--)for(x=g,g=p,y=w,n=p*e[s],o=p*u,c=jt(u,e[s]),e[s+1]=w*c,w=e[s]/c,p=u/c,u=p*r[s]-w*n,r[s+1]=o+w*(p*n+w*r[s]),h=0;h<t;h++)o=i.get(h,s+1),i.set(h,s+1,w*i.get(h,s)+p*o),i.set(h,s,p*i.get(h,s)-w*o);u=-w*y*x*m*e[l]/d,e[l]=w*u,r[l]=p*u}while(Math.abs(e[l])>R*_);r[l]=r[l]+M,e[l]=0}for(s=0;s<t-1;s++){for(h=s,u=r[s],a=s+1;a<t;a++)r[a]<u&&(h=a,u=r[a]);if(h!==s)for(r[h]=r[s],r[s]=u,a=0;a<t;a++)u=i.get(a,s),i.set(a,s,i.get(a,h)),i.set(a,h,u)}}function Ab(t,e,r,i){let n=0,o=t-1,s,a,h,l,f,u,c;for(u=n+1;u<=o-1;u++){for(c=0,l=u;l<=o;l++)c=c+Math.abs(e.get(l,u-1));if(c!==0){for(h=0,l=o;l>=u;l--)r[l]=e.get(l,u-1)/c,h+=r[l]*r[l];for(a=Math.sqrt(h),r[u]>0&&(a=-a),h=h-r[u]*a,r[u]=r[u]-a,f=u;f<t;f++){for(s=0,l=o;l>=u;l--)s+=r[l]*e.get(l,f);for(s=s/h,l=u;l<=o;l++)e.set(l,f,e.get(l,f)-s*r[l])}for(l=0;l<=o;l++){for(s=0,f=o;f>=u;f--)s+=r[f]*e.get(l,f);for(s=s/h,f=u;f<=o;f++)e.set(l,f,e.get(l,f)-s*r[f])}r[u]=c*r[u],e.set(u,u-1,c*a)}}for(l=0;l<t;l++)for(f=0;f<t;f++)i.set(l,f,l===f?1:0);for(u=o-1;u>=n+1;u--)if(e.get(u,u-1)!==0){for(l=u+1;l<=o;l++)r[l]=e.get(l,u-1);for(f=u;f<=o;f++){for(a=0,l=u;l<=o;l++)a+=r[l]*i.get(l,f);for(a=a/r[u]/e.get(u,u-1),l=u;l<=o;l++)i.set(l,f,i.get(l,f)+a*r[l])}}}function Sb(t,e,r,i,n){let o=t-1,s=0,a=t-1,h=Number.EPSILON,l=0,f=0,u=0,c=0,d=0,p=0,g=0,x=0,m,w,y,M,_,R,E,A,I,b,k,B,S,j,L;for(m=0;m<t;m++)for((m<s||m>a)&&(r[m]=n.get(m,m),e[m]=0),w=Math.max(m-1,0);w<t;w++)f=f+Math.abs(n.get(m,w));for(;o>=s;){for(M=o;M>s&&(p=Math.abs(n.get(M-1,M-1))+Math.abs(n.get(M,M)),p===0&&(p=f),!(Math.abs(n.get(M,M-1))<h*p));)M--;if(M===o)n.set(o,o,n.get(o,o)+l),r[o]=n.get(o,o),e[o]=0,o--,x=0;else if(M===o-1){if(E=n.get(o,o-1)*n.get(o-1,o),u=(n.get(o-1,o-1)-n.get(o,o))/2,c=u*u+E,g=Math.sqrt(Math.abs(c)),n.set(o,o,n.get(o,o)+l),n.set(o-1,o-1,n.get(o-1,o-1)+l),A=n.get(o,o),c>=0){for(g=u>=0?u+g:u-g,r[o-1]=A+g,r[o]=r[o-1],g!==0&&(r[o]=A-E/g),e[o-1]=0,e[o]=0,A=n.get(o,o-1),p=Math.abs(A)+Math.abs(g),u=A/p,c=g/p,d=Math.sqrt(u*u+c*c),u=u/d,c=c/d,w=o-1;w<t;w++)g=n.get(o-1,w),n.set(o-1,w,c*g+u*n.get(o,w)),n.set(o,w,c*n.get(o,w)-u*g);for(m=0;m<=o;m++)g=n.get(m,o-1),n.set(m,o-1,c*g+u*n.get(m,o)),n.set(m,o,c*n.get(m,o)-u*g);for(m=s;m<=a;m++)g=i.get(m,o-1),i.set(m,o-1,c*g+u*i.get(m,o)),i.set(m,o,c*i.get(m,o)-u*g)}else r[o-1]=A+u,r[o]=A+u,e[o-1]=g,e[o]=-g;o=o-2,x=0}else{if(A=n.get(o,o),I=0,E=0,M<o&&(I=n.get(o-1,o-1),E=n.get(o,o-1)*n.get(o-1,o)),x===10){for(l+=A,m=s;m<=o;m++)n.set(m,m,n.get(m,m)-A);p=Math.abs(n.get(o,o-1))+Math.abs(n.get(o-1,o-2)),A=I=.75*p,E=-.4375*p*p}if(x===30&&(p=(I-A)/2,p=p*p+E,p>0)){for(p=Math.sqrt(p),I<A&&(p=-p),p=A-E/((I-A)/2+p),m=s;m<=o;m++)n.set(m,m,n.get(m,m)-p);l+=p,A=I=E=.964}for(x=x+1,_=o-2;_>=M&&(g=n.get(_,_),d=A-g,p=I-g,u=(d*p-E)/n.get(_+1,_)+n.get(_,_+1),c=n.get(_+1,_+1)-g-d-p,d=n.get(_+2,_+1),p=Math.abs(u)+Math.abs(c)+Math.abs(d),u=u/p,c=c/p,d=d/p,!(_===M||Math.abs(n.get(_,_-1))*(Math.abs(c)+Math.abs(d))<h*(Math.abs(u)*(Math.abs(n.get(_-1,_-1))+Math.abs(g)+Math.abs(n.get(_+1,_+1))))));)_--;for(m=_+2;m<=o;m++)n.set(m,m-2,0),m>_+2&&n.set(m,m-3,0);for(y=_;y<=o-1&&(j=y!==o-1,y!==_&&(u=n.get(y,y-1),c=n.get(y+1,y-1),d=j?n.get(y+2,y-1):0,A=Math.abs(u)+Math.abs(c)+Math.abs(d),A!==0&&(u=u/A,c=c/A,d=d/A)),A!==0);y++)if(p=Math.sqrt(u*u+c*c+d*d),u<0&&(p=-p),p!==0){for(y!==_?n.set(y,y-1,-p*A):M!==_&&n.set(y,y-1,-n.get(y,y-1)),u=u+p,A=u/p,I=c/p,g=d/p,c=c/u,d=d/u,w=y;w<t;w++)u=n.get(y,w)+c*n.get(y+1,w),j&&(u=u+d*n.get(y+2,w),n.set(y+2,w,n.get(y+2,w)-u*g)),n.set(y,w,n.get(y,w)-u*A),n.set(y+1,w,n.get(y+1,w)-u*I);for(m=0;m<=Math.min(o,y+3);m++)u=A*n.get(m,y)+I*n.get(m,y+1),j&&(u=u+g*n.get(m,y+2),n.set(m,y+2,n.get(m,y+2)-u*d)),n.set(m,y,n.get(m,y)-u),n.set(m,y+1,n.get(m,y+1)-u*c);for(m=s;m<=a;m++)u=A*i.get(m,y)+I*i.get(m,y+1),j&&(u=u+g*i.get(m,y+2),i.set(m,y+2,i.get(m,y+2)-u*d)),i.set(m,y,i.get(m,y)-u),i.set(m,y+1,i.get(m,y+1)-u*c)}}}if(f!==0){for(o=t-1;o>=0;o--)if(u=r[o],c=e[o],c===0)for(M=o,n.set(o,o,1),m=o-1;m>=0;m--){for(E=n.get(m,m)-u,d=0,w=M;w<=o;w++)d=d+n.get(m,w)*n.get(w,o);if(e[m]<0)g=E,p=d;else if(M=m,e[m]===0?n.set(m,o,E!==0?-d/E:-d/(h*f)):(A=n.get(m,m+1),I=n.get(m+1,m),c=(r[m]-u)*(r[m]-u)+e[m]*e[m],R=(A*p-g*d)/c,n.set(m,o,R),n.set(m+1,o,Math.abs(A)>Math.abs(g)?(-d-E*R)/A:(-p-I*R)/g)),R=Math.abs(n.get(m,o)),h*R*R>1)for(w=m;w<=o;w++)n.set(w,o,n.get(w,o)/R)}else if(c<0)for(M=o-1,Math.abs(n.get(o,o-1))>Math.abs(n.get(o-1,o))?(n.set(o-1,o-1,c/n.get(o,o-1)),n.set(o-1,o,-(n.get(o,o)-u)/n.get(o,o-1))):(L=Rn(0,-n.get(o-1,o),n.get(o-1,o-1)-u,c),n.set(o-1,o-1,L[0]),n.set(o-1,o,L[1])),n.set(o,o-1,0),n.set(o,o,1),m=o-2;m>=0;m--){for(b=0,k=0,w=M;w<=o;w++)b=b+n.get(m,w)*n.get(w,o-1),k=k+n.get(m,w)*n.get(w,o);if(E=n.get(m,m)-u,e[m]<0)g=E,d=b,p=k;else if(M=m,e[m]===0?(L=Rn(-b,-k,E,c),n.set(m,o-1,L[0]),n.set(m,o,L[1])):(A=n.get(m,m+1),I=n.get(m+1,m),B=(r[m]-u)*(r[m]-u)+e[m]*e[m]-c*c,S=(r[m]-u)*2*c,B===0&&S===0&&(B=h*f*(Math.abs(E)+Math.abs(c)+Math.abs(A)+Math.abs(I)+Math.abs(g))),L=Rn(A*d-g*b+c*k,A*p-g*k-c*b,B,S),n.set(m,o-1,L[0]),n.set(m,o,L[1]),Math.abs(A)>Math.abs(g)+Math.abs(c)?(n.set(m+1,o-1,(-b-E*n.get(m,o-1)+c*n.get(m,o))/A),n.set(m+1,o,(-k-E*n.get(m,o)-c*n.get(m,o-1))/A)):(L=Rn(-d-I*n.get(m,o-1),-p-I*n.get(m,o),g,c),n.set(m+1,o-1,L[0]),n.set(m+1,o,L[1]))),R=Math.max(Math.abs(n.get(m,o-1)),Math.abs(n.get(m,o))),h*R*R>1)for(w=m;w<=o;w++)n.set(w,o-1,n.get(w,o-1)/R),n.set(w,o,n.get(w,o)/R)}for(m=0;m<t;m++)if(m<s||m>a)for(w=m;w<t;w++)i.set(m,w,n.get(m,w));for(w=t-1;w>=s;w--)for(m=s;m<=a;m++){for(g=0,y=s;y<=Math.min(w,a);y++)g=g+i.get(m,y)*n.get(y,w);i.set(m,w,g)}}}function Rn(t,e,r,i){let n,o;return Math.abs(r)>Math.abs(i)?(n=i/r,o=r+n*i,[(t+n*e)/o,(e-n*t)/o]):(n=r/i,o=i+n*r,[(n*t+e)/o,(n*e-t)/o])}var Tn=class{constructor(e){if(e=it.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let r=e,i=r.rows,n=new W(i,i),o=!0,s,a,h;for(a=0;a<i;a++){let l=0;for(h=0;h<a;h++){let f=0;for(s=0;s<h;s++)f+=n.get(h,s)*n.get(a,s);f=(r.get(a,h)-f)/n.get(h,h),n.set(a,h,f),l=l+f*f}for(l=r.get(a,a)-l,o&=l>0,n.set(a,a,Math.sqrt(Math.max(l,0))),h=a+1;h<i;h++)n.set(a,h,0)}this.L=n,this.positiveDefinite=!!o}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=it.checkMatrix(e);let r=this.L,i=r.rows;if(e.rows!==i)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let n=e.columns,o=e.clone(),s,a,h;for(h=0;h<i;h++)for(a=0;a<n;a++){for(s=0;s<h;s++)o.set(h,a,o.get(h,a)-o.get(s,a)*r.get(h,s));o.set(h,a,o.get(h,a)/r.get(h,h))}for(h=i-1;h>=0;h--)for(a=0;a<n;a++){for(s=h+1;s<i;s++)o.set(h,a,o.get(h,a)-o.get(s,a)*r.get(s,h));o.set(h,a,o.get(h,a)/r.get(h,h))}return o}get lowerTriangularMatrix(){return this.L}},Ln=class{constructor(e,r={}){e=it.checkMatrix(e);let{Y:i}=r,{scaleScores:n=!1,maxIterations:o=1e3,terminationCriteria:s=1e-10}=r,a;if(i){if(ht.isAnyArray(i)&&typeof i[0]=="number"?i=W.columnVector(i):i=it.checkMatrix(i),i.rows!==e.rows)throw new Error("Y should have the same number of rows as X");a=i.getColumnVector(0)}else a=e.getColumnVector(0);let h=1,l,f,u,c;for(let d=0;d<o&&h>s;d++)u=e.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),u=u.div(u.norm()),l=e.mmul(u).div(u.transpose().mmul(u).get(0,0)),d>0&&(h=l.clone().sub(c).pow(2).sum()),c=l.clone(),i?(f=i.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),f=f.div(f.norm()),a=i.mmul(f).div(f.transpose().mmul(f).get(0,0))):a=l;if(i){let d=e.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0));d=d.div(d.norm());let p=e.clone().sub(l.clone().mmul(d.transpose())),g=a.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),x=i.clone().sub(l.clone().mulS(g.get(0,0)).mmul(f.transpose()));this.t=l,this.p=d.transpose(),this.w=u.transpose(),this.q=f,this.u=a,this.s=l.transpose().mmul(l),this.xResidual=p,this.yResidual=x,this.betas=g}else this.w=u.transpose(),this.s=l.transpose().mmul(l).sqrt(),n?this.t=l.clone().div(this.s.get(0,0)):this.t=l,this.xResidual=e.sub(l.mmul(u.transpose()))}};Me.AbstractMatrix=Fe;Me.CHO=Tn;Me.CholeskyDecomposition=Tn;Me.EVD=Bn;Me.EigenvalueDecomposition=Bn;Me.LU=Qr;Me.LuDecomposition=Qr;Me.Matrix=W;Me.MatrixColumnSelectionView=ga;Me.MatrixColumnView=ma;Me.MatrixFlipColumnView=xa;Me.MatrixFlipRowView=wa;Me.MatrixRowSelectionView=ya;Me.MatrixRowView=ba;Me.MatrixSelectionView=Jr;Me.MatrixSubView=va;Me.MatrixTransposeView=_a;Me.NIPALS=Ln;Me.Nipals=Ln;Me.QR=Oi;Me.QrDecomposition=Oi;Me.SVD=nr;Me.SingularValueDecomposition=nr;Me.WrapperMatrix1D=Pn;Me.WrapperMatrix2D=it;Me.correlation=Mb;Me.covariance=_b;Me.default=W;Me.determinant=Cn;Me.inverse=xb;Me.linearDependencies=yb;Me.pseudoInverse=vb;Me.solve=Kd;Me.wrap=gb});var Bt=X((Z8,Qd)=>{Qd.exports=Db;function Db(t,e){t=t||0;for(var r=new Array(t),i=0;i<t;i++)r[i]=e;return r}});var tp=X((Q8,ep)=>{"use strict";var Rb=Object.prototype.toString;ep.exports=function(e){return Rb.call(e).substr(-6,5)==="Array"}});var Sr=X(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});function ip(t,e){let r=0;for(let i=0;i<t.length;i++)r+=(t[i]-e[i])*(t[i]-e[i]);return r}Nn.squaredEuclidean=ip;function Pb(t,e){return Math.sqrt(ip(t,e))}Nn.euclidean=Pb});var op=X((A6,np)=>{"use strict";var{squaredEuclidean:Bb}=Sr(),Tb={sigma:1},Ua=class{constructor(e){e=Object.assign({},Tb,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,r){let i=Bb(e,r);return Math.exp(-i/this.divisor)}};np.exports=Ua});var ap=X((S6,sp)=>{"use strict";var Lb={degree:1,constant:1,scale:1},Na=class{constructor(e){e=Object.assign({},Lb,e),this.degree=e.degree,this.constant=e.constant,this.scale=e.scale}compute(e,r){for(var i=0,n=0;n<e.length;n++)i+=e[n]*r[n];return Math.pow(this.scale*i+this.constant,this.degree)}};sp.exports=Na});var hp=X((D6,lp)=>{"use strict";var Fb={alpha:.01,constant:-Math.E},Ya=class{constructor(e){e=Object.assign({},Fb,e),this.alpha=e.alpha,this.constant=e.constant}compute(e,r){for(var i=0,n=0;n<e.length;n++)i+=e[n]*r[n];return Math.tanh(this.alpha*i+this.constant)}};lp.exports=Ya});var up=X((I6,fp)=>{"use strict";var Ob={sigma:1,degree:1},za=class{constructor(e){e=Object.assign({},Ob,e),this.sigma=e.sigma,this.degree=e.degree}compute(e,r){for(var i=0,n=Math.min(e.length,r.length),o=1;o<=n;++o)i+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(e[o-1],o)-Math.pow(r[o-1],o),2)),this.degree);return i}};fp.exports=za});var dp=X((R6,cp)=>{"use strict";var{squaredEuclidean:Ub}=Sr(),Nb={sigma:1},Xa=class{constructor(e){e=Object.assign({},Nb,e),this.sigma=e.sigma}compute(e,r){return 1/(1+Ub(e,r)/(this.sigma*this.sigma))}};cp.exports=Xa});var mp=X((C6,pp)=>{"use strict";var{euclidean:Yb}=Sr(),zb={sigma:1},ja=class{constructor(e){e=Object.assign({},zb,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,r){let i=Yb(e,r);return Math.exp(-i/this.divisor)}};pp.exports=ja});var xp=X((P6,gp)=>{"use strict";var Ga=class{compute(e,r){for(var i=Math.min(e.length,r.length),n=0,o=0;o<i;++o)n+=Math.min(e[o],r[o]);return n}};gp.exports=Ga});var bp=X((B6,wp)=>{"use strict";var{euclidean:Xb}=Sr(),jb={sigma:1},qa=class{constructor(e){e=Object.assign({},jb,e),this.sigma=e.sigma}compute(e,r){let i=Xb(e,r);return Math.exp(-i/this.sigma)}};wp.exports=qa});var vp=X((T6,yp)=>{"use strict";var{squaredEuclidean:Gb}=Sr(),qb={constant:1},Va=class{constructor(e){e=Object.assign({},qb,e),this.constant=e.constant}compute(e,r){return Math.sqrt(Gb(e,r)+this.constant*this.constant)}};yp.exports=Va});var Mp=X((L6,_p)=>{"use strict";var{squaredEuclidean:Vb}=Sr(),$b={constant:1},$a=class{constructor(e){e=Object.assign({},$b,e),this.constant=e.constant}compute(e,r){let i=Vb(e,r);return 1-i/(i+this.constant)}};_p.exports=$a});var Ip=X((F6,Dp)=>{"use strict";var{Matrix:Wa,MatrixTransposeView:Wb}=ka(),Ep=op(),kp=ap(),Ap=hp(),Kb=up(),Zb=dp(),Hb=mp(),Sp=xp(),Jb=bp(),Qb=vp(),ey=Mp(),ty={gaussian:Ep,rbf:Ep,polynomial:kp,poly:kp,anova:Kb,cauchy:Zb,exponential:Hb,histogram:Sp,min:Sp,laplacian:Jb,multiquadratic:Qb,rational:ey,sigmoid:Ap,mlp:Ap},Ka=class{constructor(e,r){if(this.kernelType=e,e!=="linear")if(typeof e=="string"){e=e.toLowerCase();var i=ty[e];if(i)this.kernelFunction=new i(r);else throw new Error(`unsupported kernel type: ${e}`)}else if(typeof e=="object"&&typeof e.compute=="function")this.kernelFunction=e;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(e,r){if(e=Wa.checkMatrix(e),r===void 0?r=e:r=Wa.checkMatrix(r),this.kernelType==="linear")return e.mmul(new Wb(r));let i=new Wa(e.rows,r.rows);if(e===r)for(let n=0;n<e.rows;n++)for(let o=n;o<e.rows;o++){let s=this.kernelFunction.compute(e.getRow(n),e.getRow(o));i.set(n,o,s),i.set(o,n,s)}else for(let n=0;n<e.rows;n++)for(let o=0;o<r.rows;o++)i.set(n,o,this.kernelFunction.compute(e.getRow(n),r.getRow(o)));return i}};Dp.exports=Ka});var Zp=X((Wp,Kp)=>{(function(){function t(r,i,n){this.next=n,n&&(n.prev=this),this.prev=i,i&&(i.next=this),this.data=r}function e(){if(!(this instanceof e))return new e;this._head=null,this._tail=null,this.length=0}e.prototype={push:function(r){this._tail=new t(r,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var r=this._tail;return this._tail=r.prev,r.prev&&(r.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),r.data}},unshift:function(r){this._head=new t(r,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var r=this._head;return this._head=r.next,r.next&&(r.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),r.data}},item:function(r){r<0&&(r=this.length+r);for(var i=this._head;r-- >0&&i;)i=i.next;return i?i.data:void 0},slice:function(r,i){if(r||(r=0),i||(i=this.length),i<0&&(i=this.length+i),r<0&&(r=this.length+r),i===r)return[];if(i<r)throw new Error("invalid offset: "+r+","+i+" (length="+this.length+")");for(var n=i-r,o=new Array(n),s=0,a=this._head;r-- >0&&a;)a=a.next;for(;s<n&&a;)o[s++]=a.data,a=a.next;return o},drop:function(){e.call(this)},forEach:function(r,i){for(var n=this._head,o=0,s=this.length;o<s&&n;)r.call(i||this,n.data,o,this),n=n.next,o++},map:function(r,i){var n=new e;return this.forEach(function(o,s,a){n.push(r.call(i||a,o,s,a))}),n},filter:function(r,i){var n=new e;return this.forEach(function(o,s,a){r.call(i||a,o,s,a)&&n.push(o)}),n},reduce:function(r,i,n){var o=0,s=this._head,a=this.length;for(i||(o=1,i=s&&s.data,s=s&&s.next);o<a&&s;)i=r.call(n||this,i,s.data,this),o++,s=s.next;return i}},typeof Wp<"u"?Kp.exports=e:typeof define=="function"&&define.amd?define("FastList",function(){return e}):function(){return this}().FastList=e})()});var c1=X((xh,wh)=>{(function(t,e){typeof xh=="object"&&typeof wh<"u"?wh.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self,t.Qty=e())})(xh,function(){"use strict";function t(v){return typeof v=="string"||v instanceof String}var e=Number.isFinite||window.isFinite;function r(v){return e(v)}function i(v){return v}function n(v){var D={};return v.filter(function(C){return D.hasOwnProperty(C)?!1:D[C]=!0})}function o(v,D){if(D.length!==v.length)return!1;for(var C=0;C<v.length;C++)if(D[C].compareArray&&!D[C].compareArray(v[C])||D[C]!==v[C])return!1;return!0}function s(v,D){Object.keys(D).forEach(function(C){v[C]=D[C]})}function a(){for(var v=1,D=0,C=0;C<arguments.length;C++){var O=arguments[C];D=D+f(O),v*=O}return D!==0?l(v,D):v}function h(v,D){if(D===0)throw new Error("Divide by zero");var C=Math.pow(10,f(D)),O=C/(C*D);return a(v,O)}function l(v,D){return Math.round(v*Math.pow(10,D))/Math.pow(10,D)}function f(v){if(!isFinite(v))return 0;for(var D=0;v%1!==0;)v*=10,D++;return D}function u(){var v;if(!this)return v=Object.create(u.prototype),u.apply(v,arguments),v;v=Error.apply(this,arguments),this.name="QtyError",this.message=v.message,this.stack=v.stack}u.prototype=Object.create(Error.prototype,{constructor:{value:u}});function c(v,D){throw new u("Incompatible units: "+v+" and "+D)}var d={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","\u03BC","\xB5","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","\u03A9","\u2126"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},p=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],g="<1>",x=[g];function m(v,D){var C=D[1],O=D[3]||[],$=D[4]||[];if(!r(C))throw new u(v+": Invalid unit definition. 'scalar' must be a number");O.forEach(function(K){if(d[K]===void 0)throw new u(v+": Invalid unit definition. Unit "+K+" in 'numerator' is not recognized")}),$.forEach(function(K){if(d[K]===void 0)throw new u(v+": Invalid unit definition. Unit "+K+" in 'denominator' is not recognized")})}var w={},y={},M={},_={},R={};for(var E in d)if(d.hasOwnProperty(E)){var A=d[E];if(A[2]==="prefix"){w[E]=A[1];for(var I=0;I<A[0].length;I++)y[A[0][I]]=E}else{m(E,A),M[E]={scalar:A[1],numerator:A[3],denominator:A[4]};for(var b=0;b<A[0].length;b++)_[A[0][b]]=E}R[E]=A[0][0]}function k(v){var D,C=[],O=Object.keys(d);if(typeof v>"u")for(D=0;D<O.length;D++)["","prefix"].indexOf(d[O[D]][2])===-1&&C.push(O[D].substr(1,O[D].length-2));else{if(this.getKinds().indexOf(v)===-1)throw new u("Kind not recognized");for(D=0;D<O.length;D++)d[O[D]][2]===v&&C.push(O[D].substr(1,O[D].length-2))}return C.sort(function($,K){return $.toLowerCase()<K.toLowerCase()?-1:$.toLowerCase()>K.toLowerCase()?1:0})}function B(v){if(!_[v])throw new u("Unit not recognized");return d[_[v]][0]}var S=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function j(){if(this.signature)return this.signature;for(var v=L.call(this),D=0;D<v.length;D++)v[D]*=Math.pow(20,D);return v.reduce(function(C,O){return C+O},0)}function L(){if(!this.isBase())return L.call(this.toBase());for(var v=new Array(S.length),D=0;D<v.length;D++)v[D]=0;for(var C,O,$=0;$<this.numerator.length;$++)(C=d[this.numerator[$]])&&(O=S.indexOf(C[2]),O>=0&&(v[O]=v[O]+1));for(var K=0;K<this.denominator.length;K++)(C=d[this.denominator[K]])&&(O=S.indexOf(C[2]),O>=0&&(v[O]=v[O]-1));return v}var G="[+-]",H="\\d+",Q=G+"?"+H,te="\\."+H,he="(?:"+H+"(?:"+te+")?)|(?:"+te+")",ae="[Ee]"+Q,ne="(?:"+he+")(?:"+ae+")?",Y=G+"?\\s*"+ne,P="("+Y+")?\\s*([^/]*)(?:/(.+))?",q=new RegExp("^"+P+"$"),se="\\^|\\*{2}",J="[01234]",fe=new RegExp("([^ \\*\\d]+?)(?:"+se+")?(-?"+J+"(?![a-zA-Z]))"),ue=new RegExp("([^ \\*\\d]+?)(?:"+se+")?("+J+"(?![a-zA-Z]))");function oe(v){t(v)||(v=v.toString()),v=v.trim();var D=q.exec(v);if(!D)throw new u(v+": Quantity not recognized");var C=D[1];C?(C=C.replace(/\s/g,""),this.scalar=parseFloat(C)):this.scalar=1;for(var O=D[2],$=D[3],K,Ne,Be;D=fe.exec(O);){if(K=parseFloat(D[2]),isNaN(K))throw new u("Unit exponent is not a number");if(K===0&&!de.test(D[1]))throw new u("Unit not recognized");Ne=D[1]+" ",Be="";for(var Ge=0;Ge<Math.abs(K);Ge++)Be+=Ne;K>=0?O=O.replace(D[0],Be):($=$?$+Be:Be,O=O.replace(D[0],""))}for(;D=ue.exec($);){if(K=parseFloat(D[2]),isNaN(K))throw new u("Unit exponent is not a number");if(K===0&&!de.test(D[1]))throw new u("Unit not recognized");Ne=D[1]+" ",Be="";for(var Qe=0;Qe<K;Qe++)Be+=Ne;$=$.replace(D[0],Be)}O&&(this.numerator=T(O.trim())),$&&(this.denominator=T($.trim()))}var V=Object.keys(y).sort(function(v,D){return D.length-v.length}).join("|"),z=Object.keys(_).sort(function(v,D){return D.length-v.length}).join("|"),Ee="\\b|$",le="("+V+")??("+z+")(?:"+Ee+")",de=new RegExp("^\\s*("+le+"[\\s\\*]*)+$"),ze=new RegExp(le,"g"),Ve={};function T(v){var D=Ve[v];if(D)return D;var C,O=[];if(!de.test(v))throw new u("Unit not recognized");for(;C=ze.exec(v);)O.push(C.slice(1));return O=O.map(function($){return y[$[0]]?[y[$[0]],_[$[1]]]:[_[$[1]]]}),O=O.reduce(function($,K){return $.concat(K)},[]),O=O.filter(function($){return $}),Ve[v]=O,O}function ee(v){if(!t(v))throw new u("Argument should be a string");try{return this(v)}catch{return null}}function ie(v){return v instanceof U}function U(v,D){if(me.apply(null,arguments),!ie(this))return new U(v,D);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=x,this.denominator=x,ge(v)?(this.scalar=v.scalar,this.numerator=v.numerator&&v.numerator.length!==0?v.numerator:x,this.denominator=v.denominator&&v.denominator.length!==0?v.denominator:x):D?(oe.call(this,D),this.scalar=v):oe.call(this,v),this.denominator.join("*").indexOf("temp")>=0)throw new u("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new u("Cannot multiply by temperatures");if(!o(this.denominator,x))throw new u("Cannot divide with temperatures")}if(this.initValue=v,_e.call(this),this.isTemperature()&&this.baseScalar<0)throw new u("Temperatures must not be less than absolute zero")}U.prototype={constructor:U};function me(v,D){if(D){if(!(r(v)&&t(D)))throw new u("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(v)||r(v)||ie(v)||ge(v)))throw new u("Only string, number or quantity accepted as single initialization value")}function ge(v){return v&&typeof v=="object"&&v.hasOwnProperty("scalar")}function _e(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=j.call(this);else{var v=this.toBase();this.baseScalar=v.scalar,this.signature=v.signature}}var ye={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function Te(){return n(Object.keys(ye).map(function(v){return ye[v]}))}U.prototype.kind=function(){return ye[this.signature.toString()]},s(U.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&o(this.denominator,x)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Re(v,D){var C=v.units(),O=D.to(C),$=U(ce(C));return U({scalar:v.scalar-O.scalar,numerator:$.numerator,denominator:$.denominator})}function N(v,D){var C=D.to(ce(v.units()));return U({scalar:v.scalar-C.scalar,numerator:v.numerator,denominator:v.denominator})}function Z(v,D){var C=D.to(ce(v.units()));return U({scalar:v.scalar+C.scalar,numerator:v.numerator,denominator:v.denominator})}function ce(v){if(v==="tempK")return"degK";if(v==="tempC")return"degC";if(v==="tempF")return"degF";if(v==="tempR")return"degR";throw new u("Unknown type for temp conversion from: "+v)}function Ce(v,D){var C=xe(v),O=D.units(),$;if(O==="degK")$=C.scalar;else if(O==="degC")$=C.scalar;else if(O==="degF")$=C.scalar*9/5;else if(O==="degR")$=C.scalar*9/5;else throw new u("Unknown type for degree conversion to: "+O);return U({scalar:$,numerator:D.numerator,denominator:D.denominator})}function xe(v){var D=v.units(),C;if(D.match(/(deg)[CFRK]/))C=v.baseScalar;else if(D==="tempK")C=v.scalar;else if(D==="tempC")C=v.scalar;else if(D==="tempF")C=v.scalar*5/9;else if(D==="tempR")C=v.scalar*5/9;else throw new u("Unknown type for temp conversion from: "+D);return U({scalar:C,numerator:["<kelvin>"],denominator:x})}function be(v,D){var C=D.units(),O;if(C==="tempK")O=v.baseScalar;else if(C==="tempC")O=v.baseScalar-273.15;else if(C==="tempF")O=v.baseScalar*9/5-459.67;else if(C==="tempR")O=v.baseScalar*9/5;else throw new u("Unknown type for temp conversion to: "+C);return U({scalar:O,numerator:D.numerator,denominator:D.denominator})}function Ae(v){var D=v.units(),C;if(D.match(/(deg)[CFRK]/))C=v.baseScalar;else if(D==="tempK")C=v.scalar;else if(D==="tempC")C=v.scalar+273.15;else if(D==="tempF")C=(v.scalar+459.67)*5/9;else if(D==="tempR")C=v.scalar*5/9;else throw new u("Unknown type for temp conversion from: "+D);return U({scalar:C,numerator:["<temp-K>"],denominator:x})}s(U.prototype,{to:function(v){var D,C;if(v==null)return this;if(!t(v))return this.to(v.units());if(D=this._conversionCache[v],D)return D;if(C=U(v),C.units()===this.units())return this;if(!this.isCompatible(C))this.isInverse(C)?C=this.inverse().to(v):c(this.units(),C.units());else if(C.isTemperature())C=be(this,C);else if(C.isDegrees())C=Ce(this,C);else{var O=h(this.baseScalar,C.baseScalar);C=U({scalar:O,numerator:C.numerator,denominator:C.denominator})}return this._conversionCache[v]=C,C},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Ae(this);var v=Se[this.units()];return v||(v=je(this.numerator,this.denominator),Se[this.units()]=v),v.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new u("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(v){if(t(v)&&(v=U(v)),r(v)&&(v=U(v+" "+this.units())),this.isUnitless()?v.isUnitless()||c(this.units(),v.units()):v=v.to(this.units()),v.scalar===0)throw new u("Divide by zero");var D=a(Math.round(this.scalar/v.scalar),v.scalar);return U(D+this.units())}});function pe(v,D){var C=U(v),O=U(D);if(C.eq(O))return i;var $;return C.isTemperature()?$=function(K){return C.mul(K).to(O).scalar}:$=function(K){return K*C.baseScalar/O.baseScalar},function(Ne){var Be,Ge,Qe;if(Array.isArray(Ne)){for(Ge=Ne.length,Qe=[],Be=0;Be<Ge;Be++)Qe.push($(Ne[Be]));return Qe}else return $(Ne)}}var Se={};function je(v,D){for(var C=[],O=[],$=1,K,Ne=0;Ne<v.length;Ne++)K=v[Ne],w[K]?$=a($,w[K]):M[K]&&($*=M[K].scalar,M[K].numerator&&C.push(M[K].numerator),M[K].denominator&&O.push(M[K].denominator));for(var Be=0;Be<D.length;Be++)K=D[Be],w[K]?$/=w[K]:M[K]&&($/=M[K].scalar,M[K].numerator&&O.push(M[K].numerator),M[K].denominator&&C.push(M[K].denominator));return C=C.reduce(function(Ge,Qe){return Ge.concat(Qe)},[]),O=O.reduce(function(Ge,Qe){return Ge.concat(Qe)},[]),U({scalar:$,numerator:C,denominator:O})}U.parse=ee,U.getUnits=k,U.getAliases=B,U.mulSafe=a,U.divSafe=h,U.getKinds=Te,U.swiftConverter=pe,U.Error=u,s(U.prototype,{add:function(v){if(t(v)&&(v=U(v)),this.isCompatible(v)||c(this.units(),v.units()),this.isTemperature()&&v.isTemperature())throw new u("Cannot add two temperatures");return this.isTemperature()?Z(this,v):v.isTemperature()?Z(v,this):U({scalar:this.scalar+v.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(v){if(t(v)&&(v=U(v)),this.isCompatible(v)||c(this.units(),v.units()),this.isTemperature()&&v.isTemperature())return Re(this,v);if(this.isTemperature())return N(this,v);if(v.isTemperature())throw new u("Cannot subtract a temperature from a differential degree unit");return U({scalar:this.scalar-v.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(v){if(r(v))return U({scalar:a(this.scalar,v),numerator:this.numerator,denominator:this.denominator});if(t(v)&&(v=U(v)),(this.isTemperature()||v.isTemperature())&&!(this.isUnitless()||v.isUnitless()))throw new u("Cannot multiply by temperatures");var D=this,C=v;D.isCompatible(C)&&D.signature!==400&&(C=C.to(D));var O=Pe(D.numerator,D.denominator,C.numerator,C.denominator);return U({scalar:a(D.scalar,C.scalar,O[2]),numerator:O[0],denominator:O[1]})},div:function(v){if(r(v)){if(v===0)throw new u("Divide by zero");return U({scalar:this.scalar/v,numerator:this.numerator,denominator:this.denominator})}else t(v)&&(v=U(v));if(v.scalar===0)throw new u("Divide by zero");if(v.isTemperature())throw new u("Cannot divide with temperatures");if(this.isTemperature()&&!v.isUnitless())throw new u("Cannot divide with temperatures");var D=this,C=v;D.isCompatible(C)&&D.signature!==400&&(C=C.to(D));var O=Pe(D.numerator,D.denominator,C.denominator,C.numerator);return U({scalar:a(D.scalar,O[2])/C.scalar,numerator:O[0],denominator:O[1]})},inverse:function(){if(this.isTemperature())throw new u("Cannot divide with temperatures");if(this.scalar===0)throw new u("Divide by zero");return U({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Pe(v,D,C,O){function $(ut){return ut!==g}v=v.filter($),C=C.filter($),D=D.filter($),O=O.filter($);var K={};function Ne(ut,ct){for(var et,Ut,qt,St=0;St<ut.length;St++)if(w[ut[St]]?(et=ut[St+1],Ut=ut[St],qt=w[Ut],St++):(et=ut[St],Ut=null,qt=1),et&&et!==g)if(K[et]){K[et][0]+=ct;var $i=K[et][2]?w[K[et][2]]:1;K[et][ct===1?3:4]*=h(qt,$i)}else K[et]=[ct,et,Ut,1,1]}Ne(v,1),Ne(D,-1),Ne(C,1),Ne(O,-1);var Be=[],Ge=[],Qe=1;for(var ii in K)if(K.hasOwnProperty(ii)){var Ze=K[ii],Ot;if(Ze[0]>0)for(Ot=0;Ot<Ze[0];Ot++)Be.push(Ze[2]===null?Ze[1]:[Ze[2],Ze[1]]);else if(Ze[0]<0)for(Ot=0;Ot<-Ze[0];Ot++)Ge.push(Ze[2]===null?Ze[1]:[Ze[2],Ze[1]]);Qe*=h(Ze[3],Ze[4])}return Be.length===0&&(Be=x),Ge.length===0&&(Ge=x),Be=Be.reduce(function(ut,ct){return ut.concat(ct)},[]),Ge=Ge.reduce(function(ut,ct){return ut.concat(ct)},[]),[Be,Ge,Qe]}s(U.prototype,{eq:function(v){return this.compareTo(v)===0},lt:function(v){return this.compareTo(v)===-1},lte:function(v){return this.eq(v)||this.lt(v)},gt:function(v){return this.compareTo(v)===1},gte:function(v){return this.eq(v)||this.gt(v)},compareTo:function(v){if(t(v))return this.compareTo(U(v));if(this.isCompatible(v)||c(this.units(),v.units()),this.baseScalar<v.baseScalar)return-1;if(this.baseScalar===v.baseScalar)return 0;if(this.baseScalar>v.baseScalar)return 1},same:function(v){return this.scalar===v.scalar&&this.units()===v.units()}}),s(U.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(v){return o(v,x)})},isCompatible:function(v){return t(v)?this.isCompatible(U(v)):ie(v)&&v.signature!==void 0?this.signature===v.signature:!1},isInverse:function(v){return this.inverse().isCompatible(v)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(v){v!==g&&p.indexOf(v)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Je(){}Je.prototype.get=function(v){return arguments.length>1&&(v=Array.apply(null,arguments)),v.reduce(function(D,C,O){if(D){var $=D[C];return O===v.length-1?$?$.data:void 0:$}},this)},Je.prototype.set=function(v,D){return arguments.length>2&&(v=Array.prototype.slice.call(arguments,0,-1),D=arguments[arguments.length-1]),v.reduce(function(C,O,$){var K=C[O];return K===void 0&&(K=C[O]={}),$===v.length-1?(K.data=D,D):K},this)};function mt(v,D){return(v+" "+D).trim()}U.formatter=mt,s(U.prototype,{units:function(){if(this._units!==void 0)return this._units;var v=o(this.numerator,x),D=o(this.denominator,x);if(v&&D)return this._units="",this._units;var C=Ft(this.numerator),O=Ft(this.denominator);return this._units=C+(D?"":"/"+O),this._units},toString:function(v,D){var C;if(r(v))C=this.units(),D=v;else if(t(v))C=v;else if(ie(v))return this.toPrec(v).toString(D);var O=this.to(C),$=D!==void 0?l(O.scalar,D):O.scalar;return O=($+" "+O.units()).trim(),O},format:function(v,D){arguments.length===1&&typeof v=="function"&&(D=v,v=void 0),D=D||U.formatter;var C=this.to(v);return D.call(this,C.scalar,C.units())}});var At=new Je;function Ft(v){var D=At.get(v);if(D)return D;var C=o(v,x);return C?D="1":D=fr(Gt(v)).join("*"),At.set(v,D),D}function Gt(v){for(var D=[],C,O,$=0;$<v.length;$++)C=v[$],O=v[$+1],w[C]?(D.push(R[C]+R[O]),$++):D.push(R[C]);return D}function fr(v){var D=v.reduce(function(C,O){var $=C[O];return $||C.push($=C[O]=[O,0]),$[1]++,C},[]);return D.map(function(C){return C[0]+(C[1]>1?C[1]:"")})}return U.version="1.8.0",U})});var yh=X((e5,p1)=>{"use strict";p1.exports=sv;var d1=+(Math.pow(2,27)+1);function sv(t,e,r){var i=t*e,n=d1*t,o=n-t,s=n-o,a=t-s,h=d1*e,l=h-e,f=h-l,u=e-f,c=i-s*f,d=c-a*f,p=d-s*u,g=a*u-p;return r?(r[0]=g,r[1]=i,r):[g,i]}});var g1=X((t5,m1)=>{"use strict";m1.exports=lv;function av(t,e){var r=t+e,i=r-t,n=r-i,o=e-i,s=t-n,a=s+o;return a?[a,r]:[r]}function lv(t,e){var r=t.length|0,i=e.length|0;if(r===1&&i===1)return av(t[0],e[0]);var n=r+i,o=new Array(n),s=0,a=0,h=0,l=Math.abs,f=t[a],u=l(f),c=e[h],d=l(c),p,g;u<d?(g=f,a+=1,a<r&&(f=t[a],u=l(f))):(g=c,h+=1,h<i&&(c=e[h],d=l(c))),a<r&&u<d||h>=i?(p=f,a+=1,a<r&&(f=t[a],u=l(f))):(p=c,h+=1,h<i&&(c=e[h],d=l(c)));for(var x=p+g,m=x-p,w=g-m,y=w,M=x,_,R,E,A,I;a<r&&h<i;)u<d?(p=f,a+=1,a<r&&(f=t[a],u=l(f))):(p=c,h+=1,h<i&&(c=e[h],d=l(c))),g=y,x=p+g,m=x-p,w=g-m,w&&(o[s++]=w),_=M+x,R=_-M,E=_-R,A=x-R,I=M-E,y=I+A,M=_;for(;a<r;)p=f,g=y,x=p+g,m=x-p,w=g-m,w&&(o[s++]=w),_=M+x,R=_-M,E=_-R,A=x-R,I=M-E,y=I+A,M=_,a+=1,a<r&&(f=t[a]);for(;h<i;)p=c,g=y,x=p+g,m=x-p,w=g-m,w&&(o[s++]=w),_=M+x,R=_-M,E=_-R,A=x-R,I=M-E,y=I+A,M=_,h+=1,h<i&&(c=e[h]);return y&&(o[s++]=y),M&&(o[s++]=M),s||(o[s++]=0),o.length=s,o}});var w1=X((r5,x1)=>{"use strict";x1.exports=hv;function hv(t,e,r){var i=t+e,n=i-t,o=i-n,s=e-n,a=t-o;return r?(r[0]=a+s,r[1]=i,r):[a+s,i]}});var y1=X((i5,b1)=>{"use strict";var vh=yh(),fv=w1();b1.exports=uv;function uv(t,e){var r=t.length;if(r===1){var i=vh(t[0],e);return i[0]?i:[i[1]]}var n=new Array(2*r),o=[.1,.1],s=[.1,.1],a=0;vh(t[0],e,o),o[0]&&(n[a++]=o[0]);for(var h=1;h<r;++h){vh(t[h],e,s);var l=o[1];fv(l,s[0],o),o[0]&&(n[a++]=o[0]);var f=s[1],u=o[1],c=f+u,d=c-f,p=u-d;o[1]=c,p&&(n[a++]=p)}return o[1]&&(n[a++]=o[1]),a===0&&(n[a++]=0),n.length=a,n}});var _1=X((n5,v1)=>{"use strict";v1.exports=dv;function cv(t,e){var r=t+e,i=r-t,n=r-i,o=e-i,s=t-n,a=s+o;return a?[a,r]:[r]}function dv(t,e){var r=t.length|0,i=e.length|0;if(r===1&&i===1)return cv(t[0],-e[0]);var n=r+i,o=new Array(n),s=0,a=0,h=0,l=Math.abs,f=t[a],u=l(f),c=-e[h],d=l(c),p,g;u<d?(g=f,a+=1,a<r&&(f=t[a],u=l(f))):(g=c,h+=1,h<i&&(c=-e[h],d=l(c))),a<r&&u<d||h>=i?(p=f,a+=1,a<r&&(f=t[a],u=l(f))):(p=c,h+=1,h<i&&(c=-e[h],d=l(c)));for(var x=p+g,m=x-p,w=g-m,y=w,M=x,_,R,E,A,I;a<r&&h<i;)u<d?(p=f,a+=1,a<r&&(f=t[a],u=l(f))):(p=c,h+=1,h<i&&(c=-e[h],d=l(c))),g=y,x=p+g,m=x-p,w=g-m,w&&(o[s++]=w),_=M+x,R=_-M,E=_-R,A=x-R,I=M-E,y=I+A,M=_;for(;a<r;)p=f,g=y,x=p+g,m=x-p,w=g-m,w&&(o[s++]=w),_=M+x,R=_-M,E=_-R,A=x-R,I=M-E,y=I+A,M=_,a+=1,a<r&&(f=t[a]);for(;h<i;)p=c,g=y,x=p+g,m=x-p,w=g-m,w&&(o[s++]=w),_=M+x,R=_-M,E=_-R,A=x-R,I=M-E,y=I+A,M=_,h+=1,h<i&&(c=-e[h]);return y&&(o[s++]=y),M&&(o[s++]=M),s||(o[s++]=0),o.length=s,o}});var E1=X((o5,_h)=>{"use strict";var pv=yh(),mv=g1(),gv=y1(),xv=_1(),M1=5,io=11102230246251565e-32,wv=(3+16*io)*io,bv=(7+56*io)*io;function yv(t,e,r,i){return function(o,s,a){var h=t(t(e(s[1],a[0]),e(-a[1],s[0])),t(e(o[1],s[0]),e(-s[1],o[0]))),l=t(e(o[1],a[0]),e(-a[1],o[0])),f=i(h,l);return f[f.length-1]}}function vv(t,e,r,i){return function(o,s,a,h){var l=t(t(r(t(e(a[1],h[0]),e(-h[1],a[0])),s[2]),t(r(t(e(s[1],h[0]),e(-h[1],s[0])),-a[2]),r(t(e(s[1],a[0]),e(-a[1],s[0])),h[2]))),t(r(t(e(s[1],h[0]),e(-h[1],s[0])),o[2]),t(r(t(e(o[1],h[0]),e(-h[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),h[2])))),f=t(t(r(t(e(a[1],h[0]),e(-h[1],a[0])),o[2]),t(r(t(e(o[1],h[0]),e(-h[1],o[0])),-a[2]),r(t(e(o[1],a[0]),e(-a[1],o[0])),h[2]))),t(r(t(e(s[1],a[0]),e(-a[1],s[0])),o[2]),t(r(t(e(o[1],a[0]),e(-a[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),a[2])))),u=i(l,f);return u[u.length-1]}}function _v(t,e,r,i){return function(o,s,a,h,l){var f=t(t(t(r(t(r(t(e(h[1],l[0]),e(-l[1],h[0])),a[2]),t(r(t(e(a[1],l[0]),e(-l[1],a[0])),-h[2]),r(t(e(a[1],h[0]),e(-h[1],a[0])),l[2]))),s[3]),t(r(t(r(t(e(h[1],l[0]),e(-l[1],h[0])),s[2]),t(r(t(e(s[1],l[0]),e(-l[1],s[0])),-h[2]),r(t(e(s[1],h[0]),e(-h[1],s[0])),l[2]))),-a[3]),r(t(r(t(e(a[1],l[0]),e(-l[1],a[0])),s[2]),t(r(t(e(s[1],l[0]),e(-l[1],s[0])),-a[2]),r(t(e(s[1],a[0]),e(-a[1],s[0])),l[2]))),h[3]))),t(r(t(r(t(e(a[1],h[0]),e(-h[1],a[0])),s[2]),t(r(t(e(s[1],h[0]),e(-h[1],s[0])),-a[2]),r(t(e(s[1],a[0]),e(-a[1],s[0])),h[2]))),-l[3]),t(r(t(r(t(e(h[1],l[0]),e(-l[1],h[0])),s[2]),t(r(t(e(s[1],l[0]),e(-l[1],s[0])),-h[2]),r(t(e(s[1],h[0]),e(-h[1],s[0])),l[2]))),o[3]),r(t(r(t(e(h[1],l[0]),e(-l[1],h[0])),o[2]),t(r(t(e(o[1],l[0]),e(-l[1],o[0])),-h[2]),r(t(e(o[1],h[0]),e(-h[1],o[0])),l[2]))),-s[3])))),t(t(r(t(r(t(e(s[1],l[0]),e(-l[1],s[0])),o[2]),t(r(t(e(o[1],l[0]),e(-l[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),l[2]))),h[3]),t(r(t(r(t(e(s[1],h[0]),e(-h[1],s[0])),o[2]),t(r(t(e(o[1],h[0]),e(-h[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),h[2]))),-l[3]),r(t(r(t(e(a[1],h[0]),e(-h[1],a[0])),s[2]),t(r(t(e(s[1],h[0]),e(-h[1],s[0])),-a[2]),r(t(e(s[1],a[0]),e(-a[1],s[0])),h[2]))),o[3]))),t(r(t(r(t(e(a[1],h[0]),e(-h[1],a[0])),o[2]),t(r(t(e(o[1],h[0]),e(-h[1],o[0])),-a[2]),r(t(e(o[1],a[0]),e(-a[1],o[0])),h[2]))),-s[3]),t(r(t(r(t(e(s[1],h[0]),e(-h[1],s[0])),o[2]),t(r(t(e(o[1],h[0]),e(-h[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),h[2]))),a[3]),r(t(r(t(e(s[1],a[0]),e(-a[1],s[0])),o[2]),t(r(t(e(o[1],a[0]),e(-a[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),a[2]))),-h[3]))))),u=t(t(t(r(t(r(t(e(h[1],l[0]),e(-l[1],h[0])),a[2]),t(r(t(e(a[1],l[0]),e(-l[1],a[0])),-h[2]),r(t(e(a[1],h[0]),e(-h[1],a[0])),l[2]))),o[3]),r(t(r(t(e(h[1],l[0]),e(-l[1],h[0])),o[2]),t(r(t(e(o[1],l[0]),e(-l[1],o[0])),-h[2]),r(t(e(o[1],h[0]),e(-h[1],o[0])),l[2]))),-a[3])),t(r(t(r(t(e(a[1],l[0]),e(-l[1],a[0])),o[2]),t(r(t(e(o[1],l[0]),e(-l[1],o[0])),-a[2]),r(t(e(o[1],a[0]),e(-a[1],o[0])),l[2]))),h[3]),r(t(r(t(e(a[1],h[0]),e(-h[1],a[0])),o[2]),t(r(t(e(o[1],h[0]),e(-h[1],o[0])),-a[2]),r(t(e(o[1],a[0]),e(-a[1],o[0])),h[2]))),-l[3]))),t(t(r(t(r(t(e(a[1],l[0]),e(-l[1],a[0])),s[2]),t(r(t(e(s[1],l[0]),e(-l[1],s[0])),-a[2]),r(t(e(s[1],a[0]),e(-a[1],s[0])),l[2]))),o[3]),r(t(r(t(e(a[1],l[0]),e(-l[1],a[0])),o[2]),t(r(t(e(o[1],l[0]),e(-l[1],o[0])),-a[2]),r(t(e(o[1],a[0]),e(-a[1],o[0])),l[2]))),-s[3])),t(r(t(r(t(e(s[1],l[0]),e(-l[1],s[0])),o[2]),t(r(t(e(o[1],l[0]),e(-l[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),l[2]))),a[3]),r(t(r(t(e(s[1],a[0]),e(-a[1],s[0])),o[2]),t(r(t(e(o[1],a[0]),e(-a[1],o[0])),-s[2]),r(t(e(o[1],s[0]),e(-s[1],o[0])),a[2]))),-l[3])))),c=i(f,u);return c[c.length-1]}}function no(t){var e=t===3?yv:t===4?vv:_v;return e(mv,pv,gv,xv)}var Mv=no(3),Ev=no(4),Cr=[function(){return 0},function(){return 0},function(e,r){return r[0]-e[0]},function(e,r,i){var n=(e[1]-i[1])*(r[0]-i[0]),o=(e[0]-i[0])*(r[1]-i[1]),s=n-o,a;if(n>0){if(o<=0)return s;a=n+o}else if(n<0){if(o>=0)return s;a=-(n+o)}else return s;var h=wv*a;return s>=h||s<=-h?s:Mv(e,r,i)},function(e,r,i,n){var o=e[0]-n[0],s=r[0]-n[0],a=i[0]-n[0],h=e[1]-n[1],l=r[1]-n[1],f=i[1]-n[1],u=e[2]-n[2],c=r[2]-n[2],d=i[2]-n[2],p=s*f,g=a*l,x=a*h,m=o*f,w=o*l,y=s*h,M=u*(p-g)+c*(x-m)+d*(w-y),_=(Math.abs(p)+Math.abs(g))*Math.abs(u)+(Math.abs(x)+Math.abs(m))*Math.abs(c)+(Math.abs(w)+Math.abs(y))*Math.abs(d),R=bv*_;return M>R||-M>R?M:Ev(e,r,i,n)}];function kv(t){var e=Cr[t.length];return e||(e=Cr[t.length]=no(t.length)),e.apply(void 0,t)}function Av(t,e,r,i,n,o,s){return function(h,l,f,u,c){switch(arguments.length){case 0:case 1:return 0;case 2:return i(h,l);case 3:return n(h,l,f);case 4:return o(h,l,f,u);case 5:return s(h,l,f,u,c)}for(var d=new Array(arguments.length),p=0;p<arguments.length;++p)d[p]=arguments[p];return t(d)}}function Sv(){for(;Cr.length<=M1;)Cr.push(no(Cr.length));_h.exports=Av.apply(void 0,[kv].concat(Cr));for(var t=0;t<=M1;++t)_h.exports[t]=Cr[t]}Sv()});var A1=X((s5,k1)=>{k1.exports=Dv;var oo=E1();function Dv(t,e){for(var r=e[0],i=e[1],n=t.length,o=1,s=n,a=0,h=n-1;a<s;h=a++){var l=t[a],f=t[h],u=l[1],c=f[1];if(c<u){if(c<i&&i<u){var d=oo(l,f,e);if(d===0)return 0;o^=0<d|0}else if(i===u){var p=t[(a+1)%n],g=p[1];if(u<g){var d=oo(l,f,e);if(d===0)return 0;o^=0<d|0}}}else if(u<c){if(u<i&&i<c){var d=oo(l,f,e);if(d===0)return 0;o^=d<0|0}else if(i===u){var p=t[(a+1)%n],g=p[1];if(g<u){var d=oo(l,f,e);if(d===0)return 0;o^=d<0|0}}}else if(i===u){var x=Math.min(l[0],f[0]),m=Math.max(l[0],f[0]);if(a===0){for(;h>0;){var w=(h+n-1)%n,y=t[w];if(y[1]!==i)break;var M=y[0];x=Math.min(x,M),m=Math.max(m,M),h=w}if(h===0)return x<=r&&r<=m?0:1;s=h+1}for(var _=t[(h+n-1)%n][1];a+1<s;){var y=t[a+1];if(y[1]!==i)break;var M=y[0];x=Math.min(x,M),m=Math.max(m,M),a+=1}if(x<=r&&r<=m)return 0;var R=t[(a+1)%n][1];r<x&&_<i!=R<i&&(o^=1)}}return 2*o-1}});var D1=X((A5,S1)=>{"use strict";var Dh=class{constructor(){this.nodes=new Map}add(e){var r=this.nodes.get(e);return r||(r=new Uv(e),this.nodes.set(e,r)),r}union(e,r){let i=this.find(e),n=this.find(r);i!==n&&(i.rank<n.rank?i.parent=n:i.rank>n.rank?n.parent=i:(n.parent=i,i.rank++))}find(e){for(var r=e;r.parent!==null;)r=r.parent;for(var i=e;i.parent!==null;){var n=i;i=i.parent,n.parent=r}return r}connected(e,r){return this.find(e)===this.find(r)}};S1.exports=Dh;function Uv(t){this.value=t,this.parent=null,this.rank=0}});var C1=X((R1,Ph)=>{(function(t){if(typeof R1=="object"&&typeof Ph<"u")Ph.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.PriorityQueue=t()}})(function(){var t,e,r;return function i(n,o,s){function a(f,u){if(!o[f]){if(!n[f]){var c=typeof ni=="function"&&ni;if(!u&&c)return c(f,!0);if(h)return h(f,!0);var d=new Error("Cannot find module '"+f+"'");throw d.code="MODULE_NOT_FOUND",d}var p=o[f]={exports:{}};n[f][0].call(p.exports,function(g){var x=n[f][1][g];return a(x||g)},p,p.exports,i,n,o,s)}return o[f].exports}for(var h=typeof ni=="function"&&ni,l=0;l<s.length;l++)a(s[l]);return a}({1:[function(i,n,o){var s,a,h,l,f,u=function(d,p){for(var g in p)c.call(p,g)&&(d[g]=p[g]);function x(){this.constructor=d}return x.prototype=p.prototype,d.prototype=new x,d.__super__=p.prototype,d},c={}.hasOwnProperty;s=i("./PriorityQueue/AbstractPriorityQueue"),a=i("./PriorityQueue/ArrayStrategy"),l=i("./PriorityQueue/BinaryHeapStrategy"),h=i("./PriorityQueue/BHeapStrategy"),f=function(d){u(p,d);function p(g){g||(g={}),g.strategy||(g.strategy=l),g.comparator||(g.comparator=function(x,m){return(x||0)-(m||0)}),p.__super__.constructor.call(this,g)}return p}(s),f.ArrayStrategy=a,f.BinaryHeapStrategy=l,f.BHeapStrategy=h,n.exports=f},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(i,n,o){var s;n.exports=s=function(){function a(h){var l;if(h?.strategy==null)throw"Must pass options.strategy, a strategy";if(h?.comparator==null)throw"Must pass options.comparator, a comparator";this.priv=new h.strategy(h),this.length=(h!=null&&(l=h.initialValues)!=null?l.length:void 0)||0}return a.prototype.queue=function(h){this.length++,this.priv.queue(h)},a.prototype.dequeue=function(h){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},a.prototype.peek=function(h){if(!this.length)throw"Empty queue";return this.priv.peek()},a.prototype.clear=function(){return this.length=0,this.priv.clear()},a}()},{}],3:[function(i,n,o){var s,a;a=function(h,l,f){var u,c,d;for(c=0,u=h.length;c<u;)d=c+u>>>1,f(h[d],l)>=0?c=d+1:u=d;return c},n.exports=s=function(){function h(l){var f;this.options=l,this.comparator=this.options.comparator,this.data=((f=this.options.initialValues)!=null?f.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return h.prototype.queue=function(l){var f;f=a(this.data,l,this.comparator),this.data.splice(f,0,l)},h.prototype.dequeue=function(){return this.data.pop()},h.prototype.peek=function(){return this.data[this.data.length-1]},h.prototype.clear=function(){this.data.length=0},h}()},{}],4:[function(i,n,o){var s;n.exports=s=function(){function a(h){var l,f,u,c,d,p,g,x,m;for(this.comparator=h?.comparator||function(w,y){return w-y},this.pageSize=h?.pageSize||512,this.length=0,x=0;1<<x<this.pageSize;)x+=1;if(1<<x!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=x,this._emptyMemoryPageTemplate=l=[],f=u=0,p=this.pageSize;0<=p?u<p:u>p;f=0<=p?++u:--u)l.push(null);if(this._memory=[],this._mask=this.pageSize-1,h.initialValues)for(g=h.initialValues,c=0,d=g.length;c<d;c++)m=g[c],this.queue(m)}return a.prototype.queue=function(h){this.length+=1,this._write(this.length,h),this._bubbleUp(this.length,h)},a.prototype.dequeue=function(){var h,l;return h=this._read(1),l=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,l),this._bubbleDown(1,l)),h},a.prototype.peek=function(){return this._read(1)},a.prototype.clear=function(){this.length=0,this._memory.length=0},a.prototype._write=function(h,l){var f;for(f=h>>this._shift;f>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[f][h&this._mask]=l},a.prototype._read=function(h){return this._memory[h>>this._shift][h&this._mask]},a.prototype._bubbleUp=function(h,l){var f,u,c,d;for(f=this.comparator;h>1&&(u=h&this._mask,h<this.pageSize||u>3?c=h&~this._mask|u>>1:u<2?(c=h-this.pageSize>>this._shift,c+=c&~(this._mask>>1),c|=this.pageSize>>1):c=h-2,d=this._read(c),!(f(d,l)<0));)this._write(c,l),this._write(h,d),h=c},a.prototype._bubbleDown=function(h,l){var f,u,c,d,p;for(p=this.comparator;h<this.length;)if(h>this._mask&&!(h&this._mask-1)?f=u=h+2:h&this.pageSize>>1?(f=(h&~this._mask)>>1,f|=h&this._mask>>1,f=f+1<<this._shift,u=f+1):(f=h+(h&this._mask),u=f+1),f!==u&&u<=this.length)if(c=this._read(f),d=this._read(u),p(c,l)<0&&p(c,d)<=0)this._write(f,l),this._write(h,c),h=f;else if(p(d,l)<0)this._write(u,l),this._write(h,d),h=u;else break;else if(f<=this.length)if(c=this._read(f),p(c,l)<0)this._write(f,l),this._write(h,c),h=f;else break;else break},a}()},{}],5:[function(i,n,o){var s;n.exports=s=function(){function a(h){var l;this.comparator=h?.comparator||function(f,u){return f-u},this.length=0,this.data=((l=h.initialValues)!=null?l.slice(0):void 0)||[],this._heapify()}return a.prototype._heapify=function(){var h,l,f;if(this.data.length>0)for(h=l=1,f=this.data.length;1<=f?l<f:l>f;h=1<=f?++l:--l)this._bubbleUp(h)},a.prototype.queue=function(h){this.data.push(h),this._bubbleUp(this.data.length-1)},a.prototype.dequeue=function(){var h,l;return l=this.data[0],h=this.data.pop(),this.data.length>0&&(this.data[0]=h,this._bubbleDown(0)),l},a.prototype.peek=function(){return this.data[0]},a.prototype.clear=function(){this.length=0,this.data.length=0},a.prototype._bubbleUp=function(h){for(var l,f;h>0&&(l=h-1>>>1,this.comparator(this.data[h],this.data[l])<0);)f=this.data[l],this.data[l]=this.data[h],this.data[h]=f,h=l},a.prototype._bubbleDown=function(h){var l,f,u,c,d;for(l=this.data.length-1;f=(h<<1)+1,c=f+1,u=h,f<=l&&this.comparator(this.data[f],this.data[u])<0&&(u=f),c<=l&&this.comparator(this.data[c],this.data[u])<0&&(u=c),u!==h;)d=this.data[u],this.data[u]=this.data[h],this.data[h]=d,h=u},a}()},{}]},{},[1])(1)})});var L1=X(T1=>{"use strict";var Wv=function(){var t=self.window=self;function e(){this._listeners={}}e.prototype.on=function(i,n){if(this._listeners[i])throw new RangeError("there is already a listener for "+i);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[i]=n},e.prototype._send=function(i,n,o){o===void 0?o=[]:Array.isArray(o)||(o=[o]),self.postMessage({id:i,data:n},o)},e.prototype._trigger=function(i,n){if(!this._listeners[i])throw new Error("event "+i+" is not defined");this._listeners[i].apply(null,n)};var r=new e;self.onmessage=function(i){switch(i.data.action){case"exec":i.data.args.unshift(function(n,o){r._send(i.data.id,n,o)}),r._trigger(i.data.event,i.data.args);break;case"ping":r._send(i.data.id,"pong");break;default:throw new Error("unexpected action: "+i.data.action)}}},B1=Wv.toString().split('"CODE";');T1.newWorkerURL=function(e,r){var i=new Blob(["(",B1[0],"importScripts.apply(self, "+JSON.stringify(r)+`);
`,"(",e,")();",B1[1],")();"],{type:"application/javascript"});return URL.createObjectURL(i)}});var O1=X((pD,F1)=>{"use strict";var Kv=L1(),Oh=navigator.hardwareConcurrency||1,dD=Function.prototype;function hr(t,e){if(typeof t!="string"&&typeof t!="function")throw new TypeError("func argument must be a function");if(e===void 0&&(e={}),typeof e!="object"||e===null)throw new TypeError("options argument must be an object");this._workerCode=t.toString(),e.maxWorkers===void 0||e.maxWorkers==="auto"?this._numWorkers=Math.min(Oh-1,1):e.maxWorkers>0?this._numWorkers=Math.min(e.maxWorkers,Oh):this._numWorkers=Oh,this._workers=new Map,this._timeout=e.timeout||0,this._terminateOnError=!!e.terminateOnError;var r=e.deps;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}hr.prototype._init=function(t){for(var e=Kv.newWorkerURL(this._workerCode,t),r=0;r<this._numWorkers;r++){var i=new Worker(e);i.onmessage=this._onmessage.bind(this,i),i.onerror=this._onerror.bind(this,i),i.running=!1,i.id=r,this._workers.set(i,null)}URL.revokeObjectURL(e)};hr.prototype._onerror=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[1](e.message),this._workers.set(t,null),this._terminateOnError?this.terminate():this._exec()}};hr.prototype._onmessage=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[0](e.data.data),this._workers.set(t,null),this._exec()}};hr.prototype._exec=function(){for(var t of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!t.running)for(var e=0;e<this._waiting.length;e++){var r=this._waiting[e];if(!(typeof r[4]=="number"&&r[4]!==t.id)){this._waiting.splice(e,1),t.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),t.running=!0,t.time=Date.now(),this._workers.set(t,r[3]),this._working++;break}}}};hr.prototype.terminate=function(){if(!this._terminated){for(var t of this._workers)t[0].terminate(),t[1]&&t[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};hr.prototype.postAll=function(t,e){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var i of this._workers.keys())r.push(this.post(t,e,[],i.id));return Promise.all(r)};hr.prototype.post=function(t,e,r,i){e===void 0&&(e=[]),r===void 0&&(r=[]),Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);var n=this;return new Promise(function(o,s){if(n._terminated)throw new Error("Cannot post (terminated)");n._waiting.push([t,e,r,[o,s],i]),n._exec()})};F1.exports=hr});var tm=ve(Xf(),1);var rm=class extends Error{constructor(t,e,r){super(`Possible EventEmitter memory leak detected. ${r} ${e.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=t,this.type=e,this.count=r,this.name="MaxListenersExceededWarning"}},jf=class{static listenerCount(t,e){return t.listenerCount(e)}constructor(){this.events=new Map,this.maxListeners=jf.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(t,e,r){this.emit(t,e,r)}_getListeners(t){return Array.prototype.concat.apply([],this.events.get(t))||[]}_removeListener(t,e){let r=t.indexOf(e);return r>-1&&t.splice(r,1),[]}_wrapOnceListener(t,e){let r=(...i)=>(this.removeListener(t,r),e.apply(this,i));return Object.defineProperty(r,"name",{value:e.name}),r}setMaxListeners(t){return this.maxListeners=t,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(t,...e){let r=this._getListeners(t);return r.forEach(i=>{i.apply(this,e)}),r.length>0}addListener(t,e){this._emitInternalEvent("newListener",t,e);let r=this._getListeners(t).concat(e);if(this.events.set(t,r),this.maxListeners>0&&this.listenerCount(t)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;let i=new rm(this,t,this.listenerCount(t));console.warn(i)}return this}on(t,e){return this.addListener(t,e)}once(t,e){return this.addListener(t,this._wrapOnceListener(t,e))}prependListener(t,e){let r=this._getListeners(t);if(r.length>0){let i=[e].concat(r);this.events.set(t,i)}else this.events.set(t,r.concat(e));return this}prependOnceListener(t,e){return this.prependListener(t,this._wrapOnceListener(t,e))}removeListener(t,e){let r=this._getListeners(t);return r.length>0&&(this._removeListener(r,e),this.events.set(t,r),this._emitInternalEvent("removeListener",t,e)),this}off(t,e){return this.removeListener(t,e)}removeAllListeners(t){return t?this.events.delete(t):this.events.clear(),this}listeners(t){return Array.from(this._getListeners(t))}listenerCount(t){return this._getListeners(t).length}rawListeners(t){return this.listeners(t)}},Gf=jf;Gf.defaultMaxListeners=10;var li=null;typeof WebSocket<"u"?li=WebSocket:typeof MozWebSocket<"u"?li=MozWebSocket:typeof global<"u"?li=global.WebSocket||global.MozWebSocket:typeof window<"u"?li=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(li=self.WebSocket||self.MozWebSocket);var qf={getBit(t){return this.data[en(t)]&1<<tn(t)?1:0},setBit(t){this.data[en(t)]|=1<<tn(t)},clearBit(t){this.data[en(t)]&=~(1<<tn(t))},toggleBit(t){this.data[en(t)]^=1<<tn(t)},getBitXY(t,e){return t>=this.width||e>=this.height?0:this.getBit(e*this.width+t)},setBitXY(t,e){this.setBit(e*this.width+t)},clearBitXY(t,e){this.clearBit(e*this.width+t)},toggleBitXY(t,e){this.toggleBit(e*this.width+t)}};function en(t){return t>>3}function tn(t){return 7-(t&7)}function _o(t){for(let e in qf)t.prototype[e]=qf[e]}function Mo(t,e={}){let{bitDepth:r,alpha:i,colorModel:n,components:o,channels:s}=e;if(typeof t!="string"||t.length===0)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${t} can only be applied if bit depth is in: ${r}`);if(i&&(Array.isArray(i)||(i=[i]),!i.includes(this.alpha)))throw new TypeError(`The process: ${t} can only be applied if alpha is in: ${i}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.colorModel)))throw new TypeError(`The process: ${t} can only be applied if color model is in: ${n}`);if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.components))){let a=`The process: ${t} can only be applied if the number of components is in: ${o}`;throw o.length===1&&o[0]===1?new TypeError(`${a}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(a)}if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.channels)))throw new TypeError(`The process: ${t} can only be applied if the number of channels is in: ${s}`)}function im(t,e){t=t||[],e=e||{},typeof e=="string"&&(e={type:e});try{return new Blob(t,e)}catch(o){if(o.name!=="TypeError")throw o;for(var r=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,i=new r,n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}function nm(t){var e=t.match(/data:([^;]+)/)[1],r=t.replace(/^[^,]+,/,""),i=om(atob(r));return im([i],{type:e})}function Vf(t,e,r){return typeof t.toBlob=="function"?new Promise(function(i){t.toBlob(i,e,r)}):Promise.resolve(nm(t.toDataURL(e,r)))}function om(t){for(var e=t.length,r=new ArrayBuffer(e),i=new Uint8Array(r),n=-1;++n<e;)i[n]=t.charCodeAt(n);return r}var vn=ve(iu());var D0=ve(Tr());function Yr(t){let e=t.length;for(;--e>=0;)t[e]=0}var cm=0,Xu=1,dm=2,pm=3,mm=258,Jo=29,Mi=256,mi=Mi+1+Jo,Or=30,Qo=19,ju=2*mi+1,dr=15,Io=16,gm=7,es=256,Gu=16,qu=17,Vu=18,jo=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),hn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xm=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),$u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wm=512,Yt=new Array((mi+2)*2);Yr(Yt);var ci=new Array(Or*2);Yr(ci);var gi=new Array(wm);Yr(gi);var xi=new Array(mm-pm+1);Yr(xi);var ts=new Array(Jo);Yr(ts);var fn=new Array(Or);Yr(fn);function Ro(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}var Wu,Ku,Zu;function Co(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}var Hu=t=>t<256?gi[t]:gi[256+(t>>>7)],wi=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},st=(t,e,r)=>{t.bi_valid>Io-r?(t.bi_buf|=e<<t.bi_valid&65535,wi(t,t.bi_buf),t.bi_buf=e>>Io-t.bi_valid,t.bi_valid+=r-Io):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Rt=(t,e,r)=>{st(t,r[e*2],r[e*2+1])},Ju=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},bm=t=>{t.bi_valid===16?(wi(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},ym=(t,e)=>{let r=e.dyn_tree,i=e.max_code,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,h=e.stat_desc.max_length,l,f,u,c,d,p,g=0;for(c=0;c<=dr;c++)t.bl_count[c]=0;for(r[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<ju;l++)f=t.heap[l],c=r[r[f*2+1]*2+1]+1,c>h&&(c=h,g++),r[f*2+1]=c,!(f>i)&&(t.bl_count[c]++,d=0,f>=a&&(d=s[f-a]),p=r[f*2],t.opt_len+=p*(c+d),o&&(t.static_len+=p*(n[f*2+1]+d)));if(g!==0){do{for(c=h-1;t.bl_count[c]===0;)c--;t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[h]--,g-=2}while(g>0);for(c=h;c!==0;c--)for(f=t.bl_count[c];f!==0;)u=t.heap[--l],!(u>i)&&(r[u*2+1]!==c&&(t.opt_len+=(c-r[u*2+1])*r[u*2],r[u*2+1]=c),f--)}},Qu=(t,e,r)=>{let i=new Array(dr+1),n=0,o,s;for(o=1;o<=dr;o++)n=n+r[o-1]<<1,i[o]=n;for(s=0;s<=e;s++){let a=t[s*2+1];a!==0&&(t[s*2]=Ju(i[a]++,a))}},vm=()=>{let t,e,r,i,n,o=new Array(dr+1);for(r=0,i=0;i<Jo-1;i++)for(ts[i]=r,t=0;t<1<<jo[i];t++)xi[r++]=i;for(xi[r-1]=i,n=0,i=0;i<16;i++)for(fn[i]=n,t=0;t<1<<hn[i];t++)gi[n++]=i;for(n>>=7;i<Or;i++)for(fn[i]=n<<7,t=0;t<1<<hn[i]-7;t++)gi[256+n++]=i;for(e=0;e<=dr;e++)o[e]=0;for(t=0;t<=143;)Yt[t*2+1]=8,t++,o[8]++;for(;t<=255;)Yt[t*2+1]=9,t++,o[9]++;for(;t<=279;)Yt[t*2+1]=7,t++,o[7]++;for(;t<=287;)Yt[t*2+1]=8,t++,o[8]++;for(Qu(Yt,mi+1,o),t=0;t<Or;t++)ci[t*2+1]=5,ci[t*2]=Ju(t,5);Wu=new Ro(Yt,jo,Mi+1,mi,dr),Ku=new Ro(ci,hn,0,Or,dr),Zu=new Ro(new Array(0),xm,0,Qo,gm)},e0=t=>{let e;for(e=0;e<mi;e++)t.dyn_ltree[e*2]=0;for(e=0;e<Or;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Qo;e++)t.bl_tree[e*2]=0;t.dyn_ltree[es*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},t0=t=>{t.bi_valid>8?wi(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},nu=(t,e,r,i)=>{let n=e*2,o=r*2;return t[n]<t[o]||t[n]===t[o]&&i[e]<=i[r]},Po=(t,e,r)=>{let i=t.heap[r],n=r<<1;for(;n<=t.heap_len&&(n<t.heap_len&&nu(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!nu(e,i,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=i},ou=(t,e,r)=>{let i,n,o=0,s,a;if(t.sym_next!==0)do i=t.pending_buf[t.sym_buf+o++]&255,i+=(t.pending_buf[t.sym_buf+o++]&255)<<8,n=t.pending_buf[t.sym_buf+o++],i===0?Rt(t,n,e):(s=xi[n],Rt(t,s+Mi+1,e),a=jo[s],a!==0&&(n-=ts[s],st(t,n,a)),i--,s=Hu(i),Rt(t,s,r),a=hn[s],a!==0&&(i-=fn[s],st(t,i,a)));while(o<t.sym_next);Rt(t,es,e)},Go=(t,e)=>{let r=e.dyn_tree,i=e.stat_desc.static_tree,n=e.stat_desc.has_stree,o=e.stat_desc.elems,s,a,h=-1,l;for(t.heap_len=0,t.heap_max=ju,s=0;s<o;s++)r[s*2]!==0?(t.heap[++t.heap_len]=h=s,t.depth[s]=0):r[s*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,r[l*2]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=i[l*2+1]);for(e.max_code=h,s=t.heap_len>>1;s>=1;s--)Po(t,r,s);l=o;do s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Po(t,r,1),a=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=a,r[l*2]=r[s*2]+r[a*2],t.depth[l]=(t.depth[s]>=t.depth[a]?t.depth[s]:t.depth[a])+1,r[s*2+1]=r[a*2+1]=l,t.heap[1]=l++,Po(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],ym(t,e),Qu(r,h,t.bl_count)},su=(t,e,r)=>{let i,n=-1,o,s=e[0*2+1],a=0,h=7,l=4;for(s===0&&(h=138,l=3),e[(r+1)*2+1]=65535,i=0;i<=r;i++)o=s,s=e[(i+1)*2+1],!(++a<h&&o===s)&&(a<l?t.bl_tree[o*2]+=a:o!==0?(o!==n&&t.bl_tree[o*2]++,t.bl_tree[Gu*2]++):a<=10?t.bl_tree[qu*2]++:t.bl_tree[Vu*2]++,a=0,n=o,s===0?(h=138,l=3):o===s?(h=6,l=3):(h=7,l=4))},au=(t,e,r)=>{let i,n=-1,o,s=e[0*2+1],a=0,h=7,l=4;for(s===0&&(h=138,l=3),i=0;i<=r;i++)if(o=s,s=e[(i+1)*2+1],!(++a<h&&o===s)){if(a<l)do Rt(t,o,t.bl_tree);while(--a!==0);else o!==0?(o!==n&&(Rt(t,o,t.bl_tree),a--),Rt(t,Gu,t.bl_tree),st(t,a-3,2)):a<=10?(Rt(t,qu,t.bl_tree),st(t,a-3,3)):(Rt(t,Vu,t.bl_tree),st(t,a-11,7));a=0,n=o,s===0?(h=138,l=3):o===s?(h=6,l=3):(h=7,l=4)}},_m=t=>{let e;for(su(t,t.dyn_ltree,t.l_desc.max_code),su(t,t.dyn_dtree,t.d_desc.max_code),Go(t,t.bl_desc),e=Qo-1;e>=3&&t.bl_tree[$u[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Mm=(t,e,r,i)=>{let n;for(st(t,e-257,5),st(t,r-1,5),st(t,i-4,4),n=0;n<i;n++)st(t,t.bl_tree[$u[n]*2+1],3);au(t,t.dyn_ltree,e-1),au(t,t.dyn_dtree,r-1)},Em=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<Mi;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},lu=!1,km=t=>{lu||(vm(),lu=!0),t.l_desc=new Co(t.dyn_ltree,Wu),t.d_desc=new Co(t.dyn_dtree,Ku),t.bl_desc=new Co(t.bl_tree,Zu),t.bi_buf=0,t.bi_valid=0,e0(t)},r0=(t,e,r,i)=>{st(t,(cm<<1)+(i?1:0),3),t0(t),wi(t,r),wi(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},Am=t=>{st(t,Xu<<1,3),Rt(t,es,Yt),bm(t)},Sm=(t,e,r,i)=>{let n,o,s=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Em(t)),Go(t,t.l_desc),Go(t,t.d_desc),s=_m(t),n=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=n&&(n=o)):n=o=r+5,r+4<=n&&e!==-1?r0(t,e,r,i):t.strategy===4||o===n?(st(t,(Xu<<1)+(i?1:0),3),ou(t,Yt,ci)):(st(t,(dm<<1)+(i?1:0),3),Mm(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),ou(t,t.dyn_ltree,t.dyn_dtree)),e0(t),i&&t0(t)},Dm=(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(xi[r]+Mi+1)*2]++,t.dyn_dtree[Hu(e)*2]++),t.sym_next===t.sym_end),Im=km,Rm=r0,Cm=Sm,Pm=Dm,Bm=Am,Tm={_tr_init:Im,_tr_stored_block:Rm,_tr_flush_block:Cm,_tr_tally:Pm,_tr_align:Bm},Lm=(t,e,r,i)=>{let n=t&65535|0,o=t>>>16&65535|0,s=0;for(;r!==0;){s=r>2e3?2e3:r,r-=s;do n=n+e[i++]|0,o=o+n|0;while(--s);n%=65521,o%=65521}return n|o<<16|0},bi=Lm,Fm=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},Om=new Uint32Array(Fm()),Um=(t,e,r,i)=>{let n=Om,o=i+r;t^=-1;for(let s=i;s<o;s++)t=t>>>8^n[(t^e[s])&255];return t^-1},We=Um,gr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},zr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Nm,_tr_stored_block:qo,_tr_flush_block:Ym,_tr_tally:Ht,_tr_align:zm}=Tm,{Z_NO_FLUSH:Jt,Z_PARTIAL_FLUSH:Xm,Z_FULL_FLUSH:jm,Z_FINISH:xt,Z_BLOCK:hu,Z_OK:He,Z_STREAM_END:fu,Z_STREAM_ERROR:Ct,Z_DATA_ERROR:Gm,Z_BUF_ERROR:Bo,Z_DEFAULT_COMPRESSION:qm,Z_FILTERED:Vm,Z_HUFFMAN_ONLY:nn,Z_RLE:$m,Z_FIXED:Wm,Z_DEFAULT_STRATEGY:Km,Z_UNKNOWN:Zm,Z_DEFLATED:dn}=zr,Hm=9,Jm=15,Qm=8,eg=29,tg=256,Vo=tg+1+eg,rg=30,ig=19,ng=2*Vo+1,og=15,ke=3,Zt=258,Pt=Zt+ke+1,sg=32,Ur=42,rs=57,$o=69,Wo=73,Ko=91,Zo=103,pr=113,fi=666,tt=1,Xr=2,xr=3,jr=4,ag=3,mr=(t,e)=>(t.msg=gr[e],e),uu=t=>t*2-(t>4?9:0),Kt=t=>{let e=t.length;for(;--e>=0;)t[e]=0},lg=t=>{let e,r,i,n=t.w_size;e=t.hash_size,i=e;do r=t.head[--i],t.head[i]=r>=n?r-n:0;while(--e);e=n,i=e;do r=t.prev[--i],t.prev[i]=r>=n?r-n:0;while(--e)},hg=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,Qt=hg,dt=t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},pt=(t,e)=>{Ym(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,dt(t.strm)},Ie=(t,e)=>{t.pending_buf[t.pending++]=e},hi=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Ho=(t,e,r,i)=>{let n=t.avail_in;return n>i&&(n=i),n===0?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),r),t.state.wrap===1?t.adler=bi(t.adler,e,n,r):t.state.wrap===2&&(t.adler=We(t.adler,e,n,r)),t.next_in+=n,t.total_in+=n,n)},i0=(t,e)=>{let r=t.max_chain_length,i=t.strstart,n,o,s=t.prev_length,a=t.nice_match,h=t.strstart>t.w_size-Pt?t.strstart-(t.w_size-Pt):0,l=t.window,f=t.w_mask,u=t.prev,c=t.strstart+Zt,d=l[i+s-1],p=l[i+s];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do if(n=e,!(l[n+s]!==p||l[n+s-1]!==d||l[n]!==l[i]||l[++n]!==l[i+1])){i+=2,n++;do;while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<c);if(o=Zt-(c-i),i=c-Zt,o>s){if(t.match_start=e,s=o,o>=a)break;d=l[i+s-1],p=l[i+s]}}while((e=u[e&f])>h&&--r!==0);return s<=t.lookahead?s:t.lookahead},Nr=t=>{let e=t.w_size,r,i,n;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Pt)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),lg(t),i+=e),t.strm.avail_in===0)break;if(r=Ho(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=r,t.lookahead+t.insert>=ke)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=Qt(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=Qt(t,t.ins_h,t.window[n+ke-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<ke)););}while(t.lookahead<Pt&&t.strm.avail_in!==0)},n0=(t,e)=>{let r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i,n,o,s=0,a=t.strm.avail_in;do{if(i=65535,o=t.bi_valid+42>>3,t.strm.avail_out<o||(o=t.strm.avail_out-o,n=t.strstart-t.block_start,i>n+t.strm.avail_in&&(i=n+t.strm.avail_in),i>o&&(i=o),i<r&&(i===0&&e!==xt||e===Jt||i!==n+t.strm.avail_in)))break;s=e===xt&&i===n+t.strm.avail_in?1:0,qo(t,0,0,s),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,dt(t.strm),n&&(n>i&&(n=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,i-=n),i&&(Ho(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(s===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?jr:e!==Jt&&e!==xt&&t.strm.avail_in===0&&t.strstart===t.block_start?Xr:(o=t.window_size-t.strstart,t.strm.avail_in>o&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,o+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),o>t.strm.avail_in&&(o=t.strm.avail_in),o&&(Ho(t.strm,t.window,t.strstart,o),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.high_water<t.strstart&&(t.high_water=t.strstart),o=t.bi_valid+42>>3,o=t.pending_buf_size-o>65535?65535:t.pending_buf_size-o,r=o>t.w_size?t.w_size:o,n=t.strstart-t.block_start,(n>=r||(n||e===xt)&&e!==Jt&&t.strm.avail_in===0&&n<=o)&&(i=n>o?o:n,s=e===xt&&t.strm.avail_in===0&&i===n?1:0,qo(t,t.block_start,i,s),t.block_start+=i,dt(t.strm)),s?xr:tt)},To=(t,e)=>{let r,i;for(;;){if(t.lookahead<Pt){if(Nr(t),t.lookahead<Pt&&e===Jt)return tt;if(t.lookahead===0)break}if(r=0,t.lookahead>=ke&&(t.ins_h=Qt(t,t.ins_h,t.window[t.strstart+ke-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-Pt&&(t.match_length=i0(t,r)),t.match_length>=ke)if(i=Ht(t,t.strstart-t.match_start,t.match_length-ke),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=ke){t.match_length--;do t.strstart++,t.ins_h=Qt(t,t.ins_h,t.window[t.strstart+ke-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Qt(t,t.ins_h,t.window[t.strstart+1]);else i=Ht(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(pt(t,!1),t.strm.avail_out===0))return tt}return t.insert=t.strstart<ke-1?t.strstart:ke-1,e===xt?(pt(t,!0),t.strm.avail_out===0?xr:jr):t.sym_next&&(pt(t,!1),t.strm.avail_out===0)?tt:Xr},Lr=(t,e)=>{let r,i,n;for(;;){if(t.lookahead<Pt){if(Nr(t),t.lookahead<Pt&&e===Jt)return tt;if(t.lookahead===0)break}if(r=0,t.lookahead>=ke&&(t.ins_h=Qt(t,t.ins_h,t.window[t.strstart+ke-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=ke-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-Pt&&(t.match_length=i0(t,r),t.match_length<=5&&(t.strategy===Vm||t.match_length===ke&&t.strstart-t.match_start>4096)&&(t.match_length=ke-1)),t.prev_length>=ke&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-ke,i=Ht(t,t.strstart-1-t.prev_match,t.prev_length-ke),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=Qt(t,t.ins_h,t.window[t.strstart+ke-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=ke-1,t.strstart++,i&&(pt(t,!1),t.strm.avail_out===0))return tt}else if(t.match_available){if(i=Ht(t,0,t.window[t.strstart-1]),i&&pt(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return tt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=Ht(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<ke-1?t.strstart:ke-1,e===xt?(pt(t,!0),t.strm.avail_out===0?xr:jr):t.sym_next&&(pt(t,!1),t.strm.avail_out===0)?tt:Xr},fg=(t,e)=>{let r,i,n,o,s=t.window;for(;;){if(t.lookahead<=Zt){if(Nr(t),t.lookahead<=Zt&&e===Jt)return tt;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=ke&&t.strstart>0&&(n=t.strstart-1,i=s[n],i===s[++n]&&i===s[++n]&&i===s[++n])){o=t.strstart+Zt;do;while(i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&n<o);t.match_length=Zt-(o-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=ke?(r=Ht(t,1,t.match_length-ke),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=Ht(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(pt(t,!1),t.strm.avail_out===0))return tt}return t.insert=0,e===xt?(pt(t,!0),t.strm.avail_out===0?xr:jr):t.sym_next&&(pt(t,!1),t.strm.avail_out===0)?tt:Xr},ug=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(Nr(t),t.lookahead===0)){if(e===Jt)return tt;break}if(t.match_length=0,r=Ht(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(pt(t,!1),t.strm.avail_out===0))return tt}return t.insert=0,e===xt?(pt(t,!0),t.strm.avail_out===0?xr:jr):t.sym_next&&(pt(t,!1),t.strm.avail_out===0)?tt:Xr};function It(t,e,r,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i,this.func=n}var ui=[new It(0,0,0,0,n0),new It(4,4,8,4,To),new It(4,5,16,8,To),new It(4,6,32,32,To),new It(4,4,16,16,Lr),new It(8,16,32,32,Lr),new It(8,16,128,128,Lr),new It(8,32,128,256,Lr),new It(32,128,258,1024,Lr),new It(32,258,258,4096,Lr)],cg=t=>{t.window_size=2*t.w_size,Kt(t.head),t.max_lazy_match=ui[t.level].max_lazy,t.good_match=ui[t.level].good_length,t.nice_match=ui[t.level].nice_length,t.max_chain_length=ui[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=ke-1,t.match_available=0,t.ins_h=0};function dg(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=dn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ng*2),this.dyn_dtree=new Uint16Array((2*rg+1)*2),this.bl_tree=new Uint16Array((2*ig+1)*2),Kt(this.dyn_ltree),Kt(this.dyn_dtree),Kt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(og+1),this.heap=new Uint16Array(2*Vo+1),Kt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Vo+1),Kt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Ei=t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.status!==Ur&&e.status!==rs&&e.status!==$o&&e.status!==Wo&&e.status!==Ko&&e.status!==Zo&&e.status!==pr&&e.status!==fi?1:0},o0=t=>{if(Ei(t))return mr(t,Ct);t.total_in=t.total_out=0,t.data_type=Zm;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?rs:e.wrap?Ur:pr,t.adler=e.wrap===2?0:1,e.last_flush=-2,Nm(e),He},s0=t=>{let e=o0(t);return e===He&&cg(t.state),e},pg=(t,e)=>Ei(t)||t.state.wrap!==2?Ct:(t.state.gzhead=e,He),a0=(t,e,r,i,n,o)=>{if(!t)return Ct;let s=1;if(e===qm&&(e=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),n<1||n>Hm||r!==dn||i<8||i>15||e<0||e>9||o<0||o>Wm||i===8&&s!==1)return mr(t,Ct);i===8&&(i=9);let a=new dg;return t.state=a,a.strm=t,a.status=Ur,a.wrap=s,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+ke-1)/ke),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=o,a.method=r,s0(t)},mg=(t,e)=>a0(t,e,dn,Jm,Qm,Km),gg=(t,e)=>{if(Ei(t)||e>hu||e<0)return t?mr(t,Ct):Ct;let r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===fi&&e!==xt)return mr(t,t.avail_out===0?Bo:Ct);let i=r.last_flush;if(r.last_flush=e,r.pending!==0){if(dt(t),t.avail_out===0)return r.last_flush=-1,He}else if(t.avail_in===0&&uu(e)<=uu(i)&&e!==xt)return mr(t,Bo);if(r.status===fi&&t.avail_in!==0)return mr(t,Bo);if(r.status===Ur&&r.wrap===0&&(r.status=pr),r.status===Ur){let n=dn+(r.w_bits-8<<4)<<8,o=-1;if(r.strategy>=nn||r.level<2?o=0:r.level<6?o=1:r.level===6?o=2:o=3,n|=o<<6,r.strstart!==0&&(n|=sg),n+=31-n%31,hi(r,n),r.strstart!==0&&(hi(r,t.adler>>>16),hi(r,t.adler&65535)),t.adler=1,r.status=pr,dt(t),r.pending!==0)return r.last_flush=-1,He}if(r.status===rs){if(t.adler=0,Ie(r,31),Ie(r,139),Ie(r,8),r.gzhead)Ie(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ie(r,r.gzhead.time&255),Ie(r,r.gzhead.time>>8&255),Ie(r,r.gzhead.time>>16&255),Ie(r,r.gzhead.time>>24&255),Ie(r,r.level===9?2:r.strategy>=nn||r.level<2?4:0),Ie(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(Ie(r,r.gzhead.extra.length&255),Ie(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=We(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=$o;else if(Ie(r,0),Ie(r,0),Ie(r,0),Ie(r,0),Ie(r,0),Ie(r,r.level===9?2:r.strategy>=nn||r.level<2?4:0),Ie(r,ag),r.status=pr,dt(t),r.pending!==0)return r.last_flush=-1,He}if(r.status===$o){if(r.gzhead.extra){let n=r.pending,o=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let a=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>n&&(t.adler=We(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex+=a,dt(t),r.pending!==0)return r.last_flush=-1,He;n=0,o-=a}let s=new Uint8Array(r.gzhead.extra);r.pending_buf.set(s.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>n&&(t.adler=We(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=Wo}if(r.status===Wo){if(r.gzhead.name){let n=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=We(t.adler,r.pending_buf,r.pending-n,n)),dt(t),r.pending!==0)return r.last_flush=-1,He;n=0}r.gzindex<r.gzhead.name.length?o=r.gzhead.name.charCodeAt(r.gzindex++)&255:o=0,Ie(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>n&&(t.adler=We(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=Ko}if(r.status===Ko){if(r.gzhead.comment){let n=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=We(t.adler,r.pending_buf,r.pending-n,n)),dt(t),r.pending!==0)return r.last_flush=-1,He;n=0}r.gzindex<r.gzhead.comment.length?o=r.gzhead.comment.charCodeAt(r.gzindex++)&255:o=0,Ie(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>n&&(t.adler=We(t.adler,r.pending_buf,r.pending-n,n))}r.status=Zo}if(r.status===Zo){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(dt(t),r.pending!==0))return r.last_flush=-1,He;Ie(r,t.adler&255),Ie(r,t.adler>>8&255),t.adler=0}if(r.status=pr,dt(t),r.pending!==0)return r.last_flush=-1,He}if(t.avail_in!==0||r.lookahead!==0||e!==Jt&&r.status!==fi){let n=r.level===0?n0(r,e):r.strategy===nn?ug(r,e):r.strategy===$m?fg(r,e):ui[r.level].func(r,e);if((n===xr||n===jr)&&(r.status=fi),n===tt||n===xr)return t.avail_out===0&&(r.last_flush=-1),He;if(n===Xr&&(e===Xm?zm(r):e!==hu&&(qo(r,0,0,!1),e===jm&&(Kt(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),dt(t),t.avail_out===0))return r.last_flush=-1,He}return e!==xt?He:r.wrap<=0?fu:(r.wrap===2?(Ie(r,t.adler&255),Ie(r,t.adler>>8&255),Ie(r,t.adler>>16&255),Ie(r,t.adler>>24&255),Ie(r,t.total_in&255),Ie(r,t.total_in>>8&255),Ie(r,t.total_in>>16&255),Ie(r,t.total_in>>24&255)):(hi(r,t.adler>>>16),hi(r,t.adler&65535)),dt(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?He:fu)},xg=t=>{if(Ei(t))return Ct;let e=t.state.status;return t.state=null,e===pr?mr(t,Gm):He},wg=(t,e)=>{let r=e.length;if(Ei(t))return Ct;let i=t.state,n=i.wrap;if(n===2||n===1&&i.status!==Ur||i.lookahead)return Ct;if(n===1&&(t.adler=bi(t.adler,e,r,0)),i.wrap=0,r>=i.w_size){n===0&&(Kt(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(e.subarray(r-i.w_size,r),0),e=h,r=i.w_size}let o=t.avail_in,s=t.next_in,a=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Nr(i);i.lookahead>=ke;){let h=i.strstart,l=i.lookahead-(ke-1);do i.ins_h=Qt(i,i.ins_h,i.window[h+ke-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--l);i.strstart=h,i.lookahead=ke-1,Nr(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ke-1,i.match_available=0,t.next_in=s,t.input=a,t.avail_in=o,i.wrap=n,He},bg=mg,yg=a0,vg=s0,_g=o0,Mg=pg,Eg=gg,kg=xg,Ag=wg,Sg="pako deflate (from Nodeca project)",di={deflateInit:bg,deflateInit2:yg,deflateReset:vg,deflateResetKeep:_g,deflateSetHeader:Mg,deflate:Eg,deflateEnd:kg,deflateSetDictionary:Ag,deflateInfo:Sg},Dg=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Ig=function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let i in r)Dg(r,i)&&(t[i]=r[i])}}return t},Rg=t=>{let e=0;for(let i=0,n=t.length;i<n;i++)e+=t[i].length;let r=new Uint8Array(e);for(let i=0,n=0,o=t.length;i<o;i++){let s=t[i];r.set(s,n),n+=s.length}return r},pn={assign:Ig,flattenChunks:Rg},l0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l0=!1}var yi=new Uint8Array(256);for(let t=0;t<256;t++)yi[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;yi[254]=yi[254]=1;var Cg=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,i,n,o,s=t.length,a=0;for(n=0;n<s;n++)r=t.charCodeAt(n),(r&64512)===55296&&n+1<s&&(i=t.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(a),o=0,n=0;o<a;n++)r=t.charCodeAt(n),(r&64512)===55296&&n+1<s&&(i=t.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|r&63):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|r&63):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|r&63);return e},Pg=(t,e)=>{if(e<65534&&t.subarray&&l0)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let i=0;i<e;i++)r+=String.fromCharCode(t[i]);return r},Bg=(t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,n,o=new Array(r*2);for(n=0,i=0;i<r;){let s=t[i++];if(s<128){o[n++]=s;continue}let a=yi[s];if(a>4){o[n++]=65533,i+=a-1;continue}for(s&=a===2?31:a===3?15:7;a>1&&i<r;)s=s<<6|t[i++]&63,a--;if(a>1){o[n++]=65533;continue}s<65536?o[n++]=s:(s-=65536,o[n++]=55296|s>>10&1023,o[n++]=56320|s&1023)}return Pg(o,n)},Tg=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+yi[t[r]]>e?r:e},vi={string2buf:Cg,buf2string:Bg,utf8border:Tg};function Lg(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var h0=Lg,f0=Object.prototype.toString,{Z_NO_FLUSH:Fg,Z_SYNC_FLUSH:Og,Z_FULL_FLUSH:Ug,Z_FINISH:Ng,Z_OK:un,Z_STREAM_END:Yg,Z_DEFAULT_COMPRESSION:zg,Z_DEFAULT_STRATEGY:Xg,Z_DEFLATED:jg}=zr;function ki(t){this.options=pn.assign({level:zg,method:jg,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xg},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h0,this.strm.avail_out=0;let r=di.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==un)throw new Error(gr[r]);if(e.header&&di.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(typeof e.dictionary=="string"?i=vi.string2buf(e.dictionary):f0.call(e.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(e.dictionary):i=e.dictionary,r=di.deflateSetDictionary(this.strm,i),r!==un)throw new Error(gr[r]);this._dict_set=!0}}ki.prototype.push=function(t,e){let r=this.strm,i=this.options.chunkSize,n,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?Ng:Fg,typeof t=="string"?r.input=vi.string2buf(t):f0.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(o===Og||o===Ug)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(n=di.deflate(r,o),n===Yg)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=di.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===un;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};ki.prototype.onData=function(t){this.chunks.push(t)};ki.prototype.onEnd=function(t){t===un&&(this.result=pn.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function is(t,e){let r=new ki(e);if(r.push(t,!0),r.err)throw r.msg||gr[r.err];return r.result}function Gg(t,e){return e=e||{},e.raw=!0,is(t,e)}function qg(t,e){return e=e||{},e.gzip=!0,is(t,e)}var Vg=ki,$g=is,Wg=Gg,Kg=qg,Zg=zr,Hg={Deflate:Vg,deflate:$g,deflateRaw:Wg,gzip:Kg,constants:Zg},on=16209,Jg=16191,Qg=function(e,r){let i,n,o,s,a,h,l,f,u,c,d,p,g,x,m,w,y,M,_,R,E,A,I,b,k=e.state;i=e.next_in,I=e.input,n=i+(e.avail_in-5),o=e.next_out,b=e.output,s=o-(r-e.avail_out),a=o+(e.avail_out-257),h=k.dmax,l=k.wsize,f=k.whave,u=k.wnext,c=k.window,d=k.hold,p=k.bits,g=k.lencode,x=k.distcode,m=(1<<k.lenbits)-1,w=(1<<k.distbits)-1;e:do{p<15&&(d+=I[i++]<<p,p+=8,d+=I[i++]<<p,p+=8),y=g[d&m];t:for(;;){if(M=y>>>24,d>>>=M,p-=M,M=y>>>16&255,M===0)b[o++]=y&65535;else if(M&16){_=y&65535,M&=15,M&&(p<M&&(d+=I[i++]<<p,p+=8),_+=d&(1<<M)-1,d>>>=M,p-=M),p<15&&(d+=I[i++]<<p,p+=8,d+=I[i++]<<p,p+=8),y=x[d&w];r:for(;;){if(M=y>>>24,d>>>=M,p-=M,M=y>>>16&255,M&16){if(R=y&65535,M&=15,p<M&&(d+=I[i++]<<p,p+=8,p<M&&(d+=I[i++]<<p,p+=8)),R+=d&(1<<M)-1,R>h){e.msg="invalid distance too far back",k.mode=on;break e}if(d>>>=M,p-=M,M=o-s,R>M){if(M=R-M,M>f&&k.sane){e.msg="invalid distance too far back",k.mode=on;break e}if(E=0,A=c,u===0){if(E+=l-M,M<_){_-=M;do b[o++]=c[E++];while(--M);E=o-R,A=b}}else if(u<M){if(E+=l+u-M,M-=u,M<_){_-=M;do b[o++]=c[E++];while(--M);if(E=0,u<_){M=u,_-=M;do b[o++]=c[E++];while(--M);E=o-R,A=b}}}else if(E+=u-M,M<_){_-=M;do b[o++]=c[E++];while(--M);E=o-R,A=b}for(;_>2;)b[o++]=A[E++],b[o++]=A[E++],b[o++]=A[E++],_-=3;_&&(b[o++]=A[E++],_>1&&(b[o++]=A[E++]))}else{E=o-R;do b[o++]=b[E++],b[o++]=b[E++],b[o++]=b[E++],_-=3;while(_>2);_&&(b[o++]=b[E++],_>1&&(b[o++]=b[E++]))}}else if(M&64){e.msg="invalid distance code",k.mode=on;break e}else{y=x[(y&65535)+(d&(1<<M)-1)];continue r}break}}else if(M&64)if(M&32){k.mode=Jg;break e}else{e.msg="invalid literal/length code",k.mode=on;break e}else{y=g[(y&65535)+(d&(1<<M)-1)];continue t}break}}while(i<n&&o<a);_=p>>3,i-=_,p-=_<<3,d&=(1<<p)-1,e.next_in=i,e.next_out=o,e.avail_in=i<n?5+(n-i):5-(i-n),e.avail_out=o<a?257+(a-o):257-(o-a),k.hold=d,k.bits=p},Fr=15,cu=852,du=592,pu=0,Lo=1,mu=2,ex=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),tx=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),rx=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ix=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),nx=(t,e,r,i,n,o,s,a)=>{let h=a.bits,l=0,f=0,u=0,c=0,d=0,p=0,g=0,x=0,m=0,w=0,y,M,_,R,E,A=null,I,b=new Uint16Array(Fr+1),k=new Uint16Array(Fr+1),B=null,S,j,L;for(l=0;l<=Fr;l++)b[l]=0;for(f=0;f<i;f++)b[e[r+f]]++;for(d=h,c=Fr;c>=1&&b[c]===0;c--);if(d>c&&(d=c),c===0)return n[o++]=1<<24|64<<16|0,n[o++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<c&&b[u]===0;u++);for(d<u&&(d=u),x=1,l=1;l<=Fr;l++)if(x<<=1,x-=b[l],x<0)return-1;if(x>0&&(t===pu||c!==1))return-1;for(k[1]=0,l=1;l<Fr;l++)k[l+1]=k[l]+b[l];for(f=0;f<i;f++)e[r+f]!==0&&(s[k[e[r+f]]++]=f);if(t===pu?(A=B=s,I=20):t===Lo?(A=ex,B=tx,I=257):(A=rx,B=ix,I=0),w=0,f=0,l=u,E=o,p=d,g=0,_=-1,m=1<<d,R=m-1,t===Lo&&m>cu||t===mu&&m>du)return 1;for(;;){S=l-g,s[f]+1<I?(j=0,L=s[f]):s[f]>=I?(j=B[s[f]-I],L=A[s[f]-I]):(j=96,L=0),y=1<<l-g,M=1<<p,u=M;do M-=y,n[E+(w>>g)+M]=S<<24|j<<16|L|0;while(M!==0);for(y=1<<l-1;w&y;)y>>=1;if(y!==0?(w&=y-1,w+=y):w=0,f++,--b[l]===0){if(l===c)break;l=e[r+s[f]]}if(l>d&&(w&R)!==_){for(g===0&&(g=d),E+=u,p=l-g,x=1<<p;p+g<c&&(x-=b[p+g],!(x<=0));)p++,x<<=1;if(m+=1<<p,t===Lo&&m>cu||t===mu&&m>du)return 1;_=w&R,n[_]=d<<24|p<<16|E-o|0}}return w!==0&&(n[E+w]=l-g<<24|64<<16|0),a.bits=d,0},pi=nx,ox=0,u0=1,c0=2,{Z_FINISH:gu,Z_BLOCK:sx,Z_TREES:sn,Z_OK:wr,Z_STREAM_END:ax,Z_NEED_DICT:lx,Z_STREAM_ERROR:wt,Z_DATA_ERROR:d0,Z_MEM_ERROR:p0,Z_BUF_ERROR:hx,Z_DEFLATED:xu}=zr,mn=16180,wu=16181,bu=16182,yu=16183,vu=16184,_u=16185,Mu=16186,Eu=16187,ku=16188,Au=16189,cn=16190,Nt=16191,Fo=16192,Su=16193,Oo=16194,Du=16195,Iu=16196,Ru=16197,Cu=16198,an=16199,ln=16200,Pu=16201,Bu=16202,Tu=16203,Lu=16204,Fu=16205,Uo=16206,Ou=16207,Uu=16208,Le=16209,m0=16210,g0=16211,fx=852,ux=592,cx=15,dx=cx,Nu=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function px(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var br=t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.mode<mn||e.mode>g0?1:0},x0=t=>{if(br(t))return wt;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=mn,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(fx),e.distcode=e.distdyn=new Int32Array(ux),e.sane=1,e.back=-1,wr},w0=t=>{if(br(t))return wt;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,x0(t)},b0=(t,e)=>{let r;if(br(t))return wt;let i=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?wt:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=r,i.wbits=e,w0(t))},y0=(t,e)=>{if(!t)return wt;let r=new px;t.state=r,r.strm=t,r.window=null,r.mode=mn;let i=b0(t,e);return i!==wr&&(t.state=null),i},mx=t=>y0(t,dx),Yu=!0,No,Yo,gx=t=>{if(Yu){No=new Int32Array(512),Yo=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(pi(u0,t.lens,0,288,No,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;pi(c0,t.lens,0,32,Yo,0,t.work,{bits:5}),Yu=!1}t.lencode=No,t.lenbits=9,t.distcode=Yo,t.distbits=5},v0=(t,e,r,i)=>{let n,o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>i&&(n=i),o.window.set(e.subarray(r-i,r-i+n),o.wnext),i-=n,i?(o.window.set(e.subarray(r-i,r),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0},xx=(t,e)=>{let r,i,n,o,s,a,h,l,f,u,c,d,p,g,x=0,m,w,y,M,_,R,E,A,I=new Uint8Array(4),b,k,B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(br(t)||!t.output||!t.input&&t.avail_in!==0)return wt;r=t.state,r.mode===Nt&&(r.mode=Fo),s=t.next_out,n=t.output,h=t.avail_out,o=t.next_in,i=t.input,a=t.avail_in,l=r.hold,f=r.bits,u=a,c=h,A=wr;e:for(;;)switch(r.mode){case mn:if(r.wrap===0){r.mode=Fo;break}for(;f<16;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(r.wrap&2&&l===35615){r.wbits===0&&(r.wbits=15),r.check=0,I[0]=l&255,I[1]=l>>>8&255,r.check=We(r.check,I,2,0),l=0,f=0,r.mode=wu;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",r.mode=Le;break}if((l&15)!==xu){t.msg="unknown compression method",r.mode=Le;break}if(l>>>=4,f-=4,E=(l&15)+8,r.wbits===0&&(r.wbits=E),E>15||E>r.wbits){t.msg="invalid window size",r.mode=Le;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=l&512?Au:Nt,l=0,f=0;break;case wu:for(;f<16;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(r.flags=l,(r.flags&255)!==xu){t.msg="unknown compression method",r.mode=Le;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=Le;break}r.head&&(r.head.text=l>>8&1),r.flags&512&&r.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,r.check=We(r.check,I,2,0)),l=0,f=0,r.mode=bu;case bu:for(;f<32;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}r.head&&(r.head.time=l),r.flags&512&&r.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,r.check=We(r.check,I,4,0)),l=0,f=0,r.mode=yu;case yu:for(;f<16;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}r.head&&(r.head.xflags=l&255,r.head.os=l>>8),r.flags&512&&r.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,r.check=We(r.check,I,2,0)),l=0,f=0,r.mode=vu;case vu:if(r.flags&1024){for(;f<16;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}r.length=l,r.head&&(r.head.extra_len=l),r.flags&512&&r.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,r.check=We(r.check,I,2,0)),l=0,f=0}else r.head&&(r.head.extra=null);r.mode=_u;case _u:if(r.flags&1024&&(d=r.length,d>a&&(d=a),d&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(i.subarray(o,o+d),E)),r.flags&512&&r.wrap&4&&(r.check=We(r.check,i,d,o)),a-=d,o+=d,r.length-=d),r.length))break e;r.length=0,r.mode=Mu;case Mu:if(r.flags&2048){if(a===0)break e;d=0;do E=i[o+d++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E));while(E&&d<a);if(r.flags&512&&r.wrap&4&&(r.check=We(r.check,i,d,o)),a-=d,o+=d,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Eu;case Eu:if(r.flags&4096){if(a===0)break e;d=0;do E=i[o+d++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E));while(E&&d<a);if(r.flags&512&&r.wrap&4&&(r.check=We(r.check,i,d,o)),a-=d,o+=d,E)break e}else r.head&&(r.head.comment=null);r.mode=ku;case ku:if(r.flags&512){for(;f<16;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(r.wrap&4&&l!==(r.check&65535)){t.msg="header crc mismatch",r.mode=Le;break}l=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=Nt;break;case Au:for(;f<32;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}t.adler=r.check=Nu(l),l=0,f=0,r.mode=cn;case cn:if(r.havedict===0)return t.next_out=s,t.avail_out=h,t.next_in=o,t.avail_in=a,r.hold=l,r.bits=f,lx;t.adler=r.check=1,r.mode=Nt;case Nt:if(e===sx||e===sn)break e;case Fo:if(r.last){l>>>=f&7,f-=f&7,r.mode=Uo;break}for(;f<3;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}switch(r.last=l&1,l>>>=1,f-=1,l&3){case 0:r.mode=Su;break;case 1:if(gx(r),r.mode=an,e===sn){l>>>=2,f-=2;break e}break;case 2:r.mode=Iu;break;case 3:t.msg="invalid block type",r.mode=Le}l>>>=2,f-=2;break;case Su:for(l>>>=f&7,f-=f&7;f<32;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Le;break}if(r.length=l&65535,l=0,f=0,r.mode=Oo,e===sn)break e;case Oo:r.mode=Du;case Du:if(d=r.length,d){if(d>a&&(d=a),d>h&&(d=h),d===0)break e;n.set(i.subarray(o,o+d),s),a-=d,o+=d,h-=d,s+=d,r.length-=d;break}r.mode=Nt;break;case Iu:for(;f<14;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(r.nlen=(l&31)+257,l>>>=5,f-=5,r.ndist=(l&31)+1,l>>>=5,f-=5,r.ncode=(l&15)+4,l>>>=4,f-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Le;break}r.have=0,r.mode=Ru;case Ru:for(;r.have<r.ncode;){for(;f<3;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}r.lens[B[r.have++]]=l&7,l>>>=3,f-=3}for(;r.have<19;)r.lens[B[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,b={bits:r.lenbits},A=pi(ox,r.lens,0,19,r.lencode,0,r.work,b),r.lenbits=b.bits,A){t.msg="invalid code lengths set",r.mode=Le;break}r.have=0,r.mode=Cu;case Cu:for(;r.have<r.nlen+r.ndist;){for(;x=r.lencode[l&(1<<r.lenbits)-1],m=x>>>24,w=x>>>16&255,y=x&65535,!(m<=f);){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(y<16)l>>>=m,f-=m,r.lens[r.have++]=y;else{if(y===16){for(k=m+2;f<k;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(l>>>=m,f-=m,r.have===0){t.msg="invalid bit length repeat",r.mode=Le;break}E=r.lens[r.have-1],d=3+(l&3),l>>>=2,f-=2}else if(y===17){for(k=m+3;f<k;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}l>>>=m,f-=m,E=0,d=3+(l&7),l>>>=3,f-=3}else{for(k=m+7;f<k;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}l>>>=m,f-=m,E=0,d=11+(l&127),l>>>=7,f-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Le;break}for(;d--;)r.lens[r.have++]=E}}if(r.mode===Le)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Le;break}if(r.lenbits=9,b={bits:r.lenbits},A=pi(u0,r.lens,0,r.nlen,r.lencode,0,r.work,b),r.lenbits=b.bits,A){t.msg="invalid literal/lengths set",r.mode=Le;break}if(r.distbits=6,r.distcode=r.distdyn,b={bits:r.distbits},A=pi(c0,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,b),r.distbits=b.bits,A){t.msg="invalid distances set",r.mode=Le;break}if(r.mode=an,e===sn)break e;case an:r.mode=ln;case ln:if(a>=6&&h>=258){t.next_out=s,t.avail_out=h,t.next_in=o,t.avail_in=a,r.hold=l,r.bits=f,Qg(t,c),s=t.next_out,n=t.output,h=t.avail_out,o=t.next_in,i=t.input,a=t.avail_in,l=r.hold,f=r.bits,r.mode===Nt&&(r.back=-1);break}for(r.back=0;x=r.lencode[l&(1<<r.lenbits)-1],m=x>>>24,w=x>>>16&255,y=x&65535,!(m<=f);){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(w&&!(w&240)){for(M=m,_=w,R=y;x=r.lencode[R+((l&(1<<M+_)-1)>>M)],m=x>>>24,w=x>>>16&255,y=x&65535,!(M+m<=f);){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}l>>>=M,f-=M,r.back+=M}if(l>>>=m,f-=m,r.back+=m,r.length=y,w===0){r.mode=Fu;break}if(w&32){r.back=-1,r.mode=Nt;break}if(w&64){t.msg="invalid literal/length code",r.mode=Le;break}r.extra=w&15,r.mode=Pu;case Pu:if(r.extra){for(k=r.extra;f<k;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Bu;case Bu:for(;x=r.distcode[l&(1<<r.distbits)-1],m=x>>>24,w=x>>>16&255,y=x&65535,!(m<=f);){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(!(w&240)){for(M=m,_=w,R=y;x=r.distcode[R+((l&(1<<M+_)-1)>>M)],m=x>>>24,w=x>>>16&255,y=x&65535,!(M+m<=f);){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}l>>>=M,f-=M,r.back+=M}if(l>>>=m,f-=m,r.back+=m,w&64){t.msg="invalid distance code",r.mode=Le;break}r.offset=y,r.extra=w&15,r.mode=Tu;case Tu:if(r.extra){for(k=r.extra;f<k;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Le;break}r.mode=Lu;case Lu:if(h===0)break e;if(d=c-h,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Le;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=n,p=s-r.offset,d=r.length;d>h&&(d=h),h-=d,r.length-=d;do n[s++]=g[p++];while(--d);r.length===0&&(r.mode=ln);break;case Fu:if(h===0)break e;n[s++]=r.length,h--,r.mode=ln;break;case Uo:if(r.wrap){for(;f<32;){if(a===0)break e;a--,l|=i[o++]<<f,f+=8}if(c-=h,t.total_out+=c,r.total+=c,r.wrap&4&&c&&(t.adler=r.check=r.flags?We(r.check,n,c,s-c):bi(r.check,n,c,s-c)),c=h,r.wrap&4&&(r.flags?l:Nu(l))!==r.check){t.msg="incorrect data check",r.mode=Le;break}l=0,f=0}r.mode=Ou;case Ou:if(r.wrap&&r.flags){for(;f<32;){if(a===0)break e;a--,l+=i[o++]<<f,f+=8}if(r.wrap&4&&l!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=Le;break}l=0,f=0}r.mode=Uu;case Uu:A=ax;break e;case Le:A=d0;break e;case m0:return p0;case g0:default:return wt}return t.next_out=s,t.avail_out=h,t.next_in=o,t.avail_in=a,r.hold=l,r.bits=f,(r.wsize||c!==t.avail_out&&r.mode<Le&&(r.mode<Uo||e!==gu))&&v0(t,t.output,t.next_out,c-t.avail_out),u-=t.avail_in,c-=t.avail_out,t.total_in+=u,t.total_out+=c,r.total+=c,r.wrap&4&&c&&(t.adler=r.check=r.flags?We(r.check,n,c,t.next_out-c):bi(r.check,n,c,t.next_out-c)),t.data_type=r.bits+(r.last?64:0)+(r.mode===Nt?128:0)+(r.mode===an||r.mode===Oo?256:0),(u===0&&c===0||e===gu)&&A===wr&&(A=hx),A},wx=t=>{if(br(t))return wt;let e=t.state;return e.window&&(e.window=null),t.state=null,wr},bx=(t,e)=>{if(br(t))return wt;let r=t.state;return r.wrap&2?(r.head=e,e.done=!1,wr):wt},yx=(t,e)=>{let r=e.length,i,n,o;return br(t)||(i=t.state,i.wrap!==0&&i.mode!==cn)?wt:i.mode===cn&&(n=1,n=bi(n,e,r,0),n!==i.check)?d0:(o=v0(t,e,r,r),o?(i.mode=m0,p0):(i.havedict=1,wr))},vx=w0,_x=b0,Mx=x0,Ex=mx,kx=y0,Ax=xx,Sx=wx,Dx=bx,Ix=yx,Rx="pako inflate (from Nodeca project)",zt={inflateReset:vx,inflateReset2:_x,inflateResetKeep:Mx,inflateInit:Ex,inflateInit2:kx,inflate:Ax,inflateEnd:Sx,inflateGetHeader:Dx,inflateSetDictionary:Ix,inflateInfo:Rx};function Cx(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Px=Cx,_0=Object.prototype.toString,{Z_NO_FLUSH:Bx,Z_FINISH:Tx,Z_OK:_i,Z_STREAM_END:zo,Z_NEED_DICT:Xo,Z_STREAM_ERROR:Lx,Z_DATA_ERROR:zu,Z_MEM_ERROR:Fx}=zr;function Ai(t){this.options=pn.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h0,this.strm.avail_out=0;let r=zt.inflateInit2(this.strm,e.windowBits);if(r!==_i)throw new Error(gr[r]);if(this.header=new Px,zt.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=vi.string2buf(e.dictionary):_0.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=zt.inflateSetDictionary(this.strm,e.dictionary),r!==_i)))throw new Error(gr[r])}Ai.prototype.push=function(t,e){let r=this.strm,i=this.options.chunkSize,n=this.options.dictionary,o,s,a;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Tx:Bx,_0.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),o=zt.inflate(r,s),o===Xo&&n&&(o=zt.inflateSetDictionary(r,n),o===_i?o=zt.inflate(r,s):o===zu&&(o=Xo));r.avail_in>0&&o===zo&&r.state.wrap>0&&t[r.next_in]!==0;)zt.inflateReset(r),o=zt.inflate(r,s);switch(o){case Lx:case zu:case Xo:case Fx:return this.onEnd(o),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(r.avail_out===0||o===zo))if(this.options.to==="string"){let h=vi.utf8border(r.output,r.next_out),l=r.next_out-h,f=vi.buf2string(r.output,h);r.next_out=l,r.avail_out=i-l,l&&r.output.set(r.output.subarray(h,h+l),0),this.onData(f)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===_i&&a===0)){if(o===zo)return o=zt.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Ai.prototype.onData=function(t){this.chunks.push(t)};Ai.prototype.onEnd=function(t){t===_i&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=pn.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ns(t,e){let r=new Ai(e);if(r.push(t),r.err)throw r.msg||gr[r.err];return r.result}function Ox(t,e){return e=e||{},e.raw=!0,ns(t,e)}var Ux=Ai,Nx=ns,Yx=Ox,zx=ns,Xx=zr,jx={Inflate:Ux,inflate:Nx,inflateRaw:Yx,ungzip:zx,constants:Xx},{Deflate:z_,deflate:Gx,deflateRaw:X_,gzip:j_}=Hg,{Inflate:qx,inflate:Vx,inflateRaw:G_,ungzip:q_}=jx;var M0=Gx;var E0=qx,gn=Vx;var Gr=[137,80,78,71,13,10,26,10],A0=[];for(let t=0;t<256;t++){let e=t;for(let r=0;r<8;r++)e&1?e=3988292384^e>>>1:e=e>>>1;A0[t]=e}var k0=4294967295;function $x(t,e,r){let i=t;for(let n=0;n<r;n++)i=A0[(i^e[n])&255]^i>>>8;return i}function xn(t,e){return($x(k0,t,e)^k0)>>>0}var qe;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(qe||(qe={}));var er;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"})(er||(er={}));var yr;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"})(yr||(yr={}));var vr;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"})(vr||(vr={}));var Wx=new Uint8Array(0),S0="\0",Kx=new Uint16Array([255]),Zx=new Uint8Array(Kx.buffer),Hx=Zx[0]===255,Si=class extends D0.IOBuffer{constructor(e,r={}){super(e);let{checkCrc:i=!1}=r;this._checkCrc=i,this._inflator=new E0,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=er.UNKNOWN,this._filterMethod=yr.UNKNOWN,this._interlaceMethod=vr.UNKNOWN,this._colorType=qe.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<Gr.length;e++)if(this.readUint8()!==Gr[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${Gr[e]}.`)}decodeChunk(){let e=this.readUint32(),r=this.readChars(4),i=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${r}`);if(this._checkCrc){let n=this.readUint32(),o=e+4,s=xn(new Uint8Array(this.buffer,this.byteOffset+this.offset-o-4,o),o);if(s!==n)throw new Error(`CRC mismatch for chunk ${r}. Expected ${n}, found ${s}`)}else this.skip(4)}decodeIHDR(){let e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=ow(this.readUint8());let r=this.readUint8();this._colorType=r;let i;switch(r){case qe.GREYSCALE:i=1;break;case qe.TRUECOLOUR:i=3;break;case qe.INDEXED_COLOUR:i=1;break;case qe.GREYSCALE_ALPHA:i=2;break;case qe.TRUECOLOUR_ALPHA:i=4;break;default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==er.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);let r=e/3;this._hasPalette=!0;let i=[];this._palette=i;for(let n=0;n<r;n++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){switch(this._colorType){case qe.GREYSCALE:case qe.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let r=0;r<e/2;r++)this._transparency[r]=this.readUint16();break}case qe.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let r=0;for(;r<e;r++){let i=this.readByte();this._palette[r].push(i)}for(;r<this._palette.length;r++)this._palette[r].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){let r="",i;for(;(i=this.readChar())!==S0;)r+=i;let n=this.readUint8();if(n!==er.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);let o=this.readBytes(e-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:gn(o)}}decodetEXt(e){let r="",i;for(;(i=this.readChar())!==S0;)r+=i;this._png.text[r]=this.readChars(e-r.length-1)}decodepHYs(){let e=this.readUint32(),r=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:r,unit:i}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);let e=this._inflator.result;if(this._filterMethod!==yr.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===vr.NO_INTERLACE)this.decodeInterlaceNull(e);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(e){let r=this._png.height,i=this._png.channels*this._png.depth/8,n=this._png.width*i,o=new Uint8Array(this._png.height*n),s=Wx,a=0,h,l;for(let f=0;f<r;f++){switch(h=e.subarray(a+1,a+1+n),l=o.subarray(f*n,(f+1)*n),e[a]){case 0:Jx(h,l,n);break;case 1:Qx(h,l,n,i);break;case 2:ew(h,l,s,n);break;case 3:tw(h,l,s,n,i);break;case 4:rw(h,l,s,n,i);break;default:throw new Error(`Unsupported filter: ${e[a]}`)}s=l,a+=n+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){let f=new Uint16Array(o.buffer);if(Hx)for(let u=0;u<f.length;u++)f[u]=nw(f[u]);this._png.data=f}else this._png.data=o}};function Jx(t,e,r){for(let i=0;i<r;i++)e[i]=t[i]}function Qx(t,e,r,i){let n=0;for(;n<i;n++)e[n]=t[n];for(;n<r;n++)e[n]=t[n]+e[n-i]&255}function ew(t,e,r,i){let n=0;if(r.length===0)for(;n<i;n++)e[n]=t[n];else for(;n<i;n++)e[n]=t[n]+r[n]&255}function tw(t,e,r,i,n){let o=0;if(r.length===0){for(;o<n;o++)e[o]=t[o];for(;o<i;o++)e[o]=t[o]+(e[o-n]>>1)&255}else{for(;o<n;o++)e[o]=t[o]+(r[o]>>1)&255;for(;o<i;o++)e[o]=t[o]+(e[o-n]+r[o]>>1)&255}}function rw(t,e,r,i,n){let o=0;if(r.length===0){for(;o<n;o++)e[o]=t[o];for(;o<i;o++)e[o]=t[o]+e[o-n]&255}else{for(;o<n;o++)e[o]=t[o]+r[o]&255;for(;o<i;o++)e[o]=t[o]+iw(e[o-n],r[o],r[o-n])&255}}function iw(t,e,r){let i=t+e-r,n=Math.abs(i-t),o=Math.abs(i-e),s=Math.abs(i-r);return n<=o&&n<=s?t:o<=s?e:r}function nw(t){return(t&255)<<8|t>>8&255}function ow(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}var os=ve(Tr());var sw={level:3},Di=class extends os.IOBuffer{constructor(e,r={}){super(),this._colorType=qe.UNKNOWN,this._zlibOptions={...sw,...r.zlib},this._png=this._checkData(e),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(Gr)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(er.DEFLATE),this.writeByte(yr.ADAPTIVE),this.writeByte(vr.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(e){this.writeUint32(e.length),this.writeChars("IDAT"),this.writeBytes(e),this.writeCrc(e.length+4)}encodeData(){let{width:e,height:r,channels:i,depth:n,data:o}=this._png,s=i*e,a=new os.IOBuffer().setBigEndian(),h=0;for(let u=0;u<r;u++)if(a.writeByte(0),n===8)h=lw(o,a,s,h);else if(n===16)h=hw(o,a,s,h);else throw new Error("unreachable");let l=a.toArray(),f=M0(l,this._zlibOptions);this.encodeIDAT(f)}_checkData(e){let{colorType:r,channels:i,depth:n}=aw(e),o={width:I0(e.width,"width"),height:I0(e.height,"height"),channels:i,data:e.data,depth:n,text:{}};this._colorType=r;let s=o.width*o.height*i;if(o.data.length!==s)throw new RangeError(`wrong data size. Found ${o.data.length}, expected ${s}`);return o}writeCrc(e){this.writeUint32(xn(new Uint8Array(this.buffer,this.byteOffset+this.offset-e,e),e))}};function I0(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(`${e} must be a positive integer`)}function aw(t){let{channels:e=4,depth:r=8}=t;if(e!==4&&e!==3&&e!==2&&e!==1)throw new RangeError(`unsupported number of channels: ${e}`);if(r!==8&&r!==16)throw new RangeError(`unsupported bit depth: ${r}`);let i={channels:e,depth:r,colorType:qe.UNKNOWN};switch(e){case 4:i.colorType=qe.TRUECOLOUR_ALPHA;break;case 3:i.colorType=qe.TRUECOLOUR;break;case 1:i.colorType=qe.GREYSCALE;break;case 2:i.colorType=qe.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return i}function lw(t,e,r,i){for(let n=0;n<r;n++)e.writeByte(t[i++]);return i}function hw(t,e,r,i){for(let n=0;n<r;n++)e.writeUint16(t[i++]);return i}var R0;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(R0||(R0={}));function C0(t,e){return new Si(t,e).decode()}function P0(t,e){return new Di(t,e).encode()}var $0=ve(ls());var qr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ii=new Uint8Array(256);for(let t=0;t<qr.length;t++)Ii[qr.charCodeAt(t)]=t;function dw(t){let e,r=t.length,i="";for(e=0;e<r;e+=3)i+=qr[t[e]>>2],i+=qr[(t[e]&3)<<4|t[e+1]>>4],i+=qr[(t[e+1]&15)<<2|t[e+2]>>6],i+=qr[t[e+2]&63];return r%3===2?i=`${i.substring(0,i.length-1)}=`:r%3===1&&(i=`${i.substring(0,i.length-2)}==`),i}function N0(t){let e=t.length*.75,r=t.length,i=0,n,o,s,a;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);let h=new Uint8Array(e);for(let l=0;l<r;l+=4)n=Ii[t.charCodeAt(l)],o=Ii[t.charCodeAt(l+1)],s=Ii[t.charCodeAt(l+2)],a=Ii[t.charCodeAt(l+3)],h[i++]=n<<2|o>>4,h[i++]=(o&15)<<4|s>>2,h[i++]=(s&3)<<6|a&63;return h}function bn(t,e){let r=dw(t);return`data:${e};base64,${r}`}var Y0=self.ImageData,z0=self.Image;function yn(t,e){let r=self.document.createElement("canvas");return r.width=t,r.height=e,r}function X0(t,{withCredentials:e=!1}={}){return new Promise(function(r,i){let n=new self.XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.withCredentials=e,n.onload=function(o){this.status!==200?i(o):r(this.response)},n.onerror=i,n.send()})}function j0(){throw new Error("createWriteStream does not exist in the browser")}function G0(){throw new Error("writeFile does not exist in the browser")}function q0(t){return t.includes("/")||(t=`image/${t}`),t}function hs(t,e={}){let r={width:t.width,height:t.height,data:t.getRGBAData()};return(0,$0.encode)(r,e.quality).data}function fs(t,e){let r={width:t.width,height:t.height,channels:t.channels,depth:t.bitDepth,data:t.data};return(r.depth===1||r.depth===32)&&(r.depth=8,r.channels=4,r.data=t.getRGBAData()),P0(r,e)}var V0={save(t,e={}){let{useCanvas:r=!1,encoder:i=void 0}=e,{format:n}=e;if(!n){let o=/\.(?<format>[a-zA-Z]+)$/.exec(t);o&&(n=o.groups.format.toLowerCase())}if(!n)throw new Error("file format not provided");return new Promise((o,s)=>{let a,h;switch(n.toLowerCase()){case"png":{r?a=this.getCanvas().pngStream():h=fs(this,i);break}case"jpg":case"jpeg":r?a=this.getCanvas().jpegStream():h=hs(this,i);break;case"bmp":h=(0,vn.encode)(this,i);break;default:throw new RangeError(`invalid output format: ${n}`)}if(a){let l=j0(t);l.on("finish",o),l.on("error",s),a.pipe(l)}else h&&G0(t,h,l=>{if(l){s(l);return}o()})})},toDataURL(t="image/png",e={}){typeof t=="object"&&(e=t,t="image/png");let{useCanvas:r=!1,encoder:i=void 0}=e;t=q0(t);function n(o,s){let a=o(s,i);return bn(a,t)}return t==="image/bmp"?n(vn.encode,this):t==="image/png"&&!r?n(fs,this):t==="image/jpeg"&&!r?n(hs,this):this.getCanvas().toDataURL(t)},toBuffer(t={}){let{format:e="png",encoder:r=void 0}=t;switch(e.toLowerCase()){case"png":return fs(this,r);case"jpeg":case"jpg":return hs(this,r);case"bmp":return(0,vn.encode)(this,r);default:throw new RangeError(`invalid output format: ${e}`)}},toBase64(t="image/png",e={}){if(e.async)return this.toDataURL(t,e).then(function(r){return r.substring(r.indexOf(",")+1)});{let r=this.toDataURL(t,e);return r.substring(r.indexOf(",")+1)}},toBlob(t="image/png",e=.8){return Vf(this.getCanvas(),t,e)},getCanvas(){let t=new Y0(this.getRGBAData({clamped:!0}),this.width,this.height),e=yn(this.width,this.height);return e.getContext("2d").putImageData(t,0,0),e}};function us(t){for(let e in V0)t.prototype[e]=V0[e]}var H0=ve(ds());var Z0={configurable:!0,enumerable:!1,get:void 0};function J0(t,e,r={}){let{inPlace:i=!1,returnThis:n=!0,partialArgs:o=[]}=r;return i?F.prototype[t]=function(...s){this.computed=null;let a=e.apply(this,[...o,...s]);return n?this:a}:F.prototype[t]=function(...s){return e.apply(this,[...o,...s])},F}function Q0(t,e,r={}){let{partialArgs:i=[]}=r;return Z0.get=function(){if(this.computed===null)this.computed={};else if((0,H0.default)(t,this.computed))return this.computed[t];let n=e.apply(this,i);return this.computed[t]=n,n},Object.defineProperty(F.prototype,t,Z0),F}var Pi={};Ki(Pi,{CMYK:()=>tr,GREY:()=>Ke,HSL:()=>Ri,HSV:()=>Ci,RGB:()=>Oe});var Ke="GREY",Oe="RGB",Ri="HSL",Ci="HSV",tr="CMYK";function ps(t={}){let{clamped:e}=t;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});let r=this.width*this.height*4,i=e?new Uint8ClampedArray(r):new Uint8Array(r);return this.bitDepth===1?gw(this,i):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?xw(this,i):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[Oe]}),ww(this,i))):this.components===1?bw(this,i):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[Oe]}),yw(this,i)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),vw(this,i)):_w(this,i),i}function gw(t,e){for(let r=0;r<t.size;r++){let i=t.getBit(r);e[r*4]=i*255,e[r*4+1]=i*255,e[r*4+2]=i*255}}function xw(t,e){let r=t.min[0],n=t.max[0]-r;for(let o=0;o<t.size;o++){let s=Math.floor(255*(t.data[o]-r)/n);e[o*4]=s,e[o*4+1]=s,e[o*4+2]=s}}function ww(t,e){let r=Math.min(...t.min),n=Math.max(...t.max)-r;for(let o=0;o<t.size;o++){let s=Math.floor(255*(t.data[o*3]-r)/n),a=Math.floor(255*(t.data[o*3+1]-r)/n),h=Math.floor(255*(t.data[o*3+2]-r)/n);e[o*4]=s,e[o*4+1]=a,e[o*4+2]=h}}function bw(t,e){for(let r=0;r<t.size;r++)e[r*4]=t.data[r*t.channels]>>>t.bitDepth-8,e[r*4+1]=t.data[r*t.channels]>>>t.bitDepth-8,e[r*4+2]=t.data[r*t.channels]>>>t.bitDepth-8}function yw(t,e){for(let r=0;r<t.size;r++)e[r*4]=t.data[r*t.channels]>>>t.bitDepth-8,e[r*4+1]=t.data[r*t.channels+1]>>>t.bitDepth-8,e[r*4+2]=t.data[r*t.channels+2]>>>t.bitDepth-8}function vw(t,e){for(let r=0;r<t.size;r++)e[r*4+3]=t.data[r*t.channels+t.components]>>t.bitDepth-8}function _w(t,e){for(let r=0;r<t.size;r++)e[r*4+3]=255}var rt="BINARY",ec="GREY",tc="GREYA",rc="RGB",_n="RGBA",ic="CMYK",nc="CMYKA";var rr={};rr[rt]={components:1,alpha:0,bitDepth:1,colorModel:Ke};rr[tc]={components:1,alpha:1,bitDepth:8,colorModel:Ke};rr[ec]={components:1,alpha:0,bitDepth:8,colorModel:Ke};rr[_n]={components:3,alpha:1,bitDepth:8,colorModel:Oe};rr[rc]={components:3,alpha:0,bitDepth:8,colorModel:Oe};rr[ic]={components:4,alpha:0,bitDepth:8,colorModel:tr};rr[nc]={components:4,alpha:1,bitDepth:8,colorModel:tr};function ac(t){let e=rr[t];if(!e)throw new RangeError(`invalid image kind: ${t}`);return e}var sc=[1,8,16,32];function lc(t){let{components:e,alpha:r,bitDepth:i,colorModel:n}=t;if(!Number.isInteger(e)||e<=0)throw new RangeError(`invalid components: ${e}. Must be a positive integer`);if(r!==0&&r!==1&&typeof r!="boolean")throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!sc.includes(i))throw new RangeError(`invalid bitDepth: ${i}. Must be one of ${sc.join(", ")}`);if(!Pi[n])throw new RangeError(`invalid colorModel: ${n}. Must be one of ${Object.keys(Pi).join(", ")}`)}function hc(t,e,r){let i=e*t;return r===1&&(i=Math.ceil(i/8)),i}function fc(t,e,r,i,n,o){let s=i*t,a;switch(n){case 1:a=new Uint8Array(Math.ceil(s/8));break;case 8:a=new Uint8Array(s);break;case 16:a=new Uint16Array(s);break;case 32:a=new Float32Array(s);break;default:throw new Error(`Cannot create pixel array for bit depth ${n}`)}if(r)for(let h=e;h<a.length;h+=i)a[h]=o;return a}var dd=ve(Nc());var pd=ve(Xc()),md=ve(ls());var sd=ve(Tr());function jc(t){if(t.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");let e=t.rowsPerStrip*t.width*t.samplesPerPixel*(t.bitsPerSample/8);return new Array(t.stripOffsets.length).fill(e)}function Gc(t,e,r){let i=0;for(;i<t.length;){for(let n=r;n<e*r;n+=r)for(let o=0;o<r;o++)t[i+n+o]=t[i+n+o]+t[i+n-(r-o)]&255;i+=e*r}}function qc(t,e,r){let i=0;for(;i<t.length;){for(let n=r;n<e*r;n+=r)for(let o=0;o<r;o++)t[i+n+o]=t[i+n+o]+t[i+n-(r-o)]&65535;i+=e*r}}var Ps={};Ki(Ps,{tagsById:()=>Cs,tagsByName:()=>Vc});var Cs={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},Vc={};for(let t in Cs)Vc[Cs[t]]=Number(t);var Ts={};Ki(Ts,{tagsById:()=>Bs,tagsByName:()=>$c});var Bs={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},$c={};for(let t in Bs)$c[Bs[t]]=Number(t);var Fs={};Ki(Fs,{tagsById:()=>Ls,tagsByName:()=>Wc});var Ls={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},Wc={};for(let t in Ls)Wc[Ls[t]]=Number(t);var Kc={standard:Fs,exif:Ps,gps:Ts},_r=class{constructor(e){if(!e)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=e,this._hasMap=!1,this._map={}}get(e){if(typeof e=="number")return this.fields.get(e);if(typeof e=="string")return this.fields.get(Kc[this.kind].tagsByName[e]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){let e=Kc[this.kind].tagsById;for(let r of this.fields.keys())e[r]&&(this._map[e[r]]=this.fields.get(r));this._hasMap=!0}return this._map}};var Hc=new Map([[1,[1,Zc]],[2,[1,Kw]],[3,[2,Zw]],[4,[4,Hw]],[5,[8,Jw]],[6,[1,Qw]],[7,[1,Zc]],[8,[2,e2]],[9,[4,t2]],[10,[8,r2]],[11,[4,i2]],[12,[8,n2]]]);function Jc(t,e){let r=Hc.get(t);if(!r)throw new Error(`type not found: ${t}`);return r[0]*e}function Qc(t,e,r){let i=Hc.get(e);if(!i)throw new Error(`type not found: ${e}`);return i[1](t,r)}function Zc(t,e){if(e===1)return t.readUint8();let r=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t.readUint8();return r}function Kw(t,e){let r=[],i="";for(let n=0;n<e;n++){let o=String.fromCharCode(t.readUint8());o==="\0"?(r.push(i),i=""):i+=o}return r.length===1?r[0]:r}function Zw(t,e){if(e===1)return t.readUint16();let r=new Uint16Array(e);for(let i=0;i<e;i++)r[i]=t.readUint16();return r}function Hw(t,e){if(e===1)return t.readUint32();let r=new Uint32Array(e);for(let i=0;i<e;i++)r[i]=t.readUint32();return r}function Jw(t,e){if(e===1)return t.readUint32()/t.readUint32();let r=new Array(e);for(let i=0;i<e;i++)r[i]=t.readUint32()/t.readUint32();return r}function Qw(t,e){if(e===1)return t.readInt8();let r=new Int8Array(e);for(let i=0;i<e;i++)r[i]=t.readInt8();return r}function e2(t,e){if(e===1)return t.readInt16();let r=new Int16Array(e);for(let i=0;i<e;i++)r[i]=t.readInt16();return r}function t2(t,e){if(e===1)return t.readInt32();let r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.readInt32();return r}function r2(t,e){if(e===1)return t.readInt32()/t.readInt32();let r=new Array(e);for(let i=0;i<e;i++)r[i]=t.readInt32()/t.readInt32();return r}function i2(t,e){if(e===1)return t.readFloat32();let r=new Float32Array(e);for(let i=0;i<e;i++)r[i]=t.readFloat32();return r}function n2(t,e){if(e===1)return t.readFloat64();let r=new Float64Array(e);for(let i=0;i<e;i++)r[i]=t.readFloat64();return r}var id=ve(Tr()),o2=256,ed=257,td=258,rd=9,Mr=[];function s2(){if(Mr.length===0){for(let e=0;e<256;e++)Mr.push([e]);let t=[];for(let e=256;e<4096;e++)Mr.push(t)}}var a2=[511,1023,2047,4095],l2=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095],Os=class{constructor(e){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=td,this.currentBitLength=rd,this.stripArray=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.outData=new id.IOBuffer(e.byteLength),this.initializeTable()}decode(){let e=0,r=0;for(;(e=this.getNextCode())!==ed;)if(e===o2){if(this.initializeTable(),e=this.getNextCode(),e===ed)break;this.writeString(this.stringFromCode(e)),r=e}else if(this.isInTable(e))this.writeString(this.stringFromCode(e)),this.addStringToTable(this.stringFromCode(r).concat(this.stringFromCode(e)[0])),r=e;else{let n=this.stringFromCode(r).concat(this.stringFromCode(r)[0]);this.writeString(n),this.addStringToTable(n),r=e}let i=this.outData.toArray();return new DataView(i.buffer,i.byteOffset,i.byteLength)}initializeTable(){s2(),this.tableLength=td,this.currentBitLength=rd}writeString(e){this.outData.writeBytes(e)}stringFromCode(e){return Mr[e]}isInTable(e){return e<this.tableLength}addStringToTable(e){if(Mr[this.tableLength++]=e,Mr.length>4096)throw Mr=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===l2[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);let e=this.nextData>>this.nextBits-this.currentBitLength&a2[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:e}};function nd(t){return new Os(t).decode()}var h2=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,$r=class extends _r{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let e=new Date,r=h2.exec(this.dateTime);if(r===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return e.setFullYear(Number(r[1]),Number(r[2])-1,Number(r[3])),e.setHours(Number(r[4]),Number(r[5]),Number(r[6])),e}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){let e=this.get("BitsPerSample");return e&&typeof e!="number"?e[0]:e}get alpha(){let e=this.extraSamples;return e?e[0]!==0:!1}get associatedAlpha(){let e=this.extraSamples;return e?e[0]===1:!1}get extraSamples(){return Us(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return Us(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return Us(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){let e=2**this.bitsPerSample,r=this.get("ColorMap");if(!r)return;if(r.length!==3*e)throw new Error(`ColorMap size must be ${e}`);let i=[];for(let n=0;n<e;n++)i.push([r[n],r[n+e],r[n+2*e]]);return i}};function Us(t){return typeof t=="number"?[t]:t}function od(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=gn(e);return new DataView(r.buffer,r.byteOffset,r.byteLength)}var f2={ignoreImageData:!1,onlyFirst:!1},Bi=class extends sd.IOBuffer{constructor(e){super(e),this._nextIFD=0}get isMultiPage(){let e=0;for(this.decodeHeader();this._nextIFD;)if(e++,this.decodeIFD({ignoreImageData:!0},!0),e===2)return!0;if(e===1)return!1;throw Xt("ifdCount",e)}get pageCount(){let e=0;for(this.decodeHeader();this._nextIFD;)e++,this.decodeIFD({ignoreImageData:!0},!0);if(e>0)return e;throw Xt("ifdCount",e)}decode(e={}){e=Object.assign({},f2,e);let r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(e,!0)),e.onlyFirst)return[r[0]];return r}decodeHeader(){let e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${e.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e,r){this.seek(this._nextIFD);let i;if(r)i=new $r;else{if(!e.kind)throw new Error("kind is missing");i=new _r(e.kind)}let n=this.readUint16();for(let o=0;o<n;o++)this.decodeIFDEntry(i);if(!e.ignoreImageData){if(!(i instanceof $r))throw new Error("must be a tiff ifd");this.decodeImageData(i)}return this._nextIFD=this.readUint32(),i}decodeIFDEntry(e){let r=this.offset,i=this.readUint16(),n=this.readUint16(),o=this.readUint32();if(n<1||n>12){this.skip(4);return}Jc(n,o)>4&&this.seek(this.readUint32());let a=Qc(this,n,o);if(e.fields.set(i,a),i===34665||i===34853){let h=this.offset,l="exif";i===34665?l="exif":i===34853&&(l="gps"),this._nextIFD=a,e[l]=this.decodeIFD({kind:l,ignoreImageData:!0},!1),this.offset=h}this.seek(r),this.skip(12)}decodeImageData(e){let r=e.orientation;if(r&&r!==1)throw Xt("orientation",r);switch(e.type){case 0:case 1:case 2:case 3:this.readStripData(e);break;default:throw Xt("image type",e.type)}if(this.applyPredictor(e),this.convertAlpha(e),e.type===0){let i=e.bitsPerSample,n=Math.pow(2,i)-1;for(let o=0;o<e.data.length;o++)e.data[o]=n-e.data[o]}}readStripData(e){let r=e.width,i=e.height,n=e.bitsPerSample,o=e.sampleFormat,s=r*i*e.samplesPerPixel,a=u2(s,n,o),l=e.rowsPerStrip*r*e.samplesPerPixel,f=e.stripOffsets,u=e.stripByteCounts||jc(e),c=s,d=0;for(let p=0;p<f.length;p++){let g=new DataView(this.buffer,this.byteOffset+f[p],u[p]),x=c>l?l:c;c-=x;let m=g;switch(e.compression){case 1:break;case 5:{m=nd(g);break}case 8:{m=od(g);break}case 2:throw Xt("Compression","CCITT Group 3");case 32773:throw Xt("Compression","PackBits");default:throw Xt("Compression",e.compression)}d=this.fillUncompressed(n,o,a,m,d,x)}e.data=a}fillUncompressed(e,r,i,n,o,s){if(e===8)return c2(i,n,o,s);if(e===16)return d2(i,n,o,s,this.isLittleEndian());if(e===32&&r===3)return p2(i,n,o,s,this.isLittleEndian());throw Xt("bitDepth",e)}applyPredictor(e){let r=e.bitsPerSample;switch(e.predictor){case 1:break;case 2:{if(r===8)Gc(e.data,e.width,e.components);else if(r===16)qc(e.data,e.width,e.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${r}`);break}default:throw new Error(`invalid predictor: ${e.predictor}`)}}convertAlpha(e){if(e.alpha&&e.associatedAlpha){let{data:r,components:i,maxSampleValue:n}=e;for(let o=0;o<r.length;o+=i){let s=r[o+i-1];for(let a=0;a<i-1;a++)r[o+a]=Math.round(r[o+a]*n/s)}}}};function u2(t,e,r){if(e===8)return new Uint8Array(t);if(e===16)return new Uint16Array(t);if(e===32&&r===3)return new Float32Array(t);throw Xt("bit depth / sample format",`${e} / ${r}`)}function c2(t,e,r,i){for(let n=0;n<i;n++)t[r++]=e.getUint8(n);return r}function d2(t,e,r,i,n){for(let o=0;o<i*2;o+=2)t[r++]=e.getUint16(o,n);return r}function p2(t,e,r,i,n){for(let o=0;o<i*4;o+=4)t[r++]=e.getFloat32(o,n);return r}function Xt(t,e){return new Error(`Unsupported ${t}: ${e}`)}function ad(t,e){return new Bi(t).decode(e)}var fd=ve(ds());function Ns(t={}){let{algorithm:e="matchToPrevious",ignoreBorder:r=[0,0]}=t;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let i=e==="matchToPrevious",n=this[0],o=[];o[0]={position:[0,0],image:this[0]};let s=[0,0];for(let c=1;c<this.length;c++){let d=n.getBestMatch(this[c],{border:r});o[c]={position:[d[0]+s[0],d[1]+s[1]],image:this[c]},i&&(s[0]+=d[0],s[1]+=d[1],n=this[c])}let a=0,h=0,l=0,f=0;for(let c=0;c<o.length;c++){let d=o[c];d.position[0]>a&&(a=d.position[0]),d.position[0]<h&&(h=d.position[0]),d.position[1]>l&&(l=d.position[1]),d.position[1]<f&&(f=d.position[1])}h=0-h,f=0-f;for(let c=0;c<o.length;c++){let d=o[c];d.crop=d.image.crop({x:a-d.position[0],y:l-d.position[1],width:n.width-h-a,height:n.height-f-l})}let u=[];for(let c=0;c<o.length;c++)u[c]=o[c].crop;return new at(u)}function Ys(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].min;for(let e=1;e<this.length;e++)for(let r=0;r<t.length;r++)t[r]=Math.min(t[r],this[e].min[r]);return t}function zs(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].max;for(let e=1;e<this.length;e++)for(let r=0;r<t.length;r++)t[r]=Math.max(t[r],this[e].max[r]);return t}function Mn(t){let e=t.reduce((s,a)=>s+a);if(e===0)throw new Error("unreachable");let r=0,i=0,n=e/2,o;for(;;){if(t[r]>0){if(o!==void 0)return(o+r)/2;if(i+=t[r],i>n)return r;i===n&&(o=r)}r++}}function ld(t){let e=0,r=0;for(let i=0;i<t.length;i++)e+=t[i],r+=t[i]*i;return e===0?0:r/e}function Xs(){this.checkProcessable("median",{bitDepth:[8,16]});let t=this.getHistograms({maxSlots:this[0].maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let i=t[r];e[r]=Mn(i)}return e}function js(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistogram(t);for(let r=1;r<this.length;r++){let i=this[r].getHistogram(t);for(let n=0;n<e.length;n++)e[n]+=i[n]}return e}function Gs(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistograms(t),r=e[0].length;for(let i=1;i<this.length;i++){let n=this[i].getHistograms(t);for(let o=0;o<e.length;o++)for(let s=0;s<r;s++)e[o][s]+=n[o][s]}return e}function En(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let t=new Uint32Array(this[0].data.length);for(let i=0;i<this.length;i++){let n=this[i];for(let o=0;o<this[0].data.length;o++)t[o]+=n.data[o]}let e=F.createFrom(this[0]),r=e.data;for(let i=0;i<this[0].data.length;i++)r[i]=t[i]/this.length;return e}function qs(){this.checkProcessable("max",{bitDepth:[8,16]});let t=F.createFrom(this[0]);t.data.fill(0);for(let e of this)for(let r=0;r<t.data.length;r++)t.data[r]=Math.max(e.data[r],t.data[r]);return t}function Vs(){this.checkProcessable("max",{bitDepth:[8,16]});let t=F.createFrom(this[0]);t.data.fill(t.maxValue);for(let e of this)for(let r=0;r<t.data.length;r++)t.data[r]=Math.min(e.data[r],t.data[r]);return t}function $s(t){t.extendMethod("matchAndCrop",Ns),t.extendMethod("getMin",Ys),t.extendMethod("getMax",zs),t.extendMethod("getMedian",Xs),t.extendMethod("getHistogram",js),t.extendMethod("getHistograms",Gs),t.extendMethod("getAverage",En),t.extendMethod("getAverageImage",En),t.extendMethod("getMaxImage",qs),t.extendMethod("getMinImage",Vs)}var hd={configurable:!0,enumerable:!1,get:void 0},at=class t extends Array{constructor(e){if(Array.isArray(e)){super(e.length);for(let r=0;r<e.length;r++)this[r]=e[r]}else typeof e=="number"?super(e):super();this.computed=null}static load(e){return Promise.all(e.map(F.load)).then(r=>new t(r))}static extendMethod(e,r,i={}){let{inPlace:n=!1,returnThis:o=!0,partialArgs:s=[]}=i;return n?t.prototype[e]=function(...a){this.computed=null;let h=r.apply(this,[...s,...a]);return o?this:h}:t.prototype[e]=function(...a){return r.apply(this,[...s,...a])},t}static extendProperty(e,r,i={}){let{partialArgs:n=[]}=i;return hd.get=function(){if(this.computed===null)this.computed={};else if((0,fd.default)(e,this.computed))return this.computed[e];let o=r.apply(this,n);return this.computed[e]=o,o},Object.defineProperty(t.prototype,e,hd),t}checkProcessable(e,r={}){if(typeof e!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${e} can not be applied on an empty stack`);this[0].checkProcessable(e,r);for(let i=1;i<this.length;i++){if((r.sameSize===void 0||r.sameSize)&&this[0].width!==this[i].width)throw new TypeError(`The process: ${e} can not be applied if width is not identical in all images`);if((r.sameSize===void 0||r.sameSize)&&this[0].height!==this[i].height)throw new TypeError(`The process: ${e} can not be applied if height is not identical in all images`);if((r.sameAlpha===void 0||r.sameAlpha)&&this[0].alpha!==this[i].alpha)throw new TypeError(`The process: ${e} can not be applied if alpha is not identical in all images`);if((r.sameBitDepth===void 0||r.sameBitDepth)&&this[0].bitDepth!==this[i].bitDepth)throw new TypeError(`The process: ${e} can not be applied if bitDepth is not identical in all images`);if((r.sameColorModel===void 0||r.sameColorModel)&&this[0].colorModel!==this[i].colorModel)throw new TypeError(`The process: ${e} can not be applied if colorModel is not identical in all images`);if((r.sameNumberChannels===void 0||r.sameNumberChannels)&&this[0].channels!==this[i].channels)throw new TypeError(`The process: ${e} can not be applied if channels is not identical in all images`)}}};Array[Symbol.species]||(at.prototype.map=function(t,e){if(typeof t!="function")throw new TypeError(`${t} is not a function`);let r=new at(this.length);for(let i=0;i<this.length;i++)r[i]=t.call(e,this[i],i,this);return r});$s(at);var m2=/^data:[a-z]+\/(?:[a-z]+);base64,/;function Zs(t,e){if(typeof t=="string")return g2(t,e);if(t instanceof ArrayBuffer)return Promise.resolve(Ws(new Uint8Array(t),void 0,e&&e.ignorePalette));if(t.buffer)return Promise.resolve(Ws(t,void 0,e&&e.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function Ws(t,e,r){let i=(0,pd.default)(t);if(i)switch(i.mime){case"image/png":return x2(t);case"image/jpeg":return b2(t);case"image/tiff":return y2(t,r);default:return cd(n(i.mime))}return cd(n("application/octet-stream"));function n(o){return e||bn(t,o)}}function g2(t,e){let r=t.slice(0,64).match(m2),i;return r!==null?i=Promise.resolve(N0(t.slice(r[0].length))):i=X0(t,e),i.then(n=>{let o=new Uint8Array(n);return Ws(o,r?t:void 0,e&&e.ignorePalette)})}function x2(t){let e=C0(t),r=e.channels,i,n=0;return r===2||r===4?(i=r-1,n=1):i=r,e.palette?w2(e):new F(e.width,e.height,e.data,{components:i,alpha:n,bitDepth:e.depth})}function w2(t){let e=t.width*t.height,r=t.palette[0].length,i=new Uint8Array(e*r),n=8/t.depth,o=t.depth<8?n:1,s=parseInt("1".repeat(t.depth),2),a=r===4,h=0;for(let l=0;l<e;l++){let f=Math.floor(l/o),u=t.data[f];t.depth<8&&(u=u>>>t.depth*(n-1-l%n)&s);let c=t.palette[u];i[h++]=c[0],i[h++]=c[1],i[h++]=c[2],a&&(i[h++]=c[3])}return new F(t.width,t.height,i,{components:3,alpha:a,bitDepth:8})}function b2(t){let e=(0,dd.decode)(t),r;e.exif&&(r=Ks(e.exif));let i=(0,md.decode)(t,{useTArray:!0,maxMemoryUsageInMB:1024}),n=new F(i.width,i.height,i.data,{meta:r});if(r&&r.tiff.tags.Orientation){let o=r.tiff.tags.Orientation;o>2&&(n=n.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[o])),[2,4,5,7].includes(o)&&(n=n.flipX())}return n}function y2(t,e){let r=ad(t);return r.length===1?ud(r[0],e):new at(r.map(function(i){return ud(i,e)}))}function Ks(t){let e={tiff:{fields:t.fields,tags:t.map}};return t.exif&&(e.exif=t.exif),t.gps&&(e.gps=t.gps),e}function ud(t,e){if(!e&&t.type===3){let r=new Uint16Array(3*t.width*t.height),i=t.palette,n=0;for(let o=0;o<t.data.length;o++){let s=t.data[o],a=i[s];r[n++]=a[0],r[n++]=a[1],r[n++]=a[2]}return new F(t.width,t.height,r,{components:3,alpha:t.alpha,colorModel:Oe,bitDepth:16,meta:Ks(t)})}else return new F(t.width,t.height,t.data,{components:t.type===2?3:1,alpha:t.alpha,colorModel:t.type===2?Oe:Ke,bitDepth:t.bitsPerSample.length?t.bitsPerSample[0]:t.bitsPerSample,meta:Ks(t)})}function cd(t,e){return e=e||{},new Promise(function(r,i){let n=new z0;n.onload=function(){let o=n.width,s=n.height,h=yn(o,s).getContext("2d");h.drawImage(n,0,0,o,s);let l=h.getImageData(0,0,o,s).data;r(new F(o,s,l,e))},n.onerror=function(){i(new Error(`Could not load ${t}`))},n.src=t})}var gd={getValueXY(t,e,r){return this.data[(e*this.width+t)*this.channels+r]},setValueXY(t,e,r,i){return this.data[(e*this.width+t)*this.channels+r]=i,this.computed=null,this},getValue(t,e){return this.data[t*this.channels+e]},setValue(t,e,r){return this.data[t*this.channels+e]=r,this.computed=null,this},getPixelXY(t,e){return this.getPixel(e*this.width+t)},setPixelXY(t,e,r){return this.setPixel(e*this.width+t,r)},getPixel(t){let e=new Array(this.channels),r=t*this.channels;for(let i=0;i<this.channels;i++)e[i]=this.data[r+i];return e},setPixel(t,e){let r=t*this.channels;for(let i=0;i<e.length;i++)this.data[r+i]=e[i];return this.computed=null,this}};function Hs(t){for(let e in gd)t.prototype[e]=gd[e]}function Er(t){return{width:t.width,height:t.height,components:t.components,alpha:t.alpha,colorModel:t.colorModel,bitDepth:t.bitDepth}}function Js(t,e,r,i={}){let{out:n}=e;if(n===void 0)return i.copy?t.clone():F.createFrom(t,r);{if(!F.isImage(n))throw new TypeError("out must be an Image object");let o=Object.assign(Er(t),r);for(let s in o)if(n[s]!==o[s])throw new RangeError(`cannot use out. Its ${s} must be "${o[s]}" (found "${n[s]}")`);return n}}function Wr(t,e,r){if(e.inPlace!==void 0&&typeof e.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(e.inPlace){if(e.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return t}return Js(t,e,null,r)}function Qs(t={}){this.checkProcessable("abs",{bitDepth:[32]});let e=Wr(this,t);return v2(this,e),e}function v2(t,e){for(let r=0;r<t.data.length;r++)e.data[r]=Math.abs(t.data[r])}function ea(t,e){if(t.alpha===1&&e.alpha===1)for(let r=0;r<t.size;r++)e.data[r*e.channels+e.components]=t.data[r*t.channels+t.components]}function ta(t={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});let e=Wr(this,t);return this.bitDepth===1?_2(this,e):(M2(this,e),this!==e&&ea(this,e)),e}function _2(t,e){for(let r=0;r<t.data.length;r++)e.data[r]=~t.data[r]}function M2(t,e){for(let r=0;r<t.data.length;r+=t.channels)for(let i=0;i<t.components;i++)e.data[r+i]=t.maxValue-t.data[r+i]}function ra(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let t=0;t<this.height;t++){let e=t*this.width*this.channels;for(let r=0;r<Math.floor(this.width/2);r++){let i=r*this.channels+e,n=(this.width-r-1)*this.channels+e;for(let o=0;o<this.channels;o++){let s=this.data[i+o];this.data[i+o]=this.data[n+o],this.data[n+o]=s}}}return this}function ia(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let t=0;t<Math.floor(this.height/2);t++)for(let e=0;e<this.width;e++){let r=e*this.channels+t*this.width*this.channels,i=e*this.channels+(this.height-1-t)*this.channels*this.width;for(let n=0;n<this.channels;n++){let o=this.data[r+n];this.data[r+n]=this.data[i+n],this.data[i+n]=o}}return this}function na(t={}){let{radius:e=1}=t;if(e<1)throw new Error("radius must be greater than 1");let r=2*e+1,i=new Array(r);for(let n=0;n<r;n++){i[n]=new Array(r);for(let o=0;o<r;o++)i[n][o]=1/(r*r)}return this.convolution(i)}var xd=ve(oa());function Xe(t,e={}){let{channels:r,allowAlpha:i,defaultAlpha:n}=e;return typeof i!="boolean"&&(i=!0),typeof r>"u"?E2(t,n):k2(t,r,i)}function E2(t,e){let r=e?t.channels:t.components,i=new Array(r);for(let n=0;n<r;n++)i[n]=n;return i}function k2(t,e,r){Array.isArray(e)||(e=[e]);for(let i=0;i<e.length;i++)e[i]=Ti(t,e[i],r);return e}function Ti(t,e,r=!0){if(e===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(typeof e=="string"){switch(t.colorModel){case Ke:break;case Oe:if("rgb".includes(e))switch(e){case"r":e=0;break;case"g":e=1;break;case"b":e=2;break}break;case Ri:if("hsl".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"l":e=2;break}break;case Ci:if("hsv".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"v":e=2;break}break;case tr:if("cmyk".includes(e))switch(e){case"c":e=0;break;case"m":e=1;break;case"y":e=2;break;case"k":e=3;break}break;default:throw new Error(`Unexpected color model: ${t.colorModel}`)}if(e==="a"){if(!t.alpha)throw new Error("validateChannel : the image does not contain alpha channel");e=t.components}if(typeof e=="string")throw new Error(`validateChannel : undefined channel: ${e}`)}if(e>=t.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(!r&&e>=t.components)throw new RangeError("validateChannel : alpha channel may not be selected");return e}function sa(t={}){let{radius:e=1,border:r="copy",channels:i}=t;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),e<1)throw new Error("radius must be greater than 0");i=Xe(this,i,!0);let n=e,o=e,s=F.createFrom(this),a=(n*2+1)*(o*2+1),h=new Array(a);for(let l=0;l<i.length;l++){let f=i[l];for(let u=o;u<this.height-o;u++)for(let c=n;c<this.width-n;c++){let d=0;for(let g=-o;g<=o;g++)for(let x=-n;x<=n;x++){let m=((u+g)*this.width+c+x)*this.channels+f;h[d++]=this.data[m]}let p=(u*this.width+c)*this.channels+f;s.data[p]=(0,xd.default)(h)}}if(this.alpha&&!i.includes(this.channels))for(let l=this.components;l<this.data.length;l=l+this.channels)s.data[l]=this.data[l];return s.setBorder({size:[n,o],algorithm:r}),s}function aa(t={}){let{radius:e=1,sigma:r,channels:i,border:n="copy"}=t;this.checkProcessable("gaussian",{bitDepth:[8,16]});let o=A2(e,r);return this.convolution([o,o],{border:n,channels:i,algorithm:"separable"})}function A2(t,e){let r=t*2+1,i=new Array(r),n=e||((r-1)*.5-1)*.3+.8,o=-.5/(n*n),s=0;for(let a=0;a<r;a++){let h=a-t,l=Math.exp(o*h*h);i[a]=l,s+=l}for(let a=0;a<r;a++)i[a]/=s;return i}var wd=[[-1,0,1],[-2,0,2],[-1,0,1]],bd=[[-1,-2,-1],[0,0,0],[1,2,1]],yd=[[3,0,-3],[10,0,-10],[3,0,-3]],vd=[[3,10,3],[0,0,0],[-3,-10,-3]];var On=ve(Ad());var Rd=ve(ca());function Cd(t){let e,r;if(Array.isArray(t))if(Array.isArray(t[0])){if(!(t.length&1)||!(t[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");e=Math.floor(t.length/2),r=Math.floor(t[0].length/2)}else{let i=Math.sqrt(t.length);if((0,Rd.default)(i))r=e=Math.floor(Math.sqrt(t.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let n=new Array(i);for(let o=0;o<i;o++){n[o]=new Array(i);for(let s=0;s<i;s++)n[o][s]=t[o*i+s]}t=n}else throw new Error(`validateKernel: Invalid Kernel: ${t}`);return{kernel:t,kWidth:r,kHeight:e}}function Li(t,e){return Math.round(Math.min(Math.max(t,0),e.maxValue))}function Fi(t,e,r){if(r===void 0){let o=t.length+e.length-1;r=new Array(o)}P2(r);for(var i=0;i<t.length;i++)for(var n=0;n<e.length;n++)r[i+n]+=t[i]*e[n];return r}function P2(t){for(var e=0;e<t.length;e++)t[e]=0}var T2=ve(Bd()),L2=ve(Ld());function da(t,e,r,i){let n=new Array(t.length),o,s,a,h;h=e[1],a=(h.length-1)/2,s=new Array(r+h.length-1),o=new Array(r);for(let l=0;l<i;l++){for(let f=0;f<r;f++)o[f]=t[l*r+f];Fi(o,h,s);for(let f=0;f<r;f++)n[l*r+f]=s[a+f]}h=e[0],a=(h.length-1)/2,s=new Array(i+h.length-1),o=new Array(i);for(let l=0;l<r;l++){for(let f=0;f<i;f++)o[f]=n[f*r+l];Fi(o,h,s);for(let f=0;f<i;f++)n[f*r+l]=s[a+f]}return n}var we=ve(ka(),1);var ft=we.Matrix;var Zd=we.SVD,Hd=we.SingularValueDecomposition;var C8=we.default.Matrix?we.default.Matrix:we.Matrix;var Aa=we.inverse;var Jd=we.solve;function Sa(t){let e=new Zd(t,{autoTranspose:!0});if(e.rank!==1)return null;let r=Math.sqrt(e.s[0]),i=e.U.to2DArray().map(o=>o[0]*r),n=e.V.to2DArray().map(o=>o[0]*r);return[i,n]}function or(t,e={}){let{channels:r,bitDepth:i,normalize:n=!1,divisor:o=1,border:s="copy",algorithm:a="auto"}=e,h={};i&&(h.bitDepth=i);let l=F.createFrom(this,h);if(r=Xe(this,r,!0),a!=="separable")({kernel:t}=Cd(t));else if(!Array.isArray(t)||t.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(a==="auto"){let M=Sa(t);M!==null?(a="separable",t=M):(t.length>9||t[0].length>9)&&this.width<=4096&&this.height<=4096?a="fft":a="direct"}let f,u;a==="separable"?(f=Math.floor(t[0].length/2),u=Math.floor(t[1].length/2)):(f=Math.floor(t.length/2),u=Math.floor(t[0].length/2));let c=l.isClamped,d=new Array(this.height*this.width),p,g,x,m,w,y;for(m=0;m<r.length;m++){for(w=r[m],x=0;x<this.height;x++)for(g=0;g<this.width;g++)p=x*this.width+g,d[p]=this.data[p*this.channels+w];if(a==="direct")y=(0,On.direct)(d,t,{rows:this.height,cols:this.width,normalize:n,divisor:o});else if(a==="separable"){if(y=da(d,t,this.width,this.height),n){o=0;for(let M=0;M<t[0].length;M++)for(let _=0;_<t[1].length;_++)o+=t[0][M]*t[1][_]}if(o!==1)for(let M=0;M<y.length;M++)y[M]/=o}else y=(0,On.fft)(d,t,{rows:this.height,cols:this.width,normalize:n,divisor:o});for(x=0;x<this.height;x++)for(g=0;g<this.width;g++)p=x*this.width+g,c?l.data[p*this.channels+w]=Li(y[p],l):l.data[p*this.channels+w]=y[p]}if(this.alpha&&!r.includes(this.channels))for(g=this.components;g<this.data.length;g=g+this.channels)l.data[g]=this.data[g];return s!=="periodic"&&l.setBorder({size:[u,f],algorithm:s}),l}function Ar(t={}){let{direction:e="xy",border:r="copy",kernelX:i,kernelY:n,channels:o,bitDepth:s=this.bitDepth}=t;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),e){case"x":if(!i)throw new Error("kernelX option is missing");return or.call(this,i,{channels:o,border:r,bitDepth:s});case"y":if(!n)throw new Error("kernelY option is missing");return or.call(this,n,{channels:o,border:r,bitDepth:s});case"xy":{if(!i)throw new Error("kernelX option is missing");if(!n)throw new Error("kernelY option is missing");let a=or.call(this,i,{channels:o,border:r,bitDepth:32}),h=or.call(this,n,{channels:o,border:r,bitDepth:32});return a.hypotenuse(h,{bitDepth:s,channels:o})}default:throw new Error(`Unknown parameter direction: ${e}`)}}function Da(t){return Ar.call(this,Object.assign({},t,{kernelX:wd,kernelY:bd}))}function Ia(t){return Ar.call(this,Object.assign({},t,{kernelX:yd,kernelY:vd}))}var Ra=ve(Bt());function Ca(t={}){let{algorithm:e="range",channels:r,min:i=this.min,max:n=this.max}=t;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),r=Xe(this,{channels:r}),r.length!==this.channel&&(Array.isArray(i)&&i.length===this.channels&&(i=i.filter((o,s)=>r.includes(s))),Array.isArray(n)&&n.length===this.channels&&(n=n.filter((o,s)=>r.includes(s)))),e){case"range":i<0&&(i=0),n>this.maxValue&&(n=this.maxValue),Array.isArray(i)||(i=(0,Ra.default)(r.length,i)),Array.isArray(n)||(n=(0,Ra.default)(r.length,n)),Ib(this,i,n,r);break;default:throw new Error(`level: algorithm not implement: ${e}`)}return this}function Ib(t,e,r,i){let n=1e-5,o=new Array(i.length);for(let s=0;s<i.length;s++)e[s]===0&&r[s]===t.maxValue||r[s]===e[s]?o[s]=0:o[s]=(t.maxValue+1-n)/(r[s]-e[s]),e[s]+=(.5-n/2)/o[s];for(let s=0;s<i.length;s++){let a=i[s];if(o[s]!==0)for(let h=0;h<t.data.length;h+=t.channels)t.data[h+a]=Math.min(Math.max(0,(t.data[h+a]-e[s])*o[s]+.5|0),t.maxValue)}}var rp=ve(tp());function sr(t){if(isNaN(t)){if(t instanceof F)return t.data;if(!(0,rp.default)(t))throw new Error("checkNumberArray: the value should be either a number, array or Image");return t}else{if(t<=0)throw new Error("checkNumberArray: the value must be greater than 0");return t}}function Pa(t,e={}){let{channels:r}=e;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=Xe(this,{channels:r}),t=sr(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("add: the data size is different");for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.max(0,Math.min(this.maxValue,this.data[o+n]+t[o+n]>>0))}}else for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.min(this.maxValue,this.data[o+n]+t>>0)}return this}function Ba(t,e={}){let{channels:r}=e;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=Xe(this,{channels:r}),t=sr(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("subtract: the data size is different");for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.max(0,Math.min(this.maxValue,this.data[o+n]-t[o+n]>>0))}}else for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.max(0,this.data[o+n]-t>>0)}return this}function Ta(t,e={}){let{channels:r,absolute:i=!1}=e;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==t.width||this.height!==t.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("subtractImage: both images must have the same number of channels");let n=this.clone();r=Xe(this,{channels:r});for(let o=0;o<r.length;o++){let s=r[o];for(let a=s;a<this.data.length;a+=this.channels){let h=this.data[a]-t.data[a];i?n.data[a]=Math.abs(h):n.data[a]=Math.max(h,0)}}return n}function La(t,e={}){let{bitDepth:r=this.bitDepth,channels:i}=e;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==t.width||this.height!==t.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("hypotenuse: both images must have the same number of channels");let n=F.createFrom(this,{bitDepth:r});i=Xe(this,{channels:i});let o=n.isClamped;for(let s=0;s<i.length;s++){let a=i[s];for(let h=a;h<this.data.length;h+=this.channels){let l=Math.hypot(this.data[h],t.data[h]);o?n.data[h]=Math.min(Math.max(Math.round(l),0),n.maxValue):n.data[h]=l}}return n}function Fa(t,e={}){let{channels:r}=e;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),t<=0)throw new Error("multiply: the value must be greater than 0");if(r=Xe(this,{channels:r}),t=sr(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("multiply: the data size is different");for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.max(0,Math.min(this.maxValue,this.data[o+n]*t[o+n]>>0))}}else for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.min(this.maxValue,this.data[o+n]*t>>0)}return this}function Oa(t,e={}){let{channels:r}=e;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=Xe(this,{channels:r}),t=sr(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("divide: the: the data size is different");for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.max(0,Math.min(this.maxValue,this.data[o+n]/t[o+n]>>0))}}else for(let i=0;i<r.length;i++){let n=r[i];for(let o=0;o<this.data.length;o+=this.channels)this.data[o+n]=Math.min(this.maxValue,this.data[o+n]/t>>0)}return this}var Un=ve(kr());var Ui=class t{constructor(){if(new.target===t)throw new Error("BaseRegression must be subclassed")}predict(e){if(typeof e=="number")return this._predict(e);if((0,Un.isAnyArray)(e)){let r=[];for(let i=0;i<e.length;i++)r.push(this._predict(e[i]));return r}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(e,r){if(!(0,Un.isAnyArray)(e)||!(0,Un.isAnyArray)(r)||e.length!==r.length)throw new Error("x and y must be arrays of the same length");let i=e.length,n=new Array(i);for(let d=0;d<i;d++)n[d]=this._predict(e[d]);let o=0,s=0,a=0,h=0,l=0,f=0,u=0;for(let d=0;d<i;d++)o+=n[d],s+=r[d],l+=n[d]*n[d],f+=r[d]*r[d],u+=n[d]*r[d],r[d]!==0&&(a+=(r[d]-n[d])*(r[d]-n[d])/r[d]),h+=(r[d]-n[d])*(r[d]-n[d]);let c=(i*u-o*s)/Math.sqrt((i*l-o*o)*(i*f-s*s));return{r:c,r2:c*c,chi2:a,rmsd:Math.sqrt(h/i)}}};var Za=ve(Ip());var ry={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1},Dr=class t extends Ui{constructor(e,r,i){if(super(),e===!0)this.alpha=r.alpha,this.inputs=r.inputs,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=new Za.default(r.kernelType,r.kernelOptions);else{e=ft.checkMatrix(e),i=Object.assign({},ry,i);let n=new Za.default(i.kernelType,i.kernelOptions),o=n.compute(e),s=e.rows;o.add(ft.eye(s,s).mul(i.lambda)),this.alpha=Jd(o,r),this.inputs=e,this.kernelType=i.kernelType,this.kernelOptions=i.kernelOptions,this.kernel=n}}_predict(e){return this.kernel.compute([e],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(e){if(e.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new t(!0,e)}};var iy=ve(kr()),ny=ve(oa());function Ha(t,e,r){let i=new Dr(t,e,r),n=new Array(this.size);for(let a=0;a<this.width;a++)for(let h=0;h<this.height;h++)n[h*this.width+a]=[a,h];let o=i.predict(n),s=F.createFrom(this);for(let a=0;a<this.size;a++)s.data[a]=Math.min(this.maxValue,Math.max(0,o[a][0]));return s}function Ja(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let i=!0;e:for(let o of e)for(let s of o)if(s!==1){i=!1;break e}let n=this;for(let o=0;o<r;o++)if(this.bitDepth===1)if(i){let s=n.clone();n=ly(n,s,e.length,e[0].length)}else{let s=F.createFrom(n);n=ay(n,s,e)}else if(i){let s=F.createFrom(n);n=sy(n,s,e.length,e[0].length)}else{let s=F.createFrom(n);n=oy(n,s,e)}return n}function oy(t,e,r){let i=r.length,n=r[0].length,o=(i-1)/2,s=(n-1)/2;for(let a=0;a<t.height;a++)for(let h=0;h<t.width;h++){let l=0;for(let f=0;f<n;f++)for(let u=0;u<i;u++){if(r[u][f]!==1)continue;let c=u-o+h,d=f-s+a;if(c<0||d<0||c>=t.width||d>=t.height)continue;let p=t.getValueXY(c,d,0);p>l&&(l=p)}e.setValueXY(h,a,0,l)}return e}function sy(t,e,r,i){let n=(r-1)/2,o=(i-1)/2,s=[];for(let a=0;a<t.width;a++)s.push(0);for(let a=0;a<t.height;a++){for(let h=0;h<t.width;h++){let l=0;for(let f=Math.max(0,a-o);f<Math.min(t.height,a+o+1);f++){let u=t.getValueXY(h,f,0);u>l&&(l=u)}s[h]=l}for(let h=0;h<t.width;h++){let l=0;for(let f=Math.max(0,h-n);f<Math.min(t.width,h+n+1);f++)s[f]>l&&(l=s[f]);e.setValueXY(h,a,0,l)}}return e}function ay(t,e,r){let i=r.length,n=r[0].length,o=(i-1)/2,s=(n-1)/2;for(let a=0;a<t.height;a++)for(let h=0;h<t.width;h++){let l=0;e:for(let f=0;f<n;f++)for(let u=0;u<i;u++){if(r[u][f]!==1)continue;let c=u-o+h,d=f-s+a;if(d<0||c<0||c>=t.width||d>=t.height)continue;if(t.getBitXY(c,d)===1){l=1;break e}}l===1&&e.setBitXY(h,a)}return e}function ly(t,e,r,i){let n=(r-1)/2,o=(i-1)/2,s=[];for(let a=0;a<t.width;a++)s.push(1);for(let a=0;a<t.height;a++){for(let h=0;h<t.width;h++){s[h]=0;for(let l=Math.max(0,a-o);l<Math.min(t.height,a+o+1);l++)if(t.getBitXY(h,l)===1){s[h]=1;break}}for(let h=0;h<t.width;h++)if(e.getBitXY(h,a)!==1){for(let l=Math.max(0,h-n);l<Math.min(t.width,h+n+1);l++)if(s[l]===1){e.setBitXY(h,a);break}}}return e}function Qa(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let i=!0;e:for(let o of e)for(let s of o)if(s!==1){i=!1;break e}let n=this;for(let o=0;o<r;o++)if(this.bitDepth===1)if(i){let s=n.clone();n=cy(n,s,e.length,e[0].length)}else{let s=F.createFrom(n);n=uy(n,s,e)}else if(i){let s=F.createFrom(n);n=fy(n,s,e.length,e[0].length)}else{let s=F.createFrom(n);n=hy(n,s,e)}return n}function hy(t,e,r){let i=r.length,n=r[0].length,o=(i-1)/2,s=(n-1)/2;for(let a=0;a<t.height;a++)for(let h=0;h<t.width;h++){let l=t.maxValue;for(let f=0;f<n;f++)for(let u=0;u<i;u++){if(r[u][f]!==1)continue;let c=u-o+h,d=f-s+a;if(c<0||d<0||c>=t.width||d>=t.height)continue;let p=t.getValueXY(c,d,0);p<l&&(l=p)}e.setValueXY(h,a,0,l)}return e}function fy(t,e,r,i){let n=(r-1)/2,o=(i-1)/2,s=[];for(let a=0;a<t.width;a++)s.push(0);for(let a=0;a<t.height;a++){for(let h=0;h<t.width;h++){let l=t.maxValue;for(let f=Math.max(0,a-o);f<Math.min(t.height,a+o+1);f++){let u=t.getValueXY(h,f,0);u<l&&(l=u)}s[h]=l}for(let h=0;h<t.width;h++){let l=t.maxValue;for(let f=Math.max(0,h-n);f<Math.min(t.width,h+n+1);f++)s[f]<l&&(l=s[f]);e.setValueXY(h,a,0,l)}}return e}function uy(t,e,r){let i=r.length,n=r[0].length,o=(i-1)/2,s=(n-1)/2;for(let a=0;a<t.height;a++)for(let h=0;h<t.width;h++){let l=1;e:for(let f=0;f<n;f++)for(let u=0;u<i;u++){if(r[u][f]!==1)continue;let c=u-o+h,d=f-s+a;if(d<0||c<0||c>=t.width||d>=t.height)continue;if(t.getBitXY(c,d)===0){l=0;break e}}l===1&&e.setBitXY(h,a)}return e}function cy(t,e,r,i){let n=(r-1)/2,o=(i-1)/2,s=[];for(let a=0;a<t.width;a++)s.push(0);for(let a=0;a<t.height;a++){for(let h=0;h<t.width;h++){s[h]=1;for(let l=Math.max(0,a-o);l<Math.min(t.height,a+o+1);l++)if(t.getBitXY(h,l)===0){s[h]=0;break}}for(let h=0;h<t.width;h++)if(e.getBitXY(h,a)!==0){for(let l=Math.max(0,h-n);l<Math.min(t.width,h+n+1);l++)if(s[l]===0){e.clearBitXY(h,a);break}}}return e}function el(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<r;n++)i=i.erode({kernel:e}),i=i.dilate({kernel:e});return i}function tl(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<r;n++)i=i.dilate({kernel:e}).erode({kernel:e});return i}function rl(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),e.length%2===0||e[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<r;n++)i=i.open({kernel:e}).subtractImage(i,{absolute:!0});return i}function il(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<r;n++)i=i.close({kernel:e}).subtractImage(i,{absolute:!0});return i}function nl(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<r;n++){let o=i.dilate({kernel:e}),s=i.erode({kernel:e});i=o.subtractImage(s,{absolute:!0})}return i}function dy(t){let e=0,r=0,i=0,n=0,o=t[0][0],s=0;for(let l=1;l<t.length;l++)t[l][0]<o&&(o=t[l][0],s=l);let a=t[(s+1)%t.length][0],h=(s+1)%t.length;for(let l=1;l<t.length;l++)t[l][0]<a&&l!==s&&(a=t[l][0],h=l);return t[h][1]<t[s][1]?(e=t[h],n=t[s],s!==(h+1)%4?(r=t[(h+1)%4],i=t[(h+2)%4]):(r=t[(h+2)%4],i=t[(h+3)%4])):(n=t[h],e=t[s],h!==(s+1)%4?(r=t[(s+1)%4],i=t[(s+2)%4]):(r=t[(s+2)%4],i=t[(s+3)%4])),[e,r,i,n]}function ar(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function Yn(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ei(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function py(t,e,r,i,n,o){let s=Math.max(ar(t,e),ar(i,r)),a=Math.max(ar(t,i),ar(e,r)),h=0,l=0,f=Math.ceil(n/2),u=Math.ceil(o/2),c=s/a,d=[t[0],t[1],1],p=[e[0],e[1],1],g=[i[0],i[1],1],x=[r[0],r[1],1],m=ei(Yn(d,x),g)/ei(Yn(p,x),g),w=ei(Yn(d,x),p)/ei(Yn(g,x),p),y=[m*p[0]-d[0],m*p[1]-d[1],m*p[2]-d[2]],M=[w*g[0]-d[0],w*g[1]-d[1],w*g[2]-d[2]],_=y[0],R=y[1],E=y[2],A=M[0],I=M[1],b=M[2],k=1/(E*b)*(_*A-(_*b+E*A)*f+E*b*f*f+(R*I-(R*b+E*I)*u+E*b*u*u));k>=0?k=Math.sqrt(k):k=Math.sqrt(-k);let B=new ft([[k,0,f],[0,k,u],[0,0,1]]),S=B.transpose(),j=Aa(S),L=Aa(B),G=ft.rowVector(y),H=ft.rowVector(M),Q=Math.sqrt(ei(G.mmul(j).mmul(L).to1DArray(),y)/ei(H.mmul(j).mmul(L).to1DArray(),M));return Q===0||c===0?(h=Math.ceil(s),l=Math.ceil(a)):Q<c?(h=Math.ceil(s),l=Math.ceil(h/Q)):(l=Math.ceil(a),h=Math.ceil(Q*l)),[h,l]}function my(t,e,r,i,n,o,s,a,h,l,f,u){let[c,d]=[(r*t+i*e+n)/(h*t+l*e+1),(o*t+s*e+a)/(h*t+l*e+1)];return f.getValueXY(Math.floor(c),Math.floor(d),u)}function ol(t,e={}){let{calculateRatio:r=!0}=e;if(t.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${t.length} elements`);let[i,n,o,s]=t,a=[i,n,o,s],[h,l,f,u]=dy(a),c,d;r?[c,d]=py(h,l,f,u,this.width,this.height):(c=Math.ceil(Math.max(ar(h,l),ar(u,f))),d=Math.ceil(Math.max(ar(h,u),ar(l,f))));let p=F.createFrom(this,{width:c,height:d}),[g,x]=h,[m,w]=l,[y,M]=f,[_,R]=u,[E,A]=[0,0],[I,b]=[0,c-1],[k,B]=[d-1,c-1],[S,j]=[d-1,0],L=new ft([[E,A,1,0,0,0,-E*g,-A*g],[I,b,1,0,0,0,-I*m,-b*m],[k,B,1,0,0,0,-k*y,-A*y],[S,j,1,0,0,0,-S*_,-j*_],[0,0,0,E,A,1,-E*x,-A*x],[0,0,0,I,b,1,-I*w,-b*w],[0,0,0,k,B,1,-k*M,-B*M],[0,0,0,S,j,1,-S*R,-j*R]]),G=ft.columnVector([g,m,y,_,x,w,M,R]),Q=new Hd(L).solve(G),[te,he,ae,ne,Y,P,q,se]=Q.to1DArray(),J=new ft(d,c);for(let fe=0;fe<this.channels;fe++){for(let ue=0;ue<d;ue++)for(let oe=0;oe<c;oe++)J.set(ue,oe,my(ue,oe,te,he,ae,ne,Y,P,q,se,this,fe));p.setMatrix(J,{channel:fe})}return p}function sl(t={}){let{x:e=0,y:r=0,width:i=this.width-e,height:n=this.height-r}=t;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),e=Math.round(e),r=Math.round(r),i=Math.round(i),n=Math.round(n),e>this.width-1||r>this.height-1)throw new RangeError(`crop: origin (x:${e}, y:${r}) out of range (${this.width-1}; ${this.height-1})`);if(i<=0||n<=0)throw new RangeError(`crop: width and height (width:${i}; height:${n}) must be positive numbers`);if(e<0||r<0)throw new RangeError(`crop: x and y (x:${e}, y:${r}) must be positive numbers`);if(i>this.width-e||n>this.height-r)throw new RangeError(`crop: (x: ${e}, y:${r}, width:${i}, height:${n}) size is out of range`);let o=this;if(this.bitDepth===1){let s=new F(i,n,{kind:"BINARY",parent:this});o=xy(this,s,e,r,i,n)}else{let s=F.createFrom(this,{width:i,height:n,position:[e,r]});o=gy(this,s,e,r,i,n)}return o}function gy(t,e,r,i,n,o){let s=n*t.channels,a=i+o,h=0,l=r*t.channels;for(let f=i;f<a;f++){let u=f*t.width*t.channels+l,c=u+s;for(;u<c;u++)e.data[h++]=t.data[u]}return e}function xy(t,e,r,i,n,o){let s=n*t.channels,a=i+o,h=0,l=r*t.channels;for(let f=i;f<a;f++){let u=f*t.width*t.channels+l,c=u+s;for(;u<c;u++)t.getBit(u)&&e.setBit(h),++h}return e}function al(t={}){this.checkProcessable("cropAlpha",{alpha:1});let{threshold:e=this.maxValue}=t,r=wy(this,e,this.components);if(r===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let i=by(this,e,this.components,r),n=yy(this,e,this.components,r),o=vy(this,e,this.components,r,i,n);return this.crop({x:r,y:i,width:o-r+1,height:n-i+1})}function wy(t,e,r){for(let i=0;i<t.width;i++)for(let n=0;n<t.height;n++)if(t.getValueXY(i,n,r)>=e)return i;return-1}function by(t,e,r,i){for(let n=0;n<t.height;n++)for(let o=i;o<t.width;o++)if(t.getValueXY(o,n,r)>=e)return n;return-1}function yy(t,e,r,i){for(let n=t.height-1;n>=0;n--)for(let o=i;o<t.width;o++)if(t.getValueXY(o,n,r)>=e)return n;return-1}function vy(t,e,r,i,n,o){for(let s=t.width-1;s>=i;s--)for(let a=n;a<=o;a++)if(t.getValueXY(s,a,r)>=e)return s;return-1}function _y(t){if(typeof t=="string"){let e=t[t.length-1];t=parseFloat(t),e==="%"&&(t/=100)}return t}function Rp(t,e){if(!e)throw Error("getThreshold : the maxValue should be specified");if(typeof t=="string"){if(t[t.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(t)/100*e}else{if(typeof t=="number")return t<1?t*e:t;throw Error("getThreshold : the value is not valid")}}function Cp(t,e,r){t=_y(t);let i=Math.round(t*e),n=Math.round(t*r);return i<=0&&(i=1),n<=0&&(n=1),{width:i,height:n}}function Pp(t,e){if(e<0||e>=t.height)throw new RangeError(`row must be included between 0 and ${t.height-1}. Current value: ${e}`)}function Bp(t,e){if(e<0||e>=t.width)throw new RangeError(`column must be included between 0 and ${t.width-1}. Current value: ${e}`)}function zn(t,e){if(e<0||e>=t.channels)throw new RangeError(`channel must be included between 0 and ${t.channels-1}. Current value: ${e}`)}var kt={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function Xn(t){if(typeof t!="string")throw new TypeError("interpolation must be a string");if(t=t.toLowerCase(),!kt[t])throw new RangeError(`invalid interpolation algorithm: ${t}`);return kt[t]}function ll(t,e,r){let i=this.width/e,n=this.height/r;if(this.bitDepth>1)for(let o=0;o<e;o++){let s=Math.floor((o+.5)*i);for(let a=0;a<r;a++){let h=Math.floor((a+.5)*n);for(let l=0;l<this.channels;l++)t.setValueXY(o,a,l,this.getValueXY(s,h,l))}}else for(let o=0;o<e;o++){let s=Math.floor((o+.5)*i);for(let a=0;a<r;a++){let h=Math.floor((a+.5)*n);this.getBitXY(s,h)&&t.setBitXY(o,a)}}}function jn(t={}){let{factor:e=1,interpolation:r=kt.nearestneighbor,preserveAspectRatio:i=!0}=t,n=Xn(r),o=t.width,s=t.height;if(o||(s&&i?o=Math.round(s*(this.width/this.height)):o=this.width),s||(i?s=Math.round(o*(this.height/this.width)):s=this.height),{width:o,height:s}=Cp(e,o,s),o===this.width&&s===this.height){let f=this.clone();return f.position=[0,0],f}let a=Math.round((this.width-o)/2),h=Math.round((this.height-s)/2),l=F.createFrom(this,{width:o,height:s,position:[a,h]});switch(n){case kt.nearestneighbor:ll.call(this,l,o,s);break;default:throw new Error(`unsupported resize interpolation: ${n}`)}return l}function hl(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[Oe]});let t=F.createFrom(this,{colorModel:Ci}),e=0,r=this.data;for(let i=0;i<r.length;i+=this.channels){let n=r[i],o=r[i+1],s=r[i+2],a=Math.min(n,o,s),h=Math.max(n,o,s),l=h-a,f=0,u=h===0?0:l/h,c=h;if(h!==a){switch(h){case n:f=(o-s)/l+(o<s?6:0);break;case o:f=(s-n)/l+2;break;case s:f=(n-o)/l+4;break;default:throw new Error("unreachable")}f/=6}t.data[e++]=f*this.maxValue,t.data[e++]=u*this.maxValue,t.data[e++]=c,this.alpha&&(t.data[e++]=r[i+3])}return t}function fl(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[Oe]});let t=F.createFrom(this,{colorModel:Ri}),e=Math.floor(this.maxValue/2),r=0,i=this.data;for(let n=0;n<i.length;n+=this.channels){let o=i[n],s=i[n+1],a=i[n+2],h=Math.max(o,s,a),l=Math.min(o,s,a),f=0,u=0,c=(h+l)/2;if(h!==l){let d=h-l;switch(u=c>e?d/(2-h-l):d/(h+l),h){case o:f=(s-a)/d+(s<a?6:0);break;case s:f=(a-o)/d+2;break;case a:f=(o-s)/d+4;break;default:throw new Error("unreachable")}f/=6}t.data[r++]=f*this.maxValue,t.data[r++]=u*this.maxValue,t.data[r++]=c,this.alpha&&(t.data[r++]=i[n+3])}return t}function ul(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[Oe]});let t=F.createFrom(this,{components:4,colorModel:tr}),e=0,r=this.data;for(let i=0;i<r.length;i+=this.channels){let n=r[i],o=r[i+1],s=r[i+2],a=Math.min(this.maxValue-n,this.maxValue-o,this.maxValue-s),h=(this.maxValue-n-a)/(1-a/this.maxValue),l=(this.maxValue-o-a)/(1-a/this.maxValue),f=(this.maxValue-s-a)/(1-a/this.maxValue);t.data[e++]=Math.round(h),t.data[e++]=Math.round(l),t.data[e++]=Math.round(f),t.data[e++]=Math.round(a),this.alpha&&(t.data[e++]=r[i+3])}return t}function cl(){return new F(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}var Ue={luma709(t,e,r){return t*6966+e*23436+r*2366>>15},luma601(t,e,r){return t*9798+e*19235+r*3735>>15},maximum(t,e,r){return Math.max(t,e,r)},minimum(t,e,r){return Math.min(t,e,r)},average(t,e,r){return(t+e+r)/3>>0},minmax(t,e,r){return(Math.max(t,e,r)+Math.min(t,e,r))/2},red(t){return t},green(t,e){return e},blue(t,e,r){return r},cyan(t,e,r,i){let n=Ue.black(t,e,r,i);return(i.maxValue-t-n)/(1-n/i.maxValue)>>0},magenta(t,e,r,i){let n=Ue.black(t,e,r,i);return(i.maxValue-e-n)/(1-n/i.maxValue)>>0},yellow(t,e,r,i){let n=Ue.black(t,e,r,i);return(i.maxValue-r-n)/(1-n/i.maxValue)>>0},black(t,e,r,i){return Math.min(i.maxValue-t,i.maxValue-e,i.maxValue-r)},hue(t,e,r,i){let n=Ue.min(t,e,r),o=Ue.max(t,e,r);if(o===n)return 0;let s=0,a=o-n;switch(o){case t:s=(e-r)/a+(e<r?6:0);break;case e:s=(r-t)/a+2;break;case r:s=(t-e)/a+4;break;default:throw new Error("unreachable")}return s/6*i.maxValue>>0},saturation(t,e,r,i){let n=Ue.min(t,e,r),o=Ue.max(t,e,r),s=o-n;return o===0?0:s/o*i.maxValue},lightness(t,e,r){let i=Ue.min(t,e,r);return(Ue.max(t,e,r)+i)/2}};Object.defineProperty(Ue,"luminosity",{enumerable:!1,value:Ue.lightness});Object.defineProperty(Ue,"luminance",{enumerable:!1,value:Ue.lightness});Object.defineProperty(Ue,"min",{enumerable:!1,value:Ue.minimum});Object.defineProperty(Ue,"max",{enumerable:!1,value:Ue.maximum});Object.defineProperty(Ue,"brightness",{enumerable:!1,value:Ue.maximum});var Tp={};Object.keys(Ue).forEach(t=>{Tp[t]=t});function Gn(t={}){let{algorithm:e="luma709",keepAlpha:r=!1,mergeAlpha:i=!0}=t;if(typeof e!="string"&&typeof e!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(e="red"),r&=this.alpha,i&=this.alpha,r&&(i=!1);let n=Js(this,t,{components:1,alpha:r,colorModel:Ke}),o;if(typeof e=="function")o=e;else if(o=Ue[e.toLowerCase()],!o)throw new Error(`unsupported grey algorithm: ${e}`);let s=0;for(let a=0;a<this.data.length;a+=this.channels)i?n.data[s++]=Li(o(this.data[a],this.data[a+1],this.data[a+2],this)*this.data[a+this.components]/this.maxValue,this):(n.data[s++]=Li(o(this.data[a],this.data[a+1],this.data[a+2],this),this),n.alpha&&(n.data[s++]=this.data[a+this.components]));return n}function dl(t){let e=0;for(let f=0;f<t.length;f++)if(t[f]!==0){e=f;break}let r=t.length-1;for(let f=t.length-1;f>=e;f--)if(t[f]!==0){r=f;break}let i=1/(r-e),n=new Array(t.length),o=0,s=0;for(let f=e;f<t.length;f++)o+=f*t[f],s+=t[f],n[f]=o/s;let a=new Array(t.length);o=s=0;for(let f=r;f>0;f--)o+=f*t[f],s+=t[f],a[f-1]=o/s;let h=-1,l=Number.MAX_VALUE;for(let f=0;f<t.length;f++){let u=0,c;for(let d=0;d<=f;d++)c=1/(1+i*Math.abs(d-n[f])),c<1e-6||c>.999999||(u+=t[d]*(-c*Math.log(c)-(1-c)*Math.log(1-c)));for(let d=f+1;d<t.length;d++)c=1/(1+i*Math.abs(d-a[f])),c<1e-6||c>.999999||(u+=t[d]*(-c*Math.log(c)-(1-c)*Math.log(1-c)));u<l&&(l=u,h=f)}return h}function pl(t){let e=t.slice(),r=0;for(;!My(e);){let n=0,o=0,s=e[0];for(let a=0;a<t.length-1;a++)n=o,o=s,s=e[a+1],e[a]=(n+o+s)/3;if(e[t.length-1]=(o+s)/3,r++,r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let i=0;for(let n=1;n<t.length-1;n++)e[n-1]<e[n]&&e[n+1]<e[n]&&(i+=n);return Math.floor(i/2)}function My(t){let e=!1,r=0;for(let i=1;i<t.length-1;i++)if(t[i-1]<t[i]&&t[i+1]<t[i]&&(r++,r>2))return!1;return r===2&&(e=!0),e}function ml(t){let e,r,i,n,o=0;for(let s=1;s<t.length;s++)if(t[s]>0){o=s+1;break}for(;;){e=0,i=0;for(let s=0;s<o;s++)i=i+t[s],e=e+t[s]*s;n=0,r=0;for(let s=o+1;s<t.length;s++)r+=t[s],n+=t[s]*s;if(i>0&&r>0&&(e/=i,n/=r,o===Math.round((e+n)/2)))break;if(o++,o>t.length-2)throw new Error("Threshold not found")}return o}function gl(t,e){let r,i,n,o,s,a,h,l,f,u,c,d;c=.5,u=0;for(let p=0;p<t.length;p++)u+=p*t[p];u/=e,h=u;do{a=h,r=a+.5|0,i=0,o=0;for(let p=0;p<=r;p++)i+=p*t[p],o+=t[p];l=o===0?0:i/o,n=0,s=0;for(let p=r+1;p<t.length;p++)n+=p*t[p],s+=t[p];f=s===0?0:n/s,d=(l-f)/(Math.log(l)-Math.log(f)),d<-Number.EPSILON?h=d-.5|0:h=d+.5|0}while(Math.abs(h-a)>c);return r}function xl(t,e){let r=new Array(t.length);for(let c=0;c<t.length;c++)r[c]=t[c]/e;let i=new Array(t.length),n=new Array(t.length);i[0]=r[0],n[0]=1-i[0];for(let c=1;c<t.length;c++)i[c]=i[c-1]+r[c],n[c]=1-i[c];let o=0;for(let c=0;c<t.length;c++)if(Math.abs(i[c])>=Number.EPSILON){o=c;break}let s=t.length-1;for(let c=t.length-1;c>=o;c--)if(Math.abs(n[c])>=Number.EPSILON){s=c;break}let a=-1,h,l=Number.MIN_VALUE,f,u;for(let c=o;c<=s;c++){f=0;for(let d=0;d<=c;d++)t[d]!==0&&(f-=r[d]/i[c]*Math.log(r[d]/i[c]));u=0;for(let d=c+1;d<t.length;d++)t[d]!==0&&(u-=r[d]/n[c]*Math.log(r[d]/n[c]));h=f+u,l<h&&(l=h,a=c)}return a}function wl(t,e){let r=0;for(let i=0;i<t.length;i++)r+=i*t[i];return Math.floor(r/e)}function bl(t,e){let r,i=-2,n,o,s,a,h,l,f,u,c,d,p,g=0;for(let x=0;x<t.length;x++)g+=x*t[x];for(g/=e,r=g;r!==i;){let x=Lp(t,r),m=Lp(t,t.length-1),w=Fp(t,r),y=Fp(t,t.length-1),M=Op(t,r),_=Op(t,t.length-1);if(n=w/x,o=(y-w)/(m-x),s=x/m,a=(m-x)/m,h=M/x-n*n,l=(_-M)/(m-x)-o*o,f=1/h-1/l,u=n/h-o/l,c=n*n/h-o*o/l+Math.log10(h*(a*a)/(l*(s*s))),d=u*u-f*c,d<0)return r;i=r,p=(u+Math.sqrt(d))/f,isNaN(p)?r=i:r=Math.floor(p)}return r}function Lp(t,e){let r=0;for(let i=0;i<=e;i++)r+=t[i];return r}function Fp(t,e){let r=0;for(let i=0;i<=e;i++)r+=i*t[i];return r}function Op(t,e){let r=0;for(let i=0;i<=e;i++)r+=i*i*t[i];return r}function yl(t){if(t.length<2)return 0;let e=0,r=-1,i=-1,n=new Array(t.length);for(let o=0;o<t.length;o++)n[o]=t[o],t[o]>0&&(i=o);for(;!Ay(n);)if(n=Ey(n),e++,e>1e4)return r;return r=ky(n,i),r}function Ey(t){let e=new Array(t.length);for(let r=1;r<t.length-1;r++)e[r]=(t[r-1]+t[r]+t[r+1])/3;return e[0]=(t[0]+t[1])/3,e[t.length-1]=(t[t.length-2]+t[t.length-1])/3,e}function ky(t,e){let r;for(let i=1;i<e;i++)if(t[i-1]>t[i]&&t[i+1]>=t[i]){r=i;break}return r}function Ay(t){let e=t.length,r=!1,i=0;for(let n=1;n<e-1;n++)if(t[n-1]<t[n]&&t[n+1]<t[n]&&(i++,i>2))return!1;return i===2&&(r=!0),r}function vl(t,e){let r=1,i=0,n=0,o=0,s=0,a,h,l,f,u,c,d=-1,p=t.length,g=new Array(p);for(let x=0;x<p;x++)g[x]=t[x]/e;for(let x=0;x<p;x++)i+=x*g[x],n+=x*x*g[x],o+=x*x*x*g[x];h=r*n-i*i,l=(-n*n+i*o)/h,f=(r*-o+n*i)/h,u=.5*(-f-Math.sqrt(f*f-4*l)),c=.5*(-f+Math.sqrt(f*f-4*l)),a=(c-i)/(c-u);for(let x=0;x<p;x++)if(s+=g[x],s>a){d=x;break}return d}function _l(t,e){let r=0,i=0,n=0,o=0,s=0;for(let a=0;a<t.length;a++)s+=a*t[a];for(let a=0;a<t.length;a++){i=i+t[a];let h=e-i;if(i===0||h===0)continue;r=r+a*t[a];let l=(s-r)/h,f=i*h*(r/i-l)*(r/i-l);f>=n&&(o=a,n=f)}return o}function Ml(t){let e=-1,r=.5,i=new Array(t.length),n=Up(t,t.length-1),o=1;for(let s=0;s<t.length;s++)i[s]=Math.abs(Up(t,s)/n-r),i[s]<o&&(o=i[s],e=s);return e}function Up(t,e){let r=0;for(let i=0;i<=e;i++)r+=t[i];return r}function El(t,e){let r,i,n,o=new Array(t.length),s=new Array(t.length),a=new Array(t.length),h=0,l=0,f=0,u=0,c=0,d=0,g=1/(1-.5),m=1/(1-2);for(let _=0;_<t.length;_++)o[_]=t[_]/e;s[0]=o[0],a[0]=1-s[0];for(let _=1;_<t.length;_++)s[_]=s[_-1]+o[_],a[_]=1-s[_];i=0;for(let _=0;_<t.length;_++)if(Math.abs(s[_])>=Number.EPSILON){i=_;break}n=t.length-1;for(let _=t.length-1;_>=i;_--)if(Math.abs(a[_])>=Number.EPSILON){n=_;break}for(let _=i;_<=n;_++){let R=0,E=0,A=0;for(let L=0;L<=_;L++)t[L]!==0&&(R-=o[L]/s[_]*Math.log(o[L]/s[_])),E+=Math.sqrt(o[L]/s[_]),A+=o[L]*o[L]/(s[_]*s[_]);let I=0,b=0,k=0;for(let L=_+1;L<t.length;L++)t[L]!==0&&(I-=o[L]/a[_]*Math.log(o[L]/a[_])),b+=Math.sqrt(o[L]/a[_]),k+=o[L]*o[L]/(a[_]*a[_]);let B=R+I,S=g*(E*b>0?Math.log(E*b):0),j=m*(A*k>0?Math.log(A*k):0);B>u&&(u=B,h=_),S>c&&(c=S,l=_),j>d&&(d=j,f=_)}let w=[h,l,f];w.sort((_,R)=>_-R);let y;Math.abs(w[0]-w[1])<=5?Math.abs(w[1]-w[2])<=5?y=[1,2,1]:y=[0,1,3]:Math.abs(w[1]-w[2])<=5?y=[3,1,0]:y=[1,2,1];let M=s[w[2]]-s[w[0]];return r=Math.round(w[0]*(s[w[0]]+.25*M*y[0])+.25*w[1]*M*y[1]+w[2]*(a[w[2]]+.25*M*y[2])),r}function kl(t,e){let r=new Array(t.length);for(let d=0;d<t.length;d++)r[d]=t[d]/e;let i=new Array(t.length),n=new Array(t.length);i[0]=r[0],n[0]=1-i[0];for(let d=1;d<t.length;d++)i[d]=i[d-1]+r[d],n[d]=1-i[d];let o=0;for(let d=0;d<t.length;d++)if(Math.abs(i[d])>=Number.EPSILON){o=d;break}let s=t.length-1;for(let d=t.length-1;d>=o;d--)if(Math.abs(n[d])>=Number.EPSILON){s=d;break}let a=-1,h=Number.MAX_VALUE,l,f,u,c;for(let d=o;d<=s;d++){u=0,l=.5/i[d];for(let p=1;p<=d;p++)u-=r[p]*Math.log(1-l*i[p-1]);u*=l,c=0,l=.5/n[d];for(let p=d+1;p<t.length;p++)c-=r[p]*Math.log(1-l*n[p]);c*=l,f=Math.abs(u-c),f<h&&(h=f,a=d)}return a}function Al(t){let e=0,r=0,i=0,n=0;for(let u=0;u<t.length;u++)if(t[u]>0){e=u;break}e>0&&e--;for(let u=t.length-1;u>0;u--)if(t[u]>0){n=u;break}n<t.length-1&&n++;for(let u=0;u<t.length;u++)t[u]>r&&(i=u,r=t[u]);let o=!1;if(i-e<n-i){o=!0;let u=0,c=t.length-1;for(;u<c;){let d=t[u];t[u]=t[c],t[c]=d,u++,c--}e=t.length-1-n,i=t.length-1-i}if(e===i)return e;let s,a,h;s=t[i],a=e-i,h=Math.sqrt(s*s+a*a),s/=h,a/=h,h=s*e+a*t[e];let l=e,f=0;for(let u=e+1;u<=i;u++){let c=s*u+a*t[u]-h;c>f&&(l=u,f=c)}if(l--,o){let u=0,c=t.length-1;for(;u<c;){let d=t[u];t[u]=t[c],t[c]=d,u++,c--}return t.length-1-l}else return l}function Sl(t,e){let r=new Array(t.length);for(let l=0;l<t.length;l++)r[l]=t[l]/e;let i=new Array(t.length);i[0]=r[0];for(let l=1;l<t.length;l++)i[l]=i[l-1]+r[l];let n=new Array(t.length);n[0]=r[0]*r[0];for(let l=1;l<t.length;l++)n[l]=n[l-1]+r[l]*r[l];let o=new Array(t.length);o[t.length-1]=0;for(let l=t.length-2;l>=0;l--)o[l]=o[l+1]+r[l+1]*r[l+1];let s=-1,a=Number.MIN_VALUE,h;for(let l=0;l<t.length;l++)h=-1*(n[l]*o[l]>0?Math.log(n[l]*o[l]):0)+2*(i[l]*(1-i[l])>0?Math.log(i[l]*(1-i[l])):0),h>a&&(a=h,s=l);return s}var Dl={huang:dl,intermodes:pl,isodata:ml,li:gl,maxentropy:xl,mean:wl,minerror:bl,minimum:yl,moments:vl,otsu:_l,percentile:Ml,renyientropy:El,shanbhag:kl,triangle:Al,yen:Sl},qn={};Object.keys(Dl).forEach(t=>{qn[t]=t});function Ni(t={}){let{algorithm:e=qn.otsu}=t;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let r=Dl[e.toLowerCase()];if(r){let i=this.getHistogram();return r(i,this.size)}else throw new Error(`unknown thresholding algorithm: ${e}`)}var Np="threshold";function Il(t={}){let{algorithm:e=Np,threshold:r=.5,useAlpha:i=!0,invert:n=!1}=t;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),e===Np?r=Rp(r,this.maxValue):r=Ni.call(this,t);let o=new F(this.width,this.height,{kind:"BINARY",parent:this}),s=0;if(this.alpha&&i)for(let a=0;a<this.data.length;a+=this.channels){let h=this.data[a]+(this.maxValue-this.data[a])*(this.maxValue-this.data[a+1])/this.maxValue;(n&&h<=r||!n&&h>=r)&&o.setBit(s),s++}else for(let a=0;a<this.data.length;a+=this.channels)(n&&this.data[a]<=r||!n&&this.data[a]>=r)&&o.setBit(s),s++;return o}var Yp=ve(Bt());function Rl(t,e,r,i){let n=t.width,o=t.height,s=e.width,a=t.channels;for(let h=0;h<n;h++)for(let l=0;l<o;l++)for(let f=0;f<a;f++){let u=(l*n+h)*a+f,c=((i+l)*s+r+h)*a+f;e.data[c]=t.data[u]}}function Cl(t={}){let{size:e=0,algorithm:r="copy",color:i}=t;if(this.checkProcessable("pad",{bitDepth:[8,16]}),r==="set"){if(i.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let h=0;h<i.length;h++)i[h]===0&&(i[h]=.001)}else i=(0,Yp.default)(this.channels,null);Array.isArray(e)||(e=[e,e]);let n=this.width+e[0]*2,o=this.height+e[1]*2,s=this.channels,a=F.createFrom(this,{width:n,height:o});Rl(this,a,e[0],e[1]);for(let h=e[0];h<n-e[0];h++)for(let l=0;l<s;l++){let f=i[l]||a.data[(e[1]*n+h)*s+l];for(let u=0;u<e[1];u++)a.data[(u*n+h)*s+l]=f;f=i[l]||a.data[((o-e[1]-1)*n+h)*s+l];for(let u=o-e[1];u<o;u++)a.data[(u*n+h)*s+l]=f}for(let h=0;h<o;h++)for(let l=0;l<s;l++){let f=i[l]||a.data[(h*n+e[0])*s+l];for(let u=0;u<e[0];u++)a.data[(h*n+u)*s+l]=f;f=i[l]||a.data[(h*n+n-e[0]-1)*s+l];for(let u=n-e[0];u<n;u++)a.data[(h*n+u)*s+l]=f}return a}function Pl(t=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(t))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===t)return this.clone();let e=F.createFrom(this,{bitDepth:t});switch(t){case 8:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(e.data[r]=255);else for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]>>8;break;case 16:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(e.data[r]=65535);else for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]<<8|this.data[r];break;default:throw new Error("colorDepth conversion unexpected case")}return e}function Bl(t,e={}){let{interpolation:r=kt.nearestneighbor,width:i=this.width,height:n=this.height}=e;if(typeof t!="number")throw new TypeError("degrees must be a number");let o=Xn(r),s=t*Math.PI/180,a=Math.floor(Math.abs(i*Math.cos(s))+Math.abs(n*Math.sin(s))),h=Math.floor(Math.abs(n*Math.cos(s))+Math.abs(i*Math.sin(s))),l=Math.cos(-s),f=Math.sin(-s),u=a/2,c=h/2;a%2===0?(u=u-.5,h%2===0?c=c-.5:c=Math.floor(c)):(u=Math.floor(u),h%2===0?c=c-.5:c=Math.floor(c));let d=Math.floor(i/2-u),p=Math.floor(n/2-c);if(this.bitDepth===1){let g=new F(a,h,{kind:"BINARY",parent:this});switch(o){case kt.nearestneighbor:return Dy(this,g,d,p,u,c,l,f);case kt.bilinear:return Ry(this,g,d,p,u,c,l,f);default:throw new Error(`unsupported rotate interpolation: ${o}`)}}else{let g=F.createFrom(this,{width:a,height:h});switch(o){case kt.nearestneighbor:return Sy(this,g,d,p,u,c,l,f);case kt.bilinear:return Iy(this,g,d,p,u,c,l,f);default:throw new Error(`unsupported rotate interpolation: ${o}`)}}}function Sy(t,e,r,i,n,o,s,a){for(let h=0;h<e.width;h+=1)for(let l=0;l<e.height;l+=1)for(let f=0;f<t.channels;f++){let u=Math.round((h-n)*s-(l-o)*a+n)+r,c=Math.round((l-o)*s+(h-n)*a+o)+i;u<0||u>=t.width||c<0||c>=t.height?t.alpha===1&&f===t.channels-1?e.setValueXY(h,l,f,0):e.setValueXY(h,l,f,t.maxValue):e.setValueXY(h,l,f,t.getValueXY(u,c,f))}return e}function Dy(t,e,r,i,n,o,s,a){for(let h=0;h<e.width;h+=1)for(let l=0;l<e.height;l+=1){let f=Math.round((h-n)*s-(l-o)*a+n)+r,u=Math.round((l-o)*s+(h-n)*a+o)+i;(f<0||f>=t.width||u<0||u>=t.height||t.getBitXY(f,u))&&e.setBitXY(h,l)}return e}function Iy(t,e,r,i,n,o,s,a){let h=t.width*t.channels;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let u=(f-n)*s-(l-o)*a+n+r,c=(l-o)*s+(f-n)*a+o+i,d=u|0,p=c|0,g=u-d,x=c-p;for(let m=0;m<t.channels;m++)if(u<0||u>=t.width||c<0||c>=t.height)t.alpha===1&&m===t.channels-1?e.setValueXY(f,l,m,0):e.setValueXY(f,l,m,t.maxValue);else{let w=(p*t.width+d)*t.channels+m,y=t.data[w],M=t.data[w+t.channels],_=t.data[w+h],R=t.data[w+h+t.channels],E=y+g*(M-y)+x*(_-y)+g*x*(y-M-_+R)|0;e.setValueXY(f,l,m,E)}}return e}function Ry(t,e,r,i,n,o,s,a){let h=t.width;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let u=(f-n)*s-(l-o)*a+n+r,c=(l-o)*s+(f-n)*a+o+i,d=u|0,p=c|0,g=u-d,x=c-p;if(u<0||u>=t.width||c<0||c>=t.height)e.setBitXY(f,l);else{let m=p*t.width+d,w=t.getBit(m),y=t.getBit(m+1),M=t.getBit(m+h),_=t.getBit(m+1+h);(w|g&y-w|x&M-w|g&x&w-y-M+_)>0&&e.setBitXY(f,l)}}return e}function zp(t,e){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof t!="number")throw new TypeError("angle must be a number");switch(t<0&&(t=Math.ceil(-t/360)*360+t),t%360){case 0:return this.clone();case 90:return Ll.call(this);case 180:return Cy.call(this);case 270:return Tl.call(this);default:return Bl.call(this,t,e)}}function Tl(){if(this.bitDepth===1){let t=new F(this.height,this.width,{kind:"BINARY",parent:this}),e=t.height-1;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)this.getBitXY(i,r)&&t.setBitXY(r,e-i);return t}else{let t=F.createFrom(this,{width:this.height,height:this.width}),e=t.height-1;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)for(let n=0;n<this.channels;n++)t.setValueXY(r,e-i,n,this.getValueXY(i,r,n));return t}}function Ll(){if(this.bitDepth===1){let t=new F(this.height,this.width,{kind:"BINARY",parent:this}),e=t.width-1;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)this.getBitXY(i,r)&&t.setBitXY(e-r,i);return t}else{let t=F.createFrom(this,{width:this.height,height:this.width}),e=t.width-1;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)for(let n=0;n<this.channels;n++)t.setValueXY(e-r,i,n,this.getValueXY(i,r,n));return t}}function Cy(){if(this.bitDepth===1){let t=new F(this.width,this.height,{kind:"BINARY",parent:this}),e=t.width-1,r=t.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.getBitXY(n,i)&&t.setBitXY(e-n,r-i);return t}else{let t=F.createFrom(this),e=t.width-1,r=t.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)for(let o=0;o<this.channels;o++)t.setValueXY(e-n,r-i,o,this.getValueXY(n,i,o));return t}}function Fl(t,e={}){let r=Er(t);this.checkProcessable("insert",r);let{x:i=0,y:n=0}=e,o=Wr(this,e,{copy:!0}),s=Math.min(o.height,n+t.height),a=Math.min(o.width,i+t.width);if(o.bitDepth===1)for(let h=n;h<s;h++)for(let l=i;l<a;l++)t.getBitXY(l-i,h-n)?o.setBitXY(l,h):o.clearBitXY(l,h);else for(let h=n;h<s;h++)for(let l=i;l<a;l++)o.setPixelXY(l,h,t.getPixelXY(l-i,h-n));return o}var Xp=ve(Bt());function Ol(t={}){let{size:e=0,algorithm:r="copy",color:i}=t;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),r==="set"){if(i.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let a=0;a<i.length;a++)i[a]===0&&(i[a]=.001)}else i=(0,Xp.default)(this.channels,null);Array.isArray(e)||(e=[e,e]);let n=e[0],o=e[1],s=this.channels;for(let a=n;a<this.width-n;a++)for(let h=0;h<s;h++){let l=i[h]||this.data[(a+this.width*o)*s+h];for(let f=0;f<o;f++)this.data[(f*this.width+a)*s+h]=l;l=i[h]||this.data[(a+this.width*(this.height-o-1))*s+h];for(let f=this.height-o;f<this.height;f++)this.data[(f*this.width+a)*s+h]=l}for(let a=0;a<this.height;a++)for(let h=0;h<s;h++){let l=i[h]||this.data[(a*this.width+n)*s+h];for(let f=0;f<n;f++)this.data[(a*this.width+f)*s+h]=l;l=i[h]||this.data[(a*this.width+this.width-n-1)*s+h];for(let f=this.width-n;f<this.width;f++)this.data[(a*this.width+f)*s+h]=l}return this}function Ul(t={}){let{preserveAlpha:e=!0}=t;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new at([this.clone()]);let r=new at,i=this.data;if(this.alpha&&e)for(let n=0;n<this.components;n++){let o=F.createFrom(this,{components:1,alpha:!0,colorModel:Ke}),s=0;for(let a=0;a<i.length;a+=this.channels)o.data[s++]=i[a+n],o.data[s++]=i[a+this.components];r.push(o)}else for(let n=0;n<this.channels;n++){let o=F.createFrom(this,{components:1,alpha:!1,colorModel:Ke}),s=0;for(let a=0;a<i.length;a+=this.channels)o.data[s++]=i[a+n];r.push(o)}return r}function Nl(t,e={}){let{keepAlpha:r=!1,mergeAlpha:i=!1}=e;r&=this.alpha,i&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),t=Ti(this,t);let n=F.createFrom(this,{components:1,alpha:r,colorModel:Ke}),o=0;for(let s=0;s<this.data.length;s+=this.channels)i?n.data[o++]=this.data[s+t]*this.data[s+this.components]/this.maxValue:(n.data[o++]=this.data[s+t],r&&(n.data[o++]=this.data[s+this.components]));return n}function Yl(t=Py,e={}){let{mergeAlpha:r=!1,keepAlpha:i=!1}=e;r&=this.alpha,i&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let n=F.createFrom(this,{components:1,alpha:i,colorModel:Ke}),o=0;for(let s=0;s<this.size;s++){let a=t(this.getPixel(s));r?n.data[o++]=a*this.data[s*this.channels+this.components]/this.maxValue:(n.data[o++]=a,i&&(n.data[o++]=this.data[s*this.channels+this.components]))}return n}function Py(t){return(t[0]+t[1]+t[2])/3}function zl(t,e){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),e.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),e.width!==this.width||e.height!==this.height)throw new Error("Images must have exactly the same width and height");t=Ti(this,t);let r=t;for(let i=0;i<e.data.length;i++)this.data[r]=e.data[i],r+=this.channels;return this}var jp=ve(Bt());function Xl(t,e={}){let{shift:r=[0,0],average:i,channels:n,defaultAlpha:o,normalize:s,border:a=[0,0]}=e;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(a)||(a=[a,a]),n=Xe(this,{channels:n,defaultAlpha:o}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");typeof i>"u"&&(i=!0);let h=Math.max(a[0],-r[0]),l=Math.min(this.width-a[0],this.width-r[0]),f=Math.max(a[1],-r[1]),u=Math.min(this.height-a[1],this.height-r[1]),c=(0,jp.default)(n.length,0);for(let d=0;d<n.length;d++){let p=n[d],g=s?this.sum[p]:Math.max(this.sum[p],t.sum[p]),x=s?t.sum[p]:Math.max(this.sum[p],t.sum[p]);if(g!==0&&x!==0)for(let m=h;m<l;m++)for(let w=f;w<u;w++){let y=m*this.multiplierX+w*this.multiplierY+p,M=y+r[0]*this.multiplierX+r[1]*this.multiplierY;c[d]+=Math.min(this.data[y]/g,t.data[M]/x)}}return i?c.reduce((d,p)=>d+p)/c.length:c}function jl(t={}){let{sampling:e=[10,10],painted:r=!1,mask:i}=t;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(e)||(e=[e,e]);let n=e[0],o=e[1],s=[],a=[],h=this.width/n,l=this.height/o,f=Math.floor(h/2);for(let c=0;c<n;c++){let d=Math.floor(l/2);for(let p=0;p<o;p++){let g=Math.round(f),x=Math.round(d);(!i||i.getBitXY(g,x))&&(s.push([g,x]),a.push(this.getPixelXY(g,x))),d+=l}f+=h}let u={xyS:s,zS:a};return r&&(u.painted=this.rgba8().paintPoints(s)),u}function Ir(t,e,r){let i=new Array(t);for(let n=0;n<t;n++)i[n]=new Array(e);if(r)for(let n=0;n<t;n++)for(let o=0;o<e;o++)i[n][o]=r;return i.width=t,i.height=e,Object.setPrototypeOf(i,Ir.prototype),i}Ir.prototype.localMin=function(t,e){let r=this[t][e],i=[t,e];for(let n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(let o=Math.max(0,e-1);o<Math.min(this[0].length,e+2);o++)this[n][o]<r&&(r=this[n][o],i=[n,o]);return{position:i,value:r}};Ir.prototype.localMax=function(t,e){let r=this[t][e],i=[t,e];for(let n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(let o=Math.max(0,e-1);o<Math.min(this[0].length,e+2);o++)this[n][o]>r&&(r=this[n][o],i=[n,o]);return{position:i,value:r}};Ir.prototype.localSearch=function(t,e,r){let i=[];for(let n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(let o=Math.max(0,e-1);o<Math.min(this[0].length,e+2);o++)this[n][o]===r&&i.push([n,o]);return i};function Gl(t,e={}){let{border:r}=e;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");let i=new Ir(t.width,t.height,-1/0),n=Math.floor(t.width/2),o=Math.floor(t.height/2),s=n,a=o,h=!1;for(;!h;){let l=i.localSearch(n,o,-1/0);for(let u=0;u<l.length;u++){let c=l[u],d=this.getSimilarity(t,{border:r,shift:[s-c[0],a-c[1]]});i[c[0]][c[1]]=d}let f=i.localMax(n,o);f.position[0]!==n||f.position[1]!==o?(n=f.position[0],o=f.position[1]):h=!0}return[n-s,o-a]}function ql(t,e=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),Pp(this,t),zn(this,e);let r=new Array(this.width),i=0,n=t*this.width*this.channels+e,o=n+this.width*this.channels;for(let s=n;s<o;s+=this.channels)r[i++]=this.data[s];return r}function Vl(t,e=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),Bp(this,t),zn(this,e);let r=new Array(this.height),i=0,n=this.width*this.channels;for(let o=e+t*this.channels;o<this.data.length;o+=n)r[i++]=this.data[o];return r}function $l(t={}){let{channel:e}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}let r=new ft(this.height,this.width);for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)r.set(i,n,this.getValueXY(n,i,e));return r}function Wl(t,e={}){t=new ft(t);let{channel:r}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==t.columns||this.height!==t.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.setValueXY(n,i,r,t.get(i,n));return this}function Kl(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let t=new Array(this.size),e=0;for(let r=0;r<this.data.length;r+=this.channels){let i=new Array(this.components);for(let n=0;n<this.components;n++)i[n]=this.data[r+n];t[e++]=i}return t}function Zl(t){let e=this,r=e.getClosestCommonParent(t),i=e.getRelativePosition(r,{defaultFurther:!0}),n=Gp(e,i),o=t.getRelativePosition(r,{defaultFurther:!0}),s=Gp(t,o),a=By(n,s),h={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let l=0;l<a.length;l++){let f=a[l],u=[f[0]-i[0],f[1]-i[1]],c=[f[0]-o[0],f[1]-o[1]],d=e.getBitXY(u[0],u[1]),p=t.getBitXY(c[0],c[1]);d===1&&p===1&&h.commonWhitePixels.push(f)}for(let l=0;l<n.length;l++){let f,u;l!==0&&(f=Math.floor(l/e.width),u=l%e.width),e.getBitXY(f,u)===1&&h.whitePixelsMask1.push(n[l])}for(let l=0;l<s.length;l++){let f=0,u=0;l!==0&&(f=Math.floor(l/t.width),u=l%t.width),t.getBitXY(f,u)===1&&h.whitePixelsMask2.push(s[l])}return h}function Gp(t,e){let r=[];for(let i=0;i<t.height;i++)for(let n=0;n<t.width;n++){let o=[i,n];r.push([o[0]+e[0],o[1]+e[1]])}return r}function By(t,e){let r=0,i=0,n=[];for(;r<t.length&&i<e.length;)t[r][0]===e[i][0]&&t[r][1]===e[i][1]?(n.push(t[r]),r++,i++):t[r][0]<e[i][0]||t[r][0]===e[i][0]&&t[r][1]<e[i][1]?r++:i++;return n}function Hl(t){let e=qp(this),r=qp(t),i;if(e>=r?i=Vp(this,e):i=Vp(t,r),e===0||r===0)return i;let n=this,o=t;for(;e!==r;)if(e>r){if(n=n.parent,n===null)return i;e=e-1}else{if(o=o.parent,o===null)return i;r=r-1}for(;n!==o&&n!==null&&o!==null;)if(n=n.parent,o=o.parent,n===null||o===null)return i;return n!==o?i:n}function qp(t){let e=0,r=t;for(;r.parent!=null;)r=r.parent,e++;return e}function Vp(t,e){let r=t;for(;e>0;)r=r.parent,e=e-1;return r}var Ty={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Ly=[[-1,0,1],[-2,0,2],[-1,0,1]],Fy=[[-1,-2,-1],[0,0,0],[1,2,1]],$p={bitDepth:32,mode:"periodic"};function Jl(t,e){t.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),e=Object.assign({},Ty,e);let r=t.width,i=t.height,n=t.maxValue,o={sigma:e.gaussianBlur,radius:3},s=t.gaussianFilter(o),a=s.convolution(Fy,$p),h=s.convolution(Ly,$p),l=h.hypotenuse(a),f=t.constructor,u=new f(r,i,{kind:"GREY",bitDepth:32}),c=new f(r,i,{kind:"GREY",bitDepth:32}),d=new f(r,i,{kind:"GREY"});for(var p=1;p<r-1;p++)for(var g=1;g<i-1;g++){var x=(Math.round(Math.atan2(h.getValueXY(p,g,0),a.getValueXY(p,g,0))*(5/Math.PI))+5)%5;x===0&&(l.getValueXY(p,g,0)<=l.getValueXY(p,g-1,0)||l.getValueXY(p,g,0)<=l.getValueXY(p,g+1,0))||x===1&&(l.getValueXY(p,g,0)<=l.getValueXY(p-1,g+1,0)||l.getValueXY(p,g,0)<=l.getValueXY(p+1,g-1,0))||x===2&&(l.getValueXY(p,g,0)<=l.getValueXY(p-1,g,0)||l.getValueXY(p,g,0)<=l.getValueXY(p+1,g,0))||x===3&&(l.getValueXY(p,g,0)<=l.getValueXY(p-1,g-1,0)||l.getValueXY(p,g,0)<=l.getValueXY(p+1,g+1,0))||u.setValueXY(p,g,0,l.getValueXY(p,g,0))}for(p=0;p<r*i;++p){var m=u.data[p],w=0;m>e.highThreshold&&(w++,d.data[p]=n),m>e.lowThreshold&&w++,c.data[p]=w}var y=[];for(p=1;p<r-1;++p)for(g=1;g<i-1;++g)if(c.getValueXY(p,g,0)===1){e:for(var M=p-1;M<p+2;++M)for(var _=g-1;_<g+2;++_)if(c.getValueXY(M,_,0)===2){y.push([p,g]),d.setValueXY(p,g,0,n);break e}}for(;y.length>0;){var R=[];for(p=0;p<y.length;++p)for(g=-1;g<2;++g)for(M=-1;M<2;++M)if(!(g===0&&M===0)){var E=y[p][0]+g,A=y[p][1]+M;c.getValueXY(E,A,0)===1&&d.getValueXY(E,A,0)===0&&(R.push([E,A]),d.setValueXY(E,A,0,n))}y=R}return d}function Ql(t){return Jl(this,t)}function eh(t,e={}){let{position:r}=e;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&(r=t.getRelativePosition(this),!r))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let i=F.createFrom(this,{width:t.width,height:t.height,alpha:1,position:r,parent:this});for(let n=0;n<t.width;n++)for(let o=0;o<t.height;o++){for(let s=0;s<this.channels;s++){let a=this.getValueXY(n+r[0],o+r[1],s);i.setValueXY(n,o,s,a)}t.getBitXY(n,o)||i.setValueXY(n,o,this.components,0)}return i}else{let i=F.createFrom(this,{width:t.width,height:t.height,position:r,parent:this});for(let n=0;n<t.height;n++)for(let o=0;o<t.width;o++)t.getBitXY(o,n)&&this.getBitXY(o+r[0],n+r[1])&&i.setBitXY(o,n);return i}}var Hp=ve(Zp());function th(t={}){let{x:e=0,y:r=0,inPlace:i=!0}=t,n=i?this:F.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(e,r))return n;let s=new Hp.default;for(s.push(new Yi(e,r));s.length>0;){let a=s.shift();n.setBitXY(a.x,a.y);for(let h=a.x+1;h<this.width&&(!n.getBitXY(h,a.y)&&!this.getBitXY(h,a.y));h++)n.setBitXY(h,a.y),a.y+1<this.height&&!this.getBitXY(h,a.y+1)&&s.push(new Yi(h,a.y+1)),a.y-1>=0&&!this.getBitXY(h,a.y-1)&&s.push(new Yi(h,a.y-1));for(let h=a.x-1;h>=0&&(!n.getBitXY(h,a.y)&&!this.getBitXY(h,a.y));h++)n.setBitXY(h,a.y),a.y+1<this.height&&!this.getBitXY(h,a.y+1)&&s.push(new Yi(h,a.y+1)),a.y-1>=0&&!this.getBitXY(h,a.y-1)&&s.push(new Yi(h,a.y-1))}return n}function Yi(t,e){this.x=t,this.y=e}function ti(){return ti=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},ti.apply(this,arguments)}function Oy(t,e,r){e=e/100,r=r/100;var i=[],n=r*e,o=t/60,s=n*(1-Math.abs(o%2-1)),a=r-n;return o>=0&&o<1?i=[n,s,0]:o>=1&&o<2?i=[s,n,0]:o>=2&&o<3?i=[0,n,s]:t>=3&&o<4?i=[0,s,n]:t>=4&&o<5?i=[s,0,n]:t>=5&&o<=6?i=[n,0,s]:i=[0,0,0],{r:Math.round(255*(i[0]+a)),g:Math.round(255*(i[1]+a)),b:Math.round(255*(i[2]+a))}}function Uy(t,e,r){return e*=(r<50?r:100-r)/100,{h:t,s:2*e/(r+e)*100,v:r+e}}function Jp(t,e,r){var i=Uy(t,e,r);return Oy(i.h,i.s,i.v)}var Ny={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function Qp(t){return Yy(t)||Gy(t)||jy(t)||zy(t)||Xy(t)||qy(t)||Vy(t)}function Yy(t){var e=Ny[t.toLowerCase()];if(e)return{r:e[0],g:e[1],b:e[2],a:100}}function zy(t){var e=t.match(/rgb\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function Xy(t){var e=t.match(/rgba\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:r[3]*100}}}function jy(t){if(t[0]==="#"&&t.length===7)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:100}}function Gy(t){if(t[0]==="#"&&t.length===4)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:100}}function qy(t){var e=t.match(/hsl\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */),i=parseInt(r[0],10),n=parseInt(r[1],10),o=parseInt(r[2],10),s=Jp(i,n,o);return ti({},s,{a:100})}}function Vy(t){var e=t.match(/hsla\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */),i=parseInt(r[0],10),n=parseInt(r[1],10),o=parseInt(r[2],10),s=parseInt(parseFloat(r[3])*100,10),a=Jp(i,n,o);return ti({},a,{a:s})}}function zi(t){let e=Qp(t);return[e.r,e.g,e.b,Math.round(e.a*255/100)]}function rh(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function $y(t,e,r){let i,n,o,s,a,h;return e/=100,r/=100,e===0?s=a=h=r*255:(r<=.5?n=r*(e+1):n=r+e-r*e,i=r*2-n,o=t/360,s=rh(i,n,o+1/3),a=rh(i,n,o),h=rh(i,n,o-1/3)),{r:s,g:a,b:h}}function Wy(t){let e=new Array(t),r=0;for(let i=0;i<360;i+=360/t){r++;let n=$y(i,100,30+r%4*15);e[r-1]=[Math.round(n.r*255),Math.round(n.g*255),Math.round(n.b*255)]}return e}function Ky(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function lr(t){let{color:e,colors:r,randomColors:i,numberColors:n=50}=t;if(e&&!Array.isArray(e)&&(e=zi(e)),e)return[e];if(r)return r=r.map(function(o){return Array.isArray(o)?o:zi(o)}),r;if(i){r=new Array(n);for(let o=0;o<n;o++)r[o]=Ky()}return Wy(n)}function ih(t,e,r={}){let{color:i="blue",colors:n,font:o="12px Helvetica",rotate:s=0}=r;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:Oe}),!Array.isArray(t))throw Error("paintLabels: labels must be an array");if(!Array.isArray(e))throw Error("paintLabels: positions must be an array");if(i&&!Array.isArray(i)&&(i=zi(i)),n?n=n.map(function(l){return Array.isArray(l)?l:zi(l)}):n=[i],t.length!==e.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(o)||(o=[o]),Array.isArray(s)||(s=[s]);let h=this.getCanvas().getContext("2d");for(let l=0;l<t.length;l++){h.save();let f=n[l%n.length];h.fillStyle=`rgba(${f[0]},${f[1]},${f[2]},${f[3]/this.maxValue})`,h.font=o[l%o.length];let u=e[l];h.translate(u[0],u[1]),h.rotate(s[l%s.length]/180*Math.PI),h.fillText(t[l],0,0),h.restore()}return this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data),this}function nh(t,e={}){let{alpha:r=255,labels:i=[],labelsPosition:n=[],labelColor:o="blue",labelFont:s="12px Helvetica"}=e;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:Oe});let a=lr(Object.assign({},e,{numberColors:t.length}));Array.isArray(t)||(t=[t]);for(let h=0;h<t.length;h++){let l=t[h],f=a[h%a.length];for(let u=0;u<l.width;u++)for(let c=0;c<l.height;c++)if(l.getBitXY(u,c))for(let d=0;d<Math.min(this.components,f.length);d++)if(r===255)this.setValueXY(u+l.position[0],c+l.position[1],d,f[d]);else{let p=this.getValueXY(u+l.position[0],c+l.position[1],d);p=Math.round((p*(255-r)+f[d]*r)/255),this.setValueXY(u+l.position[0],c+l.position[1],d,p)}}if(Array.isArray(i)&&i.length>0){let l=this.getCanvas().getContext("2d");l.fillStyle=o,l.font=s;for(let f=0;f<Math.min(t.length,i.length);f++){let u=n[f]?n[f]:t[f].position;l.fillText(i[f],u[0],u[1])}this.data=Uint8Array.from(l.getImageData(0,0,this.width,this.height).data)}return this}function Xi(t,e){let r=new Array(t);for(let i=0;i<t;i++)r[i]=new Array(e).fill(0);return r}var Zy=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],Hy=[[0,1,0],[1,1,1],[0,1,0]],Tt=class{constructor(e={}){let{kind:r="cross",shape:i,size:n,width:o,height:s,filled:a=!0}=e;if(n&&(o=n,s=n),i)switch(i.toLowerCase()){case"square":case"rectangle":this.matrix=Jy(o,s,{filled:a});break;case"circle":case"ellipse":this.matrix=Qy(o,s,{filled:a});break;case"triangle":this.matrix=ev(o,s,{filled:a});break;default:throw new Error(`Shape: unexpected shape: ${i}`)}else if(r)switch(r.toLowerCase()){case"cross":this.matrix=Zy;break;case"smallcross":this.matrix=Hy;break;default:throw new Error(`Shape: unexpected kind: ${r}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let e=this.matrix,r=[];for(let i=0;i<e.length;i++)for(let n=0;n<e[0].length;n++)e[i][n]&&r.push([n-this.halfWidth,i-this.halfHeight]);return r}getMask(){let e=new F(this.width,this.height,{kind:rt});for(let r=0;r<this.matrix.length;r++)for(let i=0;i<this.matrix[0].length;i++)this.matrix[r][i]&&e.setBitXY(i,r);return e}};function Jy(t,e,r){let i=Xi(e,t);if(r.filled)for(let n=0;n<e;n++)for(let o=0;o<t;o++)i[n][o]=1;else{for(let n of[0,e-1])for(let o=0;o<t;o++)i[n][o]=1;for(let n=0;n<e;n++)for(let o of[0,t-1])i[n][o]=1}return i}function Qy(t,e,r){let i=Xi(e,t,r),n=1-e%2,o=1-t%2,s=Math.floor((t-1)/2),a=Math.floor((e-1)/2),h=s*s,l=a*a;if(r.filled)for(let f=0;f<=a;f++){let u=Math.floor(Math.sqrt(h-h*f*f/l));for(let c=s-u;c<=s;c++)i[a-f][c]=1,i[a+f+n][c]=1,i[a-f][t-c-1]=1,i[a+f+n][t-c-1]=1}else{for(let f=0;f<=a;f++){let u=Math.floor(Math.sqrt(h-h*f*f/l)),c=s-u;i[a-f][c]=1,i[a+f+n][c]=1,i[a-f][t-c-1]=1,i[a+f+n][t-c-1]=1}for(let f=0;f<=s;f++){let u=Math.floor(Math.sqrt(l-l*f*f/h)),c=a-u;i[c][s-f]=1,i[c][s+f+o]=1,i[e-c-1][s-f]=1,i[e-c-1][s+f+o]=1}}return i}function ev(t,e,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");let i=Xi(e,t,r);for(let n=0;n<e;n++){let o=Math.floor((1-n/e)*t/2);for(let s=o;s<t-o;s++)i[n][s]=1}return i}function oh(t,e={}){let{shape:r}=e;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let i=lr(Object.assign({},e,{numberColors:t.length})),n=new Tt(r).getPoints(),o=Math.min(this.channels,i[0].length);for(let s=0;s<t.length;s++){let a=i[s%i.length],h=t[s][0],l=t[s][1];for(let f=0;f<n.length;f++){let u=n[f][0],c=n[f][1];if(h+u>=0&&l+c>=0&&h+u<this.width&&l+c<this.height){let d=(h+u+(l+c)*this.width)*this.channels;for(let p=0;p<o;p++)this.data[d+p]=a[p]}}}return this}function sh(t,e={}){let{color:r=[this.maxValue,0,0],closed:i=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let n=Math.min(this.channels,r.length);for(let o=0;o<t.length-1+i;o++){let s=t[o],a=t[(o+1)%t.length],h=a[0]-s[0],l=a[1]-s[1],f=Math.max(Math.abs(h),Math.abs(l)),u=h/f,c=l/f,d=s[0],p=s[1];for(let g=0;g<=f;g++){let x=Math.round(d),m=Math.round(p);if(x>=0&&m>=0&&x<this.width&&m<this.height)if(this.bitDepth===1)this.setBitXY(x,m);else{let w=(x+m*this.width)*this.channels;for(let y=0;y<n;y++)this.data[w+y]=r[y]}d=d+u,p=p+c}}return this}function ah(t,e={}){let r=Object.assign({},e);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let i=lr(Object.assign({},e,{numberColors:t.length}));for(let n=0;n<t.length;n++)r.color=i[n%i.length],this.paintPolyline(t[n],r);return this}function lh(t,e={}){let{color:r=[this.maxValue,0,0],filled:i=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),e.closed=!0;let n=tv(t);if(i===!1)return this.paintPolyline(t,e);{let o=Array(this.height);for(let s=0;s<this.height;s++){o[s]=[];for(let a=0;a<this.width;a++)o[s].push(0)}for(let s=0;s<n.length;s++){let a=rv(n[s],n[(s+1)%n.length]);for(let h=0;h<this.height;h++)for(let l=0;l<this.width;l++)iv(l,h,a,this.height)&&(o[h][l]=o[h][l]===0?1:0)}for(let s=0;s<this.height;s++)for(let a=0;a<this.width;a++)if(o[s][a]===1)if(this.bitDepth===1)this.setBitXY(a,s);else{let h=Math.min(this.channels,r.length),l=(a+s*this.width)*this.channels;for(let f=0;f<h;f++)this.data[l+f]=r[f]}return this.paintPolyline(t,e)}}function tv(t){let e=[];for(let r=0;r<t.length;r++)if(!(t[r][0]===t[(r+1)%t.length][0]&&t[r][1]===t[(r+1)%t.length][1])){if(t[r][0]===t[(r-1+t.length)%t.length][0]&&t[r][1]===t[(r-1+t.length)%t.length][1])continue;if(t[(r+1)%t.length][0]===t[(r-1+t.length)%t.length][0]&&t[(r-1+t.length)%t.length][1]===t[(r+1)%t.length][1])continue;e.push(t[r])}return e}function rv(t,e){if(t[0]===e[0])return{a:0,b:t[0],vertical:!0};{let r=(e[1]-t[1])/(e[0]-t[0]),i=t[1]-r*t[0];return{a:r,b:i,vertical:!1}}}function iv(t,e,r,i){if(r.vertical===!0)return r.b<=t;if(r.a===0)return!1;{let n=(e-r.b)/r.a;return n<t&&n>=0&&n<=i}}function hh(t,e={}){let r=Object.assign({},e);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let i=lr(Object.assign({},e,{numberColors:t.length}));for(let n=0;n<t.length;n++)r.color=i[n%i.length],this.paintPolygon(t[n],r);return this}var e1=ve(ca()),t1=ve(Bt());function fh(t={}){let{maxSlots:e=256,channel:r,useAlpha:i=!0}=t;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}return r1.call(this,r,{useAlpha:i,maxSlots:e})}function uh(t={}){let{maxSlots:e=256,useAlpha:r=!0}=t;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let i=new Array(r?this.components:this.channels);for(let n=0;n<i.length;n++)i[n]=r1.call(this,n,{useAlpha:r,maxSlots:e});return i}function r1(t,e){let{useAlpha:r,maxSlots:i}=e;if(this.bitDepth===1){let h=[0,0];for(let l=0;l<this.height;l++)for(let f=0;f<this.width;f++){let u=this.getBitXY(l,f);u===0?h[0]+=1:u===1&&(h[1]+=1)}return h}let n=Math.log2(i);if(!(0,e1.default)(n))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let o=0;this.bitDepth>n&&(o=this.bitDepth-n);let s=this.data,a=(0,t1.default)(Math.pow(2,Math.min(this.bitDepth,n)),0);if(r&&this.alpha){let h=this.channels-t-1;for(let l=t;l<s.length;l+=this.channels)a[s[l]>>o]+=s[l+h]/this.maxValue}else for(let h=t;h<s.length;h+=this.channels)a[s[h]>>o]++;return a}var i1=ve(Bt());function Vn(t={}){let{useAlpha:e=!0,nbSlots:r=512}=t;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let i=Math.log(r)/Math.log(8);if(i!==Math.floor(i))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let n=this.bitDepth-i,o=this.data,s=(0,i1.default)(Math.pow(8,i),0),a=Math.pow(2,i*2),h=Math.pow(2,i);for(let l=0;l<o.length;l+=this.channels){let f=(o[l]>>n)*a+(o[l+1]>>n)*h+(o[l+2]>>n);e&&this.alpha?s[f]+=o[l+this.channels-1]/this.maxValue:s[f]++}return s}var n1=ve(Bt());function $n(){this.checkProcessable("min",{bitDepth:[8,16,32]});let t=(0,n1.default)(this.channels,1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)this.data[e+r]<t[r]&&(t[r]=this.data[e+r]);return t}var o1=ve(Bt());function Wn(){this.checkProcessable("max",{bitDepth:[8,16,32]});let t=(0,o1.default)(this.channels,-1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)this.data[e+r]>t[r]&&(t[r]=this.data[e+r]);return t}var s1=ve(Bt());function Kn(){this.checkProcessable("sum",{bitDepth:[8,16]});let t=(0,s1.default)(this.channels,0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)t[r]+=this.data[e+r];return t}function Zn(t=0,e=0){this.checkProcessable("getMoment",{bitDepth:[1]});let r=0;for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)this.getBitXY(i,n)===1&&(r+=i**t*n**e);return r}function ch(t={}){let{mask:e,region:r=3,removeClosePoints:i=0,invert:n=!1,maxEquals:o=2}=t,s=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),r*=4;let a=n?0:1,h=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],l=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],f=r<=8?1:2,u=[];for(let c=f;c<s.height-f;c++)for(let d=f;d<s.width-f;d++){if(e&&e.getBitXY(d,c)!==a)continue;let p=0,g=0,x=s.data[d+c*s.width];for(let m=0;m<r;m++)n?s.data[d+h[m]+(c+l[m])*s.width]>x&&p++:s.data[d+h[m]+(c+l[m])*s.width]<x&&p++,s.data[d+h[m]+(c+l[m])*s.width]===x&&g++;p+g===r&&g<=o&&u.push([d,c])}if(i>0)for(let c=0;c<u.length;c++)for(let d=c+1;d<u.length;d++)Math.sqrt(Math.pow(u[c][0]-u[d][0],2)+Math.pow(u[c][1]-u[d][1],2))<i&&(u[c][0]=u[c][0]+u[d][0]>>1,u[c][1]=u[c][1]+u[d][1]>>1,u.splice(d,1),d--);return u}function Hn(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let i=t[r];e[r]=ld(i)}return e}function Jn(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let i=t[r];e[r]=Mn(i)}return e}function Qn(){this.checkProcessable("points",{bitDepth:[1]});let t=[];for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.getBitXY(e,r)===1&&t.push([e,r]);return t}function eo(){this.checkProcessable("extendedPoints",{bitDepth:[1]});let t=[];for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)if(this.getBitXY(r,e)===1)for(t.push([r,e]),this.getBitXY(r+1,e)!==1?(t.push([r+1,e]),t.push([r+1,e+1]),this.getBitXY(r,e+1)!==1&&t.push([r,e+1])):this.getBitXY(r,e+1)!==1&&(t.push([r,e+1]),t.push([r+1,e+1]));r<this.width-2&&this.getBitXY(r+1,e)===1&&this.getBitXY(r+2,e)===1;)r++;return t}function dh(t,e={}){if(this===t)return[0,0];let r=[0,0],i=this;for(;i;){if(i===t)return r;i.position&&(r[0]+=i.position[0],r[1]+=i.position[1]),i=i.parent}return e.defaultFurther?r:!1}function ph(t={}){let{alpha:e=1}=t;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let r=0;if(e!==void 0){for(let i=this.components;i<this.data.length;i+=this.channels)this.data[i]===e&&r++;return r}else return this.size}function ji(t,e={}){let{sorted:r}=e;r||(t=t.slice().sort(nv));let i=t.length,n=new Array(i*2),o=0;for(let a=0;a<i;a++){let h=t[a];for(;o>=2&&a1(n[o-2],n[o-1],h)<=0;)o--;n[o++]=h}let s=o+1;for(let a=i-2;a>=0;a--){let h=t[a];for(;o>=s&&a1(n[o-2],n[o-1],h)<=0;)o--;n[o++]=h}return n.slice(0,o-1)}function a1(t,e,r){return(e[1]-t[1])*(r[0]-t[0])-(e[0]-t[0])*(r[1]-t[1])}function nv(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function Rr(){return ji(this.extendedPoints,{sorted:!1})}function l1(t){for(let e=0;e<t.length;e++)t[e][0]=Math.round(t[e][0]),t[e][1]=Math.round(t[e][1]);return t}function to(t,e){return[t[0]-e[0],t[1]-e[1]]}function ro(t){let e=Math.sqrt(t[0]**2+t[1]**2);return[t[0]/e,t[1]/e]}function ri(t,e,r){r===void 0&&(r=new Array(e.length));let i=Math.cos(t),n=Math.sin(t);for(let o=0;o<r.length;++o)r[o]=[i*e[o][0]-n*e[o][1],n*e[o][0]+i*e[o][1]];return r}function h1(t){let e=0;for(let r=0;r<t.length;r++){let i=t[r][0],n=t[r][1],o=t[r===t.length-1?0:r+1][0],s=t[r===t.length-1?0:r+1][1];e+=Math.sqrt((o-i)**2+(s-n)**2)}return e}function f1(t){let e=0;for(let r=0;r<t.length;r++){let i=t[r][0],n=t[r===t.length-1?0:r+1][1],o=t[r===t.length-1?0:r+1][0],s=t[r][1];e+=i*n*.5,e-=o*s*.5}return Math.abs(e)}function mh(t){let e=1/0,r=1/0,i=-1/0,n=-1/0;for(let o=0;o<t.length;o++)t[o][0]<e&&(e=t[o][0]),t[o][0]>i&&(i=t[o][0]),t[o][1]<r&&(r=t[o][1]),t[o][1]>n&&(n=t[o][1]);return[[e,r],[i,n]]}function u1(t,e){e===void 0&&(e=new Array(t.length).fill(0).map(()=>[]));let r=mh(t),i=r[0][0],n=r[0][1];for(let o=0;o<t.length;o++)e[o][0]=t[o][0]-i,e[o][1]=t[o][1]-n;return e}function Gi(t={}){let{originalPoints:e=Rr.call(this)}=t;if(e.length===0)return[];if(e.length===1)return[e[0],e[0],e[0],e[0]];let r=new Array(e.length),i=1/0,n=0,o;for(let s=0;s<r.length;s++){let a=ov(e[s],e[(s+1)%r.length]);ri(-a,e,r);let h=r[s][0],l=r[s][1],f=r[(s+1)%r.length][0],u=r[(s+1)%r.length][1],c=!0,d=0,p=0,g=0;for(let y=0;y<r.length;y++){let M=r[y][0],_=r[y][1],R=(M-h)/(f-h);c===!0?(c=!1,d=R,p=R):(R<d&&(d=R),R>p&&(p=R));let E=(-(f-h)*_+f*l-u*h)/(f-h);Math.abs(E)>Math.abs(g)&&(g=E)}let x=[h+d*(f-h),l],m=[h+p*(f-h),l],w=Math.abs(g*(d-p)*(f-h));w<i&&(n=a,i=w,o=[x,m,[m[0],m[1]-g],[x[0],x[1]-g]])}return ri(n,o,o),o}function ov(t,e){let r=to(e,t),i=ro(r),n=Math.acos(i[0]);return i[1]<0?-n:n}function gh(t){let e={inPlace:!0};t.extendMethod("invert",ta),t.extendMethod("abs",Qs),t.extendMethod("level",Ca,e),t.extendMethod("add",Pa,e),t.extendMethod("subtract",Ba,e),t.extendMethod("subtractImage",Ta),t.extendMethod("multiply",Fa,e),t.extendMethod("divide",Oa,e),t.extendMethod("hypotenuse",La),t.extendMethod("background",Ha),t.extendMethod("flipX",ra),t.extendMethod("flipY",ia),t.extendMethod("blurFilter",na),t.extendMethod("medianFilter",sa),t.extendMethod("gaussianFilter",aa),t.extendMethod("sobelFilter",Da),t.extendMethod("gradientFilter",Ar),t.extendMethod("scharrFilter",Ia),t.extendMethod("dilate",Ja),t.extendMethod("erode",Qa),t.extendMethod("open",el),t.extendMethod("close",tl),t.extendMethod("topHat",rl),t.extendMethod("blackHat",il),t.extendMethod("morphologicalGradient",nl),t.extendMethod("warpingFourPoints",ol),t.extendMethod("crop",sl),t.extendMethod("cropAlpha",al),t.extendMethod("resize",jn).extendMethod("scale",jn),t.extendMethod("hsv",hl),t.extendMethod("hsl",fl),t.extendMethod("cmyk",ul),t.extendMethod("rgba8",cl),t.extendMethod("grey",Gn).extendMethod("gray",Gn),t.extendMethod("mask",Il),t.extendMethod("pad",Cl),t.extendMethod("colorDepth",Pl),t.extendMethod("setBorder",Ol,e),t.extendMethod("rotate",zp),t.extendMethod("rotateLeft",Tl),t.extendMethod("rotateRight",Ll),t.extendMethod("insert",Fl),t.extendMethod("getRow",ql),t.extendMethod("getColumn",Vl),t.extendMethod("getMatrix",$l),t.extendMethod("setMatrix",Wl),t.extendMethod("getPixelsArray",Kl),t.extendMethod("getIntersection",Zl),t.extendMethod("getClosestCommonParent",Hl),t.extendMethod("getThreshold",Ni),t.extendMethod("split",Ul),t.extendMethod("getChannel",Nl),t.extendMethod("combineChannels",Yl),t.extendMethod("setChannel",zl),t.extendMethod("getSimilarity",Xl),t.extendMethod("getPixelsGrid",jl),t.extendMethod("getBestMatch",Gl),t.extendMethod("cannyEdge",Ql),t.extendMethod("convolution",or),t.extendMethod("extract",eh),t.extendMethod("floodFill",th),t.extendMethod("paintLabels",ih,e),t.extendMethod("paintMasks",nh,e),t.extendMethod("paintPoints",oh,e),t.extendMethod("paintPolyline",sh,e),t.extendMethod("paintPolylines",ah,e),t.extendMethod("paintPolygon",lh,e),t.extendMethod("paintPolygons",hh,e),t.extendMethod("countAlphaPixels",ph),t.extendMethod("monotoneChainConvexHull",Rr),t.extendMethod("minimalBoundingRectangle",Gi),t.extendMethod("getHistogram",fh).extendProperty("histogram",fh),t.extendMethod("getHistograms",uh).extendProperty("histograms",uh),t.extendMethod("getColorHistogram",Vn).extendProperty("colorHistogram",Vn),t.extendMethod("getMin",$n).extendProperty("min",$n),t.extendMethod("getMax",Wn).extendProperty("max",Wn),t.extendMethod("getSum",Kn).extendProperty("sum",Kn),t.extendMethod("getMoment",Zn).extendProperty("moment",Zn),t.extendMethod("getLocalMaxima",ch),t.extendMethod("getMedian",Jn).extendProperty("median",Jn),t.extendMethod("getMean",Hn).extendProperty("mean",Hn),t.extendMethod("getPoints",Qn).extendProperty("points",Qn),t.extendMethod("getExtendedPoints",eo).extendProperty("extendedPoints",eo),t.extendMethod("getRelativePosition",dh)}var P1=ve(c1());function bh(t,e=""){let r=e.split(".");for(let i of r){if(t[i]===void 0)return;t=t[i]}return t}var Eh=ve(A1());function Mh(t={}){let{originalPoints:e=Rr.call(this)}=t;if(e.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(e.length===1)return{min:1,max:1,minLine:[e[0],e[0]],maxLine:[e[0],e[0]],aspectRatio:1};let r=new Array(e.length),i=1/0,n=0,o=[];for(let l=0;l<e.length;l++){let f=Iv(e[l],e[(l+1)%e.length]);ri(-f,e,r);let u=0,c=[];for(let d=0;d<e.length;d++){let p=Math.abs(r[l][1]-r[d][1]);p>u&&(u=p,c=[],c.push([r[d][0],r[l][1]],[r[d][0],r[d][1]]))}u<i&&(i=u,n=f,o=c)}ri(n,o,o);let s=0,a=[],h=0;for(let l=0;l<e.length-1;l++)for(let f=l+1;f<e.length;f++){let u=(e[l][0]-e[f][0])**2+(e[l][1]-e[f][1])**2;u>h&&(h=u,s=Math.sqrt(u),a=[e[l],e[f]])}return{min:i,minLine:o,max:s,maxLine:a,aspectRatio:i/s}}function Iv(t,e){let r=to(e,t),i=ro(r),n=Math.acos(i[0]);return i[1]<0?-n:n}var qi=class{constructor(e,r){this.map=e,this.id=r,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(e={}){let{scale:r=1,kind:i=""}=e,n;switch(i){case"contour":n=this.contourMask;break;case"box":n=this.boxMask;break;case"filled":n=this.filledMask;break;case"center":n=this.centerMask;break;case"mbr":n=this.mbrFilledMask;break;case"hull":n=this.convexHullFilledMask;break;case"hullContour":n=this.convexHullMask;break;case"mbrContour":n=this.mbrMask;break;case"feret":n=this.feretMask;break;default:n=this.mask}return r<1&&(n=n.resize({factor:r}),n.parent=this.mask.parent,n.position[0]+=this.minX,n.position[1]+=this.minY),n}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let e=this.borderIDs,r=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let i=this.internalIDs;for(let n=0;n<e.length;n++)i.includes(e[n])||(this.computed.externalIDs.push(e[n]),this.computed.externalLengths.push(r[n]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let e=Rv(this);this.computed.borderIDs=e.ids,this.computed.borderLengths=e.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=Cv(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=Ov(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=Pv(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=Lv(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=Fv(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=Bv(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let e=new F(this.width,this.height,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let i=0;i<this.height;i++)this.map.data[r+this.minX+(i+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&i>0&&i<this.height-1?(this.map.data[r-1+this.minX+(i+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(i+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(i-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(i+1+this.minY)*this.map.width]!==this.id)&&e.setBitXY(r,i):e.setBitXY(r,i));this.computed.contourMask=e}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let e=new F(this.width,this.height,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)e.setBitXY(r,0),e.setBitXY(r,this.height-1);for(let r=0;r<this.height;r++)e.setBitXY(0,r),e.setBitXY(this.width-1,r);this.computed.boxMask=e}return this.computed.boxMask}get mask(){if(!this.computed.mask){let e=new F(this.width,this.height,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let i=0;i<this.height;i++)this.map.data[r+this.minX+(i+this.minY)*this.map.width]===this.id&&e.setBitXY(r,i);this.computed.mask=e}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let e=new F(this.width,this.height,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let i=0;i<this.height;i++){let n=r+this.minX+(i+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[n])&&e.setBitXY(r,i)}this.computed.filledMask=e}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let e=new Tt({kind:"smallCross"}).getMask();e.parent=this.map.parent,e.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=e}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){let e=[];for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)this.map.data[i+this.minX+(n+this.minY)*this.map.width]===this.id&&(i>0&&i<this.width-1&&n>0&&n<this.height-1?(this.map.data[i-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[i+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[i+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[i+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&(e.push([i,n]),e.push([i+1,n]),e.push([i,n+1]),e.push([i+1,n+1])):(e.push([i,n]),e.push([i+1,n]),e.push([i,n+1]),e.push([i+1,n+1])));let r=ji(e);this.computed.convexHull={polyline:r,surface:f1(r),perimeter:h1(r)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){let e=this.convexHull,r=new F(this.width+1,this.height+1,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(e.polyline,{closed:!0}),this.computed.convexHullMask=r}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){let e=this.convexHull,r=new F(this.width,this.height,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)(0,Eh.default)(e.polyline,[i,n])!==1&&r.setBitXY(i,n);this.computed.convexHullFilledMask=r}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let e=Gi({originalPoints:this.convexHull.polyline});if(e.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:e};else{let r=e[0],i=e[1],n=e[2],o=Math.sqrt((r[0]-i[0])**2+(r[1]-i[1])**2),s=Math.sqrt((n[0]-i[0])**2+(n[1]-i[1])**2);this.computed.mbr={width:o,height:s,elongation:1-o/s,aspectRatio:o/s,surface:o*s,perimeter:(o+s)*2,rectangle:e}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=Mh({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=Tv(this)),this.computed.perimeterInfo}get perimeter(){let e=this.perimeterInfo,r=2-Math.sqrt(2);return e.one+e.two*2+e.three*3+e.four*4-r*(e.two+e.three*2+e.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){let e=new F(this.width+1,this.height+1,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(this.feretDiameters.minLine),e.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=e}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let e=l1(this.mbr.rectangle);if(e.length>0){let r=mh(e),i=new F(r[1][0]-r[0][0]+1,r[1][1]-r[0][1]+1,{kind:rt,position:[this.minX+r[0][0],this.minY+r[0][1]],parent:this.map.parent});e=u1(e),i.paintPolyline(e,{closed:!0}),this.computed.mbrMask=i}else this.computed.mbrMask=new F(1,1,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){let e=new F(this.width,this.height,{kind:rt,position:[this.minX,this.minY],parent:this.map.parent}),r=this.mask.minimalBoundingRectangle();for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)(0,Eh.default)(r,[i,n])!==1&&e.setBitXY(i,n);this.computed.mbrFilledMask=e}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let e=[];for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++){let n=(r+this.minY)*this.map.width+i+this.minX;this.map.data[n]===this.id&&e.push([i,r])}this.computed.points=e}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let e=0,r,i=this.points;for(let n=0;n<i.length;n++)for(let o=n+1;o<i.length;o++){let s=Math.pow(i[n][0]-i[o][0],2)+Math.pow(i[n][1]-i[o][1],2);s>=e&&(e=s,r=[i[n],i[o]])}this.computed.maxLengthPoints=r}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let e=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=e}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let e=this.maxLengthPoints,r=-Math.atan2(e[0][1]-e[1][1],e[0][0]-e[1][0])*180/Math.PI;this.computed.angle=r}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}};function Rv(t){let e=t.map,r=e.data,i=new Set,n=new Map,o=new Set,s=[1,0,-1,0],a=[0,1,0,-1];for(let f=t.minX;f<=t.maxX;f++)for(let u=t.minY;u<=t.maxY;u++){let c=f+u*e.width;if(r[c]===t.id)for(let d=0;d<4;d++){let p=f+s[d],g=u+a[d];if(p>=0&&g>=0&&p<e.width&&g<e.height){let x=p+g*e.width;if(r[x]!==t.id&&!o.has(x)){o.add(x),i.add(r[x]);let m=n.get(r[x]);m?n.set(r[x],++m):n.set(r[x],1)}}}}let h=Array.from(i),l=h.map(function(f){return n.get(f)});return{ids:h,lengths:l}}function Cv(t){let e=new Set,r=t.map,i=r.data;for(let n of[0,t.height-1])for(let o=0;o<t.width;o++){let s=(n+t.minY)*r.width+o+t.minX;if(o-t.minX>0&&i[s]===t.id&&i[s-1]!==t.id){let a=i[s-1];e.add(a)}if(r.width-o-t.minX>1&&i[s]===t.id&&i[s+1]!==t.id){let a=i[s+1];e.add(a)}}for(let n of[0,t.width-1])for(let o=0;o<t.height;o++){let s=(o+t.minY)*r.width+n+t.minX;if(o-t.minY>0&&i[s]===t.id&&i[s-r.width]!==t.id){let a=i[s-r.width];e.add(a)}if(r.height-o-t.minY>1&&i[s]===t.id&&i[s+r.width]!==t.id){let a=i[s+r.width];e.add(a)}}return Array.from(e)}function Pv(t){let e=0,r=t.map,i=r.data,n=[0];t.height>1&&(n[1]=t.height-1);for(let s of n)for(let a=1;a<t.width-1;a++){let h=(s+t.minY)*r.width+a+t.minX;i[h]===t.id&&e++}let o=[0];t.width>1&&(o[1]=t.width-1);for(let s of o)for(let a=0;a<t.height;a++){let h=(a+t.minY)*r.width+s+t.minX;i[h]===t.id&&e++}return e}function Bv(t){let e=0,r=t.map,i=r.data;for(let n=1;n<t.width-1;n++)for(let o=1;o<t.height-1;o++){let s=(o+t.minY)*r.width+n+t.minX;i[s]===t.id&&(i[s-1]!==t.id||i[s+1]!==t.id||i[s-r.width]!==t.id||i[s+r.width]!==t.id)&&e++}return e+t.box}function Tv(t){let e=t.map,r=e.data,i=0,n=0,o=0,s=0;for(let a=0;a<t.width;a++)for(let h=0;h<t.height;h++){let l=(h+t.minY)*e.width+a+t.minX;if(r[l]===t.id){let f=0;switch((a===0||t.externalIDs.includes(r[l-1]))&&f++,(a===t.width-1||t.externalIDs.includes(r[l+1]))&&f++,(h===0||t.externalIDs.includes(r[l-e.width]))&&f++,(h===t.height-1||t.externalIDs.includes(r[l+e.width]))&&f++,f){case 1:i++;break;case 2:n++;break;case 3:o++;break;case 4:s++;break;default:}}}return{one:i,two:n,three:o,four:s}}function Lv(t){let e=0,r=t.map,i=r.data;for(let n=1;n<t.width-1;n++)for(let o=1;o<t.height-1;o++){let s=(o+t.minY)*r.width+n+t.minX;i[s]===t.id&&(t.externalIDs.includes(i[s-1])||t.externalIDs.includes(i[s+1])||t.externalIDs.includes(i[s-r.width])||t.externalIDs.includes(i[s+r.width]))&&e++}return e+t.box}function Fv(t){let e=0,r=t.map.width,i=t.map.data;for(let n=1;n<t.width-1;n++)for(let o=1;o<t.height-1;o++){let s=(o+t.minY)*r+n+t.minX;t.internalIDs.includes(i[s])&&i[s]!==t.id&&e++}return{number:t.internalIDs.length-1,surface:e}}function Ov(t){let e=[t.id],r=t.map,i=r.data;if(t.height>2)for(let o=0;o<t.width;o++){let s=t.minY*r.width+o+t.minX;if(e.includes(i[s])){let a=i[s+r.width];!e.includes(a)&&!t.boxIDs.includes(a)&&e.push(a)}}let n=new Array(4);for(let o=1;o<t.width-1;o++)for(let s=1;s<t.height-1;s++){let a=(s+t.minY)*r.width+o+t.minX;if(e.includes(i[a])){n[0]=i[a-1],n[1]=i[a+1],n[2]=i[a-r.width],n[3]=i[a+r.width];for(let h=0;h<4;h++){let l=n[h];!e.includes(l)&&!t.boxIDs.includes(l)&&e.push(l)}}}return e}var Lt=class{constructor(e,r){this.roiMap=e,this.options=r,this.roi=this.createRoi()}createRoi(){let e=this.roiMap.data,r={};this.roiMap.positive=0,this.roiMap.negative=0;for(let a=0;a<e.length;a++)e[a]&&!r[e[a]]&&(r[e[a]]=!0,e[a]>0?this.roiMap.positive++:this.roiMap.negative++);let i={};for(let a in r)i[a]=new qi(this.roiMap,a*1);let n=this.roiMap.width,o=this.roiMap.height;for(let a=0;a<o;a++)for(let h=0;h<n;h++){let l=a*n+h;if(e[l]!==0){let f=e[l],u=i[f];h<u.minX&&(u.minX=h),h>u.maxX&&(u.maxX=h),a<u.minY&&(u.minY=a),a>u.maxY&&(u.maxY=a),u.meanX+=h,u.meanY+=a,u.surface++}}let s=[];for(let a in r)i[a].meanX/=i[a].surface,i[a].meanY/=i[a].surface,s.push(i[a]);return s}};function kh(t){let e=t.data,r=[1,0,-1,0],i=[0,1,0,-1],n=t.minMax,o=-n.min,s=n.max+o,a=[];for(let l=0;l<=s;l++)a.push(Object.create(null));for(let l=0;l<t.width;l++)for(let f=0;f<t.height;f++){let u=l+f*t.width,c=e[u];if(c!==0){let d=Object.create(null),p=!1;for(let g=0;g<4;g++){let x=l+r[g],m=f+i[g];if(x>=0&&m>=0&&x<t.width&&m<t.height){let w=e[x+m*t.width];c!==w&&(p=!0,w!==0&&d[w]===void 0&&(d[w]=!0,a[w+o][c]?a[w+o][c]++:a[w+o][c]=1))}else p=!0}p&&(a[c+o][c]?a[c+o][c]++:a[c+o][c]=1)}}let h={};for(let l=0;l<a.length;l++)Object.keys(a[l]).length>0&&(h[l-o]=a[l]);return h}function Ah(t={}){let{algorithm:e="commonBorderLength",minCommonBorderLength:r=5,maxCommonBorderLength:i=100,minCommonBorderRatio:n=.3,maxCommonBorderRatio:o=1}=t,s=function(x,m,w){return x[w]>=r&&x[w]<=i};typeof e=="function"&&(s=e),e.toLowerCase()==="commonborderratio"&&(s=function(x,m,w){let y=Math.min(x[w]/x[m],1);return y>=n&&y<=o});let a=this,h=a.commonBorderLength,l={},f={};for(let x of Object.keys(h)){let m=h[x],w=Object.keys(m);for(let y of w)if(y!==x&&s(m,x,y)){let M=y;f[y]&&(M=f[y]);let _=x;if(f[x]&&(_=f[x]),Number(M)!==_){let R=Math.min(M,_),E=Math.max(M,_);if(l[R]||(l[R]={}),l[R][E]=!0,f[E]=R,l[E]){for(let A of Object.keys(l[E]))l[R][A]=!0,f[A]=R;delete l[E]}}}}let u=a.minMax,c=-u.min,d=u.max+c,p=new Array(d+1).fill(0);for(let x of Object.keys(f))p[Number(x)+c]=f[x];let g=a.data;for(let x=0;x<g.length;x++){let m=g[x];if(m!==0){let w=p[m+c];w!==0&&(g[x]=w)}}return a.computed={},a}var nt=class{constructor(e,r){this.parent=e,this.width=e.width,this.height=e.height,this.data=r,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let e=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let i=0;i<this.data.length;i++)this.data[i]<e&&(e=this.data[i]),this.data[i]>r&&(r=this.data[i]);return{min:e,max:r}}get commonBorderLength(){return kh(this)}mergeRoi(e={}){return Ah.call(this,e)}mergeRois(e){let r=e[0],i=e.slice(1);for(let n=0;n<this.data.length;n++)i.includes(this.data[n])&&(this.data[n]=r)}rowsInfo(){let e=new Array(this.height),r=0;for(let i=0;i<this.data.length;i+=this.width){let n={row:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};e[r++]=n;let o={},s={},a=[],h=this.data[i],l=0;for(let f=i;f<i+this.width;f++){let u=this.data[f];h!==u&&(h=u,a.push(l),l=0),l++,u>0?(n.positivePixel++,o[u]||(o[u]=!0)):u<0?(n.negativePixel++,s[u]||(s[u]=!0)):n.zeroPixel++}a.push(l),n.medianChange=a.sort((f,u)=>f-u)[Math.floor(a.length/2)],n.positiveRoiIDs=Object.keys(o),n.negativeRoiIDs=Object.keys(s),n.positiveRoi=n.positiveRoiIDs.length,n.negativeRoi=n.negativeRoiIDs.length}return e}colsInfo(){let e=new Array(this.width),r=0;for(let i=0;i<this.width;i++){let n={col:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};e[r++]=n;let o={},s={},a=[],h=this.data[i],l=0;for(let f=i;f<i+this.data.length;f+=this.width){let u=this.data[f];h!==u&&(h=u,a.push(l),l=0),l++,u>0?(n.positivePixel++,o[u]||(o[u]=!0)):u<0?(n.negativePixel++,s[u]||(s[u]=!0)):n.zeroPixel++}a.push(l),n.medianChange=a.sort((f,u)=>f-u)[Math.floor(a.length/2)],n.positiveRoiIDs=Object.keys(o),n.negativeRoiIDs=Object.keys(s),n.positiveRoi=n.positiveRoiIDs.length,n.negativeRoi=n.negativeRoiIDs.length}return e}};function Sh(t,e={}){let{allowCorners:r=!1}=e,i=65535,n=new Int16Array(t.size),o=0,s=0,a=new Uint16Array(i+1),h=new Uint16Array(i+1);for(let f=0;f<t.width;f++)for(let u=0;u<t.height;u++)n[u*t.width+f]===0&&l(f,u);function l(f,u){let c=0,d=0,p=t.getBitXY(f,u),g=p?++o:--s;if(o>32767||s<-32768)throw new Error("Too many regions of interest");for(a[0]=f,h[0]=u;c<=d;){let x=a[c&i],m=h[c&i];if(n[m*t.width+x]=g,x>0&&n[m*t.width+x-1]===0&&t.getBitXY(x-1,m)===p&&(d++,a[d&i]=x-1,h[d&i]=m,n[m*t.width+x-1]=-32768),m>0&&n[(m-1)*t.width+x]===0&&t.getBitXY(x,m-1)===p&&(d++,a[d&i]=x,h[d&i]=m-1,n[(m-1)*t.width+x]=-32768),x<t.width-1&&n[m*t.width+x+1]===0&&t.getBitXY(x+1,m)===p&&(d++,a[d&i]=x+1,h[d&i]=m,n[m*t.width+x+1]=-32768),m<t.height-1&&n[(m+1)*t.width+x]===0&&t.getBitXY(x,m+1)===p&&(d++,a[d&i]=x,h[d&i]=m+1,n[(m+1)*t.width+x]=-32768),r&&(x>0&&m>0&&n[(m-1)*t.width+x-1]===0&&t.getBitXY(x-1,m-1)===p&&(d++,a[d&i]=x-1,h[d&i]=m-1,n[(m-1)*t.width+x-1]=-32768),x<t.width-1&&m>0&&n[(m-1)*t.width+x+1]===0&&t.getBitXY(x+1,m-1)===p&&(d++,a[d&i]=x+1,h[d&i]=m-1,n[(m-1)*t.width+x+1]=-32768),x>0&&m<t.height-1&&n[(m+1)*t.width+x-1]===0&&t.getBitXY(x-1,m+1)===p&&(d++,a[d&i]=x-1,h[d&i]=m+1,n[(m+1)*t.width+x-1]=-32768),x<t.width-1&&m<t.height-1&&n[(m+1)*t.width+x+1]===0&&t.getBitXY(x+1,m+1)===p&&(d++,a[d&i]=x+1,h[d&i]=m+1,n[(m+1)*t.width+x+1]=-32768)),c++,d-c>i)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new nt(t,n)}var I1=ve(D1());var Nv=[-1,0],Yv=[0,-1],zv=[null,null],Xv=[-1,-1,0,1],jv=[0,-1,-1,-1],Gv=[null,null,null,null];function Ih(t,e={}){let{allowCorners:r=!1}=e,i=4;r&&(i=8);let n,o,s;if(i===8)n=Xv,o=jv,s=Gv;else if(i===4)n=Nv,o=Yv,s=zv;else throw new RangeError(`unsupported neighbours count: ${i}`);let a=t.size,h=t.width,l=t.height,f=new Array(a),u=new Uint32Array(a),c=new I1.default,d=1;for(let p=0;p<l;p++)for(let g=0;g<h;g++){let x=g+p*h;if(t.getBit(x)){let m=null;for(let w=0;w<s.length;w++){let y=g+n[w],M=p+o[w];if(y>=0&&M>=0&&y<h&&M<l){let _=y+M*h,R=f[_];R?(s[w]=R,(!m||s[w].value<m.value)&&(m=s[w])):s[w]=null}}if(!m)f[x]=c.add(d++);else{f[x]=m;for(let w=0;w<s.length;w++)s[w]&&s[w]!==m&&c.union(m,s[w])}}}for(let p=0;p<l;p++)for(let g=0;g<h;g++){let x=g+p*h;t.getBit(x)&&(u[x]=c.find(f[x]).value)}return new nt(t,u)}function Rh(t={}){let{allowCorner:e=!0,onlyTop:r=!1,invert:i=!1}=t,n=this;n.checkProcessable("fromMaxima",{components:[1]});let o=1,s=2,a=0,h=0,l=new Int16Array(n.size),f=new Int8Array(n.size),u=new Float32Array(n.size),c=1048575,d=new Uint16Array(c+1),p=new Uint16Array(c+1),g=0,x=0,m=new Uint16Array(c+1),w=new Uint16Array(c+1),y=0,M=0;for(_(n,{maxima:!i});g<x;){let A=d[g&c],I=p[g&c];E(A,I,s),g++}return new nt(n,l);function _({maxima:A=!0}){for(let I=1;I<n.height-1;I++)for(let b=1;b<n.width-1;b++){let k=b+I*n.width;if(f[k]===0){let B=A?n.data[k]:-n.data[b+I*n.width];if(n.data[I*n.width+b-1]>B||n.data[I*n.width+b+1]>B||n.data[(I-1)*n.width+b]>B||n.data[(I+1)*n.width+b]>B||e&&(n.data[(I-1)*n.width+b-1]>B||n.data[(I-1)*n.width+b+1]>B||n.data[(I+1)*n.width+b-1]>B||n.data[(I+1)*n.width+b+1]>B))continue;l[k]=A?++a:--h,R(b,I,o)||(A?--a:++h)}}}function R(A,I){let b=x;y=0,M=1,m[0]=A,w[0]=I;let k=!0;for(;y<M;){let B=m[y&c],S=w[y&c];k&=E(B,S,o),y++}if(!k){for(let B=0;B<M;B++){let S=m[B&c],L=w[B&c]*n.width+S;l[L]=0}x=b}return k}function E(A,I,b){let k=l[I*n.width+A],B=n.data[I*n.width+A];for(let S=I-1;S<=I+1;S++)for(let j=A-1;j<=A+1;j++){let L=S*n.width+j;if(f[L]===0)switch(f[L]=1,u[L]=n.data[L]-B,b){case o:if(u[L]===0){if(j===0||S===0||j===n.width-1||S===n.height-1)return!1;l[L]=k,m[M&c]=j,w[M&c]=S,M++}else{if(u[L]>0)return!1;r||(l[L]=k,d[x&c]=j,p[x&c]=S,x++)}break;case s:u[L]<=0&&(l[L]=k,d[x&c]=j,p[x&c]=S,x++);break;default:throw new Error("unreachable")}}return!0}}function Ch(t,e={}){let r=new Tt(e),i=new Int16Array(this.size),n=0,o=r.getPoints();for(let s=0;s<t.length;s++){n++;let a=t[s][0],h=t[s][1];for(let l=0;l<o.length;l++){let f=o[l][0],u=o[l][1];a+f>=0&&h+u>=0&&a+f<this.width&&h+u<this.height&&(i[a+f+(h+u)*this.width]=n)}}return new nt(this,i)}var Lh=ve(C1());var Bh=[1,0,-1,0,1,1,-1,-1],Th=[0,1,0,-1,1,-1,1,-1];function Fh(t={}){let{points:e,mask:r,image:i,fillMaxValue:n=this.maxValue,invert:o=!1}=t,s=i||this;s.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),o=!o,e||(e=s.getLocalMaxima({invert:o,mask:r}));let a=o?0:1,h=new Int16Array(s.size),l=s.width,f=s.height,u=new Lh.default({comparator:(c,d)=>c[2]-d[2],strategy:Lh.default.BinaryHeapStrategy});for(let c=0;c<e.length;c++){let d=e[c][0]+e[c][1]*l;h[d]=c+1;let p=s.data[d];(o&&p<=n||!o&&p>=n)&&u.queue([e[c][0],e[c][1],p])}for(;u.length>0;){let c=u.dequeue(),d=c[0]+c[1]*l;for(let p=0;p<4;p++){let g=c[0]+Bh[p],x=c[1]+Th[p];if(g>=0&&x>=0&&g<l&&x<f){let m=g+x*l;if(!r||r.getBit(m)===a){let w=s.data[m];(o&&w<=n||!o&&w>=n)&&h[m]===0&&(h[m]=h[d],u.queue([c[0]+Bh[p],c[1]+Th[p],w]))}}}}return new nt(s,h)}var Vi=class{constructor(e,r={}){this._image=e,this._options=r,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(e={}){let r=Object.assign({},this._options,e),i=Rh.call(this._image,e);this._layers[r.label]=new Lt(i,r)}fromPoints(e,r={}){let i=Object.assign({},this._options,r),n=Ch.call(this._image,e,r);return this._layers[i.label]=new Lt(n,i),this}putMap(e,r={}){let i=new nt(this._image,e),n=Object.assign({},this._options,r);return this._layers[n.label]=new Lt(i,n),this}fromWaterShed(e={}){let r=Object.assign({},this._options,e),i=Fh.call(this._image,e);this._layers[r.label]=new Lt(i,r)}fromMask(e,r={}){let i=Object.assign({},this._options,r),n=Sh.call(this._image,e,r);return this._layers[i.label]=new Lt(n,i),this}fromMaskConnectedComponentLabelingAlgorithm(e,r={}){let i=Object.assign({},this._options,r),n=Ih.call(this._image,e,r);return this._layers[i.label]=new Lt(n,i),this}getMap(e={}){let r=Object.assign({},this._options,e);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap}rowsInfo(e={}){return this.getMap(e).rowsInfo()}colsInfo(e={}){return this.getMap(e).rowsInfo()}getRoiIds(e={}){let r=this.getRois(e);if(r){let i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=r[n].id;return i}throw new Error("ROIs not found")}getRois(e={}){let{label:r=this._options.label,positive:i=!0,negative:n=!0,minSurface:o=0,maxSurface:s=Number.POSITIVE_INFINITY,minWidth:a=0,maxWidth:h=Number.POSITIVE_INFINITY,minHeight:l=0,maxHeight:f=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:c=Number.POSITIVE_INFINITY}=e;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);let d=this._layers[r].roi,p=[];for(let g of d)(g.id<0&&n||g.id>0&&i)&&g.surface>=o&&g.surface<=s&&g.width>=a&&g.width<=h&&g.height>=l&&g.height<=f&&g.ratio>=u&&g.ratio<=c&&p.push(g);return p}getRoi(e,r={}){let{label:i=this._options.label}=r;if(!this._layers[i])throw new Error(`this Roi layer (${i}) does not exist`);let n=this._layers[i].roi.find(o=>o.id===e);if(!n)throw new Error(`found no Roi with id ${e}`);return n}getMasks(e={}){let r=this.getRois(e),i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=r[n].getMask(e);return i}getAnalysisMasks(e={}){let{analysisProperty:r}=e,i=`${r}Mask`,n=this.getRois(e);return n.length===0||!n[0][i]?[]:n.map(o=>o[i])}getData(e={}){let r=Object.assign({},this._options,e);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap.data}paint(e={}){let{labelProperty:r,analysisProperty:i}=e;this._painted||(this._painted=this._image.rgba8());let n=this.getMasks(e);if(r){let o=this.getRois(e);e.labels=o.map(l=>bh(l,r));let s=Math.max(...e.labels),a=!1,h=!1;if(r.includes("surface")?a=!0:/(?:perimeter|min|max|external|width|height|length)/.test(r)&&(h=!0),isFinite(s)){let l="";if(e.unit!=="pixel"&&e.pixelSize&&(h||a)){l=a?`${e.unit}^2`:e.unit;let f=a?"m^2":"m",u=a?e.pixelSize**2:e.pixelSize,c=P1.default.swiftConverter(f,l);e.labels=e.labels.map(d=>c(u*d))}s>50?e.labels=e.labels.map(f=>Math.round(f)+l):s>10?e.labels=e.labels.map(f=>f.toFixed(1)+l):e.labels=e.labels.map(f=>f.toFixed(2)+l)}e.labelsPosition=o.map(l=>[l.meanX,l.meanY])}if(this._painted.paintMasks(n,e),i){let o=this.getAnalysisMasks(e);this._painted.paintMasks(o,{color:e.analysisColor,alpha:e.analysisAlpha})}return this._painted}getMask(e={}){let r=new F(this._image.width,this._image.height,{kind:"BINARY"}),i=this.getMasks(e);for(let n=0;n<i.length;n++){let o=i[n];for(let s=0;s<o.width;s++)for(let a=0;a<o.height;a++)o.getBitXY(s,a)&&r.setBitXY(s+o.position[0],a+o.position[1])}return r}resetPainted(e={}){let{image:r}=e;r?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(e={}){let r=this.getMap(e);return r.mergeRoi(e),this.putMap(r.data,e),this}mergeRois(e,r={}){if(!Array.isArray(e)||e.some(n=>!Number.isInteger(n)))throw new Error("Roi ids must be an array of integers");if(e.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(e).size!==e.length)throw new Error("Roi ids must be all different");e.forEach(n=>this.getRoi(n));let i=this.getMap(r);return i.mergeRois(e),this.putMap(i.data,r),this}findCorrespondingRoi(e,r={}){let i=this.getRois(r),n=[];for(let o=0;o<i.length;o++){let s=i[o],a=s.minX,h=s.minY,l=s.points,f=Math.sign(s.id),u=qv(a,h,l,e,f);n.push(u)}return n}_assertLayerWithLabel(e){if(!this._layers[e])throw new Error(`no layer with label ${e}`)}};function qv(t,e,r,i,n){let o={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let s=0;s<r.length;s++){let a=r[s],h=a[0],l=a[1],f=h+t+(l+e)*i.width,u=i.data[f];(u>0||u<0)&&(o.id.includes(u)?o.surface[o.id.indexOf(u)]+=1:(o.id.push(u),o.surface.push(1)))}for(let s=0;s<o.id.length;s++)Math.sign(o.id[s])===n?o.same+=o.surface[s]:o.opposite+=o.surface[s],o.roiSurfaceCovered[s]=o.surface[s]/r.length;return o.total=o.opposite+o.same,o}var Vv=Object.prototype.toString,F=class t{constructor(e,r,i,n){if(arguments.length===1?(n=e,{width:e,height:r,data:i}=n):i&&!i.length&&(n=i,{data:i}=n),e===void 0&&(e=1),r===void 0&&(r=1),n===void 0&&(n={}),typeof n!="object"||n===null)throw new TypeError("options must be an object");if(!Number.isInteger(e)||e<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new RangeError("height must be a positive integer");let{kind:o=_n}=n;if(typeof o!="string")throw new TypeError("kind must be a string");let s=ac(o),a=Object.assign({},n);for(let g in s)a[g]===void 0&&(a[g]=s[g]);lc(a);let{components:h,bitDepth:l,colorModel:f}=a,u=a.alpha+0,c=e*r,d=h+u,p=l===32?Number.MAX_VALUE:2**l-1;if(i===void 0)i=fc(c,h,u,d,l,p);else{let g=hc(c,d,l);if(i.length!==g)throw new RangeError(`incorrect data size: ${i.length}. Should be ${g}`)}this.width=e,this.height=r,this.data=i,this.size=c,this.components=h,this.alpha=u,this.bitDepth=l,this.maxValue=p,this.colorModel=f,this.channels=d,this.meta=n.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:n.parent||null}),this.position=n.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(e){return Vv.call(e)==="[object IJSImage]"}static fromCanvas(e){let i=e.getContext("2d").getImageData(0,0,e.width,e.height);return new t(i.width,i.height,i.data)}static createFrom(e,r){let i=Er(e);return Object.assign(i,{parent:e,position:[0,0]},r),new t(i)}getRoiManager(e){return new Vi(this,e)}clone(){let e=this.data.slice();return new t(this.width,this.height,e,this)}apply(e){for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++){let n=(r*this.width+i)*this.channels;e.call(this,n)}}};Hs(F);_o(F);us(F);F.prototype.checkProcessable=Mo;F.prototype.getRGBAData=ps;F.load=Zs;F.extendMethod=J0;F.extendProperty=Q0;gh(F);var Nh=ve(O1());var Zv={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function Hv(t,e,r){e=Object.assign({},Zv,e);let i=this.manager;return Array.isArray(t)?Promise.all(t.map(function(n){let o=U1(i,n,e);return typeof r=="function"&&o.then(r),o})):U1(i,t,e)}function U1(t,e,r){return t.post("data",[e,r]).then(function(i){for(let n in i)i[n]=new F(i[n]);return i})}function Jv(){worker.on("data",function(t,e,r){e=new IJS(e);let i={},n=[],o=e.grey(),s=o.sobelFilter();d("sobel",s);let a=s.level().mask({threshold:r.threshold});d("mask",a);let h=s.getRoiManager();h.fromMask(a);let l=h.getMask(r.roi);d("realMask",l);let f=o.getPixelsGrid({sampling:r.sampling,mask:l}),u=e.getBackground(f.xyS,f.zS,r.regression);d("background",u);let c=e.subtract(u);i.result=c,n.push(c.data.buffer),t(i,n);function d(p,g){r.include.includes(p)&&(i[p]=g,n.push(g.data.buffer))}})}var Qv={run:Hv,work:Jv},N1=Qv;function Uh(t){t.extendMethod("background",N1)}var so=class t{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(e){if(typeof e!="string")throw new TypeError("worker URL must be a string");this._url=e,this._deps[0]=e}static extendMethod(e,r){let i,n,o={};function s(...a){return i||(this.checkUrl(),n=this.url,i=new Nh.default(r.work,{deps:n}),o.manager=i),r.run.call(o,...a)}s.reset=function(){i&&(i.terminate(),i=new Nh.default(r.work,{deps:n}),o.manager=i)},t.prototype[e]=s}};Uh(so);var e_=new so;})();
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=index.js.map
